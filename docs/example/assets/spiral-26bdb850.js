import{J as Jn,K as Qn,L as es,S as ts,M as ns,N as ss,O as rs,P as as,Q as is,T as cs,U as os,V as us,W as ls,X as ds,Y as hs,Z as fs,_ as _s,$ as ms,a0 as ee,a1 as te,a2 as xt,a3 as Nt,a4 as ps,a5 as mt,a6 as _e,a7 as Es,a8 as Cs,a9 as Ss,D as Wt,aa as bs,ab as gs,ac as Ps,ad as Ut,ae as vs,q as c,af as h,ag as Os,ah as b,ai as H,aj as ys,ak as ks,al as l,am as ws,an as Is,ao as O,ap as v,aq as Le,ar as me,as as P,at as d,au as j,av as it,aw as R,ax as p,ay as pt,az as z,z as f,aA as I,aB as T,aC as we,aD as Ie,aE as Ee,aF as Et,aG as Ds,aH as ve,aI as Oe,aJ as Ze,aK as ye,aL as pe,aM as D,aN as Mt,aO as $s,aP as Ct,aQ as Ts,aR as Fs,aS as y,aT as Xe,aU as x,aV as Me,aW as jt,aX as Rs,aY as Ls,aZ as As,a_ as zs,a$ as xs,b0 as Ns,b1 as Ws,b2 as Us,b3 as Ms,b4 as js,b5 as Te,b6 as qs,b7 as St,b8 as A,b9 as Bs,ba as Hs,bb as Ks,bc as Vs,bd as qt,be as Fe,bf as oe,bg as ue,bh as Gs,bi as V,bj as je,bk as Je,bl as Qe,bm as Ys,bn as Zs,bo as bt,bp as Xs,bq as gt,br as Pt,bs as Js,bt as Qs,bu as er,bv as tr,bw as nr,bx as sr,by as rr,bz as ar,bA as Bt,bB as L,bC as ct,bD as ir,bE as cr,bF as or,bG as ur,bH as lr,bI as Ht,bJ as dr,bK as hr,bL as vt,bM as fr,bN as _r,bO as mr,bP as pr,l as Er,bQ as Kt,y as J,R as Vt,A as Gt,bR as Cr,E as Yt,d as Zt,bS as Xt,bT as Jt,bU as Sr,u as br,bV as gr,w as Qt,F as Pr,p as en,m as ot,n as ut,bW as vr,C as Or,v as G,x as yr,bX as kr,bY as wr,bZ as Ir,g as Dr,h as $r,b_ as Tr,b$ as Fr,c0 as Rr,s as Lr,t as Ot,k as et,c1 as Ar,a as zr}from"./utils-5523c140.js";const yt=ts,xr=os,Nr=Jn,tn=ns,Wr=us,kt=ss,Ur=rs,Mr=as,jr=Qn,qr=ls,Br=es,Hr=is,Kr=cs,Vr=ms,wt=ds,Gr=hs,Yr=_s,Zr=fs,nn=ee(),Xr=te(xt(Nt,t=>Jr(t)),nn);function Jr(t){const e=ps(Nt,t);return{moveTo:mt(bs,e),lineTo:mt(gs,e),beginPath:e(_e(Es,void 0)),stroke:e(_e(Cs(),void 0))}}const sn=ee(),Qr=Ss(Xr,te(xt(nn,t=>ea(t)),sn));function ea(t){return([[e,n],[s,r]])=>Wt([t.beginPath,t.moveTo(e,n),t.lineTo(s,r),t.stroke])}const rn=ee();function ta(t){return te(Ps(function*(e){const n=yield*e(Ut(t)),s=yield*e(vs(sn));return new sa(n,s)}),rn)}const na=ta({theta:0,position:[0,0]});class sa{constructor(e,n){this.state=e,this.draw=n}drawForward(e){return c(ys(this.state),b(n=>[n,ra(n,e)]),H(([n,s])=>this.draw([n.position,s])),b(([{theta:n},s])=>({theta:n,position:s})),h(n=>_e(Os(this.state,n),n)))}turn(e){return ks(this.state,({theta:n,position:s})=>({theta:n+e,position:s}))}}function ra({position:[t,e],theta:n},s){return[t+s*Math.cos(n),e+s*Math.sin(n)]}const Ce="Done",Se="Emit",ne="FromEffect",be="Read",aa=Symbol.for("@effect/stream/Channel/State"),ia={_R:t=>t,_E:t=>t},Ae={[aa]:ia},Y=()=>{const t=Object.create(Ae);return t._tag=Ce,t},qe=()=>{const t=Object.create(Ae);return t._tag=Se,t},le=t=>{const e=Object.create(Ae);return e._tag=ne,e.effect=t,e},Be=(t,e,n,s)=>{const r=Object.create(Ae);return r._tag=be,r.upstream=t,r.onEffect=e,r.onEmit=n,r.onDone=s,r},Re=t=>t._tag===ne,ca=t=>Re(t)?t.effect:l(),It=t=>Re(t)?ws(t.effect):void 0,De="ContinuationK",oa="ContinuationFinalizer";var an,cn;const on=Symbol.for("@effect/stream/Channel/Continuation"),un={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutDone:t=>t,_OutErr2:t=>t,_OutElem:t=>t,_OutDone2:t=>t};class ln{constructor(e,n){this.onSuccess=e,this.onHalt=n,this._tag=De,this[an]=un}onExit(e){return Is(e)?this.onHalt(e.cause):this.onSuccess(e.value)}}an=on;class ua{constructor(e){this.finalizer=e,this._tag=oa,this[cn]=un}}cn=on;const dn="PullFromChild",tt="PullFromUpstream",nt="DrainChildExecutors",hn="Emit";class ke{constructor(e,n,s){this.childExecutor=e,this.parentSubexecutor=n,this.onEmit=s,this._tag=dn}close(e){return O(n=>{const s=this.childExecutor.close(e),r=this.parentSubexecutor.close(e);return s!==void 0&&r!==void 0?c(v(s),Le(v(r),(a,i)=>c(a,me(i)))).traced(n):s!==void 0?s.traced(n):r!==void 0?r.traced(n):void 0})}enqueuePullFromChild(e){return this}}class M{constructor(e,n,s,r,a,i,o,u){this.upstreamExecutor=e,this.createChild=n,this.lastDone=s,this.activeChildExecutors=r,this.combineChildResults=a,this.combineWithChildResult=i,this.onPull=o,this.onEmit=u,this._tag=tt}close(e){return O(n=>{const s=this.upstreamExecutor.close(e),a=[...this.activeChildExecutors.map(i=>i!==void 0?i.childExecutor.close(e):void 0),s].reduce((i,o)=>i!==void 0&&o!==void 0?c(i,Le(v(o),(u,E)=>c(u,me(E)))):i!==void 0?i:o!==void 0?v(o):void 0,void 0);return a===void 0?a:a.traced(n)})}enqueuePullFromChild(e){return new M(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,e],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class X{constructor(e,n,s,r,a,i,o){this.upstreamExecutor=e,this.lastDone=n,this.activeChildExecutors=s,this.upstreamDone=r,this.combineChildResults=a,this.combineWithChildResult=i,this.onPull=o,this._tag=nt}close(e){return O(n=>{const s=this.upstreamExecutor.close(e),a=[...this.activeChildExecutors.map(i=>i!==void 0?i.childExecutor.close(e):void 0),s].reduce((i,o)=>i!==void 0&&o!==void 0?c(i,Le(v(o),(u,E)=>c(u,me(E)))):i!==void 0?i:o!==void 0?v(o):void 0,void 0);return a===void 0?a:a.traced(n)})}enqueuePullFromChild(e){return new X(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,e],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class He{constructor(e,n){this.value=e,this.next=n,this._tag=hn}close(e){return O(n=>{const s=this.next.close(e);return s===void 0?s:s.traced(n)})}enqueuePullFromChild(e){return this}}const la="Pulled",da="NoUpstream",ha="@effect/stream/Channel/UpstreamPullRequest",fa=Symbol.for(ha),_a={_A:t=>t},fn={[fa]:_a},Dt=t=>{const e=Object.create(fn);return e._tag=la,e.value=t,e},ma=t=>{const e=Object.create(fn);return e._tag=da,e.activeDownstreamCount=t,e},_n="Continue",pa="Close",Ea="Yield",Ca="@effect/stream/Channel/ChildExecutorDecision",$t=Symbol.for(Ca),Sa={[$t]:$t},mn=t=>{const e=Object.create(Sa);return e._tag=_n,e},pn="PullAfterNext",ba="PullAfterAllEnqueued",ga="@effect/stream/Channel/UpstreamPullStrategy",Pa=Symbol.for(ga),va={_A:t=>t},Oa={[Pa]:va},En=t=>{const e=Object.create(Oa);return e._tag=pn,e.emitSeparator=t,e},Cn="BracketOut",Sn="Bridge",lt="ConcatAll",bn="Emit",ya="Ensuring",gn="Fail",Pn="Fold",vn="FromEffect",On="PipeTo",ka="Provide",yn="Read",kn="Succeed",wn="SucceedNow",In="Suspend",Dn="Traced",wa="@effect/stream/Channel",Ia=Symbol.for(wa),Da={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutElem:t=>t,_OutDone:t=>t},g={[Ia]:Da,traced(t){return t?Object.create(g,{_tag:{value:Dn},channel:{value:this},trace:{value:t}}):this}},$a=P(2,(t,e)=>(n,s)=>{const r=Object.create(g);return r._tag=Cn,r.acquire=()=>n,r.finalizer=e(s),r.traced(t)}),Ta=d((t,e)=>(n,s,r)=>{const a=Object.create(g);return a._tag=lt,a.combineInners=e(s),a.combineAll=e(r),a.onPull=()=>En(it()),a.onEmit=()=>mn,a.value=()=>n,a.k=R,a.traced(t)}),Fa=P(4,(t,e)=>(n,s,r,a)=>{const i=Object.create(g);return i._tag=lt,i.combineInners=e(r),i.combineAll=e(a),i.onPull=()=>En(it()),i.onEmit=()=>mn,i.value=()=>n,i.k=e(s),i.traced(t)}),Ra=P(2,t=>(e,n)=>{const s=Object.create(g);return s._tag=Sn,s.input=n,s.channel=e,s.traced(t)}),se=d(t=>e=>$(Nr(e)).traced(t)),$=d(t=>e=>La(()=>e).traced(t)),La=d((t,e)=>n=>{const s=Object.create(g);return s._tag=gn,s.error=e(n),s.traced(t)}),C=P(2,(t,e)=>(n,s)=>{const r=Object.create(g);return r._tag=Pn,r.channel=n,r.k=new ln(e(s),$),r.traced(t)}),w=d(t=>e=>{const n=Object.create(g);return n._tag=vn,n.effect=()=>e,n.traced(t)}),F=P(2,t=>(e,n)=>{const s=Object.create(g);return s._tag=On,s.left=()=>e,s.right=()=>n,s.traced(t)}),ge=d((t,e)=>(n,s,r)=>ze(e(n),a=>j(jr(a),e(s),$),e(r))),ze=d((t,e)=>(n,s,r)=>{const a=Object.create(g);return a._tag=yn,a.more=e(n),a.done=new ln(e(r),e(s)),a.traced(t)}),xe=d(t=>e=>$n(()=>e).traced(t)),Q=d(t=>e=>{const n=Object.create(g);return n._tag=wn,n.terminal=e,n.traced(t)}),Ne=d((t,e)=>n=>{const s=Object.create(g);return s._tag=In,s.channel=e(n),s.traced(t)}),$n=d((t,e)=>n=>{const s=Object.create(g);return s._tag=kn,s.evaluate=e(n),s.traced(t)}),re=d(t=>()=>Q(void 0).traced(t)),m=d(t=>e=>{const n=Object.create(g);return n._tag=bn,n.out=e,n.traced(t)});class q{constructor(e,n,s){this._activeSubexecutor=void 0,this._cancelled=void 0,this._closeLastSubstream=void 0,this._done=void 0,this._doneStack=[],this._emitted=void 0,this._traceStack=[],this._input=void 0,this._inProgressFinalizer=void 0,this._currentChannel=e,this._executeCloseLastSubstream=s,this._providedEnv=n}run(){let e;for(;e===void 0;)if(this._cancelled!==void 0)e=this.processCancellation();else if(this._activeSubexecutor!==void 0)e=this.runSubexecutor();else try{if(this._currentChannel===void 0)e=Y();else switch(this._currentChannel._tag){case Cn:{e=this.runBracketOut(this._currentChannel);break}case Sn:{const n=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,this._input!==void 0){const s=this._input;this._input=void 0;const r=()=>h(n.awaitRead(),()=>I(()=>{const a=s.run();switch(a._tag){case Ce:return T(s.getDone(),i=>n.error(i),i=>n.done(i));case Se:return h(n.emit(s.getEmit()),()=>r());case ne:return z(a.effect,i=>n.error(i),()=>r());case be:return dt(a,()=>r(),i=>n.error(i))}}));e=le(h(we(r()),a=>p(()=>this.addFinalizer(i=>h(Ie(a),()=>I(()=>{const o=this.restorePipe(i,s);return o!==void 0?o:l()}))))))}break}case lt:{const n=new q(this._currentChannel.value(),this._providedEnv,r=>p(()=>{const a=this._closeLastSubstream===void 0?l():this._closeLastSubstream;this._closeLastSubstream=c(a,f(r))}));n._input=this._input;const s=this._currentChannel;this._activeSubexecutor=new M(n,r=>s.k(r),void 0,[],(r,a)=>s.combineInners(r,a),(r,a)=>s.combineAll(r,a),r=>s.onPull(r),r=>s.onEmit(r)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case bn:{this._emitted=this._currentChannel.out,this._currentChannel=this._activeSubexecutor!==void 0?void 0:re(),e=qe();break}case ya:{this.runEnsuring(this._currentChannel);break}case gn:{e=this.doneHalt(this._currentChannel.error());break}case Pn:{this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break}case vn:{const n=this._providedEnv===void 0?this._currentChannel.effect():c(this._currentChannel.effect(),pt(this._providedEnv));e=le(c(n,z(s=>{const r=this.doneHalt(s);return r!==void 0&&Re(r)?r.effect:l()},s=>{const r=this.doneSucceed(s);return r!==void 0&&Re(r)?r.effect:l()})));break}case On:{const n=this._input,s=new q(this._currentChannel.left(),this._providedEnv,r=>this._executeCloseLastSubstream(r));s._input=n,this._input=s,this.addFinalizer(r=>{const a=this.restorePipe(r,n);return a!==void 0?a:l()}),this._currentChannel=this._currentChannel.right();break}case ka:{const n=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>p(()=>{this._providedEnv=n}));break}case yn:{const n=this._currentChannel;e=Be(this._input,R,s=>{this._currentChannel=n.more(s)},s=>{const r=a=>n.done.onExit(a);this._currentChannel=r(s)});break}case kn:{e=this.doneSucceed(this._currentChannel.evaluate());break}case wn:{e=this.doneSucceed(this._currentChannel.terminal);break}case In:{this._currentChannel=this._currentChannel.channel();break}case Dn:{this._traceStack.push(this._currentChannel.trace),this.addFinalizer(()=>p(()=>{this._traceStack.pop()})),this._currentChannel=this._currentChannel.channel;break}default:this._currentChannel._tag}}catch(n){this._currentChannel=$(tn(n))}return e}stackToLines(){if(this._traceStack.length===0)return Ee();const e=[];let n=this._traceStack.length-1;for(;n>=0&&e.length<Et.traceStackLimit;){const s=this._traceStack[n];e.push(s),n=n-1}return Ds(e)}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(e){this._cancelled=e}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(e){this._inProgressFinalizer=e}popAllFinalizers(e){return ve(()=>{const n=[];let s=this._doneStack.pop();for(;s;)s._tag==="ContinuationFinalizer"&&n.push(s.finalizer),s=this._doneStack.pop();const r=n.length===0?l():Ve(n,e);return this.storeInProgressFinalizer(r),r})}popNextFinalizers(){const e=[];for(;this._doneStack.length!==0;){const n=this._doneStack[this._doneStack.length-1];if(n._tag===De)return e;e.push(n),this._doneStack.pop()}return e}restorePipe(e,n){return ve(()=>{const s=this._input;return this._input=n,s!==void 0?s.close(e):l()})}close(e){return ve(()=>{let n;const s=this._inProgressFinalizer;s!==void 0&&(n=c(s,Oe(p(()=>this.clearInProgressFinalizer()))));let r;const a=this.popAllFinalizers(e);a!==void 0&&(r=c(a,Oe(p(()=>this.clearInProgressFinalizer()))));const i=this._activeSubexecutor===void 0?void 0:this._activeSubexecutor.close(e);if(!(i===void 0&&n===void 0&&r===void 0))return c(v(Ke(i)),Ze(v(Ke(n))),Ze(v(Ke(r))),b(([[o,u],E])=>c(o,me(u),me(E))),ye,h(pe))})}doneSucceed(e){if(this._doneStack.length===0)return this._done=D(e),this._currentChannel=void 0,Y();const n=this._doneStack[this._doneStack.length-1];if(n._tag===De){this._doneStack.pop(),this._currentChannel=n.onSuccess(e);return}const s=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=s.reverse(),this._done=D(e),this._currentChannel=void 0,Y();const r=Ve(s.map(i=>i.finalizer),D(e));this.storeInProgressFinalizer(r);const a=c(r,Oe(p(()=>this.clearInProgressFinalizer())),ye,h(()=>p(()=>this.doneSucceed(e))));return le(a)}annotate(e){let n=e;if(Mr(n)&&Hr(n.annotation)){const s=n.annotation.stack,r=this.stackToLines();n=kt(n.cause,new yt(c(s.length===0?r:r.length===0||Ct(s)===Ct(r)?s:c(s,Ts(r)),$s,Mt(Et.traceStackLimit)),n.annotation.seq))}else n=kt(n,new yt(this.stackToLines(),Fs(xr)));return n}doneHalt(e){if(this._doneStack.length===0)return this._done=y(e),this._currentChannel=void 0,Y();const n=this._doneStack[this._doneStack.length-1];if(n._tag===De){this._doneStack.pop(),this._currentChannel=n.onHalt(e);return}const s=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=s.reverse(),this._done=y(e),this._currentChannel=void 0,Y();const r=Ve(s.map(i=>i.finalizer),y(e));this.storeInProgressFinalizer(r);const a=c(r,Oe(p(()=>this.clearInProgressFinalizer())),ye,h(()=>p(()=>this.doneHalt(e))));return le(a)}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,Y()}runBracketOut(e){const n=c(this.provide(e.acquire()),z(s=>p(()=>{this._currentChannel=$(s)}),s=>p(()=>{this.addFinalizer(r=>this.provide(e.finalizer(s,r))),this._currentChannel=m(s)})),ye);return le(n)}provide(e){return this._providedEnv===void 0?e:c(e,pt(this._providedEnv))}runEnsuring(e){this.addFinalizer(e.finalizer),this._currentChannel=e.channel}addFinalizer(e){this._doneStack.push(new ua(e))}runSubexecutor(){const e=this._activeSubexecutor;switch(e._tag){case dn:return this.pullFromChild(e.childExecutor,e.parentSubexecutor,e.onEmit,e);case tt:return this.pullFromUpstream(e);case nt:return this.drainChildExecutors(e);case hn:return this._emitted=e.value,this._activeSubexecutor=e.next,qe()}}replaceSubexecutor(e){this._currentChannel=void 0,this._activeSubexecutor=e}finishWithExit(e){return ve(()=>{const n=c(e,T(s=>this.doneHalt(s),s=>this.doneSucceed(s)));return this._activeSubexecutor=void 0,n===void 0?l():ca(n)})}finishSubexecutorWithCloseEffect(e,...n){this.addFinalizer(()=>c(n,Xe(r=>c(p(()=>r(e)),h(a=>a!==void 0?a:l())))));const s=c(e,T(r=>this.doneHalt(r),r=>this.doneSucceed(r)));return this._activeSubexecutor=void 0,s}applyUpstreamPullStrategy(e,n,s){switch(s._tag){case pn:{const r=!e||n.some(a=>a!==void 0);return[s.emitSeparator,r?[void 0,...n]:n]}case ba:{const r=!e||n.some(a=>a!==void 0);return[s.emitSeparator,r?[...n,void 0]:n]}}}pullFromChild(e,n,s,r){return Be(e,R,a=>{const i=s(a);switch(i._tag){case _n:break;case pa:{this.finishWithDoneValue(e,n,i.value);break}case Ea:{const o=n.enqueuePullFromChild(r);this.replaceSubexecutor(o);break}}this._activeSubexecutor=new He(a,this._activeSubexecutor)},T(a=>{const i=this.handleSubexecutorFailure(e,n,a);return i===void 0?void 0:It(i)},a=>{this.finishWithDoneValue(e,n,a)}))}finishWithDoneValue(e,n,s){const r=n;switch(r._tag){case tt:{const a=new M(r.upstreamExecutor,r.createChild,r.lastDone!==void 0?r.combineChildResults(r.lastDone,s):s,r.activeChildExecutors,r.combineChildResults,r.combineWithChildResult,r.onPull,r.onEmit);this._closeLastSubstream=e.close(D(s)),this.replaceSubexecutor(a);break}case nt:{const a=new X(r.upstreamExecutor,r.lastDone!==void 0?r.combineChildResults(r.lastDone,s):s,r.activeChildExecutors,r.upstreamDone,r.combineChildResults,r.combineWithChildResult,r.onPull);this._closeLastSubstream=e.close(D(s)),this.replaceSubexecutor(a);break}}}handleSubexecutorFailure(e,n,s){return this.finishSubexecutorWithCloseEffect(y(s),r=>n.close(r),r=>e.close(r))}pullFromUpstream(e){if(e.activeChildExecutors.length===0)return this.performPullFromUpstream(e);const n=e.activeChildExecutors[0],s=new M(e.upstreamExecutor,e.createChild,e.lastDone,e.activeChildExecutors.slice(1),e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit);if(n===void 0)return this.performPullFromUpstream(s);this.replaceSubexecutor(new ke(n.childExecutor,s,n.onEmit))}performPullFromUpstream(e){return Be(e.upstreamExecutor,n=>{const s=this._closeLastSubstream===void 0?l():this._closeLastSubstream;return this._closeLastSubstream=void 0,c(this._executeCloseLastSubstream(s),f(n))},n=>{if(this._closeLastSubstream!==void 0){const i=this._closeLastSubstream;return this._closeLastSubstream=void 0,c(this._executeCloseLastSubstream(i),b(()=>{const o=new q(e.createChild(n),this._providedEnv,this._executeCloseLastSubstream);o._input=this._input;const[u,E]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(Dt(n)));this._activeSubexecutor=new ke(o,new M(e.upstreamExecutor,e.createChild,e.lastDone,E,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),Me(u)&&(this._activeSubexecutor=new He(u.value,this._activeSubexecutor))}))}const s=new q(e.createChild(n),this._providedEnv,this._executeCloseLastSubstream);s._input=this._input;const[r,a]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(Dt(n)));this._activeSubexecutor=new ke(s,new M(e.upstreamExecutor,e.createChild,e.lastDone,a,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),Me(r)&&(this._activeSubexecutor=new He(r.value,this._activeSubexecutor))},n=>{if(e.activeChildExecutors.some(a=>a!==void 0)){const a=new X(e.upstreamExecutor,e.lastDone,[void 0,...e.activeChildExecutors],e.upstreamExecutor.getDone(),e.combineChildResults,e.combineWithChildResult,e.onPull);if(this._closeLastSubstream!==void 0){const i=this._closeLastSubstream;return this._closeLastSubstream=void 0,c(this._executeCloseLastSubstream(i),b(()=>this.replaceSubexecutor(a)))}this.replaceSubexecutor(a);return}const s=this._closeLastSubstream,r=this.finishSubexecutorWithCloseEffect(c(n,As(a=>e.combineWithChildResult(e.lastDone,a))),()=>s,a=>e.upstreamExecutor.close(a));return r===void 0?void 0:It(r)})}drainChildExecutors(e){if(e.activeChildExecutors.length===0){const a=this._closeLastSubstream;return a!==void 0&&this.addFinalizer(()=>x(a)),this.finishSubexecutorWithCloseEffect(e.upstreamDone,()=>a,i=>e.upstreamExecutor.close(i))}const n=e.activeChildExecutors[0],s=e.activeChildExecutors.slice(1);if(n===void 0){const[a,i]=this.applyUpstreamPullStrategy(!0,s,e.onPull(ma(s.reduce((o,u)=>u!==void 0?o+1:o,0))));return this.replaceSubexecutor(new X(e.upstreamExecutor,e.lastDone,i,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull)),Me(a)?(this._emitted=a.value,qe()):void 0}const r=new X(e.upstreamExecutor,e.lastDone,s,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull);this.replaceSubexecutor(new ke(n.childExecutor,r,n.onEmit))}}const Ke=jt(()=>t=>t!==void 0?t:l()),Ve=jt(()=>(t,e)=>c(zs(t,n=>v(n(e))),b(n=>c(xs(n),Ns(()=>Ws()))),h(n=>pe(n)))),dt=d(t=>(e,n,s)=>{const r=[e],a=()=>{const i=r.pop();if(i===void 0||i.upstream===void 0)return Rs("Unexpected end of input for channel execution");const o=i.upstream.run();switch(o._tag){case Se:{const u=i.onEmit(i.upstream.getEmit());return r.length===0?u===void 0?I(n):c(u,z(s,n)).traced(t):u===void 0?I(()=>a()).traced(t):c(u,z(s,()=>a())).traced(t)}case Ce:{const u=i.onDone(i.upstream.getDone());return r.length===0?u===void 0?I(n).traced(t):c(u,z(s,()=>n())).traced(t):u===void 0?I(()=>a()).traced(t):c(u,z(s,()=>a())).traced(t)}case ne:return r.push(i),c(i.onEffect(o.effect),Ls(u=>I(()=>{const E=i.onDone(y(u));return E===void 0?l():E})),z(s,()=>a())).traced(t);case be:return r.push(i),r.push(o),I(()=>a()).traced(t)}};return a()}),Aa=d(t=>e=>c(za(e),Us).traced(t)),za=t=>{const e=(n,s)=>Hs(p(()=>new q(t,void 0,R)),r=>I(()=>c($e(r.run(),r),Vs(n),f(A(n)),St(Ks()))),(r,a)=>{const i=r.close(a);return i===void 0?l():qt(i,o=>Vr(s,Fe(o)))});return h(Ms(),n=>h(Yr(n,js),s=>h(Te(),r=>h(qs(e(r,s)),a=>St(A(r),Bs(a))))))},$e=(t,e)=>{const n=t;switch(n._tag){case ne:return c(n.effect,h(()=>$e(e.run(),e)));case Se:return $e(e.run(),e);case Ce:return pe(e.getDone());case be:return dt(n,()=>$e(e.run(),e),Fe)}},Tn="Done",xa="Await",Na="@effect/stream/Channel/MergeDecision",Wa=Symbol.for(Na),Fn={[Wa]:{_R:t=>t,_E0:t=>t,_Z0:t=>t,_E:t=>t,_Z:t=>t}},Ua=t=>{const e=Object.create(Fn);return e._tag=Tn,e.effect=t,e},Ma=t=>{const e=Object.create(Fn);return e._tag=xa,e.f=t,e},Rn="BothRunning",Ln="LeftDone",An="RightDone",ja="@effect/stream/Channel/MergeState",Tt=Symbol.for(ja),ht={[Tt]:Tt},Ge=(t,e)=>{const n=Object.create(ht);return n._tag=Rn,n.left=t,n.right=e,n},Ft=t=>{const e=Object.create(ht);return e._tag=Ln,e.f=t,e},Rt=t=>{const e=Object.create(ht);return e._tag=An,e.f=t,e},Z="Empty",de="Emit",he="Error",fe="Done",zn=t=>({_tag:Z,notifyProducer:t}),Ye=t=>({_tag:de,notifyConsumers:t}),qa=t=>({_tag:he,cause:t}),Ba=t=>({_tag:fe,done:t});class Ha{constructor(e){this.ref=e}awaitRead(){return O(e=>oe(ue(this.ref,n=>n._tag===Z?[A(n.notifyProducer),n]:[l(),n])).traced(e))}close(){return O(e=>Gs(n=>this.error(Wr(n))).traced(e))}done(e){return O(n=>c(ue(this.ref,s=>{switch(s._tag){case Z:return[A(s.notifyProducer),s];case de:return[c(s.notifyConsumers,Xe(r=>je(r,Je(e)))),Ba(e)];case he:return[V(),s];case fe:return[V(),s]}}),oe).traced(n))}emit(e){return O(n=>c(Te(),h(s=>c(ue(this.ref,r=>{switch(r._tag){case Z:return[A(r.notifyProducer),r];case de:{const a=r.notifyConsumers[0],i=r.notifyConsumers.slice(1);if(a!==void 0)return[je(a,Qe(e)),i.length===0?zn(s):Ye(i)];throw new Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! Please report an issue at https://github.com/Effect-TS/stream/issues")}case he:return[V(),r];case fe:return[V(),r]}}),oe))).traced(n))}error(e){return O(n=>c(ue(this.ref,s=>{switch(s._tag){case Z:return[A(s.notifyProducer),s];case de:return[Xe(s.notifyConsumers,r=>Ys(r,e)),qa(e)];case he:return[V(),s];case fe:return[V(),s]}}),oe).traced(n))}take(){return O(e=>this.takeWith(n=>y(qr(n,Je)),n=>D(n),n=>Zs(Qe(n))).traced(e))}takeWith(e,n,s){return O(r=>c(Te(),h(a=>c(ue(this.ref,i=>{switch(i._tag){case Z:return[f(je(i.notifyProducer,void 0),bt(A(a),e,j(s,n))),Ye([a])];case de:return[bt(A(a),e,j(s,n)),Ye([...i.notifyConsumers,a])];case he:return[x(e(i.cause)),i];case fe:return[x(s(i.done)),i]}}),oe))).traced(r))}}const Ka=d(t=>()=>c(Te(),h(e=>Ut(zn(e))),b(e=>new Ha(e))).traced(t)),Va=P(2,t=>(e,n)=>Za(e,()=>n).traced(t)),Ga=P(2,(t,e)=>(n,s)=>Fa(n,e(s),()=>{},()=>{}).traced(t)),xn=d(t=>e=>{const n=ze(()=>n,$,xe);return F(e,n).traced(t)}),Ya=d(t=>e=>C(e,R).traced(t)),Nn=d(t=>e=>B(e.takeWith($,n=>C(m(n),()=>Nn(e)),xe)).traced(t)),Za=P(2,(t,e)=>(n,s)=>C(n,r=>$n(()=>e(s)(r))).traced(t)),Xa=P(2,(t,e)=>(n,s)=>{const r=ge(a=>C(m(e(s)(a)),()=>r),se,Q);return F(n,r).traced(t)}),Ja=P(4,(t,e)=>(n,s,r,a)=>ti(c(Ka(),h(i=>{const o=Nn(i);return b(Ze(Lt(F(o,n)),Lt(F(o,s))),([u,E])=>{const We=(S,_,Ue)=>(K,ie,N)=>{const Pe=W=>{const U=W;return U._tag===Tn?x(w(f(Ie(_),U.effect))):b(Xs(_),T(ce=>w(U.f(y(ce))),j(ce=>w(U.f(D(ce))),ce=>Un(m(ce),ae(N(U.f))))))};return T(S,W=>Pe(K(y(W))),j(W=>Pe(K(D(W))),W=>x(C(m(W),()=>C(w(we(Ue)),U=>ae(ie(U,_)))))))},ae=S=>{switch(S._tag){case Rn:{const _=gt(Pt(S.left)),Ue=gt(Pt(S.right));return B(Js(_,Ue,(K,ie)=>f(Ie(ie),We(K,S.right,u)(e(r),Ge,N=>Ft(N))),(K,ie)=>f(Ie(ie),We(K,S.left,E)(e(a),(N,Pe)=>Ge(Pe,N),N=>Rt(N)))))}case Ln:return B(b(v(E),T(_=>w(S.f(y(_))),j(_=>w(S.f(D(_))),_=>C(m(_),()=>ae(Ft(S.f)))))));case An:return B(b(v(u),T(_=>w(S.f(y(_))),j(_=>w(S.f(D(_))),_=>C(m(_),()=>ae(Rt(S.f)))))))}};return c(w(Le(we(u),we(E),(S,_)=>Ge(S,_))),C(ae),Ra(i))})}))).traced(t)),Wn=P(2,t=>(e,n)=>Ne(()=>{let s;const r=ge(i=>C(m(i),()=>r),i=>(s=ni(i),$(tn(s))),Q),a=ze(i=>c(m(i),C(()=>a)),i=>{const o=Kr(i);return Ur(o)&&si(o.defect)&&er(o.defect,s)?se(o.defect.error):$(i)},Q);return F(F(F(e,r),n),a).traced(t)})),Qa=d(t=>e=>Aa(xn(e)).traced(t)),ei=d(t=>e=>B(tr(n=>b(Zr(),s=>$a(qt(n(Gr(s)(e)),r=>wt(s,y(r))),(r,a)=>wt(s,a))))).traced(t)),Lt=d(t=>e=>b(Qs(p(()=>new q(e,void 0,R)),(n,s)=>{const r=n.close(s);return r===void 0?l():r}),n=>I(()=>st(n.run(),n))).traced(t)),st=(t,e)=>{const n=t;switch(n._tag){case Ce:return T(e.getDone(),Fe,s=>x(Je(s)));case Se:return x(Qe(e.getEmit()));case ne:return c(n.effect,h(()=>st(e.run(),e)));case be:return dt(n,()=>st(e.run(),e),s=>Fe(s))}},B=d(t=>e=>Ya(w(e)).traced(t)),ti=d(t=>e=>Ta(ei(e),(n,s)=>n,(n,s)=>n).traced(t)),Un=P(2,t=>(e,n)=>C(e,()=>n).traced(t)),rt=Symbol.for("@effect/stream/Channel/errors/ChannelException"),ni=t=>({_tag:"ChannelException",[rt]:rt,error:t}),si=t=>typeof t=="object"&&t!=null&&rt in t,ri=Ua,ai=Ma;var Mn;const ii="@effect/stream/Sink",ci=Symbol.for(ii),oi={_R:t=>t,_E:t=>t,_In:t=>t,_L:t=>t,_Z:t=>t};class ft{constructor(e){this.channel=e,this[Mn]=oi}}Mn=ci;const ui=(t,e,n)=>fi(()=>new ft(jn(t,e,n))),jn=(t,e,n)=>e(t)?ge(s=>{const[r,a]=qn(t,s,e,n,0,s.length);return nr(a)?c(m(a),Va(r)):jn(r,e,n)},se,()=>Q(t)):Q(t),qn=(t,e,n,s,r,a)=>{if(r===a)return[t,Ee()];const i=s(t,c(e,sr(r)));return n(i)?qn(i,e,n,s,r+1,a):[i,c(e,rr(r+1))]},li=(t,e)=>di(ui(t,ar,e)),di=t=>new ft(xn(t.channel)),hi=()=>li(it(),(t,e)=>Bt(e)),fi=t=>new ft(Ne(()=>t().channel)),_i="Both",mi={_tag:_i},pi=mi;var Bn;const Ei="@effect/stream/Stream",Ci=Symbol.for(Ei),Si={_R:t=>t,_E:t=>t,_A:t=>t};class k{constructor(e){this.channel=e,this[Bn]=Si}}Bn=Ci;const bi=4096,gi=t=>Hn(fr(t)),Pi=new k(m(Ee())),vi=L(2,(t,e)=>new k(c(t.channel,Ga(n=>c(n,Ht(s=>e(s).channel),dr(re(),(s,r)=>c(s,Un(r)))))))),Oi=t=>c(t,vi(R)),yi=t=>new k(ir(t)?re():m(t)),Hn=t=>c(t,cr(Bt),ki),ki=t=>new k(c(t,or(ur(re,se),e=>m(ct(e))),B)),at=L(2,(t,e)=>new k(c(t.channel,Xa(Ht(e))))),wi=L(3,(t,e,n)=>{const s=r=>ge(a=>{const[i,o]=c(a,lr(r,n));return c(m(o),C(()=>s(i)))},se,re);return new k(c(t.channel,F(s(e))))}),Kn=L(2,(t,e)=>{const n=s=>{const r=s.next();if(r.done)return ze(a=>n(a[Symbol.iterator]()),$,xe);{const a=r.value;return B(b(e(a),i=>C(m(ct(i)),()=>n(s))))}};return new k(c(t.channel,F(Ne(()=>n(Ee()[Symbol.iterator]())))))}),Ii=L(2,(t,e)=>Di(t,e,pi)),Di=L(3,(t,e,n)=>$i(t,e,R,R,n)),$i=L(5,(t,e,n,s,r)=>{const a=i=>o=>i||!hr(o)?ri(pe(o)):ai(pe);return new k(Ja(at(t,n).channel,at(e,s).channel,a(r._tag==="Either"||r._tag==="Left"),a(r._tag==="Either"||r._tag==="Right")))}),Ti=(t,e,n=bi)=>Ai(()=>{if(t>=e)return Pi;const s=(r,a,i)=>{const o=a-r;return o>i?c(m(vt(r,r+i-1)),C(()=>s(r+i,a,i))):m(vt(r,r+o-1))};return new k(s(t,e,n))}),Fi=P(2,t=>(e,n)=>c(e.channel,Wn(n.channel),Qa).traced(t)),Ri=d(t=>e=>c(e,Fi(hi())).traced(t)),Li=t=>yi(ct(t)),Ai=t=>new k(Ne(()=>t().channel)),zi=L(2,(t,e)=>{if(!Number.isInteger(e))return gi(Br(`${e} must be an integer`));const n=s=>ge(r=>{const a=c(r,Mt(Math.min(s,Number.POSITIVE_INFINITY))),i=Math.max(0,s-a.length);return i>0?c(m(a),C(()=>n(i))):m(a)},se,xe);return new k(c(t.channel,Wn(0<e?n(e):re())))}),xi=L(2,(t,e)=>Kn(t,n=>_e(e(n),n))),Ni=Oi,Wi=Hn,Ui=at,Vn=wi,Mi=Kn,ji=Ii,qi=Ti,Bi=Ri,Hi=Li,Ki=zi,At=xi;function _t(){return br(sc(771))}const Vi=c(l(),f(Kt),h(({width:t,height:e})=>c(l(),f(_r(0,0,t,e)),h(n=>mr(()=>createImageBitmap(n))),b(n=>c(pr(n,gr(t/-2,e/-2)))),H(n=>Er(s=>Qt(c(Yt(0,0,t,e),f(Zt(t/2,e/2)),f(Pr(-s/4)),f(en(n)),f(ot(l(),ut(16)))))))))),Gi=c(l(),f(Kt),H(({width:t,height:e})=>c(l(),f(Yt(0,0,t,e)),f(Zt(t/2,e/2)))),f(Cr(3.5,3.5)),f(J(Vt,Gt(_t))),_e(null));function Yi(t){return c(tc,Vn(3,(e,[n,s])=>[n==e**2?e+2:e,{nextSquare:e**2,isPrime:s,num:n}]),At(({isPrime:e})=>e?ot(l(),ut(16)):l()),At(ec(t)),Ui(Zi),Mi(e=>J(rn,e)),Ki(t))}function Zi({num:t,isPrime:e,nextSquare:n}){return r=>c(Wt([Ar(e?3:1),zr(e?"transparent":Ot(et(0,0,0,.25)))]),f(r.drawForward(3)),H(({position:[a,i]})=>e?Lr(Ot(et(Math.atan2(i,a)*180/Math.PI,.5,.5,1))):l()),f(r.turn(s(t,Math.sqrt(n)))),H(({position:a})=>e?Fr(Rr(a[0],a[1],2,0,Math.PI*2)):l()),f(r.drawForward(3)));function s(r,a){const i=a-2,o=a**2,u=a-1,E=r-i**2;return r==2||i**2+1==r||r!=o&&E%u==0?Math.PI/2:0}}const Gn=ee(),Xi=te(Xn("prime"),Gn),Yn=ee(),Ji=te(Xn("latest"),Yn),Zn=ee(),Qi=te(x(new Intl.NumberFormat),Zn);function ec(t){return({num:e,isPrime:n})=>J(Zn,s=>n?J(Gn,zt(s.format(e))):e>1e3&&e%100==0||e<=1e3&&e%10==0||e==t?J(Yn,zt(s.format(e))):l())}function Xn(t){return c(p(()=>Jt(document.getElementById(t))),h(Xt),vr)}function zt(t){return e=>p(()=>{e.innerText=t})}const tc=c(qi(2,Number.MAX_SAFE_INTEGER),Vn(Ee(),nc),Ni);function nc(t,e){const n=e>1&&Sr(t,r=>e%r!==0),s=[e,n];return[n?t.append(e):t,Hi(s)]}const sc=t=>c(Wi(Gi),ji(Yi(t)),Bi,h(e=>c(e,Ir(n=>Jt(n)),Xt,H(n=>en(rc(n))))),Qt,wr,H(([e])=>kr(`duration: ${e.millis}ms `)),f(ot(Vi,ut(3e3))),f(J(Vt,Gt(_t))),G(na),G(Qr),G(Xi),G(Ji),G(Qi),G(yr),Or("canvas4"));function rc({position:[t,e]}){return Dr(Tr(t,e,4),$r(et(0,.5,0,.5)))}_t();
