import{J as Jn,K as Qn,L as es,M as ts,N as ns,O as ss,P as rs,Q as as,S as is,T as cs,U as os,V as us,W as ls,X as ds,Y as hs,Z as fs,_ as _s,$ as ms,a0 as ps,a1 as Es,a2 as Cs,a3 as Ss,a4 as bs,a5 as gs,a6 as Ps,a7 as vs,a8 as Os,a9 as ee,aa as te,ab as xt,ac as Nt,ad as ks,ae as mt,af as _e,ag as ys,ah as $s,ai as ws,D as Wt,aj as Is,ak as Ds,al as Ts,am as Fs,q as c,an as h,ao as b,ap as H,aq as l,ar as Rs,as as Ls,at as O,au as v,av as Le,aw as me,ax as P,ay as d,az as j,aA as it,aB as R,aC as p,aD as pt,aE as z,z as f,aF as w,aG as T,aH as $e,aI as we,aJ as Ee,aK as Et,aL as As,aM as ve,aN as Oe,aO as Ze,aP as ke,aQ as pe,aR as I,aS as Ut,aT as zs,aU as Ct,aV as xs,aW as Ns,aX as k,aY as Xe,aZ as x,a_ as Me,a$ as Mt,b0 as Ws,b1 as Us,b2 as Ms,b3 as js,b4 as qs,b5 as Bs,b6 as Hs,b7 as Ks,b8 as Gs,b9 as Vs,ba as Ys,bb as St,bc as Zs,bd as Xs,be as Js,bf as Qs,bg as jt,bh as Te,bi as oe,bj as er,bk as G,bl as Je,bm as Qe,bn as tr,bo as bt,bp as nr,bq as gt,br as Pt,bs as sr,bt as rr,bu as ar,bv as ir,bw as cr,bx as or,by as ur,bz as lr,bA as qt,bB as L,bC as ct,bD as dr,bE as hr,bF as fr,bG as _r,bH as mr,bI as Bt,bJ as pr,bK as Er,bL as vt,bM as Cr,bN as Sr,bO as br,bP as gr,l as Pr,bQ as Ht,y as J,R as Kt,A as Gt,bR as vr,E as Vt,d as Yt,bS as Zt,bT as Xt,bU as Or,u as kr,bV as yr,w as Jt,F as $r,p as Qt,m as ot,n as ut,bW as wr,C as Ir,v as V,x as Dr,bX as Tr,bY as Fr,bZ as Rr,g as Lr,h as Ar,b_ as zr,b$ as xr,c0 as Nr,s as Wr,t as Ot,k as et,c1 as Ur,a as Mr}from"./utils-a97741b4.js";const en=Jn,jr=Qn,ue=ns,qr=es,Br=ts,Fe=ss,A=rs,Hr=as,je=is,kt=ls,Kr=Es,Gr=cs,tn=ds,Vr=Cs,yt=hs,Yr=fs,Zr=_s,Xr=os,Jr=Ss,Qr=us,ea=ms,ta=ps,na=Os,$t=bs,sa=gs,ra=vs,aa=Ps,nn=ee(),ia=te(xt(Nt,t=>ca(t)),nn);function ca(t){const e=ks(Nt,t);return{moveTo:mt(Is,e),lineTo:mt(Ds,e),beginPath:e(_e(ys,void 0)),stroke:e(_e($s(),void 0))}}const sn=ee(),oa=ws(ia,te(xt(nn,t=>ua(t)),sn));function ua(t){return([[e,n],[s,r]])=>Wt([t.beginPath,t.moveTo(e,n),t.lineTo(s,r),t.stroke])}const rn=ee();function la(t){return te(Ts(function*(e){const n=yield*e(en(t)),s=yield*e(Fs(sn));return new ha(n,s)}),rn)}const da=la({theta:0,position:[0,0]});class ha{constructor(e,n){this.state=e,this.draw=n}drawForward(e){return c(jr(this.state),b(n=>[n,fa(n,e)]),H(([n,s])=>this.draw([n.position,s])),b(([{theta:n},s])=>({theta:n,position:s})),h(n=>_e(qr(this.state,n),n)))}turn(e){return Br(this.state,({theta:n,position:s})=>({theta:n+e,position:s}))}}function fa({position:[t,e],theta:n},s){return[t+s*Math.cos(n),e+s*Math.sin(n)]}const Ce="Done",Se="Emit",ne="FromEffect",be="Read",_a=Symbol.for("@effect/stream/Channel/State"),ma={_R:t=>t,_E:t=>t},Ae={[_a]:ma},Y=()=>{const t=Object.create(Ae);return t._tag=Ce,t},qe=()=>{const t=Object.create(Ae);return t._tag=Se,t},le=t=>{const e=Object.create(Ae);return e._tag=ne,e.effect=t,e},Be=(t,e,n,s)=>{const r=Object.create(Ae);return r._tag=be,r.upstream=t,r.onEffect=e,r.onEmit=n,r.onDone=s,r},Re=t=>t._tag===ne,pa=t=>Re(t)?t.effect:l(),wt=t=>Re(t)?Rs(t.effect):void 0,Ie="ContinuationK",Ea="ContinuationFinalizer";var an,cn;const on=Symbol.for("@effect/stream/Channel/Continuation"),un={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutDone:t=>t,_OutErr2:t=>t,_OutElem:t=>t,_OutDone2:t=>t};class ln{constructor(e,n){this.onSuccess=e,this.onHalt=n,this._tag=Ie,this[an]=un}onExit(e){return Ls(e)?this.onHalt(e.cause):this.onSuccess(e.value)}}an=on;class Ca{constructor(e){this.finalizer=e,this._tag=Ea,this[cn]=un}}cn=on;const dn="PullFromChild",tt="PullFromUpstream",nt="DrainChildExecutors",hn="Emit";class ye{constructor(e,n,s){this.childExecutor=e,this.parentSubexecutor=n,this.onEmit=s,this._tag=dn}close(e){return O(n=>{const s=this.childExecutor.close(e),r=this.parentSubexecutor.close(e);return s!==void 0&&r!==void 0?c(v(s),Le(v(r),(a,i)=>c(a,me(i)))).traced(n):s!==void 0?s.traced(n):r!==void 0?r.traced(n):void 0})}enqueuePullFromChild(e){return this}}class M{constructor(e,n,s,r,a,i,o,u){this.upstreamExecutor=e,this.createChild=n,this.lastDone=s,this.activeChildExecutors=r,this.combineChildResults=a,this.combineWithChildResult=i,this.onPull=o,this.onEmit=u,this._tag=tt}close(e){return O(n=>{const s=this.upstreamExecutor.close(e),a=[...this.activeChildExecutors.map(i=>i!==void 0?i.childExecutor.close(e):void 0),s].reduce((i,o)=>i!==void 0&&o!==void 0?c(i,Le(v(o),(u,E)=>c(u,me(E)))):i!==void 0?i:o!==void 0?v(o):void 0,void 0);return a===void 0?a:a.traced(n)})}enqueuePullFromChild(e){return new M(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,e],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class X{constructor(e,n,s,r,a,i,o){this.upstreamExecutor=e,this.lastDone=n,this.activeChildExecutors=s,this.upstreamDone=r,this.combineChildResults=a,this.combineWithChildResult=i,this.onPull=o,this._tag=nt}close(e){return O(n=>{const s=this.upstreamExecutor.close(e),a=[...this.activeChildExecutors.map(i=>i!==void 0?i.childExecutor.close(e):void 0),s].reduce((i,o)=>i!==void 0&&o!==void 0?c(i,Le(v(o),(u,E)=>c(u,me(E)))):i!==void 0?i:o!==void 0?v(o):void 0,void 0);return a===void 0?a:a.traced(n)})}enqueuePullFromChild(e){return new X(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,e],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class He{constructor(e,n){this.value=e,this.next=n,this._tag=hn}close(e){return O(n=>{const s=this.next.close(e);return s===void 0?s:s.traced(n)})}enqueuePullFromChild(e){return this}}const Sa="Pulled",ba="NoUpstream",ga="@effect/stream/Channel/UpstreamPullRequest",Pa=Symbol.for(ga),va={_A:t=>t},fn={[Pa]:va},It=t=>{const e=Object.create(fn);return e._tag=Sa,e.value=t,e},Oa=t=>{const e=Object.create(fn);return e._tag=ba,e.activeDownstreamCount=t,e},_n="Continue",ka="Close",ya="Yield",$a="@effect/stream/Channel/ChildExecutorDecision",Dt=Symbol.for($a),wa={[Dt]:Dt},mn=t=>{const e=Object.create(wa);return e._tag=_n,e},pn="PullAfterNext",Ia="PullAfterAllEnqueued",Da="@effect/stream/Channel/UpstreamPullStrategy",Ta=Symbol.for(Da),Fa={_A:t=>t},Ra={[Ta]:Fa},En=t=>{const e=Object.create(Ra);return e._tag=pn,e.emitSeparator=t,e},Cn="BracketOut",Sn="Bridge",lt="ConcatAll",bn="Emit",La="Ensuring",gn="Fail",Pn="Fold",vn="FromEffect",On="PipeTo",Aa="Provide",kn="Read",yn="Succeed",$n="SucceedNow",wn="Suspend",In="Traced",za="@effect/stream/Channel",xa=Symbol.for(za),Na={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutElem:t=>t,_OutDone:t=>t},g={[xa]:Na,traced(t){return t?Object.create(g,{_tag:{value:In},channel:{value:this},trace:{value:t}}):this}},Wa=P(2,(t,e)=>(n,s)=>{const r=Object.create(g);return r._tag=Cn,r.acquire=()=>n,r.finalizer=e(s),r.traced(t)}),Ua=d((t,e)=>(n,s,r)=>{const a=Object.create(g);return a._tag=lt,a.combineInners=e(s),a.combineAll=e(r),a.onPull=()=>En(it()),a.onEmit=()=>mn,a.value=()=>n,a.k=R,a.traced(t)}),Ma=P(4,(t,e)=>(n,s,r,a)=>{const i=Object.create(g);return i._tag=lt,i.combineInners=e(r),i.combineAll=e(a),i.onPull=()=>En(it()),i.onEmit=()=>mn,i.value=()=>n,i.k=e(s),i.traced(t)}),ja=P(2,t=>(e,n)=>{const s=Object.create(g);return s._tag=Sn,s.input=n,s.channel=e,s.traced(t)}),se=d(t=>e=>D(Gr(e)).traced(t)),D=d(t=>e=>qa(()=>e).traced(t)),qa=d((t,e)=>n=>{const s=Object.create(g);return s._tag=gn,s.error=e(n),s.traced(t)}),C=P(2,(t,e)=>(n,s)=>{const r=Object.create(g);return r._tag=Pn,r.channel=n,r.k=new ln(e(s),D),r.traced(t)}),$=d(t=>e=>{const n=Object.create(g);return n._tag=vn,n.effect=()=>e,n.traced(t)}),F=P(2,t=>(e,n)=>{const s=Object.create(g);return s._tag=On,s.left=()=>e,s.right=()=>n,s.traced(t)}),ge=d((t,e)=>(n,s,r)=>ze(e(n),a=>j(Xr(a),e(s),D),e(r))),ze=d((t,e)=>(n,s,r)=>{const a=Object.create(g);return a._tag=kn,a.more=e(n),a.done=new ln(e(r),e(s)),a.traced(t)}),xe=d(t=>e=>Dn(()=>e).traced(t)),Q=d(t=>e=>{const n=Object.create(g);return n._tag=$n,n.terminal=e,n.traced(t)}),Ne=d((t,e)=>n=>{const s=Object.create(g);return s._tag=wn,s.channel=e(n),s.traced(t)}),Dn=d((t,e)=>n=>{const s=Object.create(g);return s._tag=yn,s.evaluate=e(n),s.traced(t)}),re=d(t=>()=>Q(void 0).traced(t)),m=d(t=>e=>{const n=Object.create(g);return n._tag=bn,n.out=e,n.traced(t)});class q{constructor(e,n,s){this._activeSubexecutor=void 0,this._cancelled=void 0,this._closeLastSubstream=void 0,this._done=void 0,this._doneStack=[],this._emitted=void 0,this._traceStack=[],this._input=void 0,this._inProgressFinalizer=void 0,this._currentChannel=e,this._executeCloseLastSubstream=s,this._providedEnv=n}run(){let e;for(;e===void 0;)if(this._cancelled!==void 0)e=this.processCancellation();else if(this._activeSubexecutor!==void 0)e=this.runSubexecutor();else try{if(this._currentChannel===void 0)e=Y();else switch(this._currentChannel._tag){case Cn:{e=this.runBracketOut(this._currentChannel);break}case Sn:{const n=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,this._input!==void 0){const s=this._input;this._input=void 0;const r=()=>h(n.awaitRead(),()=>w(()=>{const a=s.run();switch(a._tag){case Ce:return T(s.getDone(),i=>n.error(i),i=>n.done(i));case Se:return h(n.emit(s.getEmit()),()=>r());case ne:return z(a.effect,i=>n.error(i),()=>r());case be:return dt(a,()=>r(),i=>n.error(i))}}));e=le(h($e(r()),a=>p(()=>this.addFinalizer(i=>h(we(a),()=>w(()=>{const o=this.restorePipe(i,s);return o!==void 0?o:l()}))))))}break}case lt:{const n=new q(this._currentChannel.value(),this._providedEnv,r=>p(()=>{const a=this._closeLastSubstream===void 0?l():this._closeLastSubstream;this._closeLastSubstream=c(a,f(r))}));n._input=this._input;const s=this._currentChannel;this._activeSubexecutor=new M(n,r=>s.k(r),void 0,[],(r,a)=>s.combineInners(r,a),(r,a)=>s.combineAll(r,a),r=>s.onPull(r),r=>s.onEmit(r)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case bn:{this._emitted=this._currentChannel.out,this._currentChannel=this._activeSubexecutor!==void 0?void 0:re(),e=qe();break}case La:{this.runEnsuring(this._currentChannel);break}case gn:{e=this.doneHalt(this._currentChannel.error());break}case Pn:{this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break}case vn:{const n=this._providedEnv===void 0?this._currentChannel.effect():c(this._currentChannel.effect(),pt(this._providedEnv));e=le(c(n,z(s=>{const r=this.doneHalt(s);return r!==void 0&&Re(r)?r.effect:l()},s=>{const r=this.doneSucceed(s);return r!==void 0&&Re(r)?r.effect:l()})));break}case On:{const n=this._input,s=new q(this._currentChannel.left(),this._providedEnv,r=>this._executeCloseLastSubstream(r));s._input=n,this._input=s,this.addFinalizer(r=>{const a=this.restorePipe(r,n);return a!==void 0?a:l()}),this._currentChannel=this._currentChannel.right();break}case Aa:{const n=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>p(()=>{this._providedEnv=n}));break}case kn:{const n=this._currentChannel;e=Be(this._input,R,s=>{this._currentChannel=n.more(s)},s=>{const r=a=>n.done.onExit(a);this._currentChannel=r(s)});break}case yn:{e=this.doneSucceed(this._currentChannel.evaluate());break}case $n:{e=this.doneSucceed(this._currentChannel.terminal);break}case wn:{this._currentChannel=this._currentChannel.channel();break}case In:{this._traceStack.push(this._currentChannel.trace),this.addFinalizer(()=>p(()=>{this._traceStack.pop()})),this._currentChannel=this._currentChannel.channel;break}default:this._currentChannel._tag}}catch(n){this._currentChannel=D(tn(n))}return e}stackToLines(){if(this._traceStack.length===0)return Ee();const e=[];let n=this._traceStack.length-1;for(;n>=0&&e.length<Et.traceStackLimit;){const s=this._traceStack[n];e.push(s),n=n-1}return As(e)}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(e){this._cancelled=e}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(e){this._inProgressFinalizer=e}popAllFinalizers(e){return ve(()=>{const n=[];let s=this._doneStack.pop();for(;s;)s._tag==="ContinuationFinalizer"&&n.push(s.finalizer),s=this._doneStack.pop();const r=n.length===0?l():Ge(n,e);return this.storeInProgressFinalizer(r),r})}popNextFinalizers(){const e=[];for(;this._doneStack.length!==0;){const n=this._doneStack[this._doneStack.length-1];if(n._tag===Ie)return e;e.push(n),this._doneStack.pop()}return e}restorePipe(e,n){return ve(()=>{const s=this._input;return this._input=n,s!==void 0?s.close(e):l()})}close(e){return ve(()=>{let n;const s=this._inProgressFinalizer;s!==void 0&&(n=c(s,Oe(p(()=>this.clearInProgressFinalizer()))));let r;const a=this.popAllFinalizers(e);a!==void 0&&(r=c(a,Oe(p(()=>this.clearInProgressFinalizer()))));const i=this._activeSubexecutor===void 0?void 0:this._activeSubexecutor.close(e);if(!(i===void 0&&n===void 0&&r===void 0))return c(v(Ke(i)),Ze(v(Ke(n))),Ze(v(Ke(r))),b(([[o,u],E])=>c(o,me(u),me(E))),ke,h(pe))})}doneSucceed(e){if(this._doneStack.length===0)return this._done=I(e),this._currentChannel=void 0,Y();const n=this._doneStack[this._doneStack.length-1];if(n._tag===Ie){this._doneStack.pop(),this._currentChannel=n.onSuccess(e);return}const s=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=s.reverse(),this._done=I(e),this._currentChannel=void 0,Y();const r=Ge(s.map(i=>i.finalizer),I(e));this.storeInProgressFinalizer(r);const a=c(r,Oe(p(()=>this.clearInProgressFinalizer())),ke,h(()=>p(()=>this.doneSucceed(e))));return le(a)}annotate(e){let n=e;if(Zr(n)&&ea(n.annotation)){const s=n.annotation.stack,r=this.stackToLines();n=yt(n.cause,new kt(c(s.length===0?r:r.length===0||Ct(s)===Ct(r)?s:c(s,xs(r)),zs,Ut(Et.traceStackLimit)),n.annotation.seq))}else n=yt(n,new kt(this.stackToLines(),Ns(Kr)));return n}doneHalt(e){if(this._doneStack.length===0)return this._done=k(e),this._currentChannel=void 0,Y();const n=this._doneStack[this._doneStack.length-1];if(n._tag===Ie){this._doneStack.pop(),this._currentChannel=n.onHalt(e);return}const s=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=s.reverse(),this._done=k(e),this._currentChannel=void 0,Y();const r=Ge(s.map(i=>i.finalizer),k(e));this.storeInProgressFinalizer(r);const a=c(r,Oe(p(()=>this.clearInProgressFinalizer())),ke,h(()=>p(()=>this.doneHalt(e))));return le(a)}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,Y()}runBracketOut(e){const n=c(this.provide(e.acquire()),z(s=>p(()=>{this._currentChannel=D(s)}),s=>p(()=>{this.addFinalizer(r=>this.provide(e.finalizer(s,r))),this._currentChannel=m(s)})),ke);return le(n)}provide(e){return this._providedEnv===void 0?e:c(e,pt(this._providedEnv))}runEnsuring(e){this.addFinalizer(e.finalizer),this._currentChannel=e.channel}addFinalizer(e){this._doneStack.push(new Ca(e))}runSubexecutor(){const e=this._activeSubexecutor;switch(e._tag){case dn:return this.pullFromChild(e.childExecutor,e.parentSubexecutor,e.onEmit,e);case tt:return this.pullFromUpstream(e);case nt:return this.drainChildExecutors(e);case hn:return this._emitted=e.value,this._activeSubexecutor=e.next,qe()}}replaceSubexecutor(e){this._currentChannel=void 0,this._activeSubexecutor=e}finishWithExit(e){return ve(()=>{const n=c(e,T(s=>this.doneHalt(s),s=>this.doneSucceed(s)));return this._activeSubexecutor=void 0,n===void 0?l():pa(n)})}finishSubexecutorWithCloseEffect(e,...n){this.addFinalizer(()=>c(n,Xe(r=>c(p(()=>r(e)),h(a=>a!==void 0?a:l())))));const s=c(e,T(r=>this.doneHalt(r),r=>this.doneSucceed(r)));return this._activeSubexecutor=void 0,s}applyUpstreamPullStrategy(e,n,s){switch(s._tag){case pn:{const r=!e||n.some(a=>a!==void 0);return[s.emitSeparator,r?[void 0,...n]:n]}case Ia:{const r=!e||n.some(a=>a!==void 0);return[s.emitSeparator,r?[...n,void 0]:n]}}}pullFromChild(e,n,s,r){return Be(e,R,a=>{const i=s(a);switch(i._tag){case _n:break;case ka:{this.finishWithDoneValue(e,n,i.value);break}case ya:{const o=n.enqueuePullFromChild(r);this.replaceSubexecutor(o);break}}this._activeSubexecutor=new He(a,this._activeSubexecutor)},T(a=>{const i=this.handleSubexecutorFailure(e,n,a);return i===void 0?void 0:wt(i)},a=>{this.finishWithDoneValue(e,n,a)}))}finishWithDoneValue(e,n,s){const r=n;switch(r._tag){case tt:{const a=new M(r.upstreamExecutor,r.createChild,r.lastDone!==void 0?r.combineChildResults(r.lastDone,s):s,r.activeChildExecutors,r.combineChildResults,r.combineWithChildResult,r.onPull,r.onEmit);this._closeLastSubstream=e.close(I(s)),this.replaceSubexecutor(a);break}case nt:{const a=new X(r.upstreamExecutor,r.lastDone!==void 0?r.combineChildResults(r.lastDone,s):s,r.activeChildExecutors,r.upstreamDone,r.combineChildResults,r.combineWithChildResult,r.onPull);this._closeLastSubstream=e.close(I(s)),this.replaceSubexecutor(a);break}}}handleSubexecutorFailure(e,n,s){return this.finishSubexecutorWithCloseEffect(k(s),r=>n.close(r),r=>e.close(r))}pullFromUpstream(e){if(e.activeChildExecutors.length===0)return this.performPullFromUpstream(e);const n=e.activeChildExecutors[0],s=new M(e.upstreamExecutor,e.createChild,e.lastDone,e.activeChildExecutors.slice(1),e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit);if(n===void 0)return this.performPullFromUpstream(s);this.replaceSubexecutor(new ye(n.childExecutor,s,n.onEmit))}performPullFromUpstream(e){return Be(e.upstreamExecutor,n=>{const s=this._closeLastSubstream===void 0?l():this._closeLastSubstream;return this._closeLastSubstream=void 0,c(this._executeCloseLastSubstream(s),f(n))},n=>{if(this._closeLastSubstream!==void 0){const i=this._closeLastSubstream;return this._closeLastSubstream=void 0,c(this._executeCloseLastSubstream(i),b(()=>{const o=new q(e.createChild(n),this._providedEnv,this._executeCloseLastSubstream);o._input=this._input;const[u,E]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(It(n)));this._activeSubexecutor=new ye(o,new M(e.upstreamExecutor,e.createChild,e.lastDone,E,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),Me(u)&&(this._activeSubexecutor=new He(u.value,this._activeSubexecutor))}))}const s=new q(e.createChild(n),this._providedEnv,this._executeCloseLastSubstream);s._input=this._input;const[r,a]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(It(n)));this._activeSubexecutor=new ye(s,new M(e.upstreamExecutor,e.createChild,e.lastDone,a,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),Me(r)&&(this._activeSubexecutor=new He(r.value,this._activeSubexecutor))},n=>{if(e.activeChildExecutors.some(a=>a!==void 0)){const a=new X(e.upstreamExecutor,e.lastDone,[void 0,...e.activeChildExecutors],e.upstreamExecutor.getDone(),e.combineChildResults,e.combineWithChildResult,e.onPull);if(this._closeLastSubstream!==void 0){const i=this._closeLastSubstream;return this._closeLastSubstream=void 0,c(this._executeCloseLastSubstream(i),b(()=>this.replaceSubexecutor(a)))}this.replaceSubexecutor(a);return}const s=this._closeLastSubstream,r=this.finishSubexecutorWithCloseEffect(c(n,Ms(a=>e.combineWithChildResult(e.lastDone,a))),()=>s,a=>e.upstreamExecutor.close(a));return r===void 0?void 0:wt(r)})}drainChildExecutors(e){if(e.activeChildExecutors.length===0){const a=this._closeLastSubstream;return a!==void 0&&this.addFinalizer(()=>x(a)),this.finishSubexecutorWithCloseEffect(e.upstreamDone,()=>a,i=>e.upstreamExecutor.close(i))}const n=e.activeChildExecutors[0],s=e.activeChildExecutors.slice(1);if(n===void 0){const[a,i]=this.applyUpstreamPullStrategy(!0,s,e.onPull(Oa(s.reduce((o,u)=>u!==void 0?o+1:o,0))));return this.replaceSubexecutor(new X(e.upstreamExecutor,e.lastDone,i,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull)),Me(a)?(this._emitted=a.value,qe()):void 0}const r=new X(e.upstreamExecutor,e.lastDone,s,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull);this.replaceSubexecutor(new ye(n.childExecutor,r,n.onEmit))}}const Ke=Mt(()=>t=>t!==void 0?t:l()),Ge=Mt(()=>(t,e)=>c(js(t,n=>v(n(e))),b(n=>c(qs(n),Bs(()=>Hs()))),h(n=>pe(n)))),dt=d(t=>(e,n,s)=>{const r=[e],a=()=>{const i=r.pop();if(i===void 0||i.upstream===void 0)return Ws("Unexpected end of input for channel execution");const o=i.upstream.run();switch(o._tag){case Se:{const u=i.onEmit(i.upstream.getEmit());return r.length===0?u===void 0?w(n):c(u,z(s,n)).traced(t):u===void 0?w(()=>a()).traced(t):c(u,z(s,()=>a())).traced(t)}case Ce:{const u=i.onDone(i.upstream.getDone());return r.length===0?u===void 0?w(n).traced(t):c(u,z(s,()=>n())).traced(t):u===void 0?w(()=>a()).traced(t):c(u,z(s,()=>a())).traced(t)}case ne:return r.push(i),c(i.onEffect(o.effect),Us(u=>w(()=>{const E=i.onDone(k(u));return E===void 0?l():E})),z(s,()=>a())).traced(t);case be:return r.push(i),r.push(o),w(()=>a()).traced(t)}};return a()}),Ba=d(t=>e=>c(Ha(e),Ks).traced(t)),Ha=t=>{const e=(n,s)=>Xs(p(()=>new q(t,void 0,R)),r=>w(()=>c(De(r.run(),r),Qs(n),f(A(n)),St(Js()))),(r,a)=>{const i=r.close(a);return i===void 0?l():jt(i,o=>na(s,Te(o)))});return h(Gs(),n=>h(ra(n,Vs),s=>h(Fe(),r=>h(Ys(e(r,s)),a=>St(A(r),Zs(a))))))},De=(t,e)=>{const n=t;switch(n._tag){case ne:return c(n.effect,h(()=>De(e.run(),e)));case Se:return De(e.run(),e);case Ce:return pe(e.getDone());case be:return dt(n,()=>De(e.run(),e),Te)}},Tn="Done",Ka="Await",Ga="@effect/stream/Channel/MergeDecision",Va=Symbol.for(Ga),Fn={[Va]:{_R:t=>t,_E0:t=>t,_Z0:t=>t,_E:t=>t,_Z:t=>t}},Ya=t=>{const e=Object.create(Fn);return e._tag=Tn,e.effect=t,e},Za=t=>{const e=Object.create(Fn);return e._tag=Ka,e.f=t,e},Rn="BothRunning",Ln="LeftDone",An="RightDone",Xa="@effect/stream/Channel/MergeState",Tt=Symbol.for(Xa),ht={[Tt]:Tt},Ve=(t,e)=>{const n=Object.create(ht);return n._tag=Rn,n.left=t,n.right=e,n},Ft=t=>{const e=Object.create(ht);return e._tag=Ln,e.f=t,e},Rt=t=>{const e=Object.create(ht);return e._tag=An,e.f=t,e},Z="Empty",de="Emit",he="Error",fe="Done",zn=t=>({_tag:Z,notifyProducer:t}),Ye=t=>({_tag:de,notifyConsumers:t}),Ja=t=>({_tag:he,cause:t}),Qa=t=>({_tag:fe,done:t});class ei{constructor(e){this.ref=e}awaitRead(){return O(e=>oe(ue(this.ref,n=>n._tag===Z?[A(n.notifyProducer),n]:[l(),n])).traced(e))}close(){return O(e=>er(n=>this.error(Vr(n))).traced(e))}done(e){return O(n=>c(ue(this.ref,s=>{switch(s._tag){case Z:return[A(s.notifyProducer),s];case de:return[c(s.notifyConsumers,Xe(r=>je(r,Je(e)))),Qa(e)];case he:return[G(),s];case fe:return[G(),s]}}),oe).traced(n))}emit(e){return O(n=>c(Fe(),h(s=>c(ue(this.ref,r=>{switch(r._tag){case Z:return[A(r.notifyProducer),r];case de:{const a=r.notifyConsumers[0],i=r.notifyConsumers.slice(1);if(a!==void 0)return[je(a,Qe(e)),i.length===0?zn(s):Ye(i)];throw new Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! Please report an issue at https://github.com/Effect-TS/stream/issues")}case he:return[G(),r];case fe:return[G(),r]}}),oe))).traced(n))}error(e){return O(n=>c(ue(this.ref,s=>{switch(s._tag){case Z:return[A(s.notifyProducer),s];case de:return[Xe(s.notifyConsumers,r=>Hr(r,e)),Ja(e)];case he:return[G(),s];case fe:return[G(),s]}}),oe).traced(n))}take(){return O(e=>this.takeWith(n=>k(Jr(n,Je)),n=>I(n),n=>tr(Qe(n))).traced(e))}takeWith(e,n,s){return O(r=>c(Fe(),h(a=>c(ue(this.ref,i=>{switch(i._tag){case Z:return[f(je(i.notifyProducer,void 0),bt(A(a),e,j(s,n))),Ye([a])];case de:return[bt(A(a),e,j(s,n)),Ye([...i.notifyConsumers,a])];case he:return[x(e(i.cause)),i];case fe:return[x(s(i.done)),i]}}),oe))).traced(r))}}const ti=d(t=>()=>c(Fe(),h(e=>en(zn(e))),b(e=>new ei(e))).traced(t)),ni=P(2,t=>(e,n)=>ai(e,()=>n).traced(t)),si=P(2,(t,e)=>(n,s)=>Ma(n,e(s),()=>{},()=>{}).traced(t)),xn=d(t=>e=>{const n=ze(()=>n,D,xe);return F(e,n).traced(t)}),ri=d(t=>e=>C(e,R).traced(t)),Nn=d(t=>e=>B(e.takeWith(D,n=>C(m(n),()=>Nn(e)),xe)).traced(t)),ai=P(2,(t,e)=>(n,s)=>C(n,r=>Dn(()=>e(s)(r))).traced(t)),ii=P(2,(t,e)=>(n,s)=>{const r=ge(a=>C(m(e(s)(a)),()=>r),se,Q);return F(n,r).traced(t)}),ci=P(4,(t,e)=>(n,s,r,a)=>li(c(ti(),h(i=>{const o=Nn(i);return b(Ze(Lt(F(o,n)),Lt(F(o,s))),([u,E])=>{const We=(S,_,Ue)=>(K,ie,N)=>{const Pe=W=>{const U=W;return U._tag===Tn?x($(f(we(_),U.effect))):b(nr(_),T(ce=>$(U.f(k(ce))),j(ce=>$(U.f(I(ce))),ce=>Un(m(ce),ae(N(U.f))))))};return T(S,W=>Pe(K(k(W))),j(W=>Pe(K(I(W))),W=>x(C(m(W),()=>C($($e(Ue)),U=>ae(ie(U,_)))))))},ae=S=>{switch(S._tag){case Rn:{const _=gt(Pt(S.left)),Ue=gt(Pt(S.right));return B(sr(_,Ue,(K,ie)=>f(we(ie),We(K,S.right,u)(e(r),Ve,N=>Ft(N))),(K,ie)=>f(we(ie),We(K,S.left,E)(e(a),(N,Pe)=>Ve(Pe,N),N=>Rt(N)))))}case Ln:return B(b(v(E),T(_=>$(S.f(k(_))),j(_=>$(S.f(I(_))),_=>C(m(_),()=>ae(Ft(S.f)))))));case An:return B(b(v(u),T(_=>$(S.f(k(_))),j(_=>$(S.f(I(_))),_=>C(m(_),()=>ae(Rt(S.f)))))))}};return c($(Le($e(u),$e(E),(S,_)=>Ve(S,_))),C(ae),ja(i))})}))).traced(t)),Wn=P(2,t=>(e,n)=>Ne(()=>{let s;const r=ge(i=>C(m(i),()=>r),i=>(s=di(i),D(tn(s))),Q),a=ze(i=>c(m(i),C(()=>a)),i=>{const o=ta(i);return Yr(o)&&hi(o.defect)&&ar(o.defect,s)?se(o.defect.error):D(i)},Q);return F(F(F(e,r),n),a).traced(t)})),oi=d(t=>e=>Ba(xn(e)).traced(t)),ui=d(t=>e=>B(ir(n=>b(aa(),s=>Wa(jt(n(sa(s)(e)),r=>$t(s,k(r))),(r,a)=>$t(s,a))))).traced(t)),Lt=d(t=>e=>b(rr(p(()=>new q(e,void 0,R)),(n,s)=>{const r=n.close(s);return r===void 0?l():r}),n=>w(()=>st(n.run(),n))).traced(t)),st=(t,e)=>{const n=t;switch(n._tag){case Ce:return T(e.getDone(),Te,s=>x(Je(s)));case Se:return x(Qe(e.getEmit()));case ne:return c(n.effect,h(()=>st(e.run(),e)));case be:return dt(n,()=>st(e.run(),e),s=>Te(s))}},B=d(t=>e=>ri($(e)).traced(t)),li=d(t=>e=>Ua(ui(e),(n,s)=>n,(n,s)=>n).traced(t)),Un=P(2,t=>(e,n)=>C(e,()=>n).traced(t)),rt=Symbol.for("@effect/stream/Channel/errors/ChannelException"),di=t=>({_tag:"ChannelException",[rt]:rt,error:t}),hi=t=>typeof t=="object"&&t!=null&&rt in t,fi=Ya,_i=Za;var Mn;const mi="@effect/stream/Sink",pi=Symbol.for(mi),Ei={_R:t=>t,_E:t=>t,_In:t=>t,_L:t=>t,_Z:t=>t};class ft{constructor(e){this.channel=e,this[Mn]=Ei}}Mn=pi;const Ci=(t,e,n)=>Pi(()=>new ft(jn(t,e,n))),jn=(t,e,n)=>e(t)?ge(s=>{const[r,a]=qn(t,s,e,n,0,s.length);return cr(a)?c(m(a),ni(r)):jn(r,e,n)},se,()=>Q(t)):Q(t),qn=(t,e,n,s,r,a)=>{if(r===a)return[t,Ee()];const i=s(t,c(e,or(r)));return n(i)?qn(i,e,n,s,r+1,a):[i,c(e,ur(r+1))]},Si=(t,e)=>bi(Ci(t,lr,e)),bi=t=>new ft(xn(t.channel)),gi=()=>Si(it(),(t,e)=>qt(e)),Pi=t=>new ft(Ne(()=>t().channel)),vi="Both",Oi={_tag:vi},ki=Oi;var Bn;const yi="@effect/stream/Stream",$i=Symbol.for(yi),wi={_R:t=>t,_E:t=>t,_A:t=>t};class y{constructor(e){this.channel=e,this[Bn]=wi}}Bn=$i;const Ii=4096,Di=t=>Hn(Cr(t)),Ti=new y(m(Ee())),Fi=L(2,(t,e)=>new y(c(t.channel,si(n=>c(n,Bt(s=>e(s).channel),pr(re(),(s,r)=>c(s,Un(r)))))))),Ri=t=>c(t,Fi(R)),Li=t=>new y(dr(t)?re():m(t)),Hn=t=>c(t,hr(qt),Ai),Ai=t=>new y(c(t,fr(_r(re,se),e=>m(ct(e))),B)),at=L(2,(t,e)=>new y(c(t.channel,ii(Bt(e))))),zi=L(3,(t,e,n)=>{const s=r=>ge(a=>{const[i,o]=c(a,mr(r,n));return c(m(o),C(()=>s(i)))},se,re);return new y(c(t.channel,F(s(e))))}),Kn=L(2,(t,e)=>{const n=s=>{const r=s.next();if(r.done)return ze(a=>n(a[Symbol.iterator]()),D,xe);{const a=r.value;return B(b(e(a),i=>C(m(ct(i)),()=>n(s))))}};return new y(c(t.channel,F(Ne(()=>n(Ee()[Symbol.iterator]())))))}),xi=L(2,(t,e)=>Ni(t,e,ki)),Ni=L(3,(t,e,n)=>Wi(t,e,R,R,n)),Wi=L(5,(t,e,n,s,r)=>{const a=i=>o=>i||!Er(o)?fi(pe(o)):_i(pe);return new y(ci(at(t,n).channel,at(e,s).channel,a(r._tag==="Either"||r._tag==="Left"),a(r._tag==="Either"||r._tag==="Right")))}),Ui=(t,e,n=Ii)=>Bi(()=>{if(t>=e)return Ti;const s=(r,a,i)=>{const o=a-r;return o>i?c(m(vt(r,r+i-1)),C(()=>s(r+i,a,i))):m(vt(r,r+o-1))};return new y(s(t,e,n))}),Mi=P(2,t=>(e,n)=>c(e.channel,Wn(n.channel),oi).traced(t)),ji=d(t=>e=>c(e,Mi(gi())).traced(t)),qi=t=>Li(ct(t)),Bi=t=>new y(Ne(()=>t().channel)),Hi=L(2,(t,e)=>{if(!Number.isInteger(e))return Di(Qr(`${e} must be an integer`));const n=s=>ge(r=>{const a=c(r,Ut(Math.min(s,Number.POSITIVE_INFINITY))),i=Math.max(0,s-a.length);return i>0?c(m(a),C(()=>n(i))):m(a)},se,xe);return new y(c(t.channel,Wn(0<e?n(e):re())))}),Ki=L(2,(t,e)=>Kn(t,n=>_e(e(n),n))),Gi=Ri,Vi=Hn,Yi=at,Gn=zi,Zi=Kn,Xi=xi,Ji=Ui,Qi=ji,ec=qi,tc=Hi,At=Ki;function _t(){return kr(hc(771))}const nc=c(l(),f(Ht),h(({width:t,height:e})=>c(l(),f(Sr(0,0,t,e)),h(n=>br(()=>createImageBitmap(n))),b(n=>c(gr(n,yr(t/-2,e/-2)))),H(n=>Pr(s=>Jt(c(Vt(0,0,t,e),f(Yt(t/2,e/2)),f($r(-s/4)),f(Qt(n)),f(ot(l(),ut(16)))))))))),sc=c(l(),f(Ht),H(({width:t,height:e})=>c(l(),f(Vt(0,0,t,e)),f(Yt(t/2,e/2)))),f(vr(3.5,3.5)),f(J(Kt,Gt(_t))),_e(null));function rc(t){return c(lc,Gn(3,(e,[n,s])=>[n==e**2?e+2:e,{nextSquare:e**2,isPrime:s,num:n}]),At(({isPrime:e})=>e?ot(l(),ut(16)):l()),At(uc(t)),Yi(ac),Zi(e=>J(rn,e)),tc(t))}function ac({num:t,isPrime:e,nextSquare:n}){return r=>c(Wt([Ur(e?3:1),Mr(e?"transparent":Ot(et(0,0,0,.25)))]),f(r.drawForward(3)),H(({position:[a,i]})=>e?Wr(Ot(et(Math.atan2(i,a)*180/Math.PI,.5,.5,1))):l()),f(r.turn(s(t,Math.sqrt(n)))),H(({position:a})=>e?xr(Nr(a[0],a[1],2,0,Math.PI*2)):l()),f(r.drawForward(3)));function s(r,a){const i=a-2,o=a**2,u=a-1,E=r-i**2;return r==2||i**2+1==r||r!=o&&E%u==0?Math.PI/2:0}}const Vn=ee(),ic=te(Xn("prime"),Vn),Yn=ee(),cc=te(Xn("latest"),Yn),Zn=ee(),oc=te(x(new Intl.NumberFormat),Zn);function uc(t){return({num:e,isPrime:n})=>J(Zn,s=>n?J(Vn,zt(s.format(e))):e>1e3&&e%100==0||e<=1e3&&e%10==0||e==t?J(Yn,zt(s.format(e))):l())}function Xn(t){return c(p(()=>Xt(document.getElementById(t))),h(Zt),wr)}function zt(t){return e=>p(()=>{e.innerText=t})}const lc=c(Ji(2,Number.MAX_SAFE_INTEGER),Gn(Ee(),dc),Gi);function dc(t,e){const n=e>1&&Or(t,r=>e%r!==0),s=[e,n];return[n?t.append(e):t,ec(s)]}const hc=t=>c(Vi(sc),Xi(rc(t)),Qi,h(e=>c(e,Rr(n=>Xt(n)),Zt,H(n=>Qt(fc(n))))),Jt,Fr,H(([e])=>Tr(`duration: ${e.millis}ms `)),f(ot(nc,ut(3e3))),f(J(Kt,Gt(_t))),V(da),V(oa),V(ic),V(cc),V(oc),V(Dr),Ir("canvas4"));function fc({position:[t,e]}){return Lr(zr(t,e,4),Ar(et(0,.5,0,.5)))}_t();
