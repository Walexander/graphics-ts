var Qf=Object.defineProperty;var Xf=(t,e,n)=>e in t?Qf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var l=(t,e,n)=>(Xf(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Zf=t=>typeof t=="function",u=function(t,e){if(typeof t=="function")return function(){return t(arguments)?e.apply(this,arguments):n=>e(n,...arguments)};switch(t){case 0:case 1:throw new RangeError(`Invalid arity ${t}`);case 2:return function(n,r){return arguments.length>=2?e(n,r):function(s){return e(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?e(n,r,s):function(o){return e(o,n,r)}};case 4:return function(n,r,s,o){return arguments.length>=4?e(n,r,s,o):function(c){return e(c,n,r,s)}};case 5:return function(n,r,s,o,c){return arguments.length>=5?e(n,r,s,o,c):function(i){return e(i,n,r,s,o)}};default:return function(){if(arguments.length>=t)return e.apply(this,arguments);const n=arguments;return function(r){return e(r,...n)}}}},K=t=>t,Ln=t=>()=>t,si=Ln(!0),Ks=Ln(!1),ya=Ln(void 0),oi=ya;function f(t,e,n,r,s,o,c,i,a){switch(arguments.length){case 1:return t;case 2:return e(t);case 3:return n(e(t));case 4:return r(n(e(t)));case 5:return s(r(n(e(t))));case 6:return o(s(r(n(e(t)))));case 7:return c(o(s(r(n(e(t))))));case 8:return i(c(o(s(r(n(e(t)))))));case 9:return a(i(c(o(s(r(n(e(t))))))));default:{let h=arguments[0];for(let d=1;d<arguments.length;d++)h=arguments[d](h);return h}}}function Et(t,e,n,r,s,o,c,i,a){switch(arguments.length){case 1:return t;case 2:return function(){return e(t.apply(this,arguments))};case 3:return function(){return n(e(t.apply(this,arguments)))};case 4:return function(){return r(n(e(t.apply(this,arguments))))};case 5:return function(){return s(r(n(e(t.apply(this,arguments)))))};case 6:return function(){return o(s(r(n(e(t.apply(this,arguments))))))};case 7:return function(){return c(o(s(r(n(e(t.apply(this,arguments)))))))};case 8:return function(){return i(c(o(s(r(n(e(t.apply(this,arguments))))))))};case 9:return function(){return a(i(c(o(s(r(n(e(t.apply(this,arguments)))))))))}}}const Sr="2.0.0-next.55",Us=Symbol.for(`effect/GlobalValue/globalStoreId/${Sr}`);Us in globalThis||(globalThis[Us]=new Map);const Is=globalThis[Us],P=(t,e)=>(Is.has(t)||Is.set(t,e()),Is.get(t)),th=t=>typeof t=="string",_a=t=>typeof t=="number",eh=t=>typeof t=="bigint",Uo=Zf,nh=t=>typeof t=="object"&&t!==null,Bo=t=>nh(t)||Uo(t),I=u(2,(t,e)=>Bo(t)&&e in t),ba=u(2,(t,e)=>I(t,"_tag")&&t._tag===e),Fe=t=>t==null,Sa=t=>I(t,Symbol.iterator),rh=335903614,sh=4150755663,oh=1481765933>>>0,ch=1284865837>>>0,ih=9007199254740992,ah=134217728;class va{constructor(e,n,r,s){l(this,"_state");return Fe(n)&&Fe(e)?(n=Math.random()*4294967295>>>0,e=0):Fe(n)&&(n=e,e=0),Fe(s)&&Fe(r)?(s=this._state?this._state[3]:sh,r=this._state?this._state[2]:rh):Fe(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),ci(this._state,this._state[0],this._state[1],e>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(e){this._state[0]=e[0],this._state[1]=e[1],this._state[2]=e[2],this._state[3]=e[3]|1}integer(e){if(!e)return this._next();if(e=e>>>0,!(e&e-1))return this._next()&e-1;let n=0;const r=(-e>>>0)%e>>>0;for(n=this._next();n<r;n=this._next());return n%e}number(){const e=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(e*ah+n)/ih}_next(){const e=this._state[0]>>>0,n=this._state[1]>>>0;uh(this._state,e,n,oh,ch),ci(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=e>>>18,s=(n>>>18|e<<14)>>>0;r=(r^e)>>>0,s=(s^n)>>>0;const o=(s>>>27|r<<5)>>>0,c=e>>>27,i=(-c>>>0&31)>>>0;return(o>>>c|o<<i)>>>0}}function uh(t,e,n,r,s){let o=(n>>>16)*(s&65535)>>>0,c=(n&65535)*(s>>>16)>>>0,i=(n&65535)*(s&65535)>>>0,a=(n>>>16)*(s>>>16)+((c>>>16)+(o>>>16))>>>0;c=c<<16>>>0,i=i+c>>>0,i>>>0<c>>>0&&(a=a+1>>>0),o=o<<16>>>0,i=i+o>>>0,i>>>0<o>>>0&&(a=a+1>>>0),a=a+Math.imul(n,r)>>>0,a=a+Math.imul(e,s)>>>0,t[0]=a,t[1]=i}function ci(t,e,n,r,s){let o=e+r>>>0;const c=n+s>>>0;c>>>0<n>>>0&&(o=o+1|0),t[0]=o,t[1]=c}const Fs=P(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),lh=P(Symbol.for("effect/Hash/pcgr"),()=>new va),R=Symbol.for("effect/Hash"),y=t=>{switch(typeof t){case"number":return zo(t);case"bigint":return ie(t.toString(10));case"boolean":return ie(String(t));case"symbol":return ie(String(t));case"string":return ie(t);case"undefined":return ie("undefined");case"function":case"object":return t===null?ie("null"):fh(t)?t[R]():xn(t);default:throw new Error(`BUG: unhandled typeof ${typeof t} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},xn=t=>(Fs.has(t)||Fs.set(t,zo(lh.integer(Number.MAX_SAFE_INTEGER))),Fs.get(t)),E=t=>e=>e*53^t,Jr=t=>t&3221225471|t>>>1&1073741824,fh=t=>I(t,R),zo=t=>{if(t!==t||t===1/0)return 0;let e=t|0;for(e!==t&&(e^=t*4294967295);t>4294967295;)e^=t/=4294967295;return Jr(t)},ie=t=>{let e=5381,n=t.length;for(;n;)e=e*33^t.charCodeAt(--n);return Jr(e)},hh=(t,e)=>{let n=12289;for(let r=0;r<e.length;r++)n^=f(ie(e[r]),E(y(t[e[r]])));return Jr(n)},$a=t=>hh(t,Object.keys(t)),Wo=t=>{let e=6151;for(let n=0;n<t.length;n++)e=f(e,E(y(t[n])));return Jr(e)},M=Symbol.for("effect/Equal");function O(){return arguments.length===1?t=>ii(t,arguments[0]):ii(arguments[0],arguments[1])}function ii(t,e){if(t===e)return!0;const n=typeof t;return n!==typeof e?!1:(n==="object"||n==="function")&&t!==null&&e!==null&&ai(t)&&ai(e)?y(t)===y(e)&&t[M](e):!1}const ai=t=>I(t,M),wa=()=>(t,e)=>O(t,e),Jo=t=>(e,n)=>e===n||t(e,n),gh=u(2,(t,e)=>Jo((n,r)=>t(e(n),e(r)))),ph=t=>Jo((e,n)=>{if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(!t(e[r],n[r]))return!1;return!0}),V=Symbol.for("nodejs.util.inspect.custom"),z=t=>I(t,"toJSON")&&Uo(t.toJSON)&&t.toJSON.length===0?t.toJSON():Array.isArray(t)?t.map(z):t,H=t=>JSON.stringify(t,null,2),k=(t,e)=>{switch(e.length){case 1:return e[0](t);case 2:return e[1](e[0](t));case 3:return e[2](e[1](e[0](t)));case 4:return e[3](e[2](e[1](e[0](t))));case 5:return e[4](e[3](e[2](e[1](e[0](t)))));case 6:return e[5](e[4](e[3](e[2](e[1](e[0](t))))));case 7:return e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))));case 8:return e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t))))))));case 9:return e[8](e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))))));default:{let n=t;for(let r=0,s=e.length;r<s;r++)n=e[r](n);return n}}},dh={[R](){return $a(this)},[M](t){const e=Object.keys(this),n=Object.keys(t);if(e.length!==n.length)return!1;for(const r of e)if(!(r in t&&O(this[r],t[r])))return!1;return!0}},Vo=function(){function t(e){e&&Object.assign(this,e)}return t.prototype=dh,t}(),hr="Async",ka="Commit",G="Failure",gr="OnFailure",vr="OnSuccess",$r="OnSuccessAndFailure",Y="Success",Ea="Sync",mh="Tag",Ye="UpdateRuntimeFlags",wr="While",Oa="WithRuntime",pr="Yield",Ho="RevertFlags",Ia=Symbol.for("effect/Effect"),yh=Symbol.for("effect/Stream"),_h=Symbol.for("effect/Sink"),bh=Symbol.for("effect/Channel"),Ae={_R:t=>t,_E:t=>t,_A:t=>t,_V:Sr},Sh={_R:t=>t,_E:t=>t,_In:t=>t,_L:t=>t,_Z:t=>t},vh={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutElem:t=>t,_OutDone:t=>t},Vr={[Ia]:Ae,[yh]:Ae,[_h]:Sh,[bh]:vh,[M](t){return this===t},[R](){return xn(this)},pipe(){return k(this,arguments)}},$h={...Vr,_op:ka};({...$h,...Vo.prototype});const Fa=Symbol.for("effect/Option"),Ra={...Vr,[Fa]:{_A:t=>t},[V](){return this.toJSON()},toString(){return H(this.toJSON())}},wh=Object.assign(Object.create(Ra),{_tag:"Some",_op:"Some",[M](t){return Ma(t)&&Ca(t)&&O(t.value,this.value)},[R](){return E(y(this._tag))(y(this.value))},toJSON(){return{_id:"Option",_tag:this._tag,value:z(this.value)}}}),kh=Object.assign(Object.create(Ra),{_tag:"None",_op:"None",[M](t){return Ma(t)&&Ta(t)},[R](){return E(y(this._tag))},toJSON(){return{_id:"Option",_tag:this._tag}}}),Ma=t=>I(t,Fa),Ta=t=>t._tag==="None",Ca=t=>t._tag==="Some",Na=Object.create(kh),Aa=t=>{const e=Object.create(wh);return e.value=t,e},Pa=Symbol.for("effect/Either"),La={...Vr,[Pa]:{_A:t=>t},[V](){return this.toJSON()},toString(){return H(this.toJSON())}},Eh=Object.assign(Object.create(La),{_tag:"Right",_op:"Right",[M](t){return xa(t)&&qa(t)&&O(t.right,this.right)},[R](){return E(y(this._tag))(y(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:z(this.right)}}}),Oh=Object.assign(Object.create(La),{_tag:"Left",_op:"Left",[M](t){return xa(t)&&Da(t)&&O(t.left,this.left)},[R](){return E(y(this._tag))(y(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:z(this.left)}}}),xa=t=>I(t,Pa),Da=t=>t._tag==="Left",qa=t=>t._tag==="Right",Ih=t=>{const e=Object.create(Oh);return e.left=t,e},Fh=t=>{const e=Object.create(Eh);return e.right=t,e},ja=t=>(e,n)=>e===n?0:t(e,n),Rh=ja((t,e)=>t<e?-1:1),Mh=u(2,(t,e)=>ja((n,r)=>t(e(n),e(r)))),Th=t=>u(2,(e,n)=>t(e,n)===1),$=()=>Na,v=Aa,U=Ta,A=Ca,Ft=u(2,(t,{onNone:e,onSome:n})=>U(t)?e():n(t.value)),At=u(2,(t,e)=>U(t)?e():t.value),yw=u(2,(t,e)=>U(t)?e():t),Dn=t=>t==null?$():v(t),ae=At(ya),Ch=u(2,(t,e)=>{if(A(t))return t.value;throw e()}),Nh=Ch(()=>new Error("getOrThrow called on a None")),Sn=u(2,(t,e)=>U(t)?$():v(e(t.value))),Ka=u(2,(t,e)=>U(t)?$():e(t.value)),Ah=t=>e=>t(e)?v(e):$(),Ph=t=>u(2,(e,n)=>U(e)?!1:t(e.value,n)),Lh=wa(),xh=Ph(Lh),Dh=t=>!t,pt=Fh,Rt=Ih,yn=Da,_n=qa,qh=u(2,(t,{onLeft:e,onRight:n})=>yn(t)?e(t.left):n(t.right)),jh=qh({onLeft:K,onRight:K}),Kh=t=>t.length>0,Go=(t,e)=>{const n=Math.max(1,Math.floor(t)),r=[e(0)];for(let s=1;s<n;s++)r.push(e(s));return r},Uh=(t,e)=>t<=e?Go(e-t+1,n=>t+n):[t],nt=t=>Array.isArray(t)?t:Array.from(t),Bh=u(2,(t,{onEmpty:e,onNonEmpty:n})=>qt(t)?n(t):e()),Dt=u(2,(t,e)=>[e,...t]),Ua=u(2,(t,e)=>[...t,e]),zh=t=>t.length===0,Yo=zh,qt=Kh,Ba=(t,e)=>t<0||t>=e.length,Wh=u(2,(t,e)=>{const n=Math.floor(e);return Ba(n,t)?$():v(t[n])}),za=u(2,(t,e)=>{const n=Math.floor(e);if(Ba(n,t))throw new Error(`Index ${n} out of bounds`);return t[n]}),Wa=Wh(0),Z=za(0),Jh=t=>qt(t)?v(Vh(t)):$(),Vh=t=>t[t.length-1],ge=t=>t.slice(1),ui=t=>Array.from(t).reverse(),Ja=u(2,(t,e)=>{const n=Array.from(t);return n.sort(e),n}),li=u(2,(t,e)=>Hh(t,e,(n,r)=>[n,r])),Hh=u(3,(t,e,n)=>{const r=nt(t),s=nt(e);return qt(r)&&qt(s)?Gh(s,n)(r):[]}),Gh=u(3,(t,e,n)=>{const r=[n(Z(t),Z(e))],s=Math.min(t.length,e.length);for(let o=1;o<s;o++)r[o]=n(t[o],e[o]);return r}),Yh=u(2,(t,e)=>{const n=[Z(t)],r=ge(t);for(const s of r)n.every(o=>!e(s,o))&&n.push(s);return n}),_w=u(2,(t,e)=>{const n=Array.from(t);return e>=1&&qt(n)?Xh(n,e):Yo(n)?[n,[]]:[[],n]}),Qh=t=>t.slice(),Xh=u(2,(t,e)=>{const n=Math.max(1,e);return n>=t.length?[Qh(t),[]]:[Dt(t.slice(1,n),Z(t)),t.slice(n)]}),wn=()=>[],kt=t=>[t],Ce=u(2,(t,e)=>t.map(e)),Zh=u(2,(t,e)=>{if(Yo(t))return[];const n=[];for(let r=0;r<t.length;r++)n.push(...e(t[r],r));return n}),tg=Zh(K),Va=u(2,(t,e)=>{const n=nt(t),r=[];for(let s=0;s<n.length;s++){const o=e(n[s],s);A(o)&&r.push(o.value)}return r}),Qt=u(3,(t,e,n)=>nt(t).reduce((r,s,o)=>n(r,s,o),e)),fi=(t,e)=>{const n=[];let r=t,s;for(;A(s=e(r));){const[o,c]=s.value;n.push(o),r=c}return n},eg=ph,ng=u(2,(t,e)=>{const n=nt(t);return qt(n)?Yh(e)(n):[]}),rg=ng(wa()),Qe=u(2,(t,e)=>nt(t).join(e)),sg=u(3,(t,e,n)=>{let r=e;const s=[];for(const o of t){const c=n(r,o);r=c[0],s.push(c[1])}return[r,s]}),Ha=Symbol.for("effect/Context/Tag"),og="effect/STM",cg=Symbol.for(og),ig={...Vr,_tag:"Tag",_op:"Tag",[cg]:Ae,[Ha]:{_S:t=>t,_I:t=>t},toString(){return H(this.toJSON())},toJSON(){return{_id:"Tag",identifier:this.identifier,stack:this.stack}},[V](){return this.toJSON()},of(t){return t},context(t){return Qa(this,t)}},Rs=P("effect/Context/Tag/tagRegistry",()=>new Map),ag=t=>{if(t&&Rs.has(t))return Rs.get(t);const e=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=e;const r=Object.create(ig);return Object.defineProperty(r,"stack",{get(){return n.stack}}),t&&(r.identifier=t,Rs.set(t,r)),r},Ga=Symbol.for("effect/Context"),ug={[Ga]:{_S:t=>t},[M](t){if(Ya(t)&&this.unsafeMap.size===t.unsafeMap.size){for(const e of this.unsafeMap.keys())if(!t.unsafeMap.has(e)||!O(this.unsafeMap.get(e),t.unsafeMap.get(e)))return!1;return!0}return!1},[R](){return zo(this.unsafeMap.size)},pipe(){return k(this,arguments)},toString(){return H(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(z)}},[V](){return this.toJSON()}},jt=t=>{const e=Object.create(ug);return e.unsafeMap=t,e},lg=t=>{const e=new Error(`Service not found${t.identifier?`: ${String(t.identifier)}`:""}`);if(t.stack){const n=t.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(e.message=e.message+` (defined at ${r[1]})`)}}if(e.stack){const n=e.stack.split(`
`);n.splice(1,3),e.stack=n.join(`
`)}return e},Ya=t=>I(t,Ga),fg=t=>I(t,Ha),hg=jt(new Map),gg=()=>hg,Qa=(t,e)=>jt(new Map([[t,e]])),pg=u(3,(t,e,n)=>{const r=new Map(t.unsafeMap);return r.set(e,n),jt(r)}),Xa=u(2,(t,e)=>{if(!t.unsafeMap.has(e))throw lg(e);return t.unsafeMap.get(e)}),dg=Xa,mg=u(2,(t,e)=>t.unsafeMap.has(e)?Aa(t.unsafeMap.get(e)):Na),yg=u(2,(t,e)=>{const n=new Map(t.unsafeMap);for(const[r,s]of e.unsafeMap)n.set(r,s);return jt(n)}),_g=(...t)=>e=>{const n=new Set(t),r=new Map;for(const[s,o]of e.unsafeMap.entries())n.has(s)&&r.set(s,o);return jt(r)},bg=(...t)=>e=>{const n=new Map(e.unsafeMap);for(const r of t)n.delete(r);return jt(n)},yt=ag,Sg=jt,Za=Ya,Qo=fg,Hr=gg,Gr=Qa,Jt=pg,Pt=dg,Xo=Xa,we=mg,Yr=yg,vg=_g,$g=bg,wg=Object.freeze(Object.defineProperty({__proto__:null,Tag:yt,add:Jt,empty:Hr,get:Pt,getOption:we,isContext:Za,isTag:Qo,make:Gr,merge:Yr,omit:$g,pick:vg,unsafeGet:Xo,unsafeMake:Sg},Symbol.toStringTag,{value:"Module"})),tu=Symbol.for("effect/Chunk");function kg(t,e,n,r,s){for(let o=e;o<Math.min(t.length,e+s);o++)n[r+o-e]=t[o];return n}const eu=[],Eg=t=>Jo((e,n)=>e.length===n.length&&Lt(e).every((r,s)=>t(r,Gt(n,s)))),Og=Eg(O),Ig={[tu]:{_A:t=>t},toString(){return H(this.toJSON())},toJSON(){return{_id:"Chunk",values:Lt(this).map(z)}},[V](){return this.toJSON()},[M](t){return nu(t)&&Og(this,t)},[R](){return Wo(Lt(this))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return eu[Symbol.iterator]();default:return Lt(this)[Symbol.iterator]()}},pipe(){return k(this,arguments)}},B=t=>{const e=Object.create(Ig);switch(e.backing=t,t._tag){case"IEmpty":{e.length=0,e.depth=0,e.left=e,e.right=e;break}case"IConcat":{e.length=t.left.length+t.right.length,e.depth=1+Math.max(t.left.depth,t.right.depth),e.left=t.left,e.right=t.right;break}case"IArray":{e.length=t.array.length,e.depth=0,e.left=_t,e.right=_t;break}case"ISingleton":{e.length=1,e.depth=0,e.left=_t,e.right=_t;break}case"ISlice":{e.length=t.length,e.depth=t.chunk.depth+1,e.left=_t,e.right=_t;break}}return e},nu=t=>I(t,tu),_t=B({_tag:"IEmpty"}),Mt=()=>_t,lt=t=>B({_tag:"ISingleton",a:t}),qn=t=>nu(t)?t:B({_tag:"IArray",array:nt(t)}),Bs=(t,e,n)=>{switch(t.backing._tag){case"IArray":{kg(t.backing.array,0,e,n,t.length);break}case"IConcat":{Bs(t.left,e,n),Bs(t.right,e,n+t.left.length);break}case"ISingleton":{e[n]=t.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<t.length;)e[s]=Gt(t,r),r+=1,s+=1;break}}},Lt=t=>{switch(t.backing._tag){case"IEmpty":return eu;case"IArray":return t.backing.array;default:{const e=new Array(t.length);return Bs(t,e,0),t.backing={_tag:"IArray",array:e},t.left=_t,t.right=_t,t.depth=0,e}}},Pe=t=>{switch(t.backing._tag){case"IEmpty":case"ISingleton":return t;case"IArray":return B({_tag:"IArray",array:ui(t.backing.array)});case"IConcat":return B({_tag:"IConcat",left:Pe(t.backing.right),right:Pe(t.backing.left)});case"ISlice":return St(ui(Lt(t)))}},ru=u(2,(t,e)=>e<0||e>=t.length?$():v(Gt(t,e))),St=t=>B({_tag:"IArray",array:t}),Gt=u(2,(t,e)=>{switch(t.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(e!==0)throw new Error("Index out of bounds");return t.backing.a}case"IArray":{if(e>=t.length||e<0)throw new Error("Index out of bounds");return t.backing.array[e]}case"IConcat":return e<t.left.length?Gt(t.left,e):Gt(t.right,e-t.left.length);case"ISlice":return Gt(t.backing.chunk,e+t.backing.offset)}}),Fg=u(2,(t,e)=>su(t,lt(e))),mt=u(2,(t,e)=>su(lt(e),t)),zs=u(2,(t,e)=>{if(e<=0)return _t;if(e>=t.length)return t;switch(t.backing._tag){case"ISlice":return B({_tag:"ISlice",chunk:t.backing.chunk,length:e,offset:t.backing.offset});case"IConcat":return e>t.left.length?B({_tag:"IConcat",left:t.left,right:zs(t.right,e-t.left.length)}):zs(t.left,e);default:return B({_tag:"ISlice",chunk:t,offset:0,length:e})}}),kn=u(2,(t,e)=>{if(e<=0)return t;if(e>=t.length)return _t;switch(t.backing._tag){case"ISlice":return B({_tag:"ISlice",chunk:t.backing.chunk,offset:t.backing.offset+e,length:t.backing.length-e});case"IConcat":return e>t.left.length?kn(t.right,e-t.left.length):B({_tag:"IConcat",left:kn(t.left,e),right:t.right});default:return B({_tag:"ISlice",chunk:t,offset:e,length:t.length-e})}}),Nt=u(2,(t,e)=>{if(t.backing._tag==="IEmpty")return e;if(e.backing._tag==="IEmpty")return t;const n=e.depth-t.depth;if(Math.abs(n)<=1)return B({_tag:"IConcat",left:t,right:e});if(n<-1)if(t.left.depth>=t.right.depth){const r=Nt(t.right,e);return B({_tag:"IConcat",left:t.left,right:r})}else{const r=Nt(t.right.right,e);if(r.depth===t.depth-3){const s=B({_tag:"IConcat",left:t.right.left,right:r});return B({_tag:"IConcat",left:t.left,right:s})}else{const s=B({_tag:"IConcat",left:t.left,right:t.right.left});return B({_tag:"IConcat",left:s,right:r})}}else if(e.right.depth>=e.left.depth){const r=Nt(t,e.left);return B({_tag:"IConcat",left:r,right:e.right})}else{const r=Nt(t,e.left.left);if(r.depth===e.depth-3){const s=B({_tag:"IConcat",left:r,right:e.left.right});return B({_tag:"IConcat",left:s,right:e.right})}else{const s=B({_tag:"IConcat",left:e.left.right,right:e.right});return B({_tag:"IConcat",left:r,right:s})}}}),su=u(2,(t,e)=>Nt(t,e)),bw=u(2,(t,e)=>St(Va(t,e))),Sw=u(2,(t,e)=>St(Va(t,Ah(e)))),Zo=t=>t.length===0,pe=t=>t.length>0,Ms=ru(0),En=t=>Gt(t,0),de=En,vw=t=>ru(t,t.length-1),Rg=t=>Gt(t,t.length-1),ou=u(2,(t,e)=>t.backing._tag==="ISingleton"?lt(e(t.backing.a,0)):St(f(Lt(t),Ce((n,r)=>e(n,r))))),$w=u(3,(t,e,n)=>{const[r,s]=sg(t,e,n);return[r,St(s)]}),ww=t=>t.length,Ws=u(2,(t,e)=>St(Ja(Lt(t),e))),Mg=u(2,(t,e)=>[zs(t,e),kn(t,e)]),Tg=u(2,(t,e)=>{let n=0;for(const r of Lt(t)){if(e(r))break;n++}return Mg(t,n)}),Vt=t=>kn(t,1),Cg=t=>St(rg(Lt(t))),Ng=u(2,(t,e)=>qn(Go(t,e))),kw=(t,e)=>t<=e?Ng(e-t+1,n=>t+n):lt(t),Ew=u(2,(t,e)=>nt(t).every(e)),Ow=u(2,(t,e)=>nt(t).some(e)),Iw=Qt,me=5,tc=Math.pow(2,me),Ag=tc-1,Pg=tc/2,Lg=tc/4;function xg(t){return t-=t>>1&1431655765,t=(t&858993459)+(t>>2&858993459),t=t+(t>>4)&252645135,t+=t>>8,t+=t>>16,t&127}function Le(t,e){return e>>>t&Ag}function Te(t){return 1<<t}function cu(t,e){return xg(t&e-1)}class Dg{constructor(e,n){l(this,"value");l(this,"previous");this.value=e,this.previous=n}}function Ne(t,e,n,r){let s=r;if(!t){const o=r.length;s=new Array(o);for(let c=0;c<o;++c)s[c]=r[c]}return s[e]=n,s}function iu(t,e,n){const r=n.length-1;let s=0,o=0,c=n;if(t)s=o=e;else for(c=new Array(r);s<e;)c[o++]=n[s++];for(++s;s<=r;)c[o++]=n[s++];return t&&(c.length=r),c}function qg(t,e,n,r){const s=r.length;if(t){let a=s;for(;a>=e;)r[a--]=r[a];return r[e]=n,r}let o=0,c=0;const i=new Array(s+1);for(;o<e;)i[c++]=r[o++];for(i[e]=n;o<s;)i[++c]=r[o++];return i}class Xt{constructor(){l(this,"_tag","EmptyNode")}modify(e,n,r,s,o,c){const i=r($());return U(i)?new Xt:(++c.value,new he(e,s,o,i))}}function bt(t){return ba(t,"EmptyNode")}function jg(t){return bt(t)||t._tag==="LeafNode"||t._tag==="CollisionNode"}function Qr(t,e){return bt(t)?!1:e===t.edit}class he{constructor(e,n,r,s){l(this,"edit");l(this,"hash");l(this,"key");l(this,"value");l(this,"_tag","LeafNode");this.edit=e,this.hash=n,this.key=r,this.value=s}modify(e,n,r,s,o,c){if(O(o,this.key)){const a=r(this.value);return a===this.value?this:U(a)?(--c.value,new Xt):Qr(this,e)?(this.value=a,this):new he(e,s,o,a)}const i=r($());return U(i)?this:(++c.value,au(e,n,this.hash,this,s,new he(e,s,o,i)))}}class ec{constructor(e,n,r){l(this,"edit");l(this,"hash");l(this,"children");l(this,"_tag","CollisionNode");this.edit=e,this.hash=n,this.children=r}modify(e,n,r,s,o,c){if(s===this.hash){const a=Qr(this,e),h=this.updateCollisionList(a,e,this.hash,this.children,r,o,c);return h===this.children?this:h.length>1?new ec(e,this.hash,h):h[0]}const i=r($());return U(i)?this:(++c.value,au(e,n,this.hash,this,s,new he(e,s,o,i)))}updateCollisionList(e,n,r,s,o,c,i){const a=s.length;for(let d=0;d<a;++d){const p=s[d];if("key"in p&&O(c,p.key)){const m=p.value,b=o(m);return b===m?s:U(b)?(--i.value,iu(e,d,s)):Ne(e,d,new he(n,r,c,b),s)}}const h=o($());return U(h)?s:(++i.value,Ne(e,a,new he(n,r,c,h),s))}}class xe{constructor(e,n,r){l(this,"edit");l(this,"mask");l(this,"children");l(this,"_tag","IndexedNode");this.edit=e,this.mask=n,this.children=r}modify(e,n,r,s,o,c){const i=this.mask,a=this.children,h=Le(n,s),d=Te(h),p=cu(i,d),m=i&d,b=Qr(this,e);if(!m){const wt=new Xt().modify(e,n+me,r,s,o,c);return wt?a.length>=Pg?Ug(e,h,wt,i,a):new xe(e,i|d,qg(b,p,wt,a)):this}const S=a[p],L=S.modify(e,n+me,r,s,o,c);if(S===L)return this;let q=i,j;if(bt(L)){if(q&=~d,!q)return new Xt;if(a.length<=2&&jg(a[p^1]))return a[p^1];j=iu(b,p,a)}else j=Ne(b,p,L,a);return b?(this.mask=q,this.children=j,this):new xe(e,q,j)}}class nc{constructor(e,n,r){l(this,"edit");l(this,"size");l(this,"children");l(this,"_tag","ArrayNode");this.edit=e,this.size=n,this.children=r}modify(e,n,r,s,o,c){let i=this.size;const a=this.children,h=Le(n,s),d=a[h],p=(d||new Xt).modify(e,n+me,r,s,o,c);if(d===p)return this;const m=Qr(this,e);let b;if(bt(d)&&!bt(p))++i,b=Ne(m,h,p,a);else if(!bt(d)&&bt(p)){if(--i,i<=Lg)return Kg(e,i,h,a);b=Ne(m,h,new Xt,a)}else b=Ne(m,h,p,a);return m?(this.size=i,this.children=b,this):new nc(e,i,b)}}function Kg(t,e,n,r){const s=new Array(e-1);let o=0,c=0;for(let i=0,a=r.length;i<a;++i)if(i!==n){const h=r[i];h&&!bt(h)&&(s[o++]=h,c|=1<<i)}return new xe(t,c,s)}function Ug(t,e,n,r,s){const o=[];let c=r,i=0;for(let a=0;c;++a)c&1&&(o[a]=s[i++]),c>>>=1;return o[e]=n,new nc(t,i+1,o)}function Bg(t,e,n,r,s,o){if(n===s)return new ec(t,n,[o,r]);const c=Le(e,n),i=Le(e,s);if(c===i)return a=>new xe(t,Te(c)|Te(i),[a]);{const a=c<i?[r,o]:[o,r];return new xe(t,Te(c)|Te(i),a)}}function au(t,e,n,r,s,o){let c,i=e;for(;;){const a=Bg(t,i,n,r,s,o);if(typeof a=="function")c=new Dg(a,c),i=i+me;else{let h=a;for(;c!=null;)h=c.value(h),c=c.previous;return h}}}const uu="effect/HashMap",Js=Symbol.for(uu),zg={[Js]:Js,[Symbol.iterator](){return new Xr(this,(t,e)=>[t,e])},[R](){let t=y(uu);for(const e of this)t^=f(y(e[0]),E(y(e[1])));return t},[M](t){if(Vg(t)){if(t._size!==this._size)return!1;for(const e of this){const n=f(t,sc(e[0],y(e[0])));if(U(n))return!1;if(!O(e[1],n.value))return!1}return!0}return!1},toString(){return H(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(z)}},[V](){return this.toJSON()},pipe(){return k(this,arguments)}},rc=(t,e,n,r)=>{const s=Object.create(zg);return s._editable=t,s._edit=e,s._root=n,s._size=r,s};class Xr{constructor(e,n){l(this,"map");l(this,"f");l(this,"v");this.map=e,this.f=n,this.v=lu(this.map._root,this.f,void 0)}next(){if(U(this.v))return{done:!0,value:void 0};const e=this.v.value;return this.v=kr(e.cont),{done:!1,value:e.value}}[Symbol.iterator](){return new Xr(this.map,this.f)}}const kr=t=>t?fu(t[0],t[1],t[2],t[3],t[4]):$(),lu=(t,e,n=void 0)=>{switch(t._tag){case"LeafNode":return A(t.value)?v({value:e(t.key,t.value.value),cont:n}):kr(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=t.children;return fu(r.length,r,0,e,n)}default:return kr(n)}},fu=(t,e,n,r,s)=>{for(;n<t;){const o=e[n++];if(o&&!bt(o))return lu(o,r,[t,e,n,r,s])}return kr(s)},Wg=rc(!1,0,new Xt,0),Zr=()=>Wg,Jg=(...t)=>hu(t),hu=t=>{const e=pu(Zr());for(const n of t)On(e,n[0],n[1]);return Xg(e)},Vg=t=>I(t,Js),Hg=t=>t&&bt(t._root),Gg=u(2,(t,e)=>sc(t,e,y(e))),sc=u(3,(t,e,n)=>{let r=t._root,s=0;for(;;)switch(r._tag){case"LeafNode":return O(e,r.key)?r.value:$();case"CollisionNode":{if(n===r.hash){const o=r.children;for(let c=0,i=o.length;c<i;++c){const a=o[c];if("key"in a&&O(e,a.key))return a.value}}return $()}case"IndexedNode":{const o=Le(s,n),c=Te(o);if(r.mask&c){r=r.children[cu(r.mask,c)],s+=me;break}return $()}case"ArrayNode":{if(r=r.children[Le(s,n)],r){s+=me;break}return $()}default:return $()}}),Yg=u(2,(t,e)=>A(sc(t,e,y(e)))),On=u(3,(t,e,n)=>du(t,e,()=>v(n))),Qg=u(3,(t,e,n)=>t._editable?(t._root=e,t._size=n,t):e===t._root?t:rc(t._editable,t._edit,e,n)),gu=t=>new Xr(t,e=>e),Er=t=>t._size,pu=t=>rc(!0,t._edit+1,t._root,t._size),Xg=t=>(t._editable=!1,t),du=u(3,(t,e,n)=>Zg(t,e,y(e),n)),Zg=u(4,(t,e,n,r)=>{const s={value:t._size},o=t._root.modify(t._editable?t._edit:NaN,0,r,n,e,s);return f(t,Qg(o,s.value))}),hi=u(2,(t,e)=>du(t,e,$)),tp=u(2,(t,e)=>ts(t,Zr(),(n,r,s)=>On(n,s,e(r,s)))),ep=u(2,(t,e)=>ts(t,void 0,(n,r,s)=>e(r,s))),ts=u(3,(t,e,n)=>{const r=t._root;if(r._tag==="LeafNode")return A(r.value)?n(e,r.value.value,r.key):e;if(r._tag==="EmptyNode")return e;const s=[r.children];let o;for(;o=s.pop();)for(let c=0,i=o.length;c<i;){const a=o[c++];a&&!bt(a)&&(a._tag==="LeafNode"?A(a.value)&&(e=n(e,a.value.value,a.key)):s.push(a.children))}return e}),mu="effect/HashSet",Vs=Symbol.for(mu),np={[Vs]:Vs,[Symbol.iterator](){return gu(this._keyMap)},[R](){return E(y(this._keyMap))(y(mu))},[M](t){return yu(t)?Er(this._keyMap)===Er(t._keyMap)&&O(this._keyMap,t._keyMap):!1},toString(){return H(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(z)}},[V](){return this.toJSON()},pipe(){return k(this,arguments)}},es=t=>{const e=Object.create(np);return e._keyMap=t,e},yu=t=>I(t,Vs),rp=es(Zr()),ns=()=>rp,sp=t=>{const e=oc(ns());for(const n of t)In(e,n);return cc(e)},op=(...t)=>{const e=oc(ns());for(const n of t)In(e,n);return cc(e)},cp=u(2,(t,e)=>Yg(t._keyMap,e)),ip=t=>Er(t._keyMap),oc=t=>es(pu(t._keyMap)),cc=t=>(t._keyMap._editable=!1,t),_u=u(2,(t,e)=>{const n=oc(t);return e(n),cc(n)}),In=u(2,(t,e)=>t._keyMap._editable?(On(e,!0)(t._keyMap),t):es(On(e,!0)(t._keyMap))),bu=u(2,(t,e)=>t._keyMap._editable?(hi(e)(t._keyMap),t):es(hi(e)(t._keyMap))),ap=u(2,(t,e)=>_u(t,n=>{for(const r of e)bu(n,r)})),up=u(2,(t,e)=>_u(ns(),n=>{lp(t,r=>In(n,r));for(const r of e)In(n,r)})),lp=u(2,(t,e)=>ep(t._keyMap,(n,r)=>e(r))),fp=u(3,(t,e,n)=>ts(t._keyMap,e,(r,s,o)=>n(r,o))),hp=yu,Tt=ns,ic=sp,rs=op,gp=cp,ac=ip,vn=In,Su=bu,gi=ap,Zt=up,Or=fp,pi=Symbol.for("effect/MutableRef"),pp={[pi]:pi,toString(){return H(this.toJSON())},toJSON(){return{_id:"MutableRef",current:z(this.current)}},[V](){return this.toJSON()},pipe(){return k(this,arguments)}},Xe=t=>{const e=Object.create(pp);return e.current=t,e},dp=u(3,(t,e,n)=>O(e,t.current)?(t.current=n,!0):!1),Ut=t=>t.current,mp=t=>bp(t,e=>e+1),ke=u(2,(t,e)=>(t.current=e,t)),yp=u(2,(t,e)=>(t.current=e,t.current)),_p=u(2,(t,e)=>ke(t,e(Ut(t)))),bp=u(2,(t,e)=>yp(t,e(Ut(t)))),ss="effect/FiberId",ye=Symbol.for(ss),Fn="None",Hs="Runtime",Gs="Composite";var F$;let Sp=class{constructor(){l(this,F$,ye);l(this,"_tag",Fn)}[(F$=ye,R)](){return f(y(ss),E(y(this._tag)))}[M](e){return uc(e)&&e._tag===Fn}toString(){return H(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[V](){return this.toJSON()}};var R$;class vp{constructor(e,n){l(this,"id");l(this,"startTimeMillis");l(this,R$,ye);l(this,"_tag",Hs);this.id=e,this.startTimeMillis=n}[(R$=ye,R)](){return f(y(ss),E(y(this._tag)),E(y(this.id)),E(y(this.startTimeMillis)))}[M](e){return uc(e)&&e._tag===Hs&&this.id===e.id&&this.startTimeMillis===e.startTimeMillis}toString(){return H(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[V](){return this.toJSON()}}var M$;class $p{constructor(e,n){l(this,"left");l(this,"right");l(this,M$,ye);l(this,"_tag",Gs);this.left=e,this.right=n}[(M$=ye,R)](){return f(y(ss),E(y(this._tag)),E(y(this.left)),E(y(this.right)))}[M](e){return uc(e)&&e._tag===Gs&&O(this.left,e.left)&&O(this.right,e.right)}toString(){return H(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,left:z(this.left),right:z(this.right)}}[V](){return this.toJSON()}}const wp=new Sp,uc=t=>I(t,ye),kp=u(2,(t,e)=>t._tag===Fn?e:e._tag===Fn?t:new $p(t,e)),Ys=t=>{switch(t._tag){case Fn:return Tt();case Hs:return rs(t.id);case Gs:return f(Ys(t.left),Zt(Ys(t.right)))}},di=P(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>Xe(0)),vu=t=>Array.from(Ys(t)).map(n=>`#${n}`).join(","),Ep=()=>{const t=Ut(di);return f(di,ke(t+1)),new vp(t,new Date().getTime())},jn=wp,Op=kp,Ip=vu,$u=Ep,os=Zr,Fp=Jg,wu=hu,Rp=Hg,lc=Gg,fc=On,ku=gu,Mp=Er,Eu=tp,Ou=ts,Rn=Symbol.for("effect/List"),Ir=t=>Array.from(t),Tp=t=>gh(eg(t),Ir),Cp=Tp(O),Np={[Rn]:Rn,_tag:"Cons",toString(){return H(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:Ir(this).map(z)}},[V](){return this.toJSON()},[M](t){return Fu(t)&&this._tag===t._tag&&Cp(this,t)},[R](){return Wo(Ir(this))},[Symbol.iterator](){let t=!1,e=this;return{next(){if(t)return this.return();if(e._tag==="Nil")return t=!0,this.return();const n=e.head;return e=e.tail,{done:t,value:n}},return(n){return t||(t=!0),{done:!0,value:n}}}},pipe(){return k(this,arguments)}},Fr=(t,e)=>{const n=Object.create(Np);return n.head=t,n.tail=e,n},Ap={[Rn]:Rn,_tag:"Nil",toString(){return H(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[V](){return this.toJSON()},[R](){return Wo(Ir(this))},[M](t){return Fu(t)&&this._tag===t._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return k(this,arguments)}},Iu=Object.create(Ap),Fu=t=>I(t,Rn),xt=t=>t._tag==="Nil",Ru=t=>t._tag==="Cons",Pp=()=>Iu,_e=(t,e)=>Fr(t,e),be=Pp,hc=t=>Fr(t,Iu),Lp=u(2,(t,e)=>xp(e,t)),Mu=u(2,(t,e)=>_e(e,t)),xp=u(2,(t,e)=>{if(xt(t))return e;if(xt(e))return t;{const n=Fr(e.head,t);let r=n,s=e.tail;for(;!xt(s);){const o=Fr(s.head,t);r.tail=o,r=o,s=s.tail}return n}}),Dp=u(3,(t,e,n)=>{let r=e,s=t;for(;!xt(s);)r=n(r,s.head),s=s.tail;return r}),qp=t=>{let e=be(),n=t;for(;!xt(n);)e=Mu(e,n.head),n=n.tail;return e},jp=Symbol.for("effect/DifferContextPatch");function mi(t){return t}const Kn={...Vo.prototype,[jp]:{_Value:mi,_Patch:mi}},Kp=Object.assign(Object.create(Kn),{_tag:"Empty"}),Up=Object.create(Kp),Tu=()=>Up,Bp=Object.assign(Object.create(Kn),{_tag:"AndThen"}),zp=(t,e)=>{const n=Object.create(Bp);return n.first=t,n.second=e,n},Wp=Object.assign(Object.create(Kn),{_tag:"AddService"}),Jp=(t,e)=>{const n=Object.create(Wp);return n.tag=t,n.service=e,n},Vp=Object.assign(Object.create(Kn),{_tag:"RemoveService"}),Hp=t=>{const e=Object.create(Vp);return e.tag=t,e},Gp=Object.assign(Object.create(Kn),{_tag:"UpdateService"}),Yp=(t,e)=>{const n=Object.create(Gp);return n.tag=t,n.update=e,n},Qp=(t,e)=>{const n=new Map(t.unsafeMap);let r=Tu();for(const[s,o]of e.unsafeMap.entries())if(n.has(s)){const c=n.get(s);n.delete(s),O(c,o)||(r=dr(Yp(s,()=>o))(r))}else n.delete(s),r=dr(Jp(s,o))(r);for(const[s]of n.entries())r=dr(Hp(s))(r);return r},dr=u(2,(t,e)=>zp(t,e)),Xp=u(2,(t,e)=>{let n=!1,r=lt(t);const s=new Map(e.unsafeMap);for(;pe(r);){const c=de(r),i=Vt(r);switch(c._tag){case"Empty":{r=i;break}case"AddService":{s.set(c.tag,c.service),r=i;break}case"AndThen":{r=mt(mt(i,c.second),c.first);break}case"RemoveService":{s.delete(c.tag),r=i;break}case"UpdateService":{s.set(c.tag,c.update(s.get(c.tag))),n=!0,r=i;break}}}if(!n)return jt(s);const o=new Map;for(const[c]of e.unsafeMap)s.has(c)&&(o.set(c,s.get(c)),s.delete(c));for(const[c,i]of s)o.set(c,i);return jt(o)}),Zp=Symbol.for("effect/DifferHashSetPatch");function Ts(t){return t}const cs={...Vo.prototype,[Zp]:{_Value:Ts,_Key:Ts,_Patch:Ts}},td=Object.assign(Object.create(cs),{_tag:"Empty"}),ed=Object.create(td),Cu=()=>ed,nd=Object.assign(Object.create(cs),{_tag:"AndThen"}),rd=(t,e)=>{const n=Object.create(nd);return n.first=t,n.second=e,n},sd=Object.assign(Object.create(cs),{_tag:"Add"}),od=t=>{const e=Object.create(sd);return e.value=t,e},cd=Object.assign(Object.create(cs),{_tag:"Remove"}),id=t=>{const e=Object.create(cd);return e.value=t,e},ad=(t,e)=>{const[n,r]=Or([t,Cu()],([s,o],c)=>gp(c)(s)?[Su(c)(s),o]:[s,Qs(od(c))(o)])(e);return Or(r,(s,o)=>Qs(id(o))(s))(n)},Qs=u(2,(t,e)=>rd(t,e)),ud=u(2,(t,e)=>{let n=e,r=lt(t);for(;pe(r);){const s=de(r),o=Vt(r);switch(s._tag){case"Empty":{r=o;break}case"AndThen":{r=mt(s.first)(mt(s.second)(o));break}case"Add":{n=vn(s.value)(n),r=o;break}case"Remove":n=Su(s.value)(n),r=o}}return n}),ld=Symbol.for("effect/Differ"),fd={[ld]:{_P:K,_V:K}},Un=t=>{const e=Object.create(fd);return e.empty=t.empty,e.diff=t.diff,e.combine=t.combine,e.patch=t.patch,e},hd=()=>Un({empty:Tu(),combine:(t,e)=>dr(e)(t),diff:(t,e)=>Qp(t,e),patch:(t,e)=>Xp(e)(t)}),gd=()=>Un({empty:Cu(),combine:(t,e)=>Qs(e)(t),diff:(t,e)=>ad(t,e),patch:(t,e)=>ud(e)(t)}),pd=()=>dd((t,e)=>e),dd=t=>Un({empty:K,combine:(e,n)=>e===K?n:n===K?e:r=>n(e(r)),diff:(e,n)=>O(e,n)?K:Ln(n),patch:(e,n)=>t(n,e(n))}),Mn=255,Nu=8,Xs=t=>t&Mn,Zs=t=>t>>Nu&Mn,Bn=(t,e)=>(t&Mn)+((e&t&Mn)<<Nu),md=Bn(0,0),yd=t=>Bn(t,t),_d=t=>Bn(t,0),bd=u(2,(t,e)=>Bn(Xs(t)&~e,Zs(t))),Sd=u(2,(t,e)=>t|e),vd=t=>~t>>>0&Mn,$d=0,Ze=1<<0,wd=1<<1,Au=1<<2,to=1<<4,Pu=1<<5,kd=t=>is(t,Pu),Ed=u(2,(t,e)=>t|e),Wt=t=>Lu(t)&&!Id(t),Lu=t=>is(t,Ze),is=u(2,(t,e)=>(t&e)!==0),xu=(...t)=>t.reduce((e,n)=>e|n,0),Od=xu($d),Cs=t=>is(t,Au),Id=t=>is(t,to),De=u(2,(t,e)=>Bn(t^e,e)),eo=u(2,(t,e)=>t&(vd(Xs(e))|Zs(e))|Xs(e)&Zs(e)),yi=Un({empty:md,diff:(t,e)=>De(t,e),combine:(t,e)=>Sd(e)(t),patch:(t,e)=>eo(e,t)}),Fd=yd,Du=_d,_i=bd,qe=(t,e)=>({_tag:"Par",left:t,right:e}),ar=(t,e)=>({_tag:"Seq",left:t,right:e}),Rd=t=>{let e=hc(t),n=be();for(;;){const[r,s]=Dp(e,[qu(),be()],([o,c],i)=>{const[a,h]=Md(i);return[ju(o,a),Lp(c,h)]});if(n=Td(n,r),xt(s))return qp(n);e=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},Md=t=>{let e=t,n=qu(),r=be(),s=be();for(;;)switch(e._tag){case"Empty":{if(xt(r))return[n,s];e=r.head,r=r.tail;break}case"Par":{r=_e(e.right,r),e=e.left;break}case"Seq":{const o=e.left,c=e.right;switch(o._tag){case"Empty":{e=c;break}case"Par":{const i=o.left,a=o.right;e=qe(ar(i,c),ar(a,c));break}case"Seq":{const i=o.left,a=o.right;e=ar(i,ar(a,c));break}case"Single":{e=o,s=_e(c,s);break}}break}case"Single":{if(n=ju(n,Ad(e.dataSource,e.blockedRequest)),xt(r))return[n,s];e=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},Td=(t,e)=>{if(xt(t))return hc(Ns(e));if(Pd(e))return t;const n=Kd(t.head),r=Ld(e);return n.length===1&&r.length===1&&O(n[0],r[0])?_e(jd(t.head,Ns(e)),t.tail):_e(Ns(e),t)},Cd=Symbol.for("effect/RequestBlock/RequestBlockParallel"),Nd={_R:t=>t};var T$;class gc{constructor(e){l(this,"map");l(this,T$,Nd);this.map=e}}T$=Cd;const qu=()=>new gc(os()),Ad=(t,e)=>new gc(Fp([t,Array.of(e)])),ju=(t,e)=>new gc(Ou(t.map,e.map,(n,r,s)=>fc(n,s,Ft(lc(n,s),{onNone:()=>r,onSome:o=>[...o,...r]})))),Pd=t=>Rp(t.map),Ld=t=>Array.from(ku(t.map)),Ns=t=>qd(Eu(t.map,e=>Array.of(e))),xd=Symbol.for("effect/RequestBlock/RequestBlockSequential"),Dd={_R:t=>t};var C$;class Ku{constructor(e){l(this,"map");l(this,C$,Dd);this.map=e}}C$=xd;const qd=t=>new Ku(t),jd=(t,e)=>new Ku(Ou(e.map,t.map,(n,r,s)=>fc(n,s,Ft(lc(n,s),{onNone:()=>[],onSome:o=>[...o,...r]})))),Kd=t=>Array.from(ku(t.map)),Ud=t=>Array.from(t.map),tn="Die",je="Empty",en="Fail",nn="Interrupt",Ke="Parallel",Ue="Sequential",Uu="effect/Cause",Bu=Symbol.for(Uu),Bd={_E:t=>t},rn={[Bu]:Bd,[R](){return f(y(Uu),E(y(rm(this))))},[M](t){return zu(t)&&nm(this,t)},pipe(){return k(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:z(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:z(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:z(this.left),right:z(this.right)}}},toString(){return us(this)},[V](){return this.toJSON()}},te=(()=>{const t=Object.create(rn);return t._tag=je,t})(),Se=t=>{const e=Object.create(rn);return e._tag=en,e.error=t,e},ct=t=>{const e=Object.create(rn);return e._tag=tn,e.defect=t,e},It=t=>{const e=Object.create(rn);return e._tag=nn,e.fiberId=t,e},ft=(t,e)=>{const n=Object.create(rn);return n._tag=Ke,n.left=t,n.right=e,n},tt=(t,e)=>{const n=Object.create(rn);return n._tag=Ue,n.left=t,n.right=e,n},zu=t=>I(t,Bu),zd=t=>t._tag===tn,Wd=t=>t._tag===je?!0:Be(t,!0,(e,n)=>{switch(n._tag){case je:return v(e);case tn:case en:case nn:return v(!1);default:return $()}}),Jd=t=>A(Qd(t)),as=t=>pc(void 0,om)(t),Vd=t=>Pe(Be(t,Mt(),(e,n)=>n._tag===en?v(f(e,mt(n.error))):$())),Wu=t=>Pe(Be(t,Mt(),(e,n)=>n._tag===tn?v(f(e,mt(n.defect))):$())),Hd=t=>Be(t,Tt(),(e,n)=>n._tag===nn?v(f(e,vn(n.fiberId))):$()),Gd=t=>Vu(t,e=>e._tag===en?v(e.error):$()),Ju=t=>{const e=Gd(t);switch(e._tag){case"None":return pt(t);case"Some":return Rt(e.value)}},Yd=t=>zn(t,{onEmpty:v(te),onFail:e=>f(e,Sn(Se)),onDie:e=>v(ct(e)),onInterrupt:e=>v(It(e)),onSequential:(e,n)=>A(e)&&A(n)?v(tt(e.value,n.value)):U(e)&&A(n)?v(n.value):A(e)&&U(n)?v(e.value):$(),onParallel:(e,n)=>A(e)&&A(n)?v(ft(e.value,n.value)):U(e)&&A(n)?v(n.value):A(e)&&U(n)?v(e.value):$()}),Qd=t=>Vu(t,e=>e._tag===nn?v(e.fiberId):$()),Xd=t=>zn(t,{onEmpty:$(),onFail:e=>v(ct(e)),onDie:e=>v(ct(e)),onInterrupt:()=>$(),onSequential:(e,n)=>A(e)&&A(n)?v(tt(e.value,n.value)):A(e)&&U(n)?v(e.value):U(e)&&A(n)?v(n.value):$(),onParallel:(e,n)=>A(e)&&A(n)?v(ft(e.value,n.value)):A(e)&&U(n)?v(e.value):U(e)&&A(n)?v(n.value):$()}),Rr=t=>zn(t,{onEmpty:te,onFail:()=>te,onDie:e=>ct(e),onInterrupt:e=>It(e),onSequential:tt,onParallel:ft}),Zd=t=>zn(t,{onEmpty:te,onFail:e=>ct(e),onDie:e=>ct(e),onInterrupt:e=>It(e),onSequential:(e,n)=>tt(e,n),onParallel:(e,n)=>ft(e,n)}),tm=u(2,(t,e)=>em(t,n=>Se(e(n)))),em=u(2,(t,e)=>zn(t,{onEmpty:te,onFail:n=>e(n),onDie:n=>ct(n),onInterrupt:n=>It(n),onSequential:(n,r)=>tt(n,r),onParallel:(n,r)=>ft(n,r)})),nm=(t,e)=>{let n=lt(t),r=lt(e);for(;pe(n)&&pe(r);){const[s,o]=f(de(n),Be([Tt(),Mt()],([a,h],d)=>{const[p,m]=no(d);return v([f(a,Zt(p)),f(h,Nt(m))])})),[c,i]=f(de(r),Be([Tt(),Mt()],([a,h],d)=>{const[p,m]=no(d);return v([f(a,Zt(p)),f(h,Nt(m))])}));if(!O(s,c))return!1;n=o,r=i}return!0},rm=t=>sm(lt(t),Mt()),sm=(t,e)=>{for(;;){const[n,r]=f(t,Qt([Tt(),Mt()],([o,c],i)=>{const[a,h]=no(i);return[f(o,Zt(a)),f(c,Nt(h))]})),s=ac(n)>0?f(e,mt(n)):e;if(Zo(r))return Pe(s);t=r,e=s}throw new Error("BUG: Cause.flattenCauseLoop - please report an issue at https://github.com/Effect-TS/effect/issues")},Vu=u(2,(t,e)=>{const n=[t];for(;n.length>0;){const r=n.pop(),s=e(r);switch(s._tag){case"None":{switch(r._tag){case Ue:case Ke:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return $()}),no=t=>{let e=t;const n=[];let r=Tt(),s=Mt();for(;e!==void 0;)switch(e._tag){case je:{if(n.length===0)return[r,s];e=n.pop();break}case en:{if(r=vn(r,e.error),n.length===0)return[r,s];e=n.pop();break}case tn:{if(r=vn(r,e.defect),n.length===0)return[r,s];e=n.pop();break}case nn:{if(r=vn(r,e.fiberId),n.length===0)return[r,s];e=n.pop();break}case Ue:{switch(e.left._tag){case je:{e=e.right;break}case Ue:{e=tt(e.left.left,tt(e.left.right,e.right));break}case Ke:{e=ft(tt(e.left.left,e.right),tt(e.left.right,e.right));break}default:{s=mt(s,e.right),e=e.left;break}}break}case Ke:{n.push(e.right),e=e.left;break}}throw new Error("BUG: Cause.evaluateCauseLoop - please report an issue at https://github.com/Effect-TS/effect/issues")},om={emptyCase:si,failCase:Ks,dieCase:Ks,interruptCase:si,sequentialCase:(t,e,n)=>e&&n,parallelCase:(t,e,n)=>e&&n},bi="SequentialCase",Si="ParallelCase",zn=u(2,(t,{onDie:e,onEmpty:n,onFail:r,onInterrupt:s,onParallel:o,onSequential:c})=>pc(t,void 0,{emptyCase:()=>n,failCase:(i,a)=>r(a),dieCase:(i,a)=>e(a),interruptCase:(i,a)=>s(a),sequentialCase:(i,a,h)=>c(a,h),parallelCase:(i,a,h)=>o(a,h)})),Be=u(3,(t,e,n)=>{let r=e,s=t;const o=[];for(;s!==void 0;){const c=n(r,s);switch(r=A(c)?c.value:r,s._tag){case Ue:{o.push(s.right),s=s.left;break}case Ke:{o.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&o.length>0&&(s=o.pop())}return r}),pc=u(3,(t,e,n)=>{const r=[t],s=[];for(;r.length>0;){const c=r.pop();switch(c._tag){case je:{s.push(pt(n.emptyCase(e)));break}case en:{s.push(pt(n.failCase(e,c.error)));break}case tn:{s.push(pt(n.dieCase(e,c.defect)));break}case nn:{s.push(pt(n.interruptCase(e,c.fiberId)));break}case Ue:{r.push(c.right),r.push(c.left),s.push(Rt({_tag:bi}));break}case Ke:{r.push(c.right),r.push(c.left),s.push(Rt({_tag:Si}));break}}}const o=[];for(;s.length>0;){const c=s.pop();switch(c._tag){case"Left":{switch(c.left._tag){case bi:{const i=o.pop(),a=o.pop(),h=n.sequentialCase(e,i,a);o.push(h);break}case Si:{const i=o.pop(),a=o.pop(),h=n.parallelCase(e,i,a);o.push(h);break}}break}case"Right":{o.push(c.right);break}}}if(o.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return o.pop()}),dc=(t,e)=>{const n={value:e,enumerable:!0},r={...t,toString(){return`${this._tag}: ${this.message}`}};return s=>{const o={_tag:n};return th(s)&&(o.message={value:s,enumerable:!0}),Object.create(r,o)}},vi=Symbol.for("effect/Cause/errors/RuntimeException"),cm=dc({[vi]:vi},"RuntimeException"),im=Symbol.for("effect/Cause/errors/InterruptedException"),am=t=>I(t,im),$i=Symbol.for("effect/Cause/errors/IllegalArgument"),Hu=dc({[$i]:$i},"IllegalArgumentException"),wi=Symbol.for("effect/Cause/errors/NoSuchElement"),mc=dc({[wi]:wi},"NoSuchElementException"),um=t=>{const e=t.split(`
`),n=[];for(let r=0;r<e.length;r++){if(e[r].includes("EffectPrimitive")||e[r].includes("Generator.next")||e[r].includes("FiberRuntime"))return n.join(`
`);n.push(e[r])}return n.join(`
`)},us=t=>as(t)?"All fibers interrupted without errors.":Gu(t).map(n=>{let r=n.message;if(n.stack&&(r+=`\r
${um(n.stack)}`),n.span){let s=n.span,o=0;for(;s&&s._tag==="Span"&&o<10;)r+=`\r
    at ${s.name}`,s=ae(s.parent),o++}return r}).join(`\r
`);class ki{constructor(e,n,r){l(this,"message");l(this,"stack");l(this,"span");this.message=e,this.stack=n,this.span=r}toJSON(){const e={message:this.message};return this.stack&&(e.stack=this.stack),this.span&&(e.span=this.span),e}}const Ei=t=>typeof t=="string"?`Error: ${t}`:I(t,"toString")&&Uo(t.toString)&&t.toString!==Object.prototype.toString?t.toString():`Error: ${JSON.stringify(t)}`,Oi=Symbol.for("effect/SpanAnnotation"),Ii=t=>{const e=I(t,Oi)&&t[Oi];return t instanceof Error?new ki(Ei(t),t.stack?.split(`
`).filter(n=>n.match(/at (.*)/)).join(`
`),e):new ki(Ei(t),void 0,e)},Gu=t=>pc(t,void 0,{emptyCase:()=>[],dieCase:(e,n)=>[Ii(n)],failCase:(e,n)=>[Ii(n)],interruptCase:()=>[],parallelCase:(e,n,r)=>[...n,...r],sequentialCase:(e,n,r)=>[...n,...r]}),Wn="Pending",ls="Done",lm="effect/Deferred",fm=Symbol.for(lm),hm={_E:t=>t,_A:t=>t},yc=t=>({_tag:Wn,joiners:t}),Yu=t=>({_tag:ls,effect:t}),Fi=Symbol.for("effect/Tracer"),gm=t=>({[Fi]:Fi,...t}),ro=yt(Symbol.for("effect/Tracer")),Qu=yt(Symbol.for("effect/ParentSpan")),pm=P("effect/Tracer/SpanId.ids",()=>Xe(0));class dm{constructor(e,n,r,s,o){l(this,"name");l(this,"parent");l(this,"context");l(this,"links");l(this,"startTime");l(this,"_tag","Span");l(this,"spanId");l(this,"traceId","native");l(this,"sampled",!0);l(this,"status");l(this,"attributes");l(this,"events",[]);l(this,"end",(e,n)=>{this.status={_tag:"Ended",endTime:e,exit:n,startTime:this.status.startTime}});l(this,"attribute",(e,n)=>{this.attributes.set(e,n)});l(this,"event",(e,n,r)=>{this.events.push([e,n,r??{}])});this.name=e,this.parent=n,this.context=r,this.links=s,this.startTime=o,this.status={_tag:"Started",startTime:o},this.attributes=new Map,this.spanId=`span${mp(pm)}`}}const mm=gm({span:(t,e,n,r,s)=>new dm(t,e,n,r,s),context:t=>t()}),ym="effect/EffectError",so=Symbol.for(ym),_m=t=>I(t,so),bm=t=>({[so]:so,_tag:"EffectError",cause:t}),ot=(t,e)=>{const n=new st("Blocked");return n.i0=t,n.i1=e,n},Sm=t=>{const e=new st("RunBlocked");return e.i0=t,e},fs=Symbol.for("effect/Effect");class vm{constructor(e,n){l(this,"patch");l(this,"op");l(this,"_op",Ho);this.patch=e,this.op=n}}var N$;class st{constructor(e){l(this,"_op");l(this,"i0");l(this,"i1");l(this,"i2");l(this,"trace");l(this,N$,Ae);this._op=e}[(N$=fs,M)](e){return this===e}[R](){return xn(this)}pipe(){return k(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,i0:z(this.i0),i1:z(this.i1),i2:z(this.i2)}}toString(){return H(this.toJSON())}[V](){return this.toJSON()}}var A$;class Xu{constructor(e){l(this,"_op");l(this,"i0");l(this,"i1");l(this,"i2");l(this,"trace");l(this,A$,Ae);this._op=e,this._tag=e}[(A$=fs,M)](e){return this===e}[R](){return xn(this)}get cause(){return this.i0}pipe(){return k(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return H(this.toJSON())}[V](){return this.toJSON()}}var P$;class Zu{constructor(e){l(this,"_op");l(this,"i0");l(this,"i1");l(this,"i2");l(this,"trace");l(this,P$,Ae);this._op=e,this._tag=e}[(P$=fs,M)](e){return this===e}[R](){return xn(this)}get value(){return this.i0}pipe(){return k(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:z(this.value)}}toString(){return H(this.toJSON())}[V](){return this.toJSON()}}const ee=t=>I(t,fs),rt=t=>{const e=new st(Oa);return e.i0=t,e},Jn=u(3,(t,e,n)=>vt(r=>g(t,s=>g(dt(T(()=>r(We(e(s))))),o=>{if(o._tag==="Success"&&o.value._op==="Blocked"){const i=o.value;return ot(i.i0,Jn(w(s),()=>i.i1,n))}const c=oy(o);return T(()=>n(s,c)).pipe(Q({onFailure:i=>{switch(c._tag){case G:return D(ft(c.i0,i));case Y:return D(i)}},onSuccess:()=>c}))})))),it=u(2,(t,e)=>g(t,()=>w(e))),ut=t=>it(t,void 0),ze=(t,e=jn)=>T(()=>{let n,r;const s=new st(hr);if(t.length!==1){const o=new AbortController;r=o,s.i0=c=>{n=t(c,o.signal)}}else s.i0=o=>{n=t(o)};return s.i1=e,il(s,()=>(r&&r.abort(),n??N))}),_c=(t,e=jn)=>ze(n=>{const r=t(n);if(_n(r))n(r.right);else return r.left},e),tl=u(2,(t,e)=>{const n=new st(gr);return n.i0=t,n.i1=e,n}),Mr=u(2,(t,e)=>Hn(t,{onFailure:e,onSuccess:w})),Tr=Symbol.for("effect/SpanAnnotation"),Ri=Symbol.for("effect/OriginalAnnotation"),el=(t,e)=>A(e)?new Proxy(t,{has(n,r){return r===Tr||r===Ri||r in n},get(n,r){return r===Tr?e.value:r===Ri?t:n[r]}}):t,bc=t=>Bo(t)&&!(Tr in t)?rt(e=>D(ct(el(t,ml(e))))):D(ct(t)),nl=t=>sl(()=>ct(cm(t))),$m=t=>g(_(t),bc),Tn=t=>Hn(t,{onFailure:e=>w(Rt(e)),onSuccess:e=>w(pt(e))}),dt=t=>ol(t,{onFailure:x,onSuccess:et}),J=t=>Bo(t)&&!(Tr in t)?rt(e=>D(Se(el(t,ml(e))))):D(Se(t)),rl=t=>g(_(t),J),D=t=>{const e=new Xu(G);return e.i0=t,e},sl=t=>g(_(t),D),Sc=rt(t=>w(t.id())),hs=t=>rt(e=>t(e.id())),g=u(2,(t,e)=>{const n=new st(vr);return n.i0=t,n.i1=e,n}),We=t=>{const e=new st("OnStep");return e.i0=t,e.i1=et,e},vc=(t,e)=>{const n=new st("OnStep");return n.i0=t,n.i1=e,n},Vn=t=>g(t,K),ol=u(2,(t,{onFailure:e,onSuccess:n})=>Q(t,{onFailure:r=>w(e(r)),onSuccess:r=>w(n(r))})),Q=u(2,(t,{onFailure:e,onSuccess:n})=>{const r=new st($r);return r.i0=t,r.i1=e,r.i2=n,r}),Hn=u(2,(t,{onFailure:e,onSuccess:n})=>Q(t,{onFailure:r=>{const s=Vd(r);return Wu(r).length>0?D(Zd(r)):s.length>0?e(En(s)):D(r)},onSuccess:n})),Ot=u(2,(t,e)=>T(()=>{const n=nt(t),r=new Array(n.length);let s=0;return it(Cr({while:()=>s<n.length,body:()=>e(n[s],s),step:o=>{r[s++]=o}}),r)})),Gn=u(2,(t,e)=>T(()=>{const n=nt(t);let r=0;return Cr({while:()=>r<n.length,body:()=>e(n[r],r),step:()=>{r++}})})),wm=g(Sc,t=>cl(t)),cl=t=>D(It(t)),Je=t=>{const e=new st(Ye);e.i0=Fd(Ze);const n=r=>r._tag==="Blocked"?ot(r.i0,Je(r.i1)):r;return e.i1=()=>vc(t,n),e},km=u(2,(t,e)=>vt(n=>g(dt(n(t)),r=>uy(e,r)))),F=u(2,(t,e)=>g(t,n=>_(()=>e(n)))),Em=u(2,(t,{onFailure:e,onSuccess:n})=>Hn(t,{onFailure:r=>rl(()=>e(r)),onSuccess:r=>_(()=>n(r))})),Cn=u(2,(t,e)=>Q(t,{onFailure:n=>{const r=Ju(n);switch(r._tag){case"Left":return rl(()=>e(r.left));case"Right":return D(r.right)}},onSuccess:w})),Nn=u(2,(t,e)=>vt(n=>Q(n(t),{onFailure:r=>{const s=x(r);return Q(e(s),{onFailure:o=>x(tt(r,o)),onSuccess:()=>s})},onSuccess:r=>{const s=et(r);return at(e(s),s)}}))),il=u(2,(t,e)=>Nn(t,pl({onFailure:n=>as(n)?ut(e(Hd(n))):N,onSuccess:()=>N}))),Om=u(2,(t,e)=>Mm(t,e,w)),Im=t=>Fm(t,K),Fm=u(2,(t,e)=>Hn(t,{onFailure:n=>bc(e(n)),onSuccess:w})),w=t=>{const e=new Zu(Y);return e.i0=t,e},T=t=>g(_(t),K),_=t=>{const e=new st(Ea);return e.i0=t,e},sn=u(2,(t,e)=>g(t,n=>it(e(n),n))),Rm=t=>rt(e=>{const n=e.getFiberRef(io),r=f(n,At(()=>e.scope()));return t(cn(io,v(r)))}),Mm=u(3,(t,e,n)=>Q(t,{onFailure:r=>Wu(r).length>0?D(Nh(Xd(r))):e(),onSuccess:n})),Ve=t=>{const e=new st(Ye);e.i0=Du(Ze),e.i1=()=>vc(t,n);const n=r=>r._tag==="Blocked"?ot(r.i0,Ve(r.i1)):r;return e},vt=t=>{const e=new st(Ye);e.i0=Du(Ze);const n=r=>r._op==="Blocked"?ot(r.i0,Ve(r.i1)):r;return e.i1=r=>Lu(r)?We(t(Je)):We(t(Ve)),g(e,n)},N=w(void 0),oo=t=>{const e=new st(Ye);return e.i0=t,e.i1=void 0,e},Tm=u(2,(t,e)=>g(e,n=>n?f(t,F(v)):w($()))),Cr=t=>{const e=new st(wr);return e.i0=t.while,e.i1=t.body,e.i2=t.step,e},Cm=u(2,(t,e)=>{const n=new st(Ye);return n.i0=e,n.i1=()=>t,n}),Yn=t=>{const e=new st(pr);return typeof t?.priority<"u"?Gm(e,t.priority):e},al=u(2,(t,e)=>g(t,n=>F(e,r=>[n,r]))),gs=u(2,(t,e)=>g(t,n=>it(e,n))),at=u(2,(t,e)=>g(t,()=>e)),Nm=u(3,(t,e,n)=>g(t,r=>F(e,s=>n(r,s)))),Qn=t=>g(Sc,e=>f(t,co(e))),co=u(2,(t,e)=>g(t.interruptAsFork(e),()=>t.await)),Am={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return k(this,arguments)}},Pm={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return k(this,arguments)}},Lm={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return k(this,arguments)}},xm={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return k(this,arguments)}},ul={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return k(this,arguments)}},ll={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return k(this,arguments)}},Dm={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return k(this,arguments)}},qm={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return k(this,arguments)}},jm="effect/FiberRef",Km=Symbol.for(jm),Um={_A:t=>t},ps=t=>fl(t,e=>[e,e]),on=u(2,(t,e)=>g(ps(t),e)),Mi=u(2,(t,e)=>fl(t,()=>[void 0,e])),fl=u(2,(t,e)=>rt(n=>{const[r,s]=e(n.getFiberRef(t));return n.setFiberRef(t,s),w(r)})),cn=u(3,(t,e,n)=>g(Jn(gs(ps(e),Mi(e,n)),()=>We(t),r=>Mi(e,r)),r=>r._op==="Blocked"?ot(r.i0,cn(r.i1,e,n)):r)),Bm=u(3,(t,e,n)=>on(e,r=>cn(t,e,n(r)))),ht=(t,e)=>Xn(t,{differ:pd(),fork:e?.fork??K,join:e?.join}),hl=t=>{const e=gd();return Xn(t,{differ:e,fork:e.empty})},gl=t=>{const e=hd();return Xn(t,{differ:e,fork:e.empty})},Xn=(t,e)=>({[Km]:Um,initial:t,diff:(n,r)=>e.differ.diff(n,r),combine:(n,r)=>e.differ.combine(n,r),patch:n=>r=>e.differ.patch(n,r),fork:e.fork,join:e.join??((n,r)=>r),pipe(){return k(this,arguments)}}),zm=t=>Xn(t,{differ:yi,fork:yi.empty}),ne=P(Symbol.for("effect/FiberRef/currentContext"),()=>gl(Hr())),ds=P(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>ht(0)),Wm=P(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>ht(2048)),Jm=P(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>ht(os())),Vm=P(Symbol.for("effect/FiberRef/currentLogLevel"),()=>ht(ul)),Hm=P(Symbol.for("effect/FiberRef/currentLogSpan"),()=>ht(be())),Gm=u(2,(t,e)=>cn(t,ds,e)),Ym=P(Symbol.for("effect/FiberRef/currentConcurrency"),()=>ht("unbounded")),Qm=P(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>ht(!0)),Xm=P(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>ht(v(ll))),As=P(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>hl(Tt())),io=P(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>ht($(),{fork:()=>$(),join:(t,e)=>t})),ur=P(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>ht(te,{fork:()=>te,join:(t,e)=>t})),ao=Symbol.for("effect/Scope"),Ti=Symbol.for("effect/CloseableScope"),Rw=(t,e)=>t.addFinalizer(()=>ut(e)),Nr=(t,e)=>t.addFinalizer(e),Ar=(t,e)=>t.close(e),$c=(t,e)=>t.fork(e),Ci=u(2,(t,e)=>F(ty(t,e),Ft({onNone:()=>()=>N,onSome:n=>r=>Zm(n,r)(t)}))),Zm=u(3,(t,e,n)=>T(()=>{switch(t.state._tag){case"Exited":return N;case"Running":{const r=t.state.finalizers.get(e);return t.state.finalizers.delete(e),r!=null?t.state.update(r)(n):N}}})),ty=u(2,(t,e)=>T(()=>{switch(t.state._tag){case"Exited":return t.state.nextKey+=1,it(e(t.state.exit),$());case"Running":{const n=t.state.nextKey;return t.state.finalizers.set(n,e),t.state.nextKey+=1,w(v(n))}}})),ey=_(()=>({state:{_tag:"Running",nextKey:0,finalizers:new Map,update:K}})),ny=t=>t._tag==="Failure",Mw=t=>t._tag==="Success",ry=u(2,(t,e)=>{switch(t._tag){case G:return x(t.i0);case Y:return et(e)}}),Ps=t=>ry(t,void 0),mr=(t,e)=>iy(t,e?.parallel?ft:tt),Tw=t=>x(ct(t)),Ni=t=>x(Se(t)),x=t=>{const e=new Xu(G);return e.i0=t,e},sy=u(2,(t,e)=>{switch(t._tag){case G:return x(t.i0);case Y:return e(t.i0)}}),oy=t=>f(t,sy(K)),cy=t=>x(It(t)),Ls=u(2,(t,e)=>{switch(t._tag){case G:return x(t.i0);case Y:return et(e(t.i0))}}),pl=u(2,(t,{onFailure:e,onSuccess:n})=>{switch(t._tag){case G:return e(t.i0);case Y:return n(t.i0)}}),Pr=u(2,(t,{onFailure:e,onSuccess:n})=>{switch(t._tag){case G:return e(t.i0);case Y:return n(t.i0)}}),et=t=>{const e=new Zu(Y);return e.i0=t,e},Ht=et(void 0),Cw=u(2,(t,e)=>wc(t,e,{onSuccess:(n,r)=>[n,r],onFailure:tt})),Nw=u(2,(t,e)=>wc(t,e,{onSuccess:(n,r)=>r,onFailure:tt})),wc=u(3,(t,e,{onFailure:n,onSuccess:r})=>{switch(t._tag){case G:switch(e._tag){case Y:return x(t.i0);case G:return x(n(t.i0,e.i0))}case Y:switch(e._tag){case Y:return et(r(t.i0,e.i0));case G:return x(e.i0)}}}),iy=(t,e)=>{const n=qn(t);return pe(n)?f(Vt(n),Qt(f(de(n),Ls(lt)),(r,s)=>f(r,wc(s,{onSuccess:(o,c)=>f(o,mt(c)),onFailure:e}))),Ls(Pe),Ls(r=>Array.from(r)),v):$()},kc=t=>({[fm]:hm,state:Xe(yc([])),blockingOn:t,pipe(){return k(this,arguments)}}),Ec=()=>g(Sc,t=>ay(t)),ay=t=>_(()=>kc(t)),ms=t=>_c(e=>{const n=Ut(t.state);switch(n._tag){case ls:return pt(n.effect);case Wn:return f(t.state,ke(yc([e,...n.joiners]))),Rt(fy(t,e))}},t.blockingOn),Zn=u(2,(t,e)=>_(()=>{const n=Ut(t.state);switch(n._tag){case ls:return!1;case Wn:{f(t.state,ke(Yu(e)));for(let r=0;r<n.joiners.length;r++)n.joiners[r](e);return!0}}})),uy=u(2,(t,e)=>Zn(t,e)),xs=u(2,(t,e)=>Zn(t,J(e))),Oc=u(2,(t,e)=>Zn(t,D(e))),Aw=u(2,(t,e)=>Zn(t,cl(e))),ly=t=>_(()=>Ut(t.state)._tag===ls),ys=u(2,(t,e)=>Zn(t,w(e))),Ic=(t,e)=>{const n=Ut(t.state);if(n._tag===Wn){f(t.state,ke(Yu(e)));for(let r=n.joiners.length-1;r>=0;r--)n.joiners[r](e)}},fy=(t,e)=>_(()=>{const n=Ut(t.state);n._tag===Wn&&f(t.state,ke(yc(n.joiners.filter(r=>r!==e))))}),hy=ps(ne),Fc=()=>hy,an=t=>g(Fc(),t),Rc=u(2,(t,e)=>cn(ne,e)(t)),Mc=u(2,(t,e)=>Bm(ne,n=>Yr(n,e))(t)),dl=u(2,(t,e)=>an(n=>Rc(t,e(n)))),ml=t=>{const e=t.getFiberRef(ne).unsafeMap.get(Qu);return e!==void 0&&e._tag==="Span"?v(e):$()},Pw=Ec,gy=ms,Lw=Oc,xw=ly,Dw=ys,uo=Symbol.for("effect/Duration"),py=BigInt(1e3),Ai=BigInt(1e9),Pi=/^(-?\d+(?:\.\d+)?)\s+(nanos|micros|millis|seconds|minutes|hours|days|weeks)$/,ve=t=>{if(yl(t))return t;if(_a(t))return fo(t);if(eh(t))return lo(t);{Pi.lastIndex=0;const e=Pi.exec(t);if(e){const[n,r,s]=e,o=Number(r);switch(s){case"nanos":return lo(BigInt(r));case"micros":return _y(BigInt(r));case"millis":return fo(o);case"seconds":return by(o);case"minutes":return Sy(o);case"hours":return vy(o);case"days":return $y(o);case"weeks":return wy(o)}}}throw new Error("Invalid duration input")},Li={_tag:"Millis",millis:0},dy={_tag:"Infinity"},my={[uo]:uo,[R](){return $a(this.value)},[M](t){return yl(t)&&Iy(this,t)},toString(){return H(this.toJSON())},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:ky(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[V](){return this.toJSON()},pipe(){return k(this,arguments)}},Bt=t=>{const e=Object.create(my);return _a(t)?isNaN(t)||t<0?e.value=Li:Number.isFinite(t)?Number.isInteger(t)?e.value={_tag:"Millis",millis:t}:e.value={_tag:"Nanos",nanos:BigInt(Math.round(t*1e6))}:e.value=dy:t<BigInt(0)?e.value=Li:e.value={_tag:"Nanos",nanos:t},e},yl=t=>I(t,uo),yy=Bt(0),lo=t=>Bt(t),_y=t=>Bt(t*py),fo=t=>Bt(t),by=t=>Bt(t*1e3),Sy=t=>Bt(t*6e4),vy=t=>Bt(t*36e5),$y=t=>Bt(t*864e5),wy=t=>Bt(t*6048e5),Lr=t=>{const e=ve(t);switch(e.value._tag){case"Infinity":return 1/0;case"Nanos":return Number(e.value.nanos)/1e6;case"Millis":return e.value.millis}},qw=t=>Lr(t)/1e3,ky=t=>{const e=ve(t);switch(e.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(e.value.nanos/Ai),Number(e.value.nanos%Ai)];case"Millis":return[Math.floor(e.value.millis/1e3),Math.round(e.value.millis%1e3*1e6)]}},_l=u(3,(t,e,n)=>{const r=ve(t),s=ve(e);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(Lr(r),Lr(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const o=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),c=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(o,c)}return n.onMillis(r.value.millis,s.value.millis)}),Ey=(t,e)=>_l(t,e,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),Oy=u(2,(t,e)=>_l(t,e,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),Iy=u(2,(t,e)=>Ey(ve(t),ve(e))),xi=Symbol.for("effect/MutableHashMap"),Fy={[xi]:xi,[Symbol.iterator](){return this.backingMap.current[Symbol.iterator]()},toString(){return H(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(z)}},[V](){return this.toJSON()},pipe(){return k(this,arguments)}},Ry=t=>{const e=Object.create(Fy);return e.backingMap=Xe(t),e},My=()=>Ry(os()),ue=u(2,(t,e)=>lc(t.backingMap.current,e)),hn=u(2,(t,e)=>A(ue(t,e))),gn=u(3,(t,e,n)=>(_p(t.backingMap,fc(e,n)),t)),bl=typeof process>"u"?!1:!!process?.isBun,Ty=bl?t=>clearInterval(t):t=>clearTimeout(t),Sl=bl?(t,e)=>{const n=setInterval(()=>{t(),clearInterval(n)},e);return n}:(t,e)=>setTimeout(t,e),Cy="effect/Clock",ho=Symbol.for(Cy),_s=yt(ho),Ny=2**31-1,Di={unsafeSchedule(t,e){const n=Lr(e);if(n>Ny)return Ks;let r=!1;const s=Sl(()=>{r=!0,t()},n);return()=>(Ty(s),!r)}},qi=function(){const t=BigInt(1e6);if(typeof performance>"u")return()=>BigInt(Date.now())*t;const e="timeOrigin"in performance&&typeof performance.timeOrigin=="number"?BigInt(Math.round(performance.timeOrigin*1e6)):BigInt(Date.now())*t-BigInt(Math.round(performance.now()*1e6));return()=>e+BigInt(Math.round(performance.now()*1e6))}(),Ay=function(){const t=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!t)return qi;const e=qi()-t.bigint();return()=>e+t.bigint()}();var L$;class Py{constructor(){l(this,L$,ho);l(this,"currentTimeMillis",_(()=>this.unsafeCurrentTimeMillis()));l(this,"currentTimeNanos",_(()=>this.unsafeCurrentTimeNanos()))}unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return Ay()}scheduler(){return w(Di)}sleep(e){return _c(n=>{const r=Di.unsafeSchedule(()=>n(N),e);return Rt(ut(_(r)))})}}L$=ho;const Ly=()=>new Py,An=Rh,vl="And",$l="Or",wl="InvalidData",kl="MissingData",El="SourceUnavailable",Ol="Unsupported",xy="effect/ConfigError",ji=Symbol.for(xy),un={[ji]:ji},Il=(t,e)=>{const n=Object.create(un);return n._tag=vl,n.left=t,n.right=e,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),n},Fl=(t,e)=>{const n=Object.create(un);return n._tag=$l,n.left=t,n.right=e,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),n},Dy=(t,e,n={pathDelim:"."})=>{const r=Object.create(un);return r._tag=wl,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${f(this.path,Qe(n.pathDelim))}: "${this.message}")`}}),r},Ee=(t,e,n={pathDelim:"."})=>{const r=Object.create(un);return r._tag=kl,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${f(this.path,Qe(n.pathDelim))}: "${this.message}")`}}),r},qy=(t,e,n,r={pathDelim:"."})=>{const s=Object.create(un);return s._tag=El,s.path=t,s.message=e,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${f(this.path,Qe(r.pathDelim))}: "${this.message}")`}}),s},jy=(t,e,n={pathDelim:"."})=>{const r=Object.create(un);return r._tag=Ol,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${f(this.path,Qe(n.pathDelim))}: "${this.message}")`}}),r},fe=u(2,(t,e)=>{switch(t._tag){case vl:return Il(fe(e)(t.left),fe(e)(t.right));case $l:return Fl(fe(e)(t.left),fe(e)(t.right));case wl:return Dy([...e,...t.path],t.message);case kl:return Ee([...e,...t.path],t.message);case El:return qy([...e,...t.path],t.message,t.cause);case Ol:return jy([...e,...t.path],t.message)}}),Ky="Constant",Uy="Fail",By="Fallback",zy="Described",Wy="Lazy",Jy="MapOrFail",Vy="Nested",Hy="Primitive",Gy="Sequence",Yy="HashMap",Qy="ZipWith",Xy=t=>e=>Ee([],`Expected ${e.description} with name ${t}`),Zy={_tag:"Empty"},Ds=u(2,(t,e)=>{let n=hc(e),r=t;for(;Ru(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=_e(s.first,_e(s.second,n.tail));break}case"MapName":{r=Ce(r,s.f),n=n.tail;break}case"Nested":{r=Dt(r,s.name),n=n.tail;break}case"Unnested":{if(f(Wa(r),xh(s.name)))r=ge(r),n=n.tail;else return Rt(Ee(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return pt(r)}),xr=(t,e)=>[...t,...e],t_="effect/ConfigProvider",go=Symbol.for(t_),e_=yt(go),n_="effect/ConfigProviderFlat",Ki=Symbol.for(n_),r_=t=>({[go]:go,pipe(){return k(this,arguments)},...t}),s_=t=>({[Ki]:Ki,patch:t.patch,load:(e,n,r=!0)=>t.load(e,n,r),enumerateChildren:t.enumerateChildren}),o_=t=>r_({load:e=>g(gt(t,wn(),e,!1),n=>Ft(Wa(n),{onNone:()=>J(Ee(wn(),`Expected a single value having structure: ${e}`)),onSome:w})),flattened:t}),c_=(t={})=>{const{pathDelim:e,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},t),r=a=>f(a,Qe(e)),s=a=>a.split(e),o=()=>typeof process<"u"&&"env"in process&&typeof process.env=="object"?process.env:{};return o_(s_({load:(a,h,d=!0)=>{const p=r(a),m=o(),b=p in m?v(m[p]):$();return f(b,Cn(()=>Ee(a,`Expected ${p} to exist in the process context`)),g(S=>l_(S,a,h,n,d)))},enumerateChildren:a=>_(()=>{const h=o(),d=Object.keys(h),m=Array.from(d).map(b=>s(b.toUpperCase())).filter(b=>{for(let S=0;S<a.length;S++){const L=f(a,za(S)),q=b[S];if(q===void 0||L!==q)return!1}return!0}).flatMap(b=>b.slice(a.length,a.length+1));return ic(m)}),patch:Zy}))},i_=(t,e,n,r)=>{const s=fi(n.length,a=>a>=r.length?$():v([t(a),a+1])),o=fi(r.length,a=>a>=n.length?$():v([e(a),a+1])),c=xr(n,s),i=xr(r,o);return[c,i]},gt=(t,e,n,r)=>{const s=n;switch(s._tag){case Ky:return w(kt(s.value));case zy:return T(()=>gt(t,e,s.config,r));case Uy:return J(Ee(e,s.message));case By:return f(T(()=>gt(t,e,s.first,r)),Mr(o=>s.condition(o)?f(gt(t,e,s.second,r),Mr(c=>J(Fl(o,c)))):J(o)));case Wy:return T(()=>gt(t,e,s.config(),r));case Jy:return T(()=>f(gt(t,e,s.original,r),g(Ot(o=>f(s.mapOrFail(o),Cn(fe(e)))))));case Vy:return T(()=>gt(t,xr(e,kt(s.name)),s.config,r));case Hy:return f(Ds(e,t.patch),g(o=>f(t.load(o,s,r),g(c=>{if(c.length===0){const i=f(Jh(o),At(()=>"<n/a>"));return J(Xy(i))}return w(c)}))));case Gy:return f(Ds(e,t.patch),g(o=>f(t.enumerateChildren(o),g(g_),g(c=>c.length===0?T(()=>F(gt(t,o,s.config,!0),kt)):f(Ot(c,i=>gt(t,Ua(e,`[${i}]`),s.config,!0)),F(i=>{const a=tg(i);return a.length===0?kt(wn()):kt(a)}))))));case Yy:return T(()=>f(Ds(e,t.patch),g(o=>f(t.enumerateChildren(o),g(c=>f(c,Ot(i=>gt(t,xr(o,kt(i)),s.valueConfig,r)),F(i=>{if(i.length===0)return kt(os());const a=i.map(h=>Array.from(h));return f(f_(a),Ce(h=>wu(li(nt(c),h))))})))))));case Qy:return T(()=>f(gt(t,e,s.left,r),Tn,g(o=>f(gt(t,e,s.right,r),Tn,g(c=>{if(yn(o)&&yn(c))return J(Il(o.left,c.left));if(yn(o)&&_n(c))return J(o.left);if(_n(o)&&yn(c))return J(c.left);if(_n(o)&&_n(c)){const i=f(e,Qe(".")),a=a_(e,i),[h,d]=i_(a,a,f(o.right,Ce(pt)),f(c.right,Ce(pt)));return f(h,li(d),Ot(([p,m])=>f(al(p,m),F(([b,S])=>s.zip(b,S)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},a_=(t,e)=>n=>Rt(Ee(t,`The element at index ${n} in a sequence at path "${e}" was missing`)),u_=(t,e)=>t.split(new RegExp(`\\s*${h_(e)}\\s*`)),l_=(t,e,n,r,s)=>s?f(u_(t,r),Ot(o=>n.parse(o.trim())),Cn(fe(e))):f(n.parse(t),F(kt),Cn(fe(e))),f_=t=>Object.keys(t[0]).map(e=>t.map(n=>n[e])),h_=t=>t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&"),g_=t=>f(Ot(t,d_),Em({onFailure:()=>wn(),onSuccess:Ja(An)}),Tn,F(jh)),p_=/^(\[(\d+)\])$/,d_=t=>{const e=t.match(p_);if(e!==null){const n=e[2];return f(n!==void 0&&n.length>0?v(n):$(),Ka(m_))}return $()},m_=t=>{const e=Number.parseInt(t);return Number.isNaN(e)?$():v(e)},po=Symbol.for("effect/Console"),Tc=yt(po),y_={[po]:po,assert(t,...e){return _(()=>{console.assert(t,...e)})},clear:_(()=>{console.clear()}),count(t){return _(()=>{console.count(t)})},countReset(t){return _(()=>{console.countReset(t)})},debug(...t){return _(()=>{console.debug(...t)})},dir(t,e){return _(()=>{console.dir(t,e)})},dirxml(...t){return _(()=>{console.dirxml(...t)})},error(...t){return _(()=>{console.error(...t)})},group(t){return t?.collapsed?_(()=>console.groupCollapsed(t?.label)):_(()=>console.group(t?.label))},groupEnd:_(()=>{console.groupEnd()}),info(...t){return _(()=>{console.info(...t)})},log(...t){return _(()=>{console.log(...t)})},table(t,e){return _(()=>{console.table(t,e)})},time(t){return _(()=>console.time(t))},timeEnd(t){return _(()=>console.timeEnd(t))},timeLog(t,...e){return _(()=>{console.timeLog(t,...e)})},trace(...t){return _(()=>{console.trace(...t)})},warn(...t){return _(()=>{console.warn(...t)})},unsafe:console},__="effect/Random",mo=Symbol.for(__),Rl=yt(mo);var x$;class b_{constructor(e){l(this,"seed");l(this,x$,mo);l(this,"PRNG");this.seed=e,this.PRNG=new va(e)}get next(){return _(()=>this.PRNG.number())}get nextBoolean(){return F(this.next,e=>e>.5)}get nextInt(){return _(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(e,n){return F(this.next,r=>(n-e)*r+e)}nextIntBetween(e,n){return _(()=>this.PRNG.integer(n-e)+e)}shuffle(e){return S_(e,n=>this.nextIntBetween(0,n))}}x$=mo;const S_=(t,e)=>T(()=>f(_(()=>Array.from(t)),g(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return f(r,Gn(s=>f(e(s),F(o=>v_(n,s-1,o)))),it(qn(n)))}))),v_=(t,e,n)=>{const r=t[e];return t[e]=t[n],t[n]=r,t},$_=t=>new b_(t),w_=f(Hr(),Jt(_s,Ly()),Jt(Tc,y_),Jt(Rl,$_(Math.random()*4294967296>>>0)),Jt(e_,c_()),Jt(ro,mm)),Yt=P(Symbol.for("effect/DefaultServices/currentServices"),()=>gl(w_)),k_=t=>{const e=ve(t);return Ml(n=>n.sleep(e))},Ml=t=>on(Yt,e=>t(Pt(e,_s))),E_=Ml(t=>t.currentTimeNanos),O_=t=>on(Yt,e=>t(Pt(e,Rl))),I_=k_,F_=E_;function R_(t){return new tr(t)}function M_(){return R_(new Map)}const Ui=Symbol.for("effect/FiberRefs");var D$;class tr{constructor(e){l(this,"locals");l(this,D$,Ui);this.locals=e}pipe(){return k(this,arguments)}}D$=Ui;const T_=(t,e,n,r=!1)=>{const s=t;let o=e,c=n,i=r,a;for(;a===void 0;)if(qt(o)&&qt(c)){const h=Z(o)[0],d=ge(o),p=Z(c)[0],m=Z(c)[1],b=ge(c);h.startTimeMillis<p.startTimeMillis?(c=b,i=!0):h.startTimeMillis>p.startTimeMillis?o=d:h.id<p.id?(c=b,i=!0):h.id>p.id?o=d:a=[m,i]}else a=[s.initial,!0];return a},C_=u(3,(t,e,n)=>{const r=new Map(t.locals);for(const[s,o]of n.locals){const c=Z(o)[1];if(!O(Z(o)[0],e)){if(!r.has(s)){if(O(c,s.initial))continue;r.set(s,[[e,s.join(s.initial,c)]]);continue}const i=r.get(s),[a,h]=T_(s,i,o);if(h){const d=s.diff(a,c),p=Z(i)[1],m=s.join(p,s.patch(d)(p));if(!O(p,m)){let b;const S=Z(i)[0];O(S,e)?b=Dt([S,m])(ge(i)):b=Dt([e,m])(i),r.set(s,b)}}}}return new tr(new Map(r))}),Tl=u(2,(t,e)=>{const n=new Map;for(const[r,s]of t.locals.entries()){const o=Z(s)[1],c=r.patch(r.fork)(o);O(o,c)?n.set(r,s):n.set(r,Dt([e,c])(s))}return new tr(n)}),Cl=u(2,(t,e)=>{const n=new Map(t.locals);return n.delete(e),new tr(n)}),yo=u(2,(t,e)=>t.locals.has(e)?v(Z(t.locals.get(e))[1]):$()),Cc=u(2,(t,e)=>f(yo(t,e),At(()=>e.initial))),Dr=u(2,(t,{fiberId:e,fiberRef:n,value:r})=>{const s=t.locals.has(n)?t.locals.get(n):wn();let o;if(Yo(s))o=kt([e,r]);else{const[i,a]=Z(s);if(O(i,e)){if(O(a,r))return t;o=Dt([e,r])(ge(s))}else o=Dt([e,r])(s)}const c=new Map(t.locals);return new tr(c.set(n,o))}),N_=Tl,A_=Cc,Bi=Dr,P_=M_,L_=Am,x_=Pm,D_=Lm,q_=xm,Nl=ul,j_=ll,K_=Dm,U_=qm,B_=f(An,Mh(t=>t.ordinal)),z_=Th(B_),W_=t=>{switch(t){case"All":return L_;case"Debug":return j_;case"Error":return D_;case"Fatal":return x_;case"Info":return Nl;case"Trace":return K_;case"None":return U_;case"Warning":return q_}},J_=t=>e=>`${e.label.replace(/[\s="]/g,"_")}=${t-e.startTime}ms`,V_=J_,Al=Symbol.for("effect/Ref"),Pl={_A:t=>t};var q$;class H_{constructor(e){l(this,"ref");l(this,q$,Pl);this.ref=e}modify(e){return _(()=>{const n=Ut(this.ref),[r,s]=e(n);return n!==s&&ke(s)(this.ref),r})}pipe(){return k(this,arguments)}}q$=Al;const Ll=t=>new H_(Xe(t)),_o=t=>_(()=>Ll(t)),qr=t=>t.modify(e=>[e,e]),Nc=u(2,(t,e)=>t.modify(()=>[void 0,e])),xl=u(2,(t,e)=>t.modify(e)),bo=u(2,(t,e)=>t.modify(n=>[void 0,e(n)])),G_=u(2,(t,e)=>t.modify(n=>{const r=e(n);return[r,r]})),Y_=_o,jw=qr,Q_=xl,Kw=Nc,Uw=bo,Bw=G_,Dl="Empty",ql="Add",jl="Remove",Kl="Update",Ul="AndThen",X_={_tag:Dl},Bl=(t,e)=>{const n=new Map(t.locals);let r=X_;for(const[s,o]of e.locals.entries()){const c=Z(o)[1],i=n.get(s);if(i!==void 0){const a=Z(i)[1];O(a,c)||(r=qs({_tag:Kl,fiberRef:s,patch:s.diff(a,c)})(r))}else r=qs({_tag:ql,fiberRef:s,value:c})(r);n.delete(s)}for(const[s]of n.entries())r=qs({_tag:jl,fiberRef:s})(r);return r},qs=u(2,(t,e)=>({_tag:Ul,first:t,second:e})),zl=u(3,(t,e,n)=>{let r=n,s=kt(t);for(;qt(s);){const o=Z(s),c=ge(s);switch(o._tag){case Dl:{s=c;break}case ql:{r=Dr(r,{fiberId:e,fiberRef:o.fiberRef,value:o.value}),s=c;break}case jl:{r=Cl(r,o.fiberRef),s=c;break}case Kl:{const i=Cc(r,o.fiberRef);r=Dr(r,{fiberId:e,fiberRef:o.fiberRef,value:o.fiberRef.patch(o.patch)(i)}),s=c;break}case Ul:{s=Dt(o.first)(Dt(o.second)(c));break}}}return r}),Wl="effect/MetricLabel",So=Symbol.for(Wl);var j$;class Z_{constructor(e,n){l(this,"key");l(this,"value");l(this,j$,So);this.key=e,this.value=n}[(j$=So,R)](){return f(y(Wl),E(y(this.key)),E(y(this.value)))}[M](e){return eb(e)&&this.key===e.key&&this.value===e.value}pipe(){return k(this,arguments)}}const tb=(t,e)=>new Z_(t,e),eb=t=>I(t,So);class Ac{constructor(e){l(this,"self");l(this,"called",!1);this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new Ac(this.self)}}const zi=t=>{let e,n;return typeof t=="function"?e=t:(e=t.try,n=t.catch),_(()=>{try{return e()}catch(r){throw bm(Se(n?n(r):r))}})},nb=u(2,(t,e)=>Q(t,{onFailure:n=>{const r=e(n);switch(r._tag){case"None":return D(n);case"Some":return r.value}},onSuccess:w})),rb=u(2,(t,e)=>at(I_(e),t)),sb=t=>Yl(t,ub,Bl),Jl=u(2,(t,{onFailure:e,onSuccess:n})=>Hn(t,{onFailure:r=>w(e(r)),onSuccess:r=>w(n(r))})),ob=t=>{const e=g(g(t,()=>Yn()),()=>e);return e};class cb{constructor(e){l(this,"value");this.value=e}[Symbol.iterator](){return new Ac(this)}}const ib=function(){let t=arguments[0];for(let e=1;e<arguments.length;e++)t=arguments[e](t);return new cb(t)},ab=function(){let t;return arguments.length===1?t=arguments[0]:t=arguments[1].bind(arguments[0]),T(()=>{const e=t(ib),n=e.next(),r=s=>s.done?w(s.value):f(s.value.value,g(o=>r(e.next(o))));return r(n)})},ub=rt(t=>w(t.getFiberRefs())),lb=t=>Jl(t,{onFailure:oi,onSuccess:oi}),Vl=t=>(e,n)=>{const r=Dn(t);let s,o;return zu(e)?(o=e,s=n??""):(s=e,o=n??te),rt(c=>(c.log(s,o,r),N))},fb=Vl(),hb=Vl(Nl),gb=(t,e)=>e.discard?Gl(t,e.while,e.step,e.body):F(Hl(t,e.while,e.step,e.body),n=>Array.from(n)),Hl=(t,e,n,r)=>T(()=>e(t)?g(r(t),s=>F(Hl(n(t),e,n,r),Mu(s))):_(()=>be())),Gl=(t,e,n,r)=>T(()=>e(t)?g(r(t),()=>Gl(n(t),e,n,r)):N),Wi=u(2,(t,e)=>Q(t,{onFailure:n=>sl(()=>e(n)),onSuccess:w})),pb=t=>F(t,e=>!e),vo=t=>$b((e,n)=>f(t,zl(e,n))),db=u(3,(t,e,n)=>an(r=>Rc(t,Jt(r,e,n)))),mb=O_(w),yb=u(3,(t,e,n)=>nt(t).reduce((r,s,o)=>g(r,c=>n(c,s,o)),w(e))),Yl=u(3,(t,e,n)=>g(e,r=>g(t,s=>F(e,o=>[n(r,o),s])))),_b=u(2,(t,e)=>Q(t,{onFailure:n=>at(e(n),D(n)),onSuccess:w})),bb=t=>Sb(t,F_),Sb=u(2,(t,e)=>Yl(t,e,(n,r)=>lo(r-n))),vb=t=>{let e,n;return typeof t=="function"?e=t:(e=t.try,n=t.catch),e.length>=1?T(()=>{const r=new AbortController;return g(zi(()=>e(r.signal)),s=>ze(o=>(s.then(c=>o(et(c))).catch(c=>o(J(n?n(c):c))),_(()=>r.abort()))))}):g(zi(t),r=>ze(s=>{r.then(o=>s(et(o))).catch(o=>s(J(n?n(o):o)))}))},$b=t=>rt(e=>(e.setFiberRefs(t(e.id(),e.getFiberRefs())),N)),wb=u(3,(t,e,n)=>dl(t,r=>Jt(r,e,n(Xo(r,e))))),kb=u(2,(t,e)=>T(()=>e()?F(t,v):w($()))),Eb=t=>F(Fc(),we(t)),Ob=t=>t==null?J(mc()):w(t),Ji=Ia,Ql="Sequential",Xl="Parallel",Ib="ParallelN",Pc={_tag:Ql},Fb={_tag:Xl},Rb=t=>({_tag:Ib,parallelism:t}),Mb=t=>t._tag===Ql,Tb=t=>t._tag===Xl,$o=Pc,wo=Fb,ko=Rb,jr=Bl,Vi=zl,bs="effect/FiberStatus",$e=Symbol.for(bs),Eo="Done",Hi="Running",Gi="Suspended";var K$;class Cb{constructor(){l(this,K$,$e);l(this,"_tag",Eo)}[(K$=$e,R)](){return f(y(bs),E(y(this._tag)))}[M](e){return Lc(e)&&e._tag===Eo}}var U$;class Nb{constructor(e){l(this,"runtimeFlags");l(this,U$,$e);l(this,"_tag",Hi);this.runtimeFlags=e}[(U$=$e,R)](){return f(y(bs),E(y(this._tag)),E(y(this.runtimeFlags)))}[M](e){return Lc(e)&&e._tag===Hi&&this.runtimeFlags===e.runtimeFlags}}var B$;class Ab{constructor(e,n){l(this,"runtimeFlags");l(this,"blockingOn");l(this,B$,$e);l(this,"_tag",Gi);this.runtimeFlags=e,this.blockingOn=n}[(B$=$e,R)](){return f(y(bs),E(y(this._tag)),E(y(this.runtimeFlags)),E(y(this.blockingOn)))}[M](e){return Lc(e)&&e._tag===Gi&&this.runtimeFlags===e.runtimeFlags&&O(this.blockingOn,e.blockingOn)}}const Pb=new Cb,Lb=t=>new Nb(t),xb=(t,e)=>new Ab(t,e),Lc=t=>I(t,$e),Db=t=>t._tag===Eo,qb=Pb,Zl=Lb,jb=xb,Kb=Db;class Ub{constructor(){l(this,"buckets",[])}scheduleTask(e,n){let r,s;for(s=0;s<this.buckets.length&&this.buckets[s][0]<=n;s++)r=this.buckets[s];if(r)r[1].push(e);else{const o=[];for(let c=0;c<s;c++)o.push(this.buckets[c]);o.push([n,[e]]);for(let c=s;c<this.buckets.length;c++)o.push(this.buckets[c]);this.buckets=o}}}class Bb{constructor(e){l(this,"maxNextTickBeforeTimer");l(this,"running",!1);l(this,"tasks",new Ub);this.maxNextTickBeforeTimer=e}starveInternal(e){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let o=0;o<s.length;o++)s[o]();this.tasks.buckets.length===0?this.running=!1:this.starve(e)}starve(e=0){e>=this.maxNextTickBeforeTimer?Sl(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(e+1))}shouldYield(e){return e.currentOpCount>e.getFiberRef(Wm)?e.getFiberRef(ds):!1}scheduleTask(e,n){this.tasks.scheduleTask(e,n),this.running||(this.running=!0,this.starve())}}const zb=P(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new Bb(2048)),Kr=P(Symbol.for("effect/FiberRef/currentScheduler"),()=>ht(zb)),tf=P(Symbol.for("effect/FiberRef/currentRequestMap"),()=>ht(new Map)),Yi=(t,e,n,r)=>{switch(t){case void 0:return e();case"unbounded":return n();case"inherit":return on(Ym,s=>s==="unbounded"?n():s>1?r(s):e());default:return t>1?r(t):e()}},xc="InterruptSignal",Dc="Stateful",qc="Resume",jc="YieldNow",Qi=t=>({_tag:xc,cause:t}),yr=t=>({_tag:Dc,onFiber:t}),Re=t=>({_tag:qc,effect:t}),Wb=()=>({_tag:jc}),Jb="effect/FiberScope",Ur=Symbol.for(Jb);var z$;class Vb{constructor(){l(this,z$,Ur);l(this,"fiberId",jn);l(this,"roots",new Set)}add(e,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}z$=Ur;var W$;class Hb{constructor(e,n){l(this,"fiberId");l(this,"parent");l(this,W$,Ur);this.fiberId=e,this.parent=n}add(e,n){this.parent.tell(yr(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}W$=Ur;const Gb=t=>new Hb(t.id(),t),ef=P(Symbol.for("effect/FiberScope/Global"),()=>new Vb),Yb="effect/Fiber",Qb=Symbol.for(Yb),Xb={_E:t=>t,_A:t=>t},Zb="effect/Fiber",tS=Symbol.for(Zb),eS=t=>t.await,nS=t=>t.inheritAll,Xi=t=>gs(Vn(t.await),t.inheritAll),oe="effect/FiberCurrent",rS="effect/Logger",sS=Symbol.for(rS),oS={_Message:t=>t,_Output:t=>t},Kc=t=>({[sS]:oS,log:t,pipe(){return k(this,arguments)}}),cS=Kc(({annotations:t,cause:e,date:n,fiberId:r,logLevel:s,message:o,spans:c})=>{const i=n.getTime();let h=[`timestamp=${n.toISOString()}`,`level=${s.label}`,`fiber=${vu(r)}`].join(" ");const d=Oo(o);if(d.length>0&&(h=h+" message=",h=js(d,h)),e!=null&&e._tag!=="Empty"&&(h=h+" cause=",h=js(us(e),h)),Ru(c)){h=h+" ";let p=!0;for(const m of c)p?p=!1:h=h+" ",h=h+f(m,V_(i))}if(f(t,Mp)>0){h=h+" ";let p=!0;for(const[m,b]of t)p?p=!1:h=h+" ",h=h+uS(m),h=h+"=",h=js(Oo(b),h)}return h}),Oo=t=>{try{return typeof t=="object"?JSON.stringify(t):String(t)}catch{return String(t)}},iS=t=>`"${t.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,aS=/^[^\s"=]+$/,js=(t,e)=>e+(t.match(aS)?t:iS(t)),uS=t=>t.replace(/[\s="]/g,"_"),nf="effect/MetricBoundaries",Io=Symbol.for(nf);var J$;class lS{constructor(e){l(this,"values");l(this,J$,Io);this.values=e}[(J$=Io,R)](){return f(y(nf),E(y(this.values)))}[M](e){return fS(e)&&O(this.values,e.values)}pipe(){return k(this,arguments)}}const fS=t=>I(t,Io),hS=t=>{const e=f(t,Nt(lt(Number.POSITIVE_INFINITY)),Cg);return new lS(e)},gS=t=>f(Go(t.count-1,e=>t.start*Math.pow(t.factor,e)),St,hS),pS="effect/MetricKeyType",rf=Symbol.for(pS),sf="effect/MetricKeyType/Counter",Fo=Symbol.for(sf),dS="effect/MetricKeyType/Frequency",mS=Symbol.for(dS),yS="effect/MetricKeyType/Gauge",_S=Symbol.for(yS),of="effect/MetricKeyType/Histogram",Ro=Symbol.for(of),bS="effect/MetricKeyType/Summary",SS=Symbol.for(bS),cf={_In:t=>t,_Out:t=>t};var V$,H$;class vS{constructor(e,n){l(this,"incremental");l(this,"bigint");l(this,V$,cf);l(this,H$,Fo);this.incremental=e,this.bigint=n}[(V$=rf,H$=Fo,R)](){return y(sf)}[M](e){return af(e)}pipe(){return k(this,arguments)}}var G$,Y$;class $S{constructor(e){l(this,"boundaries");l(this,G$,cf);l(this,Y$,Ro);this.boundaries=e}[(G$=rf,Y$=Ro,R)](){return f(y(of),E(y(this.boundaries)))}[M](e){return uf(e)&&O(this.boundaries,e.boundaries)}pipe(){return k(this,arguments)}}const wS=t=>new vS(t?.incremental??!1,t?.bigint??!1),kS=t=>new $S(t),af=t=>I(t,Fo),ES=t=>I(t,mS),OS=t=>I(t,_S),uf=t=>I(t,Ro),IS=t=>I(t,SS),FS="effect/MetricKey",lf=Symbol.for(FS),RS={_Type:t=>t};var Q$;class Uc{constructor(e,n,r,s=Tt()){l(this,"name");l(this,"keyType");l(this,"description");l(this,"tags");l(this,Q$,RS);this.name=e,this.keyType=n,this.description=r,this.tags=s}[(Q$=lf,R)](){return f(y(this.name),E(y(this.keyType)),E(y(this.description)),E(y(this.tags)))}[M](e){return MS(e)&&this.name===e.name&&O(this.keyType,e.keyType)&&O(this.description,e.description)&&O(this.tags,e.tags)}pipe(){return k(this,arguments)}}const MS=t=>I(t,lf),TS=(t,e)=>new Uc(t,wS(e),Dn(e?.description)),CS=(t,e,n)=>new Uc(t,kS(e),Dn(n)),NS=u(2,(t,e)=>ac(e)===0?t:new Uc(t.name,t.keyType,t.description,f(t.tags,Zt(e)))),AS="effect/MetricState",er=Symbol.for(AS),ff="effect/MetricState/Counter",Mo=Symbol.for(ff),hf="effect/MetricState/Frequency",To=Symbol.for(hf),gf="effect/MetricState/Gauge",Co=Symbol.for(gf),pf="effect/MetricState/Histogram",No=Symbol.for(pf),df="effect/MetricState/Summary",Ao=Symbol.for(df),nr={_A:t=>t};var X$,Z$;class PS{constructor(e){l(this,"count");l(this,X$,nr);l(this,Z$,Mo);this.count=e}[(X$=er,Z$=Mo,R)](){return f(y(ff),E(y(this.count)))}[M](e){return WS(e)&&this.count===e.count}pipe(){return k(this,arguments)}}var tw,ew;class LS{constructor(e){l(this,"occurrences");l(this,tw,nr);l(this,ew,To);this.occurrences=e}[(tw=er,ew=To,R)](){return f(y(hf),E(y(this.occurrences)))}[M](e){return JS(e)&&O(this.occurrences,e.occurrences)}pipe(){return k(this,arguments)}}var nw,rw;class xS{constructor(e){l(this,"value");l(this,nw,nr);l(this,rw,Co);this.value=e}[(nw=er,rw=Co,R)](){return f(y(gf),E(y(this.value)))}[M](e){return VS(e)&&this.value===e.value}pipe(){return k(this,arguments)}}var sw,ow;class DS{constructor(e,n,r,s,o){l(this,"buckets");l(this,"count");l(this,"min");l(this,"max");l(this,"sum");l(this,sw,nr);l(this,ow,No);this.buckets=e,this.count=n,this.min=r,this.max=s,this.sum=o}[(sw=er,ow=No,R)](){return f(y(pf),E(y(this.buckets)),E(y(this.count)),E(y(this.min)),E(y(this.max)),E(y(this.sum)))}[M](e){return HS(e)&&O(this.buckets,e.buckets)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return k(this,arguments)}}var cw,iw;class qS{constructor(e,n,r,s,o,c){l(this,"error");l(this,"quantiles");l(this,"count");l(this,"min");l(this,"max");l(this,"sum");l(this,cw,nr);l(this,iw,Ao);this.error=e,this.quantiles=n,this.count=r,this.min=s,this.max=o,this.sum=c}[(cw=er,iw=Ao,R)](){return f(y(df),E(y(this.error)),E(y(this.quantiles)),E(y(this.count)),E(y(this.min)),E(y(this.max)),E(y(this.sum)))}[M](e){return GS(e)&&this.error===e.error&&O(this.quantiles,e.quantiles)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return k(this,arguments)}}const jS=t=>new PS(t),KS=t=>new LS(t),US=t=>new xS(t),BS=t=>new DS(t.buckets,t.count,t.min,t.max,t.sum),zS=t=>new qS(t.error,t.quantiles,t.count,t.min,t.max,t.sum),WS=t=>I(t,Mo),JS=t=>I(t,To),VS=t=>I(t,Co),HS=t=>I(t,No),GS=t=>I(t,Ao),YS="effect/MetricHook",QS=Symbol.for(YS),XS={_In:t=>t,_Out:t=>t},rr=t=>({[QS]:XS,pipe(){return k(this,arguments)},...t}),Zi=BigInt(0),ZS=t=>{let e=t.keyType.bigint?Zi:0;const n=t.keyType.incremental?t.keyType.bigint?r=>r>=Zi:r=>r>=0:r=>!0;return rr({get:()=>jS(e),update:r=>{n(r)&&(e=e+r)}})},t0=t=>{const e=new Map,n=s=>{const o=e.get(s)??0;e.set(s,o+1)},r=()=>wu(e.entries());return rr({get:()=>KS(r()),update:n})},e0=(t,e)=>{let n=e;return rr({get:()=>US(n),update:r=>{n=r}})},n0=t=>{const e=t.keyType.boundaries.values,n=e.length,r=new Uint32Array(n+1),s=new Float32Array(n);let o=0,c=0,i=Number.MAX_VALUE,a=Number.MIN_VALUE;f(e,Ws(An),ou((p,m)=>{s[m]=p}));const h=p=>{let m=0,b=n;for(;m!==b;){const S=Math.floor(m+(b-m)/2),L=s[S];p<=L?b=S:m=S,b===m+1&&(p<=s[m]?b=m:m=b)}r[m]=r[m]+1,o=o+1,c=c+p,p<i&&(i=p),p>a&&(a=p)},d=()=>{const p=Array(n);let m=0;for(let b=0;b<n;b++){const S=s[b],L=r[b];m=m+L,p[b]=[S,m]}return St(p)};return rr({get:()=>BS({buckets:d(),count:o,min:i,max:a,sum:c}),update:h})},r0=t=>{const{error:e,maxAge:n,maxSize:r,quantiles:s}=t.keyType,o=f(s,Ws(An)),c=Array(r);let i=0,a=0,h=0,d=Number.MAX_VALUE,p=Number.MIN_VALUE;const m=S=>{const L=[];let q=0;for(;q!==r-1;){const j=c[q];if(j!=null){const[wt,se]=j,fn=fo(S-wt);Oy(fn,yy)&&fn<=n&&L.push(se)}q=q+1}return s0(e,o,f(St(L),Ws(An)))},b=(S,L)=>{if(r>0){i=i+1;const q=i%r;c[q]=[L,S]}a=a+1,h=h+S,S<d&&(d=S),S>p&&(p=S)};return rr({get:()=>zS({error:e,quantiles:m(Date.now()),count:a,min:d,max:p,sum:h}),update:([S,L])=>b(S,L)})},s0=(t,e,n)=>{const r=n.length;if(Zo(e))return Mt();const s=En(e),o=f(e,kn(1)),c=f(o,Qt(lt(ta(t,r,$(),0,s,n)),(i,a)=>{const h=En(i);return f(i,Fg(ta(t,r,h.value,h.consumed,a,h.rest)))}));return f(c,ou(i=>[i.quantile,i.value]))},ta=(t,e,n,r,s,o)=>{let c=t,i=e,a=n,h=r,d=s,p=o,m=t,b=e,S=n,L=r,q=s,j=o;for(;;){if(Zo(p))return{quantile:d,value:$(),consumed:h,rest:Mt()};if(d===1)return{quantile:d,value:v(Rg(p)),consumed:h+p.length,rest:Mt()};const wt=f(p,Tg(Os=>Os>En(p))),se=d*i,fn=c/2*se,Ie=h+wt[0].length,Yf=Math.abs(Ie-se);if(Ie<se-fn){m=c,b=i,S=Ms(p),L=Ie,q=d,j=wt[1],c=m,i=b,a=S,h=L,d=q,p=j;continue}if(Ie>se+fn)return{quantile:d,value:a,consumed:h,rest:p};switch(a._tag){case"None":{m=c,b=i,S=Ms(p),L=Ie,q=d,j=wt[1],c=m,i=b,a=S,h=L,d=q,p=j;continue}case"Some":{const Os=Math.abs(se-a.value);if(Yf<Os){m=c,b=i,S=Ms(p),L=Ie,q=d,j=wt[1],c=m,i=b,a=S,h=L,d=q,p=j;continue}return{quantile:d,value:v(a.value),consumed:h,rest:p}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},o0="effect/MetricPair",c0=Symbol.for(o0),i0={_Type:t=>t},a0=(t,e)=>({[c0]:i0,metricKey:t,metricState:e,pipe(){return k(this,arguments)}}),u0="effect/MetricRegistry",ea=Symbol.for(u0);var aw;class l0{constructor(){l(this,aw,ea);l(this,"map",My())}snapshot(){const e=[];for(const[n,r]of this.map)e.push(a0(n,r.get()));return ic(e)}get(e){const n=f(this.map,ue(e),ae);if(n==null){if(af(e.keyType))return this.getCounter(e);if(OS(e.keyType))return this.getGauge(e);if(ES(e.keyType))return this.getFrequency(e);if(uf(e.keyType))return this.getHistogram(e);if(IS(e.keyType))return this.getSummary(e);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(e){let n=f(this.map,ue(e),ae);if(n==null){const r=ZS(e);f(this.map,hn(e))||f(this.map,gn(e,r)),n=r}return n}getFrequency(e){let n=f(this.map,ue(e),ae);if(n==null){const r=t0();f(this.map,hn(e))||f(this.map,gn(e,r)),n=r}return n}getGauge(e){let n=f(this.map,ue(e),ae);if(n==null){const r=e0(e,e.keyType.bigint?BigInt(0):0);f(this.map,hn(e))||f(this.map,gn(e,r)),n=r}return n}getHistogram(e){let n=f(this.map,ue(e),ae);if(n==null){const r=n0(e);f(this.map,hn(e))||f(this.map,gn(e,r)),n=r}return n}getSummary(e){let n=f(this.map,ue(e),ae);if(n==null){const r=r0(e);f(this.map,hn(e))||f(this.map,gn(e,r)),n=r}return n}}aw=ea;const f0=()=>new l0,h0="effect/Metric",g0=Symbol.for(h0),p0={_Type:t=>t,_In:t=>t,_Out:t=>t},d0=P(Symbol.for("effect/Metric/globalMetricRegistry"),()=>f0()),mf=function(t,e,n){return Object.assign(s=>sn(s,o=>_(()=>e(o,Tt()))),{[g0]:p0,keyType:t,unsafeUpdate:e,unsafeValue:n,pipe(){return k(this,arguments)}})},Ss=(t,e)=>yf(TS(t,e)),yf=t=>{const e=n=>{const r=f(t,NS(n));return d0.get(r)};return mf(t.keyType,(n,r)=>e(r).update(n),n=>e(n).get())},m0=(t,e,n)=>yf(CS(t,e,n)),y0=u(3,(t,e,n)=>_0(t,rs(tb(e,n)))),_0=u(2,(t,e)=>{const n=hp(e)?e:ic(e);return mf(t.keyType,(r,s)=>t.unsafeUpdate(r,f(n,Zt(s))),r=>t.unsafeValue(f(n,Zt(r))))}),b0=u(2,(t,e)=>on(tf,n=>_(()=>{if(n.has(t)){const r=n.get(t);r.state.completed||(r.state.completed=!0,Ic(r.result,e))}}))),S0="effect/Supervisor",vs=Symbol.for(S0),Bc={_T:t=>t};var uw;const ni=class{constructor(e,n){l(this,"underlying");l(this,"value0");l(this,uw,Bc);this.underlying=e,this.value0=n}get value(){return this.value0}onStart(e,n,r,s){this.underlying.onStart(e,n,r,s)}onEnd(e,n){this.underlying.onEnd(e,n)}onEffect(e,n){this.underlying.onEffect(e,n)}onSuspend(e){this.underlying.onSuspend(e)}onResume(e){this.underlying.onResume(e)}map(e){return new ni(this,f(this.value,F(e)))}zip(e){return new zr(this,e)}};let Br=ni;uw=vs;var lw;const ri=class{constructor(e,n){l(this,"left");l(this,"right");l(this,"_tag","Zip");l(this,lw,Bc);this.left=e,this.right=n}get value(){return al(this.left.value,this.right.value)}onStart(e,n,r,s){this.left.onStart(e,n,r,s),this.right.onStart(e,n,r,s)}onEnd(e,n){this.left.onEnd(e,n),this.right.onEnd(e,n)}onEffect(e,n){this.left.onEffect(e,n),this.right.onEffect(e,n)}onSuspend(e){this.left.onSuspend(e),this.right.onSuspend(e)}onResume(e){this.left.onResume(e),this.right.onResume(e)}map(e){return new Br(this,f(this.value,F(e)))}zip(e){return new ri(this,e)}};let zr=ri;lw=vs;const _f=t=>I(t,vs)&&ba(t,"Zip");var fw;class v0{constructor(e){l(this,"effect");l(this,fw,Bc);this.effect=e}get value(){return this.effect}onStart(e,n,r,s){}onEnd(e,n){}onEffect(e,n){}onSuspend(e){}onResume(e){}map(e){return new Br(this,f(this.value,F(e)))}zip(e){return new zr(this,e)}onRun(e,n){return e()}}fw=vs;const $0=t=>new v0(t),$s=P("effect/Supervisor/none",()=>$0(N)),w0=Un,bf="Empty",Sf="AddSupervisor",vf="RemoveSupervisor",$f="AndThen",$n={_tag:bf},_r=(t,e)=>({_tag:$f,first:t,second:e}),k0=(t,e)=>E0(e,lt(t)),E0=(t,e)=>{let n=t,r=e;for(;pe(r);){const s=de(r);switch(s._tag){case bf:{r=Vt(r);break}case Sf:{n=n.zip(s.supervisor),r=Vt(r);break}case vf:{n=Po(n,s.supervisor),r=Vt(r);break}case $f:{r=mt(s.first)(mt(s.second)(Vt(r)));break}}}return n},Po=(t,e)=>O(t,e)?$s:_f(t)?Po(t.left,e).zip(Po(t.right,e)):t,Wr=t=>O(t,$s)?Tt():_f(t)?f(Wr(t.left),Zt(Wr(t.right))):rs(t),O0=(t,e)=>{if(O(t,e))return $n;const n=Wr(t),r=Wr(e),s=f(r,gi(n),Or($n,(c,i)=>_r(c,{_tag:Sf,supervisor:i}))),o=f(n,gi(r),Or($n,(c,i)=>_r(c,{_tag:vf,supervisor:i})));return _r(s,o)},I0=w0({empty:$n,patch:k0,combine:_r,diff:O0}),F0=Ss("effect_fiber_started"),na=Ss("effect_fiber_active"),R0=Ss("effect_fiber_successes"),M0=Ss("effect_fiber_failures"),T0=y0(m0("effect_fiber_lifetimes",gS({start:1,factor:1.3,count:100})),"time_unit","milliseconds"),pn="Continue",C0="Done",ra="Yield",N0={_E:t=>t,_A:t=>t},dn=t=>{throw new Error(`BUG: FiberRuntime - ${JSON.stringify(t)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},lr={[vr]:(t,e,n)=>e.i1(n),OnStep:(t,e,n)=>e.i1(et(n)),[$r]:(t,e,n)=>e.i2(n),[Ho]:(t,e,n)=>(t.patchRuntimeFlags(t._runtimeFlags,e.patch),Wt(t._runtimeFlags)&&t.isInterrupted()?x(t.getInterruptedCause()):et(n)),[wr]:(t,e,n)=>(e.i2(n),e.i0()?(t.pushStack(e),e.i1()):N)},A0={[xc]:(t,e,n,r)=>(t.processNewInterruptSignal(r.cause),Wt(e)?x(r.cause):n),[qc]:(t,e,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[Dc]:(t,e,n,r)=>(r.onFiber(t,Zl(e)),n),[jc]:(t,e,n,r)=>g(Yn(),()=>n)},P0=t=>Gn(Rd(t),e=>Ge(Ud(e),([n,r])=>{const s=new Map;for(const o of r)for(const c of o)s.set(c.request,c);return cn(nv(n.runAll(r),r.flat()),tf,s)},!1));var hw,gw;class wf{constructor(e,n,r){l(this,hw,Xb);l(this,gw,N0);l(this,"_fiberRefs");l(this,"_fiberId");l(this,"_runtimeFlags");l(this,"_queue",new Array);l(this,"_children",null);l(this,"_observers",new Array);l(this,"_running",!1);l(this,"_stack",[]);l(this,"_asyncInterruptor",null);l(this,"_asyncBlockingOn",null);l(this,"_exitValue",null);l(this,"_steps",[!1]);l(this,"_supervisor");l(this,"_scheduler");l(this,"_tracer");l(this,"currentOpCount",0);l(this,"isYielding",!1);l(this,"run",()=>{this.drainQueueOnCurrentThread()});if(this._runtimeFlags=r,this._fiberId=e,this._fiberRefs=n,this._supervisor=this.getFiberRef(aa),this._scheduler=this.getFiberRef(Kr),Cs(r)){const s=this.getFiberRef(As);F0.unsafeUpdate(1,s),na.unsafeUpdate(1,s)}this._tracer=Pt(this.getFiberRef(Yt),ro)}pipe(){return k(this,arguments)}id(){return this._fiberId}resume(e){this.tell(Re(e))}get status(){return this.ask((e,n)=>n)}get runtimeFlags(){return this.ask((e,n)=>Kb(n)?e._runtimeFlags:n.runtimeFlags)}scope(){return Gb(this)}get children(){return this.ask(e=>Array.from(e.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(ur)}fiberRefs(){return this.ask(e=>e.getFiberRefs())}ask(e){return T(()=>{const n=kc(this._fiberId);return this.tell(yr((r,s)=>{Ic(n,_(()=>e(r,s)))})),ms(n)})}tell(e){this._queue.push(e),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return ze(e=>{const n=r=>e(w(r));return this.tell(yr((r,s)=>{r._exitValue!==null?n(this._exitValue):r.addObserver(n)})),_(()=>this.tell(yr((r,s)=>{r.removeObserver(n)})))},this.id())}get inheritAll(){return rt((e,n)=>{const r=e.id(),s=e.getFiberRefs(),o=n.runtimeFlags,c=this.getFiberRefs(),i=C_(s,r,c);e.setFiberRefs(i);const a=e.getFiberRef(ia),h=f(De(o,a),_i(Ze),_i(to));return oo(h)})}get poll(){return _(()=>Dn(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(e){return _(()=>this.tell(Qi(It(e))))}addObserver(e){this._exitValue!==null?e(this._exitValue):this._observers.push(e)}removeObserver(e){this._observers=this._observers.filter(n=>n!==e)}getFiberRefs(){return this.setFiberRef(ia,this._runtimeFlags),this._fiberRefs}unsafeDeleteFiberRef(e){this._fiberRefs=Cl(this._fiberRefs,e)}getFiberRef(e){return this._fiberRefs.locals.has(e)?this._fiberRefs.locals.get(e)[0][1]:e.initial}setFiberRef(e,n){this._fiberRefs=Dr(this._fiberRefs,{fiberId:this._fiberId,fiberRef:e,value:n}),this.refreshRefCache()}refreshRefCache(){this._tracer=Pt(this.getFiberRef(Yt),ro),this._supervisor=this.getFiberRef(aa),this._scheduler=this.getFiberRef(Kr)}setFiberRefs(e){this._fiberRefs=e,this.refreshRefCache()}addChild(e){this.getChildren().add(e)}removeChild(e){this.getChildren().delete(e)}drainQueueOnCurrentThread(){let e=!0;for(;e;){let n=pn;const r=globalThis[oe];globalThis[oe]=this;try{for(;n===pn;)n=this._queue.length===0?C0:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[oe]=r}this._queue.length>0&&!this._running?(this._running=!0,n===ra?(this.drainQueueLaterOnExecutor(),e=!1):e=!0):e=!1}}drainQueueLaterOnExecutor(){this._scheduler.scheduleTask(this.run,this.getFiberRef(ds))}drainQueueWhileRunning(e,n){let r=n;for(;this._queue.length>0;){const s=this._queue.splice(0,1)[0];r=A0[s._tag](this,e,r,s)}return r}isInterrupted(){return!Wd(this.getFiberRef(ur))}addInterruptedCause(e){const n=this.getFiberRef(ur);this.setFiberRef(ur,tt(n,e))}processNewInterruptSignal(e){this.addInterruptedCause(e),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let e=!1;for(const n of this._children)n.tell(Qi(It(this.id()))),e=!0;return e}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const e=this._children.values();this._children=null;let n=!1;return Cr({while:()=>!n,body:()=>{const s=e.next();return s.done?_(()=>{n=!0}):ut(s.value.await)},step:()=>{}})}return null}reportExitValue(e){if(Cs(this._runtimeFlags)){const n=this.getFiberRef(As);switch(na.unsafeUpdate(-1,n),e._tag){case Y:{R0.unsafeUpdate(1,n);break}case G:{M0.unsafeUpdate(1,n);break}}}if(e._tag==="Failure"){const n=this.getFiberRef(Xm);!as(e.cause)&&n._tag==="Some"&&this.log("Fiber terminated with a non handled error",e.cause,n)}}setExitValue(e){if(this._exitValue=e,Cs(this._runtimeFlags)){const n=this.getFiberRef(As),r=this.id().startTimeMillis,s=new Date().getTime();T0.unsafeUpdate(s-r,n)}this.reportExitValue(e);for(let n=this._observers.length-1;n>=0;n--)this._observers[n](e)}getLoggers(){return this.getFiberRef(j0)}log(e,n,r){const s=A(r)?r.value:this.getFiberRef(Vm),o=this.getFiberRef(L0);if(z_(o,s))return;const c=this.getFiberRef(Hm),i=this.getFiberRef(Jm),a=this.getLoggers(),h=this.getFiberRefs();if(ac(a)>0){const d=Pt(this.getFiberRef(Yt),_s),p=new Date(d.unsafeCurrentTimeMillis());for(const m of a)m.log({fiberId:this.id(),logLevel:s,message:e,cause:n,context:h,spans:c,annotations:i,date:p})}}evaluateMessageWhileSuspended(e){switch(e._tag){case jc:return ra;case xc:return this.processNewInterruptSignal(e.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(x(e.cause)),this._asyncInterruptor=null),pn;case qc:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(e.effect),pn;case Dc:return e.onFiber(this,this._exitValue!==null?qb:jb(this._runtimeFlags,this._asyncBlockingOn)),pn;default:return dn(e)}}evaluateEffect(e){this._supervisor.onResume(this);try{let n=Wt(this._runtimeFlags)&&this.isInterrupted()?x(this.getInterruptedCause()):e;for(;n!==null;)try{const r=n,s=this.runLoop(r);this._runtimeFlags=f(this._runtimeFlags,Ed(to));const o=this.interruptAllChildren();o!==null?n=g(o,()=>s):(this._queue.length===0?this.setExitValue(s):this.tell(Re(s)),n=null)}catch(r){if(ee(r))r._op===pr?kd(this._runtimeFlags)?(this.tell(Wb()),this.tell(Re(Ht)),n=null):n=Ht:r._op===hr&&(n=null);else throw r}}finally{this._supervisor.onSuspend(this)}}start(e){if(this._running)this.tell(Re(e));else{this._running=!0;const n=globalThis[oe];globalThis[oe]=this;try{this.evaluateEffect(e)}finally{this._running=!1,globalThis[oe]=n,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(e){this.tell(Re(e))}patchRuntimeFlags(e,n){const r=eo(e,n);return globalThis[oe]=this,this._runtimeFlags=r,r}initiateAsync(e,n){let r=!1;const s=o=>{r||(r=!0,this.tell(Re(o)))};Wt(e)&&(this._asyncInterruptor=s);try{n(s)}catch(o){s(D(ct(o)))}}pushStack(e){this._stack.push(e),e._op==="OnStep"&&this._steps.push(!0),e._op==="RevertFlags"&&this._steps.push(!1)}popStack(){const e=this._stack.pop();if(e)return(e._op==="OnStep"||e._op==="RevertFlags")&&this._steps.pop(),e}getNextSuccessCont(){let e=this.popStack();for(;e;){if(e._op!==gr)return e;e=this.popStack()}}getNextFailCont(){let e=this.popStack();for(;e;){if(e._op!==vr&&e._op!==wr)return e;e=this.popStack()}}[(hw=Qb,gw=tS,mh)](e){return F(ps(ne),n=>{try{return Xo(n,e)}catch(r){throw console.log(r),r}})}Left(e){return J(e.left)}None(e){return J(mc())}Right(e){return et(e.right)}Some(e){return et(e.value)}[Ea](e){const n=e.i0(),r=this.getNextSuccessCont();if(r!==void 0)return r._op in lr||dn(r),lr[r._op](this,r,n);throw et(n)}[Y](e){const n=e,r=this.getNextSuccessCont();if(r!==void 0)return r._op in lr||dn(r),lr[r._op](this,r,n.i0);throw n}[G](e){const n=e.i0,r=this.getNextFailCont();if(r!==void 0)switch(r._op){case gr:case $r:return Wt(this._runtimeFlags)&&this.isInterrupted()?x(Rr(n)):r.i1(n);case"OnStep":return Wt(this._runtimeFlags)&&this.isInterrupted()?x(Rr(n)):r.i1(x(n));case Ho:return this.patchRuntimeFlags(this._runtimeFlags,r.patch),Wt(this._runtimeFlags)&&this.isInterrupted()?x(tt(n,this.getInterruptedCause())):x(n);default:dn(r)}else throw x(n)}[Oa](e){return e.i0(this,Zl(this._runtimeFlags))}Blocked(e){if(this._steps[this._steps.length-1]){const n=this.popStack();if(n)switch(n._op){case"OnStep":return n.i1(e);case"OnSuccess":return ot(e.i0,g(e.i1,n.i1));case"OnSuccessAndFailure":return ot(e.i0,Q(e.i1,{onFailure:n.i1,onSuccess:n.i2}));case"OnFailure":return ot(e.i0,tl(e.i1,n.i1));case"While":return ot(e.i0,g(e.i1,r=>(n.i2(r),n.i0()?Cr({while:n.i0,body:n.i1,step:n.i2}):N)));case"RevertFlags":{this.pushStack(n);break}}}return vt(n=>g(br(Sm(e.i0)),()=>n(e.i1)))}RunBlocked(e){return P0(e.i0)}[Ye](e){const n=e.i0,r=this._runtimeFlags,s=eo(r,n);if(Wt(s)&&this.isInterrupted())return x(this.getInterruptedCause());if(this.patchRuntimeFlags(this._runtimeFlags,n),e.i1){const o=De(s,r);return this.pushStack(new vm(o,e)),e.i1(r)}else return Ht}[vr](e){return this.pushStack(e),e.i0}OnStep(e){return this.pushStack(e),e.i0}[gr](e){return this.pushStack(e),e.i0}[$r](e){return this.pushStack(e),e.i0}[hr](e){throw this._asyncBlockingOn=e.i1,this.initiateAsync(this._runtimeFlags,e.i0),e}[pr](e){throw this.isYielding=!1,e}[wr](e){const n=e.i0,r=e.i1;return n()?(this.pushStack(e),r()):Ht}[ka](e){return e.commit()}runLoop(e){let n=e;for(this.currentOpCount=0;;){if(this._runtimeFlags&wd&&this._supervisor.onEffect(this,n),this._queue.length>0&&(n=this.drainQueueWhileRunning(this._runtimeFlags,n)),!this.isYielding){this.currentOpCount+=1;const r=this._scheduler.shouldYield(this);if(r!==!1){this.isYielding=!0,this.currentOpCount=0;const s=n;n=g(Yn({priority:r}),()=>s)}}try{(!("_op"in n)||!(n._op in this))&&(console.log(n),dn(n)),n=this._tracer.context(()=>Sr!==n[Ji]._V?nl(`Cannot execute an Effect versioned ${n[Ji]._V} with a Runtime of version ${Sr}`):this[n._op](n),this)}catch(r){if(ee(r)){if(r._op===pr||r._op===hr)throw r;if(r._op===Y||r._op===G)return r}else _m(r)?n=x(r.cause):am(r)?n=x(tt(ct(r),It(jn))):n=x(ct(r))}}}}const L0=P("effect/FiberRef/currentMinimumLogLevel",()=>ht(W_("Info"))),x0=t=>{const e=A_(t,Yt);return Pt(e,Tc).unsafe},D0=P(Symbol.for("effect/Logger/defaultLogger"),()=>Kc(t=>{const e=cS.log(t);x0(t.context).log(e)})),q0=P(Symbol.for("effect/Logger/tracerLogger"),()=>Kc(({annotations:t,cause:e,context:n,fiberId:r,logLevel:s,message:o})=>{const c=Ka(yo(n,ne),we(Qu)),i=Sn(yo(n,Yt),h=>Pt(h,_s));if(c._tag==="None"||c.value._tag==="ExternalSpan"||i._tag==="None")return;const a=Object.fromEntries(Eu(t,h=>Oo(h)));a["effect.fiberId"]=Ip(r),a["effect.logLevel"]=s.label,e!==null&&e._tag!=="Empty"&&(a["effect.cause"]=us(e)),c.value.event(String(o),i.value.unsafeCurrentTimeNanos(),a)})),j0=P(Symbol.for("effect/FiberRef/currentLoggers"),()=>hl(rs(D0,q0))),K0=u(t=>ee(t[0]),(t,e)=>Ve(sn(t,n=>kf(r=>e(n,r))))),kf=t=>rt(e=>{const n=e.getFiberRefs(),r=e._runtimeFlags;return g(Ff,s=>Nr(s,o=>rt(c=>{const i=c.getFiberRefs(),a=c._runtimeFlags,h=jr(i,n),d=De(a,r),p=jr(n,i);return c.setFiberRefs(Vi(h,c.id(),n)),Jc(Cm(t(o),d),_(()=>{c.setFiberRefs(Vi(p,c.id(),c.getFiberRefs()))}))})))}),U0=t=>{if(Array.isArray(t)||Sa(t))return[t,$()];const e=Object.keys(t),n=e.length;return[e.map(r=>t[r]),v(r=>{const s={};for(let o=0;o<n;o++)s[e[o]]=r[o];return s})]},B0=(t,e,n)=>{const r=[];for(const s of t)r.push(Tn(s));return g(He(r,K,{concurrency:n?.concurrency,batching:n?.batching}),s=>{const o=$(),c=s.length,i=new Array(c),a=new Array(c);let h=!1;for(let d=0;d<c;d++){const p=s[d];p._tag==="Left"?(i[d]=v(p.left),h=!0):(a[d]=p.right,i[d]=o)}return h?e._tag==="Some"?J(e.value(i)):J(i):n?.discard?N:e._tag==="Some"?w(e.value(a)):w(a)})},z0=(t,e,n)=>{const r=[];for(const s of t)r.push(Tn(s));return n?.discard?He(r,K,{concurrency:n?.concurrency,batching:n?.batching,discard:!0}):F(He(r,K,{concurrency:n?.concurrency,batching:n?.batching}),s=>e._tag==="Some"?e.value(s):s)},Ef=(t,e)=>{const[n,r]=U0(t);return e?.mode==="validate"?B0(n,r,e):e?.mode==="either"?z0(n,r,e):r._tag==="Some"?F(He(n,K,e),r.value):He(n,K,e)},He=u(t=>Sa(t[0]),(t,e,n)=>rt(r=>{const s=n?.batching===!0||n?.batching==="inherit"&&r.getFiberRef(Qm);return n?.discard?Yi(n.concurrency,()=>Me($o)(o=>s?Lo(t,(c,i)=>o(e(c,i))):Gn(t,(c,i)=>o(e(c,i)))),()=>Me(wo)(o=>Ge(t,(c,i)=>o(e(c,i)),s)),o=>Me(ko(o))(c=>Wc(t,o,(i,a)=>c(e(i,a)),s))):Yi(n?.concurrency,()=>Me($o)(o=>s?xo(t,1,(c,i)=>o(e(c,i)),!0):Ot(t,(c,i)=>o(e(c,i)))),()=>Me(wo)(o=>zc(t,(c,i)=>o(e(c,i)),s)),o=>Me(ko(o))(c=>xo(t,o,(i,a)=>c(e(i,a)),s)))})),zc=(t,e,n)=>T(()=>{const r=nt(t),s=new Array(r.length);return at(Ge(r,(c,i)=>g(e(c,i),a=>_(()=>s[i]=a)),n),w(s))}),Lo=(t,e)=>T(()=>{const n=nt(t),r=n.length;if(r===0)return N;if(r===1)return ut(e(n[0],0));const s=n.map(e),o=new Array,c=i=>i===s.length?T(()=>{if(o.length>0){const a=o.map(h=>h.i0).reduce(qe);return ot(a,Lo(o.map(h=>h.i1),K))}return N}):vc(s[i],a=>a._op==="Blocked"?(o.push(a),c(i+1)):a._op==="Failure"?T(()=>{if(o.length>0){const h=o.map(d=>d.i0).reduce(qe);return ot(h,g(Lo(o.map(d=>d.i1),K),()=>a))}return N}):c(i+1));return c(0)}),Ge=(t,e,n)=>T(()=>{const r=nt(t),s=r.length;return s===0?N:s===1?ut(e(r[0],0)):vt(o=>{const c=kc(jn);let i=0;const a=[],h=[],d=Rm(p=>Ot(r,(m,b)=>f(p(f(T(()=>o((n?We:dt)(e(m,b)))),g(S=>{switch(S._op){case"Failure":{if(a.length>0){const L=a.map(j=>j.i0).reduce(qe),q=Ge(a,j=>j.i1,n);return ot(L,Q(q,{onFailure:j=>at(xs(c,void 0),D(ft(j,S.cause))),onSuccess:()=>at(xs(c,void 0),D(S.cause))}))}return at(xs(c,void 0),D(S.cause))}default:{if(S._op==="Blocked"&&a.push(S),i+1===s)if(a.length>0){const L=a.map(j=>j.i0).reduce(qe),q=Ge(a,j=>j.i1,n);return ys(c,ot(L,q))}else Ic(c,et(Ht));else i=i+1;return N}}}))),ws,F(S=>(S.addObserver(()=>{h.push(S)}),S)))));return g(d,p=>Q(o(ms(c)),{onFailure:m=>g(zc(p,Qn,n),b=>{const S=mr(b,{parallel:!0});return S._tag==="Some"&&ny(S.value)?D(ft(Rr(m),S.value.i0)):D(Rr(m))}),onSuccess:m=>g(m,()=>Gn(h,b=>b.inheritAll))}))})}),xo=(t,e,n,r)=>T(()=>{const s=nt(t),o=new Array(s.length);return at(Wc(s,e,(i,a)=>F(n(i,a),h=>o[a]=h),r),w(o))}),Wc=(t,e,n,r)=>T(()=>{let s=0;const o=t[Symbol.iterator](),c=[],i=g(_(()=>o.next()),h=>h.done?N:g((r?We:dt)(ut(n(h.value,s++))),d=>{switch(d._op){case"Blocked":return c.push(d),i;case"Failure":return d;case"Success":return i}})),a=[];for(let h=0;h<e;h++)a.push(i);return g(dt(Ge(a,K,r)),h=>{if(c.length===0)return h;const d=c.map(m=>m.i0).reduce(qe),p=Wc(c,e,m=>m.i1,r);return h._tag==="Failure"?ot(d,Q(p,{onFailure:m=>x(ft(h.cause,m)),onSuccess:()=>h})):ot(d,p)})}),br=t=>rt((e,n)=>w(Of(t,e,n.runtimeFlags))),ws=t=>W0(t,ef),Of=(t,e,n,r=null)=>{const s=Do(t,e,n,r);return s.resume(t),s},Do=(t,e,n,r=null)=>{const s=$u(),o=e.getFiberRefs(),c=Tl(o,s),i=new wf(s,c,n),a=Cc(c,ne),h=i._supervisor;return h.onStart(a,t,v(e),i),i.addObserver(p=>h.onEnd(p,i)),(r!==null?r:f(e.getFiberRef(io),At(()=>e.scope()))).add(n,i),i},W0=(t,e)=>rt((n,r)=>w(Of(t,n,r.runtimeFlags,e))),J0=t=>{const e=qn(t);if(!pe(e))return $m(()=>Hu("Received an empty collection of effects"));const n=de(e),r=Vt(e),s=o=>f(nS(o[1]),it(o[0]));return f(Ec(),g(o=>f(Y_(r.length),g(c=>vt(i=>f(br(Je(n)),g(a=>f(r,Ot(h=>br(Je(h))),F(St),F(h=>f(h,mt(a))),sn(h=>f(h,Qt(N,(d,p)=>f(d,at(f(eS(p),g(V0(h,p,o,c)),br,ut)))))),g(h=>f(i(f(gy(o),g(s))),il(()=>f(h,Qt(N,(d,p)=>f(d,gs(Qn(p))))))))))))))))},V0=(t,e,n,r)=>s=>Pr(s,{onFailure:o=>f(Q_(r,c=>[c===0?f(Oc(n,o),ut):N,c-1]),Vn),onSuccess:o=>f(ys(n,[o,e]),g(c=>c?f(qn(t),Qt(N,(i,a)=>a===e?i:f(i,gs(Qn(a))))):N))}),sa=t=>an(e=>Ft(we(e,Oe),{onNone:()=>t,onSome:n=>{switch(n.strategy._tag){case"Parallel":return t;case"Sequential":case"ParallelN":return g($c(n,wo),r=>or(t,r))}}})),oa=t=>e=>an(n=>Ft(we(n,Oe),{onNone:()=>e,onSome:r=>r.strategy._tag==="ParallelN"&&r.strategy.parallelism===t?e:g($c(r,ko(t)),s=>or(e,s))})),Me=t=>e=>an(n=>Ft(we(n,Oe),{onNone:()=>e(K),onSome:r=>{const s=t._tag==="Parallel"?sa:t._tag==="Sequential"?ca:oa(t.parallelism);switch(r.strategy._tag){case"Parallel":return s(e(sa));case"Sequential":return s(e(ca));case"ParallelN":return s(e(oa(r.strategy.parallelism)))}}})),If=t=>g(Oe,t),H0=t=>g(ks(),e=>Z0(e)(t)),ca=t=>an(e=>Ft(we(e,Oe),{onNone:()=>t,onSome:n=>{switch(n.strategy._tag){case"Sequential":return t;case"Parallel":case"ParallelN":return g($c(n,$o),r=>or(t,r))}}})),G0=u(t=>ee(t[1]),(t,e,n)=>sr(t,e,(r,s)=>[r,s],n)),Y0=u(t=>ee(t[1]),(t,e,n)=>sr(t,e,(r,s)=>r,n)),Q0=u(t=>ee(t[1]),(t,e,n)=>sr(t,e,(r,s)=>s,n)),sr=u(t=>ee(t[1]),(t,e,n,r)=>F(Ef([t,e],{concurrency:r?.concurrent?2:1,batching:r?.batching}),([s,o])=>n(s,o))),X0=(t,e)=>n=>T(()=>{switch(n.state._tag){case"Exited":return N;case"Running":{const r=n.state.finalizers,s=n.state.update,o=Array.from(r.keys()).sort((c,i)=>i-c).map(c=>r.get(c));return n.state={_tag:"Exited",nextKey:n.state.nextKey,exit:e,update:s},Mb(t)?f(o,Ot(c=>dt(s(c)(e))),g(c=>f(mr(c),Sn(Ps),At(()=>Ht)))):Tb(t)?f(zc(o,c=>dt(s(c)(e)),!1),g(c=>f(mr(c,{parallel:!0}),Sn(Ps),At(()=>Ht)))):f(xo(o,t.parallelism,c=>dt(s(c)(e)),!1),g(c=>f(mr(c,{parallel:!0}),Sn(Ps),At(()=>Ht))))}}}),Oe=yt(ao),Ff=Oe,ks=(t=Pc)=>F(ey,e=>({[ao]:ao,[Ti]:Ti,strategy:t,pipe(){return k(this,arguments)},fork:n=>Ve(f(ks(n),g(r=>f(Ci(e,s=>Ar(r,s)),sn(s=>Nr(r,s)),it(r))))),close:n=>ut(X0(t,n)(e)),addFinalizer:n=>ut(Ci(n)(e))})),or=u(2,(t,e)=>dl(t,Yr(Gr(Oe,e)))),Z0=u(2,(t,e)=>f(t,or(e),Nn(n=>e.close(n)))),tv=t=>Xn(t,{differ:I0,fork:$n}),ia=zm(Od),aa=tv($s),Rf=u(3,(t,e,n)=>ev(t,e,{onSelfWin:(r,s)=>g(r.await,o=>{switch(o._tag){case Y:return g(r.inheritAll,()=>n.onSelfDone(o,s));case G:return n.onSelfDone(o,s)}}),onOtherWin:(r,s)=>g(r.await,o=>{switch(o._tag){case Y:return g(r.inheritAll,()=>n.onOtherDone(o,s));case G:return n.onOtherDone(o,s)}})})),Mf=u(2,(t,e)=>hs(n=>Rf(t,e,{onSelfDone:(r,s)=>Pr(r,{onFailure:o=>f(Xi(s),Wi(c=>ft(o,c))),onSuccess:o=>f(s,co(n),it(o))}),onOtherDone:(r,s)=>Pr(r,{onFailure:o=>f(Xi(s),Wi(c=>ft(c,o))),onSuccess:o=>f(s,co(n),it(o))})}))),ev=u(3,(t,e,n)=>rt((r,s)=>{const o=s.runtimeFlags,c=Xe(!0),i=Do(t,r,o,n.selfScope),a=Do(e,r,o,n.otherScope);return ze(h=>{i.addObserver(()=>ua(i,a,n.onSelfWin,c,h)),a.addObserver(()=>ua(a,i,n.onOtherWin,c,h)),i.startFork(t),a.startFork(e)},Op(i.id(),a.id()))})),ua=(t,e,n,r,s)=>{dp(!0,!1)(r)&&s(n(t,e))},Jc=u(2,(t,e)=>vt(n=>Q(n(t),{onFailure:r=>Q(e,{onFailure:s=>D(tt(r,s)),onSuccess:()=>D(r)}),onSuccess:r=>it(e,r)}))),nv=(t,e)=>hs(n=>g(g(ws(Je(t)),r=>ze(s=>{const o=e.map(a=>a.listeners.count),c=()=>{o.every(a=>a===0)&&(i.forEach(a=>a()),s(Qn(r)))};r.addObserver(a=>{i.forEach(h=>h()),s(a)});const i=e.map((a,h)=>{const d=p=>{o[h]=p,c()};return a.listeners.addObserver(d),()=>a.listeners.removeObserver(d)});return c(),_(()=>{i.forEach(a=>a())})})),()=>T(()=>{const r=e.flatMap(s=>s.state.completed?[]:[s]);return Gn(r,s=>b0(s.request,cy(n)))}))),zw=Se,Ww=ct,Jw=It,Vw=zd,Hw=Jd,Gw=as,rv=Ju,Yw=Yd,Qw=tm,Xw=Hu,sv=u(2,(t,e)=>Vc(t,n=>_(()=>e(n)))),Vc=u(2,(t,e)=>g(t,n=>g(e(n),r=>r?w(n):g(Yn(),()=>Vc(t,e))))),ov=u(2,(t,e)=>cv(t,n=>_(()=>e(n)))),cv=u(2,(t,e)=>Vc(t,n=>pb(e(n)))),iv=u(2,(t,e)=>Tf(t,e)),Tf=(t,e)=>Mr(t,n=>e<0?J(n):g(Yn(),()=>Tf(t,e-1)));class av{constructor(e){l(this,"permits");l(this,"waiters",new Array);l(this,"taken",0);l(this,"take",e=>_c(n=>{if(this.free<e){const r=()=>{if(this.free>=e){const s=this.waiters.findIndex(o=>o===r);s!==-1&&this.waiters.splice(s,1),this.taken+=e,n(w(e))}};return this.waiters.push(r),Rt(_(()=>{const s=this.waiters.findIndex(o=>o===r);s!==-1&&this.waiters.splice(s,1)}))}return this.taken+=e,pt(w(e))}));l(this,"release",e=>rt(n=>(this.taken-=e,n.getFiberRef(Kr).scheduleTask(()=>{this.waiters.forEach(r=>r())},n.getFiberRef(ds)),N)));l(this,"withPermits",e=>n=>vt(r=>g(r(this.take(e)),s=>Jc(r(n),this.release(s)))));this.permits=e}get free(){return this.permits-this.taken}}const Cf=t=>new av(t),uv=t=>_(()=>Cf(t)),lv=u(2,(t,e)=>vt(n=>g(e.fork(Pc),r=>f(n(t),Nn(s=>r.close(s)),ws,sn(s=>r.addFinalizer(()=>hs(o=>O(o,s.id())?N:ut(Qn(s))))))))),fv=t=>If(e=>lv(t,e)),hv=u(2,(t,e)=>f(dt(t),Mf(dt(e)),n=>Vn(n))),gv="effect/Ref/SynchronizedRef",pv=Symbol.for(gv),dv={_A:t=>t};var pw,dw;class mv{constructor(e,n){l(this,"ref");l(this,"withLock");l(this,pw,dv);l(this,dw,Pl);this.ref=e,this.withLock=n}modify(e){return this.modifyEffect(n=>w(e(n)))}modifyEffect(e){return this.withLock(f(g(qr(this.ref),e),g(([n,r])=>it(Nc(this.ref,r),n))))}pipe(){return k(this,arguments)}}pw=pv,dw=Al;const yv=t=>_(()=>_v(t)),_v=t=>{const e=Ll(t),n=Cf(1);return new mv(e,n.withPermits(1))},bv="Fold",Sv="Fresh",vv="FromEffect",$v="Suspend",wv="ProvideTo",kv="ZipWith",Ev=t=>(e,n)=>{const r=$u(),s=e;let o=Bi(t.fiberRefs,{fiberId:r,fiberRef:ne,value:t.context});n?.scheduler&&(o=Bi(o,{fiberId:r,fiberRef:Kr,value:n.scheduler})),n?.updateRefs&&(o=n.updateRefs(o,r));const c=new wf(r,N_(o,r),t.runtimeFlags),i=c._supervisor;return i!==$s&&(i.onStart(t.context,s,$(),c),c.addObserver(a=>i.onEnd(a,c))),ef.add(t.runtimeFlags,c),c.start(s),c},la=Symbol.for("effect/Runtime/FiberFailure"),Ov=Symbol.for("effect/Runtime/FiberFailure/Cause"),Iv=t=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new Error;Error.stackTraceLimit=e;const r=Gu(t);if(r.length>0){const s=r[0];n.name=s.message.split(":")[0],n.message=s.message.substring(n.name.length+2),n.stack=us(t)}return n[la]=la,n[Ov]=t,n.toJSON=()=>({_id:"FiberFailure",cause:t.toJSON()}),n.toString=()=>H(n.toJSON()),n[V]=()=>n.toJSON(),n},Fv=t=>{const e=t;switch(e._op){case"Failure":case"Success":return e;case"Left":return Ni(e.left);case"Right":return et(e.right);case"Some":return et(e.value);case"None":return Ni(mc())}},Rv=t=>e=>Mv(t)(e).then(n=>{switch(n._tag){case Y:return n.i0;case G:throw Iv(n.i0)}}),Mv=t=>e=>new Promise(n=>{const r=Fv(e);r&&n(r),Ev(t)(e).addObserver(s=>{n(s)})});class Tv{constructor(e,n,r){l(this,"context");l(this,"runtimeFlags");l(this,"fiberRefs");this.context=e,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return k(this,arguments)}}const Cv=t=>new Tv(t.context,t.runtimeFlags,t.fiberRefs),Nv=xu(Ze,Pu,Au),bn=Cv({context:Hr(),runtimeFlags:Nv,fiberRefs:P_()}),Av=Rv(bn),Pv=u(2,(t,e)=>t.modifyEffect(e)),Lv="effect/Layer",Nf=Symbol.for(Lv),xv={_RIn:t=>t,_E:t=>t,_ROut:t=>t},Pn={[Nf]:xv,pipe(){return k(this,arguments)}},Dv=t=>I(t,Nf),qv=t=>t._tag===Sv;class jv{constructor(e){l(this,"ref");this.ref=e}getOrElseMemoize(e,n){return f(Pv(this.ref,r=>{const s=r.get(e);if(s!==void 0){const[o,c]=s,i=f(o,g(([a,h])=>f(vo(a),it(h))),Nn(pl({onFailure:()=>N,onSuccess:()=>Nr(n,c)})));return w([i,r])}return f(_o(0),g(o=>f(Ec(),g(c=>f(_o(()=>N),F(i=>{const a=vt(d=>f(ks(),g(p=>f(d(g(Pf(e,p),m=>sb(m(this)))),dt,g(m=>{switch(m._tag){case G:return f(Oc(c,m.i0),at(Ar(p,m)),at(D(m.i0)));case Y:return f(Nc(i,b=>f(Ar(p,b),Tm(xl(o,S=>[S===1,S-1])),ut)),at(bo(o,b=>b+1)),at(Nr(n,b=>f(qr(i),g(S=>S(b))))),at(ys(c,m.i0)),it(m.i0[1]))}}))))),h=[f(ms(c),Nn(Pr({onFailure:()=>N,onSuccess:()=>bo(o,d=>d+1)}))),d=>f(qr(i),g(p=>p(d)))];return[a,qv(e)?r:r.set(e,h)]}))))))}),Vn)}}const Kv=()=>F(yv(new Map),t=>new jv(t)),Af=u(2,(t,e)=>g(Kv(),n=>g(Pf(t,e),r=>r(n)))),Pf=(t,e)=>{const n=t;switch(n._tag){case"Locally":return _(()=>r=>n.f(r.getOrElseMemoize(n.self,e)));case"ExtendScope":return _(()=>r=>If(s=>r.getOrElseMemoize(n.layer,s)));case"Fold":return _(()=>r=>f(r.getOrElseMemoize(n.layer,e),Q({onFailure:s=>r.getOrElseMemoize(n.failureK(s),e),onSuccess:s=>r.getOrElseMemoize(n.successK(s),e)})));case"Fresh":return _(()=>r=>f(n.layer,Af(e)));case"FromEffect":return _(()=>r=>n.effect);case"ProvideTo":return _(()=>r=>f(r.getOrElseMemoize(n.first,e),g(s=>f(r.getOrElseMemoize(n.second,e),Rc(s)))));case"Scoped":return _(()=>r=>or(n.effect,e));case"Suspend":return _(()=>r=>r.getOrElseMemoize(n.evaluate(),e));case"ZipWith":return _(()=>r=>f(r.getOrElseMemoize(n.first,e),Nm(r.getOrElseMemoize(n.second,e),n.zipK)));case"ZipWithPar":return _(()=>r=>f(r.getOrElseMemoize(n.first,e),sr(r.getOrElseMemoize(n.second,e),n.zipK,{concurrent:!0})))}},Uv=u(2,(t,e)=>Vv(t,{onFailure:e,onSuccess:Yv})),Bv=()=>ln(Fc()),zv=t=>ln(D(t)),Wv=u(2,(t,e)=>{const n=Qo(t),r=n?t:e;return ln(F(n?e:t,o=>Gr(r,o)))});function ln(t){const e=Object.create(Pn);return e._tag=vv,e.effect=t,e}const Jv=u(2,(t,{onFailure:e,onSuccess:n})=>{const r=Object.create(Pn);return r._tag=bv,r.layer=t,r.failureK=e,r.successK=n,r}),Vv=u(2,(t,{onFailure:e,onSuccess:n})=>Jv(t,{onFailure:r=>{const s=rv(r);switch(s._tag){case"Left":return e(s.left);case"Right":return zv(s.right)}},onSuccess:n})),Hv=u(2,(t,e)=>Qv(()=>{const n=Object.create(Pn);return n._tag=wv,n.first=Object.create(Pn,{_tag:{value:kv,enumerable:!0},first:{value:Bv(),enumerable:!0},second:{value:t},zipK:{value:(r,s)=>Yr(r,s)}}),n.second=e,n})),Gv=u(2,(t,e)=>{const n=Qo(t);return ln(w(Gr(n?t:e,n?e:t)))}),Yv=t=>ln(w(t)),Qv=t=>{const e=Object.create(Pn);return e._tag=$v,e.evaluate=t,e},Xv=u(2,(t,e)=>Uv(t,n=>ln(g(e(n),()=>J(n))))),Zv=u(2,(t,e)=>Jn(ks(),n=>g(Af(e,n),r=>Mc(t,r)),(n,r)=>Ar(n,r))),t1=u(2,(t,e)=>{const n=De(bn.runtimeFlags,e.runtimeFlags),r=De(e.runtimeFlags,bn.runtimeFlags),s=jr(bn.fiberRefs,e.fiberRefs),o=jr(e.fiberRefs,bn.fiberRefs);return Jn(g(oo(n),()=>vo(s)),()=>Mc(t,e.context),()=>g(oo(r),()=>vo(o)))}),e1=u(2,(t,e)=>Dv(e)?Zv(t,e):Za(e)?Mc(t,e):t1(t,e)),Zw=ee,le=Ef,qo=He,tk=yb,ek=J,nk=D,rk=bc,sk=nl,ok=ab,ck=w,mn=T,W=_,jo=N,ik=Mr,ak=tl,uk=nb,lk=lb,fk=iv,hk=vb,gk=wm,pk=Je,dk=Ve,mk=vt,Hc=it,yk=ut,Gc=F,Lf=Cn,_k=K0,n1=Jn,bk=kf,Sk=Jc,vk=Ff,r1=H0,$k=hs,wk=ws,kk=fv,s1=rb,Ek=bb,Ko=e1,xf=db,o1=Eb,c1=wb,Ok=dt,Ik=km,Fk=kb,Kt=g,Rk=Vn,Mk=J0,Tk=Mf,Ck=hv,Nk=Rf,Df=sn,Ak=_b,Pk=ob,Lk=gb,xk=sv,Dk=ov,qk=Jl,jk=ol,Kk=Q,i1=fb,Uk=hb,Bk=Im,a1=Om,zk=mb,Wk=uv,Jk=Av,u1=G0,qf=Y0,Ct=Q0,Vk=sr,l1=Ob,cr=Wv,f1=Hv,h1=Gv,g1=Xv,p1=t=>on(Yt,e=>t(Pt(e,Tc))),d1=(...t)=>p1(e=>e.log(...t)),fa=d1,m1=t=>t.length===0,y1=(t,e,n,r)=>({_tag:"Hsla",h:t,s:e,l:n,a:r}),jf=(t,e,n)=>y1(t,e,n,1),Hk=jf(0,0,0),Gk=jf(360,1,1),fr=t=>{switch(t._tag){case"Hex":return t.value;case"Hsla":{const{h:e,s:n,l:r,a:s}=t,o=d=>Math.round(d*100)/100,c=o(e),i=o(n*100)+"%",a=o(r*100)+"%",h=String(s);return s===1?`hsl(${c}, ${i}, ${a})`:`hsla(${c}, ${i}, ${a}, ${h})`}}},{Tag:Kf}=wg;Kf();class Yc{constructor(e){this.message=e,this._tag="CanvasError"}}const re=Kf(),_1=C(t=>t.canvas.width),b1=C(t=>t.canvas.height),Yk=le({width:_1,height:b1});C(t=>t.canvas.toDataURL());const ha=t=>C(e=>{e.fillStyle=t});C(t=>t.fillStyle);C(t=>t.font);function S1(t){return C(e=>(e.font=t,e))}C(t=>t.globalAlpha);C(t=>t.globalCompositeOperation);C(t=>t.imageSmoothingEnabled);C(t=>t.lineCap);C(t=>t.lineDashOffset);C(t=>t.lineJoin);function v1(t){return C(e=>(e.lineWidth=t,e))}C(t=>t.lineWidth);C(t=>t.miterLimit);function $1(t){return C(e=>{e.strokeStyle=t})}C(t=>t.strokeStyle);function w1(t){return C(e=>(e.shadowBlur=t,e))}C(t=>t.shadowBlur);function k1(t){return C(e=>e.shadowColor=t)}C(t=>t.shadowColor);function E1(t){return X(e=>f(W(()=>e.shadowOffsetX=t),Hc(e)))}C(t=>t.shadowOffsetX);function O1(t){return X(e=>f(W(()=>e.shadowOffsetY=t),Hc(e)))}C(t=>t.shadowOffsetY);C(t=>t.textAlign);X(t=>W(()=>t.textBaseline));function I1(t,e,n,r,s,o=!1){return X(c=>f(W(()=>c.arc(t,e,n,r,s,o)),Hc(c)))}const Qc=C(t=>{t.beginPath()});function Qk(t,e,n,r){return X(s=>W(()=>{s.clearRect(t,e,n,r)}))}function F1(t,e){return X(n=>W(()=>{typeof e<"u"?n.clip(e,t):typeof t<"u"?n.clip(t):n.clip()}))}const R1=X(t=>W(()=>{t.closePath()})),Uf=(t,e,n)=>X(r=>W(()=>{r.drawImage(t,e,n)}));function M1(t,e,n,r,s,o,c,i=!1){return X(a=>W(()=>{a.ellipse(t,e,n,r,s,o,c,i)}))}const T1=(t,e)=>X(n=>W(()=>{typeof e<"u"?n.fill(e,t):typeof t<"u"?n.fill(t):n.fill()}));function Xk(t,e,n,r){return X(s=>W(()=>{s.fillRect(t,e,n,r)}))}const C1=(t,e,n,r)=>X(s=>W(()=>{typeof r<"u"?s.fillText(t,e,n,r):s.fillText(t,e,n)}));function Zk(t,e,n,r){return X(s=>W(()=>s.getImageData(t,e,n,r)))}X(t=>W(()=>t.getLineDash()));X(t=>W(()=>t.getTransform()));const N1=(t,e)=>C(n=>{n.lineTo(t,e)});function A1(t,e){return C(n=>{n.moveTo(t,e)})}function P1(t,e,n,r){return C(s=>s.rect(t,e,n,r))}const L1=X(t=>W(()=>{t.restore()})),x1=t=>C(e=>e.rotate(t)),D1=C(t=>t.save()),q1=(t,e)=>C(n=>n.scale(t,e));function j1(t){return X(e=>W(()=>{typeof t<"u"?e.stroke(t):e.stroke()}))}const K1=(t,e)=>C(n=>n.translate(t,e)),U1=t=>Qc.pipe(Ct(t),qf(T1())),B1=t=>Qc.pipe(Ct(t),qf(j1()));function C(t){return X(e=>W(()=>t(e)))}function zt(t){return r1(n1(D1,e=>t,e=>L1))}function X(t){return re.pipe(Kt(t))}function tE(t){const e=typeof t=="string"?W1(t):t instanceof HTMLElement?V1(t):J1(t);return Ko(e.pipe(g1(()=>i1(`i got an error for ${t}`))))}const z1=yt();function W1(t){return cr(re,H1(t))}function J1(t){return h1(re,t)}function V1(t){return cr(re,Kt(zf(t),Bf))}function H1(t){return Kt(G1(t),Bf)}function G1(t){return W(()=>document.getElementById(t)).pipe(Kt(Dn),Lf(()=>new Yc(`No such element with id ${t} exists`)),Kt(zf))}function Bf(t){return o1(z1).pipe(Df(e=>Ft(e,{onSome:n=>fa("canvas rendering settings: ",n),onNone:()=>fa("No canvas options found")})),Kt(Ft({onNone:()=>W(()=>t.getContext("2d")),onSome:e=>W(()=>t.getContext("2d",e))})),Kt(l1),Lf(e=>new Yc(`Cannot get 2d rendering context from "${t.id}"`)))}const zf=t=>t instanceof HTMLCanvasElement?pt(t):Rt(new Yc("element is not an instance of HTMLCanvasElement"));function Y1(t,e){return function(n){if(Array.isArray(n))return n.reduce(e,t);let r=t;for(const s of n)r=e(r,s);return r}}function Q1(t){return function(e){return Array.isArray(e)?e.map(t):function*(){for(const n of e)yield t(n)}()}}const X1=t=>e=>{const n=Object.keys(e);return t.imap(t.productAll(n.map(r=>e[r])),r=>{const s={};for(let o=0;o<r.length;o++)s[n[o]]=r[o];return s},r=>n.map(s=>r[s]))},$t=(t,e=(n,r)=>Y1(n,t)(r))=>({combine:t,combineMany:e}),eE=t=>$t((e,n)=>t(e,n)===1?e:n),Z1=t=>$t(()=>t,()=>t),t$=()=>$t(t=>t,t=>t),e$=u(3,(t,e,n)=>$t((r,s)=>e(t.combine(n(r),n(s))),(r,s)=>e(t.combineMany(n(r),Q1(n)(s))))),n$=(t,e)=>$t(([n,r],[s,o])=>[t.combine(n,s),e.combine(r,o)]),Wf=t=>$t((e,n)=>{const r=Math.min(e.length,n.length),s=[];let o=0;for(const c of t){if(o>=r)break;s.push(c.combine(e[o],n[o])),o++}return s}),r$=(t,e)=>{const n=Wf(e);return $t((r,s)=>[t.combine(r[0],s[0]),...n.combine(r.slice(1),s.slice(1))])},s$=Z1,o$={of:s$,imap:e$,product:n$,productMany:r$,productAll:Wf},c$=()=>$t((t,e)=>t.concat(e)),i$=X1(o$),ir=(t,e)=>({combine:t.combine,combineMany:t.combineMany,empty:e,combineAll:n=>t.combineMany(e,n)}),Jf=()=>ir(c$(),[]),Es=t=>{const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n].empty);return ir(i$(t),e)},a$=t=>ir($t((e,n)=>U(e)?n:U(n)?e:v(t.combine(e.value,n.value))),$()),Vf=yt(),u$=cr(Vf,re.pipe(Gc(h$))),Xc=yt(),l$=f1(u$,cr(Xc,Vf.pipe(Gc(f$)))),nE=t=>c1(Xc,e=>n=>n._tag!="Composite"?s1(t)(e(n)):e(n));function f$(t){return function e(n){switch(n._tag){case"Arc":return t.arc(n.x,n.y,n.r,n.start,n.end,n.anticlockwise);case"Composite":return qo(n.shapes,r=>e(r),{concurrency:n.shapes.length});case"Ellipse":return t.ellipse(n.x,n.y,n.rx,n.ry,n.rotation,n.start,n.end,n.anticlockwise);case"Path":return f(n.points,Bh({onEmpty:()=>jo,onNonEmpty:([r,...s])=>t.moveTo(r.x,r.y).pipe(Ct(qo(s,({x:o,y:c})=>t.lineTo(o,c))),Ct(n.closed?t.closePath:jo))}));case"Rect":return t.rect(n.x,n.y,n.width,n.height)}}}function h$(t){const e=xf(re,t);return{moveTo:Et(A1,e),lineTo:Et(N1,e),closePath:e(R1),ellipse:Et(M1,e),rect:Et(P1,e),arc:Et(I1,e),drawImage:Et(Uf,e)}}const g$={show:t=>[t.style,t.variant,t.weight].filter(A).map(At(Ln(""))).join(" ")},p$=Et(m1,Dh),d$={show:({fontFamily:t,size:e,fontOptions:n})=>[g$.show(n),`${e}px`,t].filter(p$).join(" ")},Zc=yt(),m$=f(Xc.pipe(u1(re),Gc(([t,e])=>b$(t,e)),cr(Zc)));function y$(t){return Zc.pipe(Df(e=>e(t)))}function _$(t){return Zc.pipe(Kt(e=>e(t)),Ko(m$),Ko(l$))}function b$(t,e){const n=xf(re,e);function r(o){return s(o).pipe(n)}return r;function s(o){switch(o._tag){case"Clipped":return le([Qc,t(o.shape),F1(),mn(()=>r(o.drawing))]).pipe(zt);case"Fill":return le([ce(o.style.color,c=>ha(fr(c))),U1(t(o.shape))],{discard:!0}).pipe(zt);case"Many":return qo(o.drawings,s,{discard:!0});case"Outline":return le([ce(o.style.color,Et(fr,$1)),ce(o.style.lineWidth,v1),B1(t(o.shape))],{discard:!0}).pipe(zt);case"Rotate":return x1(o.angle).pipe(Ct(mn(()=>r(o.drawing))),zt);case"Scale":return le([q1(o.scaleX,o.scaleY).pipe(Ct(mn(()=>r(o.drawing))))]).pipe(zt);case"Text":return le([S1(d$.show(o.font)),ce(o.style.color,Et(fr,ha)),C1(o.text,o.x,o.y)]).pipe(zt);case"Translate":return K1(o.translateX,o.translateY).pipe(Ct(mn(()=>r(o.drawing))),zt);case"WithShadow":return le([ce(o.shadow.color,Et(fr,k1)),ce(o.shadow.blur,w1),ce(o.shadow.offset,({x:c,y:i})=>E1(c).pipe(Ct(O1(i))))],{discard:!0}).pipe(Ct(mn(()=>r(o.drawing))),zt);case"Image":return Uf(o.image,o.source.x,o.source.y)}}}const ce=(t,e)=>t.pipe(Kt(e),a1(()=>jo)),ga=Jf(),ti=()=>a$(t$()),ei=ti(),Hf=ti(),S$=ti(),rE=t=>e=>({_tag:"Clipped",shape:t,drawing:e}),sE=u(2,(t,e)=>({_tag:"Fill",shape:t,style:e})),oE=t=>({color:v(t)}),cE=u(2,(t,e)=>({_tag:"Outline",shape:t,style:e})),iE=t=>({color:v(t),lineWidth:$()}),pa=t=>({_tag:"Many",drawings:t}),aE=u(2,(t,e)=>({_tag:"Rotate",angle:e,drawing:t})),uE=u(3,(t,e,n)=>({_tag:"Scale",scaleX:e,scaleY:n,drawing:t})),lE=(t,e,n)=>({_tag:"Image",image:t,source:e,dest:n}),fE=u(3,(t,e,n)=>({_tag:"Translate",translateX:e,translateY:n,drawing:t})),hE=u(2,(t,e)=>({_tag:"WithShadow",shadow:e,drawing:t})),gE=t=>({color:$(),blur:v(t),offset:$()}),pE=t=>({color:v(t),blur:$(),offset:$()}),dE=_$,mE=y$;Es({color:ei});Es({color:ei,lineWidth:Hf});const yE=Es({color:ei,blur:Hf,offset:S$}),Gf=ir($t((t,e)=>{const n=ga,r=t._tag==="Many"&&e._tag==="Many"?n.combineAll([t.drawings,e.drawings]):t._tag==="Many"?n.combineAll([t.drawings,[e]]):e._tag==="Many"?n.combineAll([[t],e.drawings]):[t,e];return pa(r)}),pa(ga.empty)),_E=Gf.combineAll,bE=Gf.combine,v$={reduce:Qt},$$=Jf,w$=$t((t,e)=>t||e,(t,e)=>{if(t===!0)return!0;for(const n of e)if(n===!0)return!0;return!1}),k$=ir(w$,!1),SE=t=>({_tag:"Degrees",degrees:t}),da=t=>({_tag:"Radians",radians:t}),ma=t=>{switch(t._tag){case"Degrees":return t.degrees*(Math.PI/180);case"Radians":return t.radians}},E$=(t,e)=>({x:t,y:e});function vE(t,e){return function(n){return n.x>t.x&&n.y>t.y&&n.x<e.y&&n.y<e.y}}const $E=(t,e,n)=>({_tag:"Arc",x:t,y:e,r:n,start:ma(da(0)),end:ma(da(Math.PI*2)),anticlockwise:!1});function O$(t){return t.reduce(I$.empty,(e,n)=>({_tag:"Path",closed:!0,points:Ua(n)(e.points)}))}const wE=(t,e,n,r)=>({_tag:"Rect",x:t,y:e,width:n,height:r}),kE=t=>f(Uh(0,t-1),Ce(e=>f(e*Math.PI/(t/2),n=>E$(Math.sin(n),Math.cos(n)))),O$(v$)),I$=Es({_tag:{combineAll:()=>"Path",combineMany:()=>"Path",combine:()=>"Path",empty:"Path"},closed:k$,points:$$()});export{Fg as $,Qk as A,x1 as B,Gk as C,f as D,aE as E,ir as F,eE as G,Gc as H,fE as I,Yk as J,SE as K,zk as L,ma as M,jf as N,An as O,Ow as P,E$ as Q,Df as R,qo as S,fa as T,uE as U,qw as V,At as W,Ek as X,vE as Y,lt as Z,jo as _,le as a,nS as a$,ww as a0,ek as a1,ik as a2,fk as a3,Gt as a4,ck as a5,$E as a6,bE as a7,Hk as a8,yt as a9,U1 as aA,I1 as aB,v1 as aC,Mw as aD,pl as aE,ny as aF,mr as aG,Tw as aH,x as aI,et as aJ,Ht as aK,Nw as aL,Ni as aM,Ls as aN,Cw as aO,H as aP,z as aQ,V as aR,k as aS,u as aT,mt as aU,Pe as aV,Ar as aW,or as aX,$c as aY,ks as aZ,Rw as a_,cr as aa,re as ab,xf as ac,Et as ad,Hc as ae,Qc as af,j1 as ag,f1 as ah,A1 as ai,N1 as aj,ok as ak,Y_ as al,Kw as am,jw as an,Bw as ao,Zk as ap,hk as aq,Bk as ar,lE as as,q1 as at,W as au,Mt as av,Ew as aw,z1 as ax,Ka as ay,Dn as az,$1 as b,r1 as b$,Qn as b0,Xi as b1,eS as b2,g as b3,_ as b4,F as b5,Xe as b6,Ec as b7,N as b8,w as b9,Ic as bA,zw as bB,qh as bC,rv as bD,K as bE,I as bF,Zw as bG,lk as bH,Vk as bI,Ok as bJ,Kk as bK,mn as bL,wk as bM,Ww as bN,Sk as bO,dk as bP,A as bQ,mk as bR,vk as bS,kk as bT,bk as bU,gy as bV,qf as bW,$o as bX,Pw as bY,sk as bZ,ak as b_,T as ba,Mr as bb,wm as bc,Ut as bd,$ as be,v as bf,Ve as bg,rt as bh,ke as bi,ut as bj,Tm as bk,ys as bl,at as bm,Ge as bn,Aw as bo,ms as bp,nt as bq,wn as br,_w as bs,Zo as bt,kc as bu,il as bv,qn as bw,Nt as bx,Sc as by,Sw as bz,B1 as c,pa as c$,n1 as c0,Ik as c1,Ak as c2,nk as c3,Dw as c4,Rk as c5,Q_ as c6,$k as c7,gk as c8,Rt as c9,Lf as cA,qk as cB,ou as cC,$w as cD,Xw as cE,rk as cF,tk as cG,St as cH,kw as cI,zs as cJ,Iw as cK,Tg as cL,Yw as cM,Ms as cN,bw as cO,uk as cP,Gw as cQ,l$ as cR,nE as cS,m$ as cT,Lk as cU,mE as cV,Uk as cW,hE as cX,yE as cY,pE as cZ,gE as c_,pt as ca,Lw as cb,Qw as cc,jk as cd,Jw as ce,_k as cf,pk as cg,Nk as ch,Vw as ci,O as cj,Wk as ck,yk as cl,Ck as cm,Pk as cn,oi as co,Ft as cp,Tk as cq,xw as cr,Fk as cs,Dk as ct,xk as cu,Uw as cv,Hw as cw,si as cx,yw as cy,vw as cz,K1 as d,kE as d0,Gf as d1,Uh as d2,Ce as d3,Zh as d4,Go as d5,rE as d6,Mk as d7,_E as e,Xk as f,sE as g,wE as h,oE as i,iE as j,y1 as k,Kt as l,Ct as m,tE as n,cE as o,Ko as p,Jk as q,P1 as r,ha as s,fr as t,C as u,s1 as v,zt as w,fo as x,dE as y,u1 as z};
