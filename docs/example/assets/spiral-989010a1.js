import{K as Vn,L as Yn,M as Zn,S as Xn,N as Qn,O as Jn,P as es,Q as ts,T as ns,U as ss,V as rs,W as as,X as is,Y as cs,Z as os,_ as us,$ as ls,a0 as ds,a1 as ee,a2 as te,a3 as Lt,a4 as At,a5 as hs,a6 as ht,a7 as fe,a8 as fs,a9 as _s,aa as ms,k as zt,ab as ps,ac as Es,ad as Ss,ae as xt,af as Cs,v as c,ag as h,ah as bs,ai as b,aj as H,ak as gs,al as Ps,am as l,an as vs,ao as Os,ap as v,aq as P,ar as Re,as as _e,at as y,au as d,av as j,aw as Nt,ax as A,ay as p,az as ft,aA as L,A as f,aB as I,aC as T,aD as ke,aE as Ie,aF as pe,aG as _t,aH as ys,aI as Pe,aJ as ve,aK as Ze,aL as Oe,aM as me,aN as w,aO as Ut,aP as ks,aQ as mt,aR as Is,aS as ws,aT as O,aU as Xe,aV as z,aW as Me,aX as Wt,aY as Ds,aZ as Ts,a_ as $s,a$ as Fs,b0 as Rs,b1 as Ls,b2 as As,b3 as zs,b4 as xs,b5 as Ns,b6 as Te,b7 as Us,b8 as pt,b9 as R,ba as Ws,bb as Ms,bc as js,bd as qs,be as Mt,bf as $e,bg as ce,bh as oe,bi as Bs,bj as G,bk as je,bl as Qe,bm as Je,bn as Hs,bo as Ks,bp as Et,bq as Gs,br as St,bs as Ct,bt as Vs,bu as Ys,bv as Zs,bw as Xs,bx as Qs,by as Js,bz as er,bA as tr,bB as jt,bC as x,bD as nr,bE as sr,bF as rr,bG as qt,bH as ar,bI as ir,bJ as cr,bK as bt,bL as or,bM as ur,bN as lr,bO as dr,l as hr,bP as Bt,B as Q,R as Ht,C as Kt,bQ as fr,F as Gt,d as Vt,bR as Yt,bS as Zt,bT as _r,x as mr,bU as pr,w as Xt,G as Er,q as Qt,n as it,p as ct,bV as Sr,E as Cr,y as V,z as br,bW as gr,bX as Pr,bY as vr,g as Or,h as yr,bZ as kr,b_ as Ir,b$ as wr,s as Dr,t as gt,m as et,c0 as Tr,a as $r}from"./utils-c738ae3f.js";const Pt=Xn,Fr=rs,Rr=Vn,Jt=Qn,Lr=as,vt=Jn,Ar=es,zr=ts,xr=Yn,Nr=is,Ur=Zn,Wr=ns,Mr=ss,jr=ds,Ot=cs,qr=os,Br=ls,Hr=us,en=ee(),Kr=te(Lt(At,t=>Gr(t)),en);function Gr(t){const e=hs(At,t);return{moveTo:ht(ps,e),lineTo:ht(Es,e),beginPath:e(fe(fs,void 0)),stroke:e(fe(_s(),void 0))}}const tn=ee(),Vr=ms(Kr,te(Lt(en,t=>Yr(t)),tn));function Yr(t){return([[e,n],[s,r]])=>zt([t.beginPath,t.moveTo(e,n),t.lineTo(s,r),t.stroke])}const nn=ee();function Zr(t){return te(Ss(function*(e){const n=yield*e(xt(t)),s=yield*e(Cs(tn));return new Qr(n,s)}),nn)}const Xr=Zr({theta:0,position:[0,0]});class Qr{constructor(e,n){this.state=e,this.draw=n}drawForward(e){return c(gs(this.state),b(n=>[n,Jr(n,e)]),H(([n,s])=>this.draw([n.position,s])),b(([{theta:n},s])=>({theta:n,position:s})),h(n=>fe(bs(this.state,n),n)))}turn(e){return Ps(this.state,({theta:n,position:s})=>({theta:n+e,position:s}))}}function Jr({position:[t,e],theta:n},s){return[t+s*Math.cos(n),e+s*Math.sin(n)]}const Ee="Done",Se="Emit",ne="FromEffect",Ce="Read",ea=Symbol.for("@effect/stream/Channel/State"),ta={_R:t=>t,_E:t=>t},Le={[ea]:ta},Y=()=>{const t=Object.create(Le);return t._tag=Ee,t},qe=()=>{const t=Object.create(Le);return t._tag=Se,t},ue=t=>{const e=Object.create(Le);return e._tag=ne,e.effect=t,e},Be=(t,e,n,s)=>{const r=Object.create(Le);return r._tag=Ce,r.upstream=t,r.onEffect=e,r.onEmit=n,r.onDone=s,r},Fe=t=>t._tag===ne,na=t=>Fe(t)?t.effect:l(),yt=t=>Fe(t)?vs(t.effect):void 0,we="ContinuationK",sa="ContinuationFinalizer";var sn,rn;const an=Symbol.for("@effect/stream/Channel/Continuation"),cn={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutDone:t=>t,_OutErr2:t=>t,_OutElem:t=>t,_OutDone2:t=>t};class on{constructor(e,n){this.onSuccess=e,this.onHalt=n,this._tag=we,this[sn]=cn}onExit(e){return Os(e)?this.onHalt(e.cause):this.onSuccess(e.value)}}sn=an;class ra{constructor(e){this.finalizer=e,this._tag=sa,this[rn]=cn}}rn=an;const un="PullFromChild",tt="PullFromUpstream",nt="DrainChildExecutors",ln="Emit";class ye{constructor(e,n,s){this.childExecutor=e,this.parentSubexecutor=n,this.onEmit=s,this._tag=un}close(e){return v(n=>{const s=this.childExecutor.close(e),r=this.parentSubexecutor.close(e);return s!==void 0&&r!==void 0?c(P(s),Re(P(r),(a,i)=>c(a,_e(i)))).traced(n):s!==void 0?s.traced(n):r!==void 0?r.traced(n):void 0})}enqueuePullFromChild(e){return this}}class M{constructor(e,n,s,r,a,i,o,u){this.upstreamExecutor=e,this.createChild=n,this.lastDone=s,this.activeChildExecutors=r,this.combineChildResults=a,this.combineWithChildResult=i,this.onPull=o,this.onEmit=u,this._tag=tt}close(e){return v(n=>{const s=this.upstreamExecutor.close(e),a=[...this.activeChildExecutors.map(i=>i!==void 0?i.childExecutor.close(e):void 0),s].reduce((i,o)=>i!==void 0&&o!==void 0?c(i,Re(P(o),(u,E)=>c(u,_e(E)))):i!==void 0?i:o!==void 0?P(o):void 0,void 0);return a===void 0?a:a.traced(n)})}enqueuePullFromChild(e){return new M(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,e],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class X{constructor(e,n,s,r,a,i,o){this.upstreamExecutor=e,this.lastDone=n,this.activeChildExecutors=s,this.upstreamDone=r,this.combineChildResults=a,this.combineWithChildResult=i,this.onPull=o,this._tag=nt}close(e){return v(n=>{const s=this.upstreamExecutor.close(e),a=[...this.activeChildExecutors.map(i=>i!==void 0?i.childExecutor.close(e):void 0),s].reduce((i,o)=>i!==void 0&&o!==void 0?c(i,Re(P(o),(u,E)=>c(u,_e(E)))):i!==void 0?i:o!==void 0?P(o):void 0,void 0);return a===void 0?a:a.traced(n)})}enqueuePullFromChild(e){return new X(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,e],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class He{constructor(e,n){this.value=e,this.next=n,this._tag=ln}close(e){return v(n=>{const s=this.next.close(e);return s===void 0?s:s.traced(n)})}enqueuePullFromChild(e){return this}}const aa="Pulled",ia="NoUpstream",ca="@effect/stream/Channel/UpstreamPullRequest",oa=Symbol.for(ca),ua={_A:t=>t},dn={[oa]:ua},kt=t=>{const e=Object.create(dn);return e._tag=aa,e.value=t,e},la=t=>{const e=Object.create(dn);return e._tag=ia,e.activeDownstreamCount=t,e},hn="Continue",da="Close",ha="Yield",fa="@effect/stream/Channel/ChildExecutorDecision",It=Symbol.for(fa),_a={[It]:It},ma=t=>{const e=Object.create(_a);return e._tag=hn,e},fn="PullAfterNext",pa="PullAfterAllEnqueued",Ea="@effect/stream/Channel/UpstreamPullStrategy",Sa=Symbol.for(Ea),Ca={_A:t=>t},ba={[Sa]:Ca},ga=t=>{const e=Object.create(ba);return e._tag=fn,e.emitSeparator=t,e},_n="BracketOut",mn="Bridge",pn="ConcatAll",En="Emit",Pa="Ensuring",Sn="Fail",Cn="Fold",bn="FromEffect",gn="PipeTo",va="Provide",Pn="Read",vn="Succeed",On="SucceedNow",yn="Suspend",kn="Traced",Oa="@effect/stream/Channel",ya=Symbol.for(Oa),ka={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutElem:t=>t,_OutDone:t=>t},g={[ya]:ka,traced(t){return t?Object.create(g,{_tag:{value:kn},channel:{value:this},trace:{value:t}}):this}},Ia=y(2,(t,e)=>(n,s)=>{const r=Object.create(g);return r._tag=_n,r.acquire=()=>n,r.finalizer=e(s),r.traced(t)}),wa=d((t,e)=>(n,s,r)=>{const a=Object.create(g);return a._tag=pn,a.combineInners=e(s),a.combineAll=e(r),a.onPull=()=>ga(Nt()),a.onEmit=()=>ma,a.value=()=>n,a.k=A,a.traced(t)}),Da=y(2,t=>(e,n)=>{const s=Object.create(g);return s._tag=mn,s.input=n,s.channel=e,s.traced(t)}),se=d(t=>e=>D(Rr(e)).traced(t)),D=d(t=>e=>Ta(()=>e).traced(t)),Ta=d((t,e)=>n=>{const s=Object.create(g);return s._tag=Sn,s.error=e(n),s.traced(t)}),S=y(2,(t,e)=>(n,s)=>{const r=Object.create(g);return r._tag=Cn,r.channel=n,r.k=new on(e(s),D),r.traced(t)}),k=d(t=>e=>{const n=Object.create(g);return n._tag=bn,n.effect=()=>e,n.traced(t)}),$=y(2,t=>(e,n)=>{const s=Object.create(g);return s._tag=gn,s.left=()=>e,s.right=()=>n,s.traced(t)}),be=d((t,e)=>(n,s,r)=>Ae(e(n),a=>j(xr(a),e(s),D),e(r))),Ae=d((t,e)=>(n,s,r)=>{const a=Object.create(g);return a._tag=Pn,a.more=e(n),a.done=new on(e(r),e(s)),a.traced(t)}),ze=d(t=>e=>In(()=>e).traced(t)),J=d(t=>e=>{const n=Object.create(g);return n._tag=On,n.terminal=e,n.traced(t)}),xe=d((t,e)=>n=>{const s=Object.create(g);return s._tag=yn,s.channel=e(n),s.traced(t)}),In=d((t,e)=>n=>{const s=Object.create(g);return s._tag=vn,s.evaluate=e(n),s.traced(t)}),Ne=d(t=>()=>J(void 0).traced(t)),m=d(t=>e=>{const n=Object.create(g);return n._tag=En,n.out=e,n.traced(t)});class q{constructor(e,n,s){this._activeSubexecutor=void 0,this._cancelled=void 0,this._closeLastSubstream=void 0,this._done=void 0,this._doneStack=[],this._emitted=void 0,this._traceStack=[],this._input=void 0,this._inProgressFinalizer=void 0,this._currentChannel=e,this._executeCloseLastSubstream=s,this._providedEnv=n}run(){let e;for(;e===void 0;)if(this._cancelled!==void 0)e=this.processCancellation();else if(this._activeSubexecutor!==void 0)e=this.runSubexecutor();else try{if(this._currentChannel===void 0)e=Y();else switch(this._currentChannel._tag){case _n:{e=this.runBracketOut(this._currentChannel);break}case mn:{const n=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,this._input!==void 0){const s=this._input;this._input=void 0;const r=()=>h(n.awaitRead(),()=>I(()=>{const a=s.run();switch(a._tag){case Ee:return T(s.getDone(),i=>n.error(i),i=>n.done(i));case Se:return h(n.emit(s.getEmit()),()=>r());case ne:return L(a.effect,i=>n.error(i),()=>r());case Ce:return ot(a,()=>r(),i=>n.error(i))}}));e=ue(h(ke(r()),a=>p(()=>this.addFinalizer(i=>h(Ie(a),()=>I(()=>{const o=this.restorePipe(i,s);return o!==void 0?o:l()}))))))}break}case pn:{const n=new q(this._currentChannel.value(),this._providedEnv,r=>p(()=>{const a=this._closeLastSubstream===void 0?l():this._closeLastSubstream;this._closeLastSubstream=c(a,f(r))}));n._input=this._input;const s=this._currentChannel;this._activeSubexecutor=new M(n,r=>s.k(r),void 0,[],(r,a)=>s.combineInners(r,a),(r,a)=>s.combineAll(r,a),r=>s.onPull(r),r=>s.onEmit(r)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case En:{this._emitted=this._currentChannel.out,this._currentChannel=this._activeSubexecutor!==void 0?void 0:Ne(),e=qe();break}case Pa:{this.runEnsuring(this._currentChannel);break}case Sn:{e=this.doneHalt(this._currentChannel.error());break}case Cn:{this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break}case bn:{const n=this._providedEnv===void 0?this._currentChannel.effect():c(this._currentChannel.effect(),ft(this._providedEnv));e=ue(c(n,L(s=>{const r=this.doneHalt(s);return r!==void 0&&Fe(r)?r.effect:l()},s=>{const r=this.doneSucceed(s);return r!==void 0&&Fe(r)?r.effect:l()})));break}case gn:{const n=this._input,s=new q(this._currentChannel.left(),this._providedEnv,r=>this._executeCloseLastSubstream(r));s._input=n,this._input=s,this.addFinalizer(r=>{const a=this.restorePipe(r,n);return a!==void 0?a:l()}),this._currentChannel=this._currentChannel.right();break}case va:{const n=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>p(()=>{this._providedEnv=n}));break}case Pn:{const n=this._currentChannel;e=Be(this._input,A,s=>{this._currentChannel=n.more(s)},s=>{const r=a=>n.done.onExit(a);this._currentChannel=r(s)});break}case vn:{e=this.doneSucceed(this._currentChannel.evaluate());break}case On:{e=this.doneSucceed(this._currentChannel.terminal);break}case yn:{this._currentChannel=this._currentChannel.channel();break}case kn:{this._traceStack.push(this._currentChannel.trace),this.addFinalizer(()=>p(()=>{this._traceStack.pop()})),this._currentChannel=this._currentChannel.channel;break}default:this._currentChannel._tag}}catch(n){this._currentChannel=D(Jt(n))}return e}stackToLines(){if(this._traceStack.length===0)return pe();const e=[];let n=this._traceStack.length-1;for(;n>=0&&e.length<_t.traceStackLimit;){const s=this._traceStack[n];e.push(s),n=n-1}return ys(e)}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(e){this._cancelled=e}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(e){this._inProgressFinalizer=e}popAllFinalizers(e){return Pe(()=>{const n=[];let s=this._doneStack.pop();for(;s;)s._tag==="ContinuationFinalizer"&&n.push(s.finalizer),s=this._doneStack.pop();const r=n.length===0?l():Ge(n,e);return this.storeInProgressFinalizer(r),r})}popNextFinalizers(){const e=[];for(;this._doneStack.length!==0;){const n=this._doneStack[this._doneStack.length-1];if(n._tag===we)return e;e.push(n),this._doneStack.pop()}return e}restorePipe(e,n){return Pe(()=>{const s=this._input;return this._input=n,s!==void 0?s.close(e):l()})}close(e){return Pe(()=>{let n;const s=this._inProgressFinalizer;s!==void 0&&(n=c(s,ve(p(()=>this.clearInProgressFinalizer()))));let r;const a=this.popAllFinalizers(e);a!==void 0&&(r=c(a,ve(p(()=>this.clearInProgressFinalizer()))));const i=this._activeSubexecutor===void 0?void 0:this._activeSubexecutor.close(e);if(!(i===void 0&&n===void 0&&r===void 0))return c(P(Ke(i)),Ze(P(Ke(n))),Ze(P(Ke(r))),b(([[o,u],E])=>c(o,_e(u),_e(E))),Oe,h(me))})}doneSucceed(e){if(this._doneStack.length===0)return this._done=w(e),this._currentChannel=void 0,Y();const n=this._doneStack[this._doneStack.length-1];if(n._tag===we){this._doneStack.pop(),this._currentChannel=n.onSuccess(e);return}const s=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=s.reverse(),this._done=w(e),this._currentChannel=void 0,Y();const r=Ge(s.map(i=>i.finalizer),w(e));this.storeInProgressFinalizer(r);const a=c(r,ve(p(()=>this.clearInProgressFinalizer())),Oe,h(()=>p(()=>this.doneSucceed(e))));return ue(a)}annotate(e){let n=e;if(zr(n)&&Wr(n.annotation)){const s=n.annotation.stack,r=this.stackToLines();n=vt(n.cause,new Pt(c(s.length===0?r:r.length===0||mt(s)===mt(r)?s:c(s,Is(r)),ks,Ut(_t.traceStackLimit)),n.annotation.seq))}else n=vt(n,new Pt(this.stackToLines(),ws(Fr)));return n}doneHalt(e){if(this._doneStack.length===0)return this._done=O(e),this._currentChannel=void 0,Y();const n=this._doneStack[this._doneStack.length-1];if(n._tag===we){this._doneStack.pop(),this._currentChannel=n.onHalt(e);return}const s=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=s.reverse(),this._done=O(e),this._currentChannel=void 0,Y();const r=Ge(s.map(i=>i.finalizer),O(e));this.storeInProgressFinalizer(r);const a=c(r,ve(p(()=>this.clearInProgressFinalizer())),Oe,h(()=>p(()=>this.doneHalt(e))));return ue(a)}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,Y()}runBracketOut(e){const n=c(this.provide(e.acquire()),L(s=>p(()=>{this._currentChannel=D(s)}),s=>p(()=>{this.addFinalizer(r=>this.provide(e.finalizer(s,r))),this._currentChannel=m(s)})),Oe);return ue(n)}provide(e){return this._providedEnv===void 0?e:c(e,ft(this._providedEnv))}runEnsuring(e){this.addFinalizer(e.finalizer),this._currentChannel=e.channel}addFinalizer(e){this._doneStack.push(new ra(e))}runSubexecutor(){const e=this._activeSubexecutor;switch(e._tag){case un:return this.pullFromChild(e.childExecutor,e.parentSubexecutor,e.onEmit,e);case tt:return this.pullFromUpstream(e);case nt:return this.drainChildExecutors(e);case ln:return this._emitted=e.value,this._activeSubexecutor=e.next,qe()}}replaceSubexecutor(e){this._currentChannel=void 0,this._activeSubexecutor=e}finishWithExit(e){return Pe(()=>{const n=c(e,T(s=>this.doneHalt(s),s=>this.doneSucceed(s)));return this._activeSubexecutor=void 0,n===void 0?l():na(n)})}finishSubexecutorWithCloseEffect(e,...n){this.addFinalizer(()=>c(n,Xe(r=>c(p(()=>r(e)),h(a=>a!==void 0?a:l())))));const s=c(e,T(r=>this.doneHalt(r),r=>this.doneSucceed(r)));return this._activeSubexecutor=void 0,s}applyUpstreamPullStrategy(e,n,s){switch(s._tag){case fn:{const r=!e||n.some(a=>a!==void 0);return[s.emitSeparator,r?[void 0,...n]:n]}case pa:{const r=!e||n.some(a=>a!==void 0);return[s.emitSeparator,r?[...n,void 0]:n]}}}pullFromChild(e,n,s,r){return Be(e,A,a=>{const i=s(a);switch(i._tag){case hn:break;case da:{this.finishWithDoneValue(e,n,i.value);break}case ha:{const o=n.enqueuePullFromChild(r);this.replaceSubexecutor(o);break}}this._activeSubexecutor=new He(a,this._activeSubexecutor)},T(a=>{const i=this.handleSubexecutorFailure(e,n,a);return i===void 0?void 0:yt(i)},a=>{this.finishWithDoneValue(e,n,a)}))}finishWithDoneValue(e,n,s){const r=n;switch(r._tag){case tt:{const a=new M(r.upstreamExecutor,r.createChild,r.lastDone!==void 0?r.combineChildResults(r.lastDone,s):s,r.activeChildExecutors,r.combineChildResults,r.combineWithChildResult,r.onPull,r.onEmit);this._closeLastSubstream=e.close(w(s)),this.replaceSubexecutor(a);break}case nt:{const a=new X(r.upstreamExecutor,r.lastDone!==void 0?r.combineChildResults(r.lastDone,s):s,r.activeChildExecutors,r.upstreamDone,r.combineChildResults,r.combineWithChildResult,r.onPull);this._closeLastSubstream=e.close(w(s)),this.replaceSubexecutor(a);break}}}handleSubexecutorFailure(e,n,s){return this.finishSubexecutorWithCloseEffect(O(s),r=>n.close(r),r=>e.close(r))}pullFromUpstream(e){if(e.activeChildExecutors.length===0)return this.performPullFromUpstream(e);const n=e.activeChildExecutors[0],s=new M(e.upstreamExecutor,e.createChild,e.lastDone,e.activeChildExecutors.slice(1),e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit);if(n===void 0)return this.performPullFromUpstream(s);this.replaceSubexecutor(new ye(n.childExecutor,s,n.onEmit))}performPullFromUpstream(e){return Be(e.upstreamExecutor,n=>{const s=this._closeLastSubstream===void 0?l():this._closeLastSubstream;return this._closeLastSubstream=void 0,c(this._executeCloseLastSubstream(s),f(n))},n=>{if(this._closeLastSubstream!==void 0){const i=this._closeLastSubstream;return this._closeLastSubstream=void 0,c(this._executeCloseLastSubstream(i),b(()=>{const o=new q(e.createChild(n),this._providedEnv,this._executeCloseLastSubstream);o._input=this._input;const[u,E]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(kt(n)));this._activeSubexecutor=new ye(o,new M(e.upstreamExecutor,e.createChild,e.lastDone,E,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),Me(u)&&(this._activeSubexecutor=new He(u.value,this._activeSubexecutor))}))}const s=new q(e.createChild(n),this._providedEnv,this._executeCloseLastSubstream);s._input=this._input;const[r,a]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(kt(n)));this._activeSubexecutor=new ye(s,new M(e.upstreamExecutor,e.createChild,e.lastDone,a,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),Me(r)&&(this._activeSubexecutor=new He(r.value,this._activeSubexecutor))},n=>{if(e.activeChildExecutors.some(a=>a!==void 0)){const a=new X(e.upstreamExecutor,e.lastDone,[void 0,...e.activeChildExecutors],e.upstreamExecutor.getDone(),e.combineChildResults,e.combineWithChildResult,e.onPull);if(this._closeLastSubstream!==void 0){const i=this._closeLastSubstream;return this._closeLastSubstream=void 0,c(this._executeCloseLastSubstream(i),b(()=>this.replaceSubexecutor(a)))}this.replaceSubexecutor(a);return}const s=this._closeLastSubstream,r=this.finishSubexecutorWithCloseEffect(c(n,$s(a=>e.combineWithChildResult(e.lastDone,a))),()=>s,a=>e.upstreamExecutor.close(a));return r===void 0?void 0:yt(r)})}drainChildExecutors(e){if(e.activeChildExecutors.length===0){const a=this._closeLastSubstream;return a!==void 0&&this.addFinalizer(()=>z(a)),this.finishSubexecutorWithCloseEffect(e.upstreamDone,()=>a,i=>e.upstreamExecutor.close(i))}const n=e.activeChildExecutors[0],s=e.activeChildExecutors.slice(1);if(n===void 0){const[a,i]=this.applyUpstreamPullStrategy(!0,s,e.onPull(la(s.reduce((o,u)=>u!==void 0?o+1:o,0))));return this.replaceSubexecutor(new X(e.upstreamExecutor,e.lastDone,i,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull)),Me(a)?(this._emitted=a.value,qe()):void 0}const r=new X(e.upstreamExecutor,e.lastDone,s,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull);this.replaceSubexecutor(new ye(n.childExecutor,r,n.onEmit))}}const Ke=Wt(()=>t=>t!==void 0?t:l()),Ge=Wt(()=>(t,e)=>c(Fs(t,n=>P(n(e))),b(n=>c(Rs(n),Ls(()=>As()))),h(n=>me(n)))),ot=d(t=>(e,n,s)=>{const r=[e],a=()=>{const i=r.pop();if(i===void 0||i.upstream===void 0)return Ds("Unexpected end of input for channel execution");const o=i.upstream.run();switch(o._tag){case Se:{const u=i.onEmit(i.upstream.getEmit());return r.length===0?u===void 0?I(n):c(u,L(s,n)).traced(t):u===void 0?I(()=>a()).traced(t):c(u,L(s,()=>a())).traced(t)}case Ee:{const u=i.onDone(i.upstream.getDone());return r.length===0?u===void 0?I(n).traced(t):c(u,L(s,()=>n())).traced(t):u===void 0?I(()=>a()).traced(t):c(u,L(s,()=>a())).traced(t)}case ne:return r.push(i),c(i.onEffect(o.effect),Ts(u=>I(()=>{const E=i.onDone(O(u));return E===void 0?l():E})),L(s,()=>a())).traced(t);case Ce:return r.push(i),r.push(o),I(()=>a()).traced(t)}};return a()}),$a=d(t=>e=>c(Fa(e),zs).traced(t)),Fa=t=>{const e=(n,s)=>Ms(p(()=>new q(t,void 0,A)),r=>I(()=>c(De(r.run(),r),qs(n),f(R(n)),pt(js()))),(r,a)=>{const i=r.close(a);return i===void 0?l():Mt(i,o=>jr(s,$e(o)))});return h(xs(),n=>h(Br(n,Ns),s=>h(Te(),r=>h(Us(e(r,s)),a=>pt(R(r),Ws(a))))))},De=(t,e)=>{const n=t;switch(n._tag){case ne:return c(n.effect,h(()=>De(e.run(),e)));case Se:return De(e.run(),e);case Ee:return me(e.getDone());case Ce:return ot(n,()=>De(e.run(),e),$e)}},wn="Done",Ra="Await",La="@effect/stream/Channel/MergeDecision",Aa=Symbol.for(La),Dn={[Aa]:{_R:t=>t,_E0:t=>t,_Z0:t=>t,_E:t=>t,_Z:t=>t}},za=t=>{const e=Object.create(Dn);return e._tag=wn,e.effect=t,e},xa=t=>{const e=Object.create(Dn);return e._tag=Ra,e.f=t,e},Tn="BothRunning",$n="LeftDone",Fn="RightDone",Na="@effect/stream/Channel/MergeState",wt=Symbol.for(Na),ut={[wt]:wt},Ve=(t,e)=>{const n=Object.create(ut);return n._tag=Tn,n.left=t,n.right=e,n},Dt=t=>{const e=Object.create(ut);return e._tag=$n,e.f=t,e},Tt=t=>{const e=Object.create(ut);return e._tag=Fn,e.f=t,e},Z="Empty",le="Emit",de="Error",he="Done",Rn=t=>({_tag:Z,notifyProducer:t}),Ye=t=>({_tag:le,notifyConsumers:t}),Ua=t=>({_tag:de,cause:t}),Wa=t=>({_tag:he,done:t});class Ma{constructor(e){this.ref=e}awaitRead(){return v(e=>ce(oe(this.ref,n=>n._tag===Z?[R(n.notifyProducer),n]:[l(),n])).traced(e))}close(){return v(e=>Bs(n=>this.error(Lr(n))).traced(e))}done(e){return v(n=>c(oe(this.ref,s=>{switch(s._tag){case Z:return[R(s.notifyProducer),s];case le:return[c(s.notifyConsumers,Xe(r=>je(r,Qe(e)))),Wa(e)];case de:return[G(),s];case he:return[G(),s]}}),ce).traced(n))}emit(e){return v(n=>c(Te(),h(s=>c(oe(this.ref,r=>{switch(r._tag){case Z:return[R(r.notifyProducer),r];case le:{const a=r.notifyConsumers[0],i=r.notifyConsumers.slice(1);if(a!==void 0)return[je(a,Je(e)),i.length===0?Rn(s):Ye(i)];throw new Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! Please report an issue at https://github.com/Effect-TS/stream/issues")}case de:return[G(),r];case he:return[G(),r]}}),ce))).traced(n))}error(e){return v(n=>c(oe(this.ref,s=>{switch(s._tag){case Z:return[R(s.notifyProducer),s];case le:return[Xe(s.notifyConsumers,r=>Hs(r,e)),Ua(e)];case de:return[G(),s];case he:return[G(),s]}}),ce).traced(n))}take(){return v(e=>this.takeWith(n=>O(Nr(n,Qe)),n=>w(n),n=>Ks(Je(n))).traced(e))}takeWith(e,n,s){return v(r=>c(Te(),h(a=>c(oe(this.ref,i=>{switch(i._tag){case Z:return[f(je(i.notifyProducer,void 0),Et(R(a),e,j(s,n))),Ye([a])];case le:return[Et(R(a),e,j(s,n)),Ye([...i.notifyConsumers,a])];case de:return[z(e(i.cause)),i];case he:return[z(s(i.done)),i]}}),ce))).traced(r))}}const ja=d(t=>()=>c(Te(),h(e=>xt(Rn(e))),b(e=>new Ma(e))).traced(t)),qa=y(2,t=>(e,n)=>Ha(e,()=>n).traced(t)),Ln=d(t=>e=>{const n=Ae(()=>n,D,ze);return $(e,n).traced(t)}),Ba=d(t=>e=>S(e,A).traced(t)),An=d(t=>e=>B(e.takeWith(D,n=>S(m(n),()=>An(e)),ze)).traced(t)),Ha=y(2,(t,e)=>(n,s)=>S(n,r=>In(()=>e(s)(r))).traced(t)),Ka=y(2,(t,e)=>(n,s)=>{const r=be(a=>S(m(e(s)(a)),()=>r),se,J);return $(n,r).traced(t)}),Ga=y(4,(t,e)=>(n,s,r,a)=>Za(c(ja(),h(i=>{const o=An(i);return b(Ze($t($(o,n)),$t($(o,s))),([u,E])=>{const Ue=(C,_,We)=>(K,ae,N)=>{const ge=U=>{const W=U;return W._tag===wn?z(k(f(Ie(_),W.effect))):b(Gs(_),T(ie=>k(W.f(O(ie))),j(ie=>k(W.f(w(ie))),ie=>Xa(m(ie),re(N(W.f))))))};return T(C,U=>ge(K(O(U))),j(U=>ge(K(w(U))),U=>z(S(m(U),()=>S(k(ke(We)),W=>re(ae(W,_)))))))},re=C=>{switch(C._tag){case Tn:{const _=St(Ct(C.left)),We=St(Ct(C.right));return B(Vs(_,We,(K,ae)=>f(Ie(ae),Ue(K,C.right,u)(e(r),Ve,N=>Dt(N))),(K,ae)=>f(Ie(ae),Ue(K,C.left,E)(e(a),(N,ge)=>Ve(ge,N),N=>Tt(N)))))}case $n:return B(b(P(E),T(_=>k(C.f(O(_))),j(_=>k(C.f(w(_))),_=>S(m(_),()=>re(Dt(C.f)))))));case Fn:return B(b(P(u),T(_=>k(C.f(O(_))),j(_=>k(C.f(w(_))),_=>S(m(_),()=>re(Tt(C.f)))))))}};return c(k(Re(ke(u),ke(E),(C,_)=>Ve(C,_))),S(re),Da(i))})}))).traced(t)),zn=y(2,t=>(e,n)=>xe(()=>{let s;const r=be(i=>S(m(i),()=>r),i=>(s=Qa(i),D(Jt(s))),J),a=Ae(i=>c(m(i),S(()=>a)),i=>{const o=Mr(i);return Ar(o)&&Ja(o.defect)&&Zs(o.defect,s)?se(o.defect.error):D(i)},J);return $($($(e,r),n),a).traced(t)})),Va=d(t=>e=>$a(Ln(e)).traced(t)),Ya=d(t=>e=>B(Xs(n=>b(Hr(),s=>Ia(Mt(n(qr(s)(e)),r=>Ot(s,O(r))),(r,a)=>Ot(s,a))))).traced(t)),$t=d(t=>e=>b(Ys(p(()=>new q(e,void 0,A)),(n,s)=>{const r=n.close(s);return r===void 0?l():r}),n=>I(()=>st(n.run(),n))).traced(t)),st=(t,e)=>{const n=t;switch(n._tag){case Ee:return T(e.getDone(),$e,s=>z(Qe(s)));case Se:return z(Je(e.getEmit()));case ne:return c(n.effect,h(()=>st(e.run(),e)));case Ce:return ot(n,()=>st(e.run(),e),s=>$e(s))}},B=d(t=>e=>Ba(k(e)).traced(t)),Za=d(t=>e=>wa(Ya(e),(n,s)=>n,(n,s)=>n).traced(t)),Xa=y(2,t=>(e,n)=>S(e,()=>n).traced(t)),rt=Symbol.for("@effect/stream/Channel/errors/ChannelException"),Qa=t=>({_tag:"ChannelException",[rt]:rt,error:t}),Ja=t=>typeof t=="object"&&t!=null&&rt in t,ei=za,ti=xa;var xn;const ni="@effect/stream/Sink",si=Symbol.for(ni),ri={_R:t=>t,_E:t=>t,_In:t=>t,_L:t=>t,_Z:t=>t};class lt{constructor(e){this.channel=e,this[xn]=ri}}xn=si;const ai=(t,e,n)=>ui(()=>new lt(Nn(t,e,n))),Nn=(t,e,n)=>e(t)?be(s=>{const[r,a]=Un(t,s,e,n,0,s.length);return Qs(a)?c(m(a),qa(r)):Nn(r,e,n)},se,()=>J(t)):J(t),Un=(t,e,n,s,r,a)=>{if(r===a)return[t,pe()];const i=s(t,c(e,Js(r)));return n(i)?Un(i,e,n,s,r+1,a):[i,c(e,er(r+1))]},ii=(t,e)=>ci(ai(t,tr,e)),ci=t=>new lt(Ln(t.channel)),oi=()=>ii(Nt(),(t,e)=>jt(e)),ui=t=>new lt(xe(()=>t().channel)),li="Both",di={_tag:li},hi=di;var Wn;const fi="@effect/stream/Stream",_i=Symbol.for(fi),mi={_R:t=>t,_E:t=>t,_A:t=>t};class F{constructor(e){this.channel=e,this[Wn]=mi}}Wn=_i;const pi=4096,Ei=t=>Mn(or(t)),Si=new F(m(pe())),Mn=t=>c(t,nr(jt),Ci),Ci=t=>new F(c(t,sr(rr(Ne,se),e=>m(qt(e))),B)),at=x(2,(t,e)=>new F(c(t.channel,Ka(ir(e))))),bi=x(3,(t,e,n)=>{const s=r=>be(a=>{const[i,o]=c(a,ar(r,n));return c(m(o),S(()=>s(i)))},se,Ne);return new F(c(t.channel,$(s(e))))}),jn=x(2,(t,e)=>{const n=s=>{const r=s.next();if(r.done)return Ae(a=>n(a[Symbol.iterator]()),D,ze);{const a=r.value;return B(b(e(a),i=>S(m(qt(i)),()=>n(s))))}};return new F(c(t.channel,$(xe(()=>n(pe()[Symbol.iterator]())))))}),gi=x(2,(t,e)=>Pi(t,e,hi)),Pi=x(3,(t,e,n)=>vi(t,e,A,A,n)),vi=x(5,(t,e,n,s,r)=>{const a=i=>o=>i||!cr(o)?ei(me(o)):ti(me);return new F(Ga(at(t,n).channel,at(e,s).channel,a(r._tag==="Either"||r._tag==="Left"),a(r._tag==="Either"||r._tag==="Right")))}),Oi=(t,e,n=pi)=>Ii(()=>{if(t>=e)return Si;const s=(r,a,i)=>{const o=a-r;return o>i?c(m(bt(r,r+i-1)),S(()=>s(r+i,a,i))):m(bt(r,r+o-1))};return new F(s(t,e,n))}),yi=y(2,t=>(e,n)=>c(e.channel,zn(n.channel),Va).traced(t)),ki=d(t=>e=>c(e,yi(oi())).traced(t)),Ii=t=>new F(xe(()=>t().channel)),wi=x(2,(t,e)=>{if(!Number.isInteger(e))return Ei(Ur(`${e} must be an integer`));const n=s=>be(r=>{const a=c(r,Ut(Math.min(s,Number.POSITIVE_INFINITY))),i=Math.max(0,s-a.length);return i>0?c(m(a),S(()=>n(i))):m(a)},se,ze);return new F(c(t.channel,zn(0<e?n(e):Ne())))}),Di=x(2,(t,e)=>jn(t,n=>fe(e(n),n))),Ti=Mn,$i=at,qn=bi,Fi=jn,Ri=gi,Li=Oi,Ai=ki,zi=wi,Ft=Di;function dt(){return mr(Gi(771))}const xi=c(l(),f(Bt),h(({width:t,height:e})=>c(l(),f(ur(0,0,t,e)),h(n=>lr(()=>createImageBitmap(n))),b(n=>c(dr(n,pr(t/-2,e/-2)))),H(n=>hr(s=>Xt(c(Gt(0,0,t,e),f(Vt(t/2,e/2)),f(Er(-s/4)),f(Qt(n)),f(it(l(),ct(16)))))))))),Ni=c(l(),f(Bt),H(({width:t,height:e})=>c(l(),f(Gt(0,0,t,e)),f(Vt(t/2,e/2)))),f(fr(3.5,3.5)),f(Q(Ht,Kt(dt))),fe(null));function Ui(t){return c(Hi,qn(3,(e,[n,s])=>[n==e**2?e+2:e,{nextSquare:e**2,isPrime:s,num:n}]),Ft(({isPrime:e})=>e?it(l(),ct(16)):l()),Ft(Bi(t)),$i(Wi),Fi(e=>Q(nn,e)),zi(t))}function Wi({num:t,isPrime:e,nextSquare:n}){return r=>c(zt([Tr(e?3:1),$r(e?"transparent":gt(et(0,0,0,.25)))]),f(r.drawForward(3)),H(({position:[a,i]})=>e?Dr(gt(et(Math.atan2(i,a)*180/Math.PI,.5,.5,1))):l()),f(r.turn(s(t,Math.sqrt(n)))),H(({position:a})=>e?Ir(wr(a[0],a[1],2,0,Math.PI*2)):l()),f(r.drawForward(3)));function s(r,a){const i=a-2,o=a**2,u=a-1,E=r-i**2;return r==2||i**2+1==r||r!=o&&E%u==0?Math.PI/2:0}}const Bn=ee(),Mi=te(Gn("prime"),Bn),Hn=ee(),ji=te(Gn("latest"),Hn),Kn=ee(),qi=te(z(new Intl.NumberFormat),Kn);function Bi(t){return({num:e,isPrime:n})=>Q(Kn,s=>n?Q(Bn,Rt(s.format(e))):e>1e3&&e%100==0||e<=1e3&&e%10==0||e==t?Q(Hn,Rt(s.format(e))):l())}function Gn(t){return c(p(()=>Zt(document.getElementById(t))),h(Yt),Sr)}function Rt(t){return e=>p(()=>{e.innerText=t})}const Hi=c(Li(2,Number.MAX_SAFE_INTEGER),qn(pe(),Ki));function Ki(t,e){const n=e>1&&_r(t,r=>e%r!==0),s=[e,n];return[n?t.append(e):t,s]}const Gi=t=>c(Ti(Ni),Ri(Ui(t)),Ai,h(e=>c(e,vr(n=>Zt(n)),Yt,H(n=>Qt(Vi(n))))),Xt,Pr,H(([e])=>gr(`duration: ${e.millis}ms `)),f(it(xi,ct(3e3))),f(Q(Ht,Kt(dt))),V(Xr),V(Vr),V(Mi),V(ji),V(qi),V(br),Cr("canvas4"));function Vi({position:[t,e]}){return Or(kr(t,e,4),yr(et(0,.5,0,.5)))}dt();
