var hh=Object.defineProperty;var gh=(t,e,n)=>e in t?hh(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var f=(t,e,n)=>(gh(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const ph=t=>typeof t=="function",u=function(t,e){if(typeof t=="function")return function(){return t(arguments)?e.apply(this,arguments):n=>e(n,...arguments)};switch(t){case 0:case 1:throw new RangeError(`Invalid arity ${t}`);case 2:return function(n,r){return arguments.length>=2?e(n,r):function(s){return e(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?e(n,r,s):function(o){return e(o,n,r)}};case 4:return function(n,r,s,o){return arguments.length>=4?e(n,r,s,o):function(c){return e(c,n,r,s)}};case 5:return function(n,r,s,o,c){return arguments.length>=5?e(n,r,s,o,c):function(i){return e(i,n,r,s,o)}};default:return function(){if(arguments.length>=t)return e.apply(this,arguments);const n=arguments;return function(r){return e(r,...n)}}}},U=t=>t,jn=t=>()=>t,ii=jn(!0),Hs=jn(!1),ya=jn(void 0),ai=ya;function l(t,e,n,r,s,o,c,i,a){switch(arguments.length){case 1:return t;case 2:return e(t);case 3:return n(e(t));case 4:return r(n(e(t)));case 5:return s(r(n(e(t))));case 6:return o(s(r(n(e(t)))));case 7:return c(o(s(r(n(e(t))))));case 8:return i(c(o(s(r(n(e(t)))))));case 9:return a(i(c(o(s(r(n(e(t))))))));default:{let h=arguments[0];for(let d=1;d<arguments.length;d++)h=arguments[d](h);return h}}}function It(t,e,n,r,s,o,c,i,a){switch(arguments.length){case 1:return t;case 2:return function(){return e(t.apply(this,arguments))};case 3:return function(){return n(e(t.apply(this,arguments)))};case 4:return function(){return r(n(e(t.apply(this,arguments))))};case 5:return function(){return s(r(n(e(t.apply(this,arguments)))))};case 6:return function(){return o(s(r(n(e(t.apply(this,arguments))))))};case 7:return function(){return c(o(s(r(n(e(t.apply(this,arguments)))))))};case 8:return function(){return i(c(o(s(r(n(e(t.apply(this,arguments))))))))};case 9:return function(){return a(i(c(o(s(r(n(e(t.apply(this,arguments)))))))))}}}const Ir="2.0.0-next.55",Gs=Symbol.for(`effect/GlobalValue/globalStoreId/${Ir}`);Gs in globalThis||(globalThis[Gs]=new Map);const As=globalThis[Gs],L=(t,e)=>(As.has(t)||As.set(t,e()),As.get(t)),dh=t=>typeof t=="string",_a=t=>typeof t=="number",mh=t=>typeof t=="bigint",Vo=ph,yh=t=>typeof t=="object"&&t!==null,Ho=t=>yh(t)||Vo(t),M=u(2,(t,e)=>Ho(t)&&e in t),ba=u(2,(t,e)=>M(t,"_tag")&&t._tag===e),Fe=t=>t==null,Sa=t=>M(t,Symbol.iterator),_h=335903614,bh=4150755663,Sh=1481765933>>>0,vh=1284865837>>>0,wh=9007199254740992,$h=134217728;class va{constructor(e,n,r,s){f(this,"_state");return Fe(n)&&Fe(e)?(n=Math.random()*4294967295>>>0,e=0):Fe(n)&&(n=e,e=0),Fe(s)&&Fe(r)?(s=this._state?this._state[3]:bh,r=this._state?this._state[2]:_h):Fe(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),ui(this._state,this._state[0],this._state[1],e>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(e){this._state[0]=e[0],this._state[1]=e[1],this._state[2]=e[2],this._state[3]=e[3]|1}integer(e){if(!e)return this._next();if(e=e>>>0,!(e&e-1))return this._next()&e-1;let n=0;const r=(-e>>>0)%e>>>0;for(n=this._next();n<r;n=this._next());return n%e}number(){const e=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(e*$h+n)/wh}_next(){const e=this._state[0]>>>0,n=this._state[1]>>>0;kh(this._state,e,n,Sh,vh),ui(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=e>>>18,s=(n>>>18|e<<14)>>>0;r=(r^e)>>>0,s=(s^n)>>>0;const o=(s>>>27|r<<5)>>>0,c=e>>>27,i=(-c>>>0&31)>>>0;return(o>>>c|o<<i)>>>0}}function kh(t,e,n,r,s){let o=(n>>>16)*(s&65535)>>>0,c=(n&65535)*(s>>>16)>>>0,i=(n&65535)*(s&65535)>>>0,a=(n>>>16)*(s>>>16)+((c>>>16)+(o>>>16))>>>0;c=c<<16>>>0,i=i+c>>>0,i>>>0<c>>>0&&(a=a+1>>>0),o=o<<16>>>0,i=i+o>>>0,i>>>0<o>>>0&&(a=a+1>>>0),a=a+Math.imul(n,r)>>>0,a=a+Math.imul(e,s)>>>0,t[0]=a,t[1]=i}function ui(t,e,n,r,s){let o=e+r>>>0;const c=n+s>>>0;c>>>0<n>>>0&&(o=o+1|0),t[0]=o,t[1]=c}const Ps=L(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),Eh=L(Symbol.for("effect/Hash/pcgr"),()=>new va),R=Symbol.for("effect/Hash"),y=t=>{switch(typeof t){case"number":return Go(t);case"bigint":return ae(t.toString(10));case"boolean":return ae(String(t));case"symbol":return ae(String(t));case"string":return ae(t);case"undefined":return ae("undefined");case"function":case"object":return t===null?ae("null"):Ih(t)?t[R]():qn(t);default:throw new Error(`BUG: unhandled typeof ${typeof t} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},qn=t=>(Ps.has(t)||Ps.set(t,Go(Eh.integer(Number.MAX_SAFE_INTEGER))),Ps.get(t)),I=t=>e=>e*53^t,Zr=t=>t&3221225471|t>>>1&1073741824,Ih=t=>M(t,R),Go=t=>{if(t!==t||t===1/0)return 0;let e=t|0;for(e!==t&&(e^=t*4294967295);t>4294967295;)e^=t/=4294967295;return Zr(t)},ae=t=>{let e=5381,n=t.length;for(;n;)e=e*33^t.charCodeAt(--n);return Zr(e)},Oh=(t,e)=>{let n=12289;for(let r=0;r<e.length;r++)n^=l(ae(e[r]),I(y(t[e[r]])));return Zr(n)},wa=t=>Oh(t,Object.keys(t)),Yo=t=>{let e=6151;for(let n=0;n<t.length;n++)e=l(e,I(y(t[n])));return Zr(e)},T=Symbol.for("effect/Equal");function F(){return arguments.length===1?t=>li(t,arguments[0]):li(arguments[0],arguments[1])}function li(t,e){if(t===e)return!0;const n=typeof t;return n!==typeof e?!1:(n==="object"||n==="function")&&t!==null&&e!==null&&fi(t)&&fi(e)?y(t)===y(e)&&t[T](e):!1}const fi=t=>M(t,T),$a=()=>(t,e)=>F(t,e),Qo=t=>(e,n)=>e===n||t(e,n),Fh=u(2,(t,e)=>Qo((n,r)=>t(e(n),e(r)))),Mh=t=>Qo((e,n)=>{if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(!t(e[r],n[r]))return!1;return!0}),J=Symbol.for("nodejs.util.inspect.custom"),W=t=>M(t,"toJSON")&&Vo(t.toJSON)&&t.toJSON.length===0?t.toJSON():Array.isArray(t)?t.map(W):t,G=t=>JSON.stringify(t,null,2),$=(t,e)=>{switch(e.length){case 1:return e[0](t);case 2:return e[1](e[0](t));case 3:return e[2](e[1](e[0](t)));case 4:return e[3](e[2](e[1](e[0](t))));case 5:return e[4](e[3](e[2](e[1](e[0](t)))));case 6:return e[5](e[4](e[3](e[2](e[1](e[0](t))))));case 7:return e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))));case 8:return e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t))))))));case 9:return e[8](e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))))));default:{let n=t;for(let r=0,s=e.length;r<s;r++)n=e[r](n);return n}}},Rh={[R](){return wa(this)},[T](t){const e=Object.keys(this),n=Object.keys(t);if(e.length!==n.length)return!1;for(const r of e)if(!(r in t&&F(this[r],t[r])))return!1;return!0}},Xo=function(){function t(e){e&&Object.assign(this,e)}return t.prototype=Rh,t}(),_r="Async",ka="Commit",Y="Failure",br="OnFailure",Or="OnSuccess",Fr="OnSuccessAndFailure",Q="Success",Ea="Sync",Th="Tag",Ye="UpdateRuntimeFlags",Mr="While",Ia="WithRuntime",Sr="Yield",Zo="RevertFlags",Oa=Symbol.for("effect/Effect"),Ch=Symbol.for("effect/Stream"),Nh=Symbol.for("effect/Sink"),Ah=Symbol.for("effect/Channel"),Ae={_R:t=>t,_E:t=>t,_A:t=>t,_V:Ir},Ph={_R:t=>t,_E:t=>t,_In:t=>t,_L:t=>t,_Z:t=>t},Lh={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutElem:t=>t,_OutDone:t=>t},ts={[Oa]:Ae,[Ch]:Ae,[Nh]:Ph,[Ah]:Lh,[T](t){return this===t},[R](){return qn(this)},pipe(){return $(this,arguments)}},xh={...ts,_op:ka};({...xh,...Xo.prototype});const Fa=Symbol.for("effect/Option"),Ma={...ts,[Fa]:{_A:t=>t},[J](){return this.toJSON()},toString(){return G(this.toJSON())}},Dh=Object.assign(Object.create(Ma),{_tag:"Some",_op:"Some",[T](t){return Ra(t)&&Ca(t)&&F(t.value,this.value)},[R](){return I(y(this._tag))(y(this.value))},toJSON(){return{_id:"Option",_tag:this._tag,value:W(this.value)}}}),jh=Object.assign(Object.create(Ma),{_tag:"None",_op:"None",[T](t){return Ra(t)&&Ta(t)},[R](){return I(y(this._tag))},toJSON(){return{_id:"Option",_tag:this._tag}}}),Ra=t=>M(t,Fa),Ta=t=>t._tag==="None",Ca=t=>t._tag==="Some",Na=Object.create(jh),Aa=t=>{const e=Object.create(Dh);return e.value=t,e},Pa=Symbol.for("effect/Either"),La={...ts,[Pa]:{_A:t=>t},[J](){return this.toJSON()},toString(){return G(this.toJSON())}},qh=Object.assign(Object.create(La),{_tag:"Right",_op:"Right",[T](t){return xa(t)&&ja(t)&&F(t.right,this.right)},[R](){return I(y(this._tag))(y(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:W(this.right)}}}),Kh=Object.assign(Object.create(La),{_tag:"Left",_op:"Left",[T](t){return xa(t)&&Da(t)&&F(t.left,this.left)},[R](){return I(y(this._tag))(y(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:W(this.left)}}}),xa=t=>M(t,Pa),Da=t=>t._tag==="Left",ja=t=>t._tag==="Right",Uh=t=>{const e=Object.create(Kh);return e.left=t,e},Bh=t=>{const e=Object.create(qh);return e.right=t,e},tc=t=>(e,n)=>e===n?0:t(e,n),zh=tc((t,e)=>t<e?-1:1),qa=u(2,(t,e)=>tc((n,r)=>t(e(n),e(r)))),Wh=t=>u(2,(e,n)=>t(e,n)===-1),Ka=t=>u(2,(e,n)=>t(e,n)===1),Ua=t=>u(2,(e,n)=>e===n||t(e,n)<1?e:n),Ba=t=>u(2,(e,n)=>e===n||t(e,n)>-1?e:n),Jh=t=>u(2,(e,n)=>Ua(t)(n.maximum,Ba(t)(n.minimum,e))),Vh=t=>u(2,(e,n)=>!Wh(t)(e,n.minimum)&&!Ka(t)(e,n.maximum)),w=()=>Na,S=Aa,B=Ta,P=Ca,te=u(2,(t,{onNone:e,onSome:n})=>B(t)?e():n(t.value)),At=u(2,(t,e)=>B(t)?e():t.value),C$=u(2,(t,e)=>B(t)?e():t),Qe=t=>t==null?w():S(t),ue=At(ya),Hh=u(2,(t,e)=>{if(P(t))return t.value;throw e()}),Gh=Hh(()=>new Error("getOrThrow called on a None")),wn=u(2,(t,e)=>B(t)?w():S(e(t.value))),za=u(2,(t,e)=>B(t)?w():e(t.value)),Yh=t=>e=>t(e)?S(e):w(),Qh=t=>u(2,(e,n)=>B(e)?!1:t(e.value,n)),Xh=$a(),Zh=Qh(Xh),tg=t=>!t,dt=Bh,Mt=Uh,bn=Da,Sn=ja,eg=u(2,(t,{onLeft:e,onRight:n})=>bn(t)?e(t.left):n(t.right)),ng=eg({onLeft:U,onRight:U}),rg=t=>t.length>0,ec=(t,e)=>{const n=Math.max(1,Math.floor(t)),r=[e(0)];for(let s=1;s<n;s++)r.push(e(s));return r},sg=(t,e)=>t<=e?ec(e-t+1,n=>t+n):[t],nt=t=>Array.isArray(t)?t:Array.from(t),og=u(2,(t,{onEmpty:e,onNonEmpty:n})=>Dt(t)?n(t):e()),xt=u(2,(t,e)=>[e,...t]),Wa=u(2,(t,e)=>[...t,e]),cg=t=>t.length===0,nc=cg,Dt=rg,Ja=(t,e)=>t<0||t>=e.length,ig=u(2,(t,e)=>{const n=Math.floor(e);return Ja(n,t)?w():S(t[n])}),Va=u(2,(t,e)=>{const n=Math.floor(e);if(Ja(n,t))throw new Error(`Index ${n} out of bounds`);return t[n]}),Ha=ig(0),Z=Va(0),ag=t=>Dt(t)?S(ug(t)):w(),ug=t=>t[t.length-1],de=t=>t.slice(1),hi=t=>Array.from(t).reverse(),Ga=u(2,(t,e)=>{const n=Array.from(t);return n.sort(e),n}),gi=u(2,(t,e)=>lg(t,e,(n,r)=>[n,r])),lg=u(3,(t,e,n)=>{const r=nt(t),s=nt(e);return Dt(r)&&Dt(s)?fg(s,n)(r):[]}),fg=u(3,(t,e,n)=>{const r=[n(Z(t),Z(e))],s=Math.min(t.length,e.length);for(let o=1;o<s;o++)r[o]=n(t[o],e[o]);return r}),hg=u(2,(t,e)=>{const n=[Z(t)],r=de(t);for(const s of r)n.every(o=>!e(s,o))&&n.push(s);return n}),N$=u(2,(t,e)=>{const n=Array.from(t);return e>=1&&Dt(n)?pg(n,e):nc(n)?[n,[]]:[[],n]}),gg=t=>t.slice(),pg=u(2,(t,e)=>{const n=Math.max(1,e);return n>=t.length?[gg(t),[]]:[xt(t.slice(1,n),Z(t)),t.slice(n)]}),En=()=>[],Et=t=>[t],Ce=u(2,(t,e)=>t.map(e)),dg=u(2,(t,e)=>{if(nc(t))return[];const n=[];for(let r=0;r<t.length;r++)n.push(...e(t[r],r));return n}),mg=dg(U),Ya=u(2,(t,e)=>{const n=nt(t),r=[];for(let s=0;s<n.length;s++){const o=e(n[s],s);P(o)&&r.push(o.value)}return r}),Ht=u(3,(t,e,n)=>nt(t).reduce((r,s,o)=>n(r,s,o),e)),pi=(t,e)=>{const n=[];let r=t,s;for(;P(s=e(r));){const[o,c]=s.value;n.push(o),r=c}return n},yg=Mh,_g=u(2,(t,e)=>{const n=nt(t);return Dt(n)?hg(e)(n):[]}),bg=_g($a()),Xe=u(2,(t,e)=>nt(t).join(e)),Sg=u(3,(t,e,n)=>{let r=e;const s=[];for(const o of t){const c=n(r,o);r=c[0],s.push(c[1])}return[r,s]}),Qa=Symbol.for("effect/Context/Tag"),vg="effect/STM",wg=Symbol.for(vg),$g={...ts,_tag:"Tag",_op:"Tag",[wg]:Ae,[Qa]:{_S:t=>t,_I:t=>t},toString(){return G(this.toJSON())},toJSON(){return{_id:"Tag",identifier:this.identifier,stack:this.stack}},[J](){return this.toJSON()},of(t){return t},context(t){return tu(this,t)}},Ls=L("effect/Context/Tag/tagRegistry",()=>new Map),kg=t=>{if(t&&Ls.has(t))return Ls.get(t);const e=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=e;const r=Object.create($g);return Object.defineProperty(r,"stack",{get(){return n.stack}}),t&&(r.identifier=t,Ls.set(t,r)),r},Xa=Symbol.for("effect/Context"),Eg={[Xa]:{_S:t=>t},[T](t){if(Za(t)&&this.unsafeMap.size===t.unsafeMap.size){for(const e of this.unsafeMap.keys())if(!t.unsafeMap.has(e)||!F(this.unsafeMap.get(e),t.unsafeMap.get(e)))return!1;return!0}return!1},[R](){return Go(this.unsafeMap.size)},pipe(){return $(this,arguments)},toString(){return G(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(W)}},[J](){return this.toJSON()}},jt=t=>{const e=Object.create(Eg);return e.unsafeMap=t,e},Ig=t=>{const e=new Error(`Service not found${t.identifier?`: ${String(t.identifier)}`:""}`);if(t.stack){const n=t.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(e.message=e.message+` (defined at ${r[1]})`)}}if(e.stack){const n=e.stack.split(`
`);n.splice(1,3),e.stack=n.join(`
`)}return e},Za=t=>M(t,Xa),Og=t=>M(t,Qa),Fg=jt(new Map),Mg=()=>Fg,tu=(t,e)=>jt(new Map([[t,e]])),Rg=u(3,(t,e,n)=>{const r=new Map(t.unsafeMap);return r.set(e,n),jt(r)}),eu=u(2,(t,e)=>{if(!t.unsafeMap.has(e))throw Ig(e);return t.unsafeMap.get(e)}),Tg=eu,Cg=u(2,(t,e)=>t.unsafeMap.has(e)?Aa(t.unsafeMap.get(e)):Na),Ng=u(2,(t,e)=>{const n=new Map(t.unsafeMap);for(const[r,s]of e.unsafeMap)n.set(r,s);return jt(n)}),Ag=(...t)=>e=>{const n=new Set(t),r=new Map;for(const[s,o]of e.unsafeMap.entries())n.has(s)&&r.set(s,o);return jt(r)},Pg=(...t)=>e=>{const n=new Map(e.unsafeMap);for(const r of t)n.delete(r);return jt(n)},St=kg,Lg=jt,nu=Za,rc=Og,es=Mg,ns=tu,Bt=Rg,Jt=Tg,sc=eu,Ze=Cg,rs=Ng,xg=Ag,Dg=Pg,jg=Object.freeze(Object.defineProperty({__proto__:null,Tag:St,add:Bt,empty:es,get:Jt,getOption:Ze,isContext:nu,isTag:rc,make:ns,merge:rs,omit:Dg,pick:xg,unsafeGet:sc,unsafeMake:Lg},Symbol.toStringTag,{value:"Module"})),ru=Symbol.for("effect/Chunk");function qg(t,e,n,r,s){for(let o=e;o<Math.min(t.length,e+s);o++)n[r+o-e]=t[o];return n}const su=[],Kg=t=>Qo((e,n)=>e.length===n.length&&Pt(e).every((r,s)=>t(r,Vt(n,s)))),Ug=Kg(F),Bg={[ru]:{_A:t=>t},toString(){return G(this.toJSON())},toJSON(){return{_id:"Chunk",values:Pt(this).map(W)}},[J](){return this.toJSON()},[T](t){return ou(t)&&Ug(this,t)},[R](){return Yo(Pt(this))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return su[Symbol.iterator]();default:return Pt(this)[Symbol.iterator]()}},pipe(){return $(this,arguments)}},z=t=>{const e=Object.create(Bg);switch(e.backing=t,t._tag){case"IEmpty":{e.length=0,e.depth=0,e.left=e,e.right=e;break}case"IConcat":{e.length=t.left.length+t.right.length,e.depth=1+Math.max(t.left.depth,t.right.depth),e.left=t.left,e.right=t.right;break}case"IArray":{e.length=t.array.length,e.depth=0,e.left=_t,e.right=_t;break}case"ISingleton":{e.length=1,e.depth=0,e.left=_t,e.right=_t;break}case"ISlice":{e.length=t.length,e.depth=t.chunk.depth+1,e.left=_t,e.right=_t;break}}return e},ou=t=>M(t,ru),_t=z({_tag:"IEmpty"}),Rt=()=>_t,ft=t=>z({_tag:"ISingleton",a:t}),Kn=t=>ou(t)?t:z({_tag:"IArray",array:nt(t)}),Ys=(t,e,n)=>{switch(t.backing._tag){case"IArray":{qg(t.backing.array,0,e,n,t.length);break}case"IConcat":{Ys(t.left,e,n),Ys(t.right,e,n+t.left.length);break}case"ISingleton":{e[n]=t.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<t.length;)e[s]=Vt(t,r),r+=1,s+=1;break}}},Pt=t=>{switch(t.backing._tag){case"IEmpty":return su;case"IArray":return t.backing.array;default:{const e=new Array(t.length);return Ys(t,e,0),t.backing={_tag:"IArray",array:e},t.left=_t,t.right=_t,t.depth=0,e}}},Pe=t=>{switch(t.backing._tag){case"IEmpty":case"ISingleton":return t;case"IArray":return z({_tag:"IArray",array:hi(t.backing.array)});case"IConcat":return z({_tag:"IConcat",left:Pe(t.backing.right),right:Pe(t.backing.left)});case"ISlice":return vt(hi(Pt(t)))}},cu=u(2,(t,e)=>e<0||e>=t.length?w():S(Vt(t,e))),vt=t=>z({_tag:"IArray",array:t}),Vt=u(2,(t,e)=>{switch(t.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(e!==0)throw new Error("Index out of bounds");return t.backing.a}case"IArray":{if(e>=t.length||e<0)throw new Error("Index out of bounds");return t.backing.array[e]}case"IConcat":return e<t.left.length?Vt(t.left,e):Vt(t.right,e-t.left.length);case"ISlice":return Vt(t.backing.chunk,e+t.backing.offset)}}),zg=u(2,(t,e)=>iu(t,ft(e))),yt=u(2,(t,e)=>iu(ft(e),t)),Qs=u(2,(t,e)=>{if(e<=0)return _t;if(e>=t.length)return t;switch(t.backing._tag){case"ISlice":return z({_tag:"ISlice",chunk:t.backing.chunk,length:e,offset:t.backing.offset});case"IConcat":return e>t.left.length?z({_tag:"IConcat",left:t.left,right:Qs(t.right,e-t.left.length)}):Qs(t.left,e);default:return z({_tag:"ISlice",chunk:t,offset:0,length:e})}}),In=u(2,(t,e)=>{if(e<=0)return t;if(e>=t.length)return _t;switch(t.backing._tag){case"ISlice":return z({_tag:"ISlice",chunk:t.backing.chunk,offset:t.backing.offset+e,length:t.backing.length-e});case"IConcat":return e>t.left.length?In(t.right,e-t.left.length):z({_tag:"IConcat",left:In(t.left,e),right:t.right});default:return z({_tag:"ISlice",chunk:t,offset:e,length:t.length-e})}}),Nt=u(2,(t,e)=>{if(t.backing._tag==="IEmpty")return e;if(e.backing._tag==="IEmpty")return t;const n=e.depth-t.depth;if(Math.abs(n)<=1)return z({_tag:"IConcat",left:t,right:e});if(n<-1)if(t.left.depth>=t.right.depth){const r=Nt(t.right,e);return z({_tag:"IConcat",left:t.left,right:r})}else{const r=Nt(t.right.right,e);if(r.depth===t.depth-3){const s=z({_tag:"IConcat",left:t.right.left,right:r});return z({_tag:"IConcat",left:t.left,right:s})}else{const s=z({_tag:"IConcat",left:t.left,right:t.right.left});return z({_tag:"IConcat",left:s,right:r})}}else if(e.right.depth>=e.left.depth){const r=Nt(t,e.left);return z({_tag:"IConcat",left:r,right:e.right})}else{const r=Nt(t,e.left.left);if(r.depth===e.depth-3){const s=z({_tag:"IConcat",left:r,right:e.left.right});return z({_tag:"IConcat",left:s,right:e.right})}else{const s=z({_tag:"IConcat",left:e.left.right,right:e.right});return z({_tag:"IConcat",left:r,right:s})}}}),iu=u(2,(t,e)=>Nt(t,e)),A$=u(2,(t,e)=>vt(Ya(t,e))),P$=u(2,(t,e)=>vt(Ya(t,Yh(e)))),oc=t=>t.length===0,me=t=>t.length>0,xs=cu(0),On=t=>Vt(t,0),ye=On,L$=t=>cu(t,t.length-1),Wg=t=>Vt(t,t.length-1),au=u(2,(t,e)=>t.backing._tag==="ISingleton"?ft(e(t.backing.a,0)):vt(l(Pt(t),Ce((n,r)=>e(n,r))))),x$=u(3,(t,e,n)=>{const[r,s]=Sg(t,e,n);return[r,vt(s)]}),D$=t=>t.length,Xs=u(2,(t,e)=>vt(Ga(Pt(t),e))),Jg=u(2,(t,e)=>[Qs(t,e),In(t,e)]),Vg=u(2,(t,e)=>{let n=0;for(const r of Pt(t)){if(e(r))break;n++}return Jg(t,n)}),zt=t=>In(t,1),Hg=t=>vt(bg(Pt(t))),Gg=u(2,(t,e)=>Kn(ec(t,e))),j$=(t,e)=>t<=e?Gg(e-t+1,n=>t+n):ft(t),q$=u(2,(t,e)=>nt(t).every(e)),K$=u(2,(t,e)=>nt(t).some(e)),U$=Ht,_e=5,cc=Math.pow(2,_e),Yg=cc-1,Qg=cc/2,Xg=cc/4;function Zg(t){return t-=t>>1&1431655765,t=(t&858993459)+(t>>2&858993459),t=t+(t>>4)&252645135,t+=t>>8,t+=t>>16,t&127}function Le(t,e){return e>>>t&Yg}function Te(t){return 1<<t}function uu(t,e){return Zg(t&e-1)}class tp{constructor(e,n){f(this,"value");f(this,"previous");this.value=e,this.previous=n}}function Ne(t,e,n,r){let s=r;if(!t){const o=r.length;s=new Array(o);for(let c=0;c<o;++c)s[c]=r[c]}return s[e]=n,s}function lu(t,e,n){const r=n.length-1;let s=0,o=0,c=n;if(t)s=o=e;else for(c=new Array(r);s<e;)c[o++]=n[s++];for(++s;s<=r;)c[o++]=n[s++];return t&&(c.length=r),c}function ep(t,e,n,r){const s=r.length;if(t){let a=s;for(;a>=e;)r[a--]=r[a];return r[e]=n,r}let o=0,c=0;const i=new Array(s+1);for(;o<e;)i[c++]=r[o++];for(i[e]=n;o<s;)i[++c]=r[o++];return i}class Gt{constructor(){f(this,"_tag","EmptyNode")}modify(e,n,r,s,o,c){const i=r(w());return B(i)?new Gt:(++c.value,new ge(e,s,o,i))}}function bt(t){return ba(t,"EmptyNode")}function np(t){return bt(t)||t._tag==="LeafNode"||t._tag==="CollisionNode"}function ss(t,e){return bt(t)?!1:e===t.edit}class ge{constructor(e,n,r,s){f(this,"edit");f(this,"hash");f(this,"key");f(this,"value");f(this,"_tag","LeafNode");this.edit=e,this.hash=n,this.key=r,this.value=s}modify(e,n,r,s,o,c){if(F(o,this.key)){const a=r(this.value);return a===this.value?this:B(a)?(--c.value,new Gt):ss(this,e)?(this.value=a,this):new ge(e,s,o,a)}const i=r(w());return B(i)?this:(++c.value,fu(e,n,this.hash,this,s,new ge(e,s,o,i)))}}class ic{constructor(e,n,r){f(this,"edit");f(this,"hash");f(this,"children");f(this,"_tag","CollisionNode");this.edit=e,this.hash=n,this.children=r}modify(e,n,r,s,o,c){if(s===this.hash){const a=ss(this,e),h=this.updateCollisionList(a,e,this.hash,this.children,r,o,c);return h===this.children?this:h.length>1?new ic(e,this.hash,h):h[0]}const i=r(w());return B(i)?this:(++c.value,fu(e,n,this.hash,this,s,new ge(e,s,o,i)))}updateCollisionList(e,n,r,s,o,c,i){const a=s.length;for(let d=0;d<a;++d){const p=s[d];if("key"in p&&F(c,p.key)){const m=p.value,b=o(m);return b===m?s:B(b)?(--i.value,lu(e,d,s)):Ne(e,d,new ge(n,r,c,b),s)}}const h=o(w());return B(h)?s:(++i.value,Ne(e,a,new ge(n,r,c,h),s))}}class xe{constructor(e,n,r){f(this,"edit");f(this,"mask");f(this,"children");f(this,"_tag","IndexedNode");this.edit=e,this.mask=n,this.children=r}modify(e,n,r,s,o,c){const i=this.mask,a=this.children,h=Le(n,s),d=Te(h),p=uu(i,d),m=i&d,b=ss(this,e);if(!m){const kt=new Gt().modify(e,n+_e,r,s,o,c);return kt?a.length>=Qg?sp(e,h,kt,i,a):new xe(e,i|d,ep(b,p,kt,a)):this}const v=a[p],x=v.modify(e,n+_e,r,s,o,c);if(v===x)return this;let q=i,K;if(bt(x)){if(q&=~d,!q)return new Gt;if(a.length<=2&&np(a[p^1]))return a[p^1];K=lu(b,p,a)}else K=Ne(b,p,x,a);return b?(this.mask=q,this.children=K,this):new xe(e,q,K)}}class ac{constructor(e,n,r){f(this,"edit");f(this,"size");f(this,"children");f(this,"_tag","ArrayNode");this.edit=e,this.size=n,this.children=r}modify(e,n,r,s,o,c){let i=this.size;const a=this.children,h=Le(n,s),d=a[h],p=(d||new Gt).modify(e,n+_e,r,s,o,c);if(d===p)return this;const m=ss(this,e);let b;if(bt(d)&&!bt(p))++i,b=Ne(m,h,p,a);else if(!bt(d)&&bt(p)){if(--i,i<=Xg)return rp(e,i,h,a);b=Ne(m,h,new Gt,a)}else b=Ne(m,h,p,a);return m?(this.size=i,this.children=b,this):new ac(e,i,b)}}function rp(t,e,n,r){const s=new Array(e-1);let o=0,c=0;for(let i=0,a=r.length;i<a;++i)if(i!==n){const h=r[i];h&&!bt(h)&&(s[o++]=h,c|=1<<i)}return new xe(t,c,s)}function sp(t,e,n,r,s){const o=[];let c=r,i=0;for(let a=0;c;++a)c&1&&(o[a]=s[i++]),c>>>=1;return o[e]=n,new ac(t,i+1,o)}function op(t,e,n,r,s,o){if(n===s)return new ic(t,n,[o,r]);const c=Le(e,n),i=Le(e,s);if(c===i)return a=>new xe(t,Te(c)|Te(i),[a]);{const a=c<i?[r,o]:[o,r];return new xe(t,Te(c)|Te(i),a)}}function fu(t,e,n,r,s,o){let c,i=e;for(;;){const a=op(t,i,n,r,s,o);if(typeof a=="function")c=new tp(a,c),i=i+_e;else{let h=a;for(;c!=null;)h=c.value(h),c=c.previous;return h}}}const hu="effect/HashMap",Zs=Symbol.for(hu),cp={[Zs]:Zs,[Symbol.iterator](){return new os(this,(t,e)=>[t,e])},[R](){let t=y(hu);for(const e of this)t^=l(y(e[0]),I(y(e[1])));return t},[T](t){if(up(t)){if(t._size!==this._size)return!1;for(const e of this){const n=l(t,lc(e[0],y(e[0])));if(B(n))return!1;if(!F(e[1],n.value))return!1}return!0}return!1},toString(){return G(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(W)}},[J](){return this.toJSON()},pipe(){return $(this,arguments)}},uc=(t,e,n,r)=>{const s=Object.create(cp);return s._editable=t,s._edit=e,s._root=n,s._size=r,s};class os{constructor(e,n){f(this,"map");f(this,"f");f(this,"v");this.map=e,this.f=n,this.v=gu(this.map._root,this.f,void 0)}next(){if(B(this.v))return{done:!0,value:void 0};const e=this.v.value;return this.v=Rr(e.cont),{done:!1,value:e.value}}[Symbol.iterator](){return new os(this.map,this.f)}}const Rr=t=>t?pu(t[0],t[1],t[2],t[3],t[4]):w(),gu=(t,e,n=void 0)=>{switch(t._tag){case"LeafNode":return P(t.value)?S({value:e(t.key,t.value.value),cont:n}):Rr(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=t.children;return pu(r.length,r,0,e,n)}default:return Rr(n)}},pu=(t,e,n,r,s)=>{for(;n<t;){const o=e[n++];if(o&&!bt(o))return gu(o,r,[t,e,n,r,s])}return Rr(s)},ip=uc(!1,0,new Gt,0),cs=()=>ip,ap=(...t)=>du(t),du=t=>{const e=yu(cs());for(const n of t)Fn(e,n[0],n[1]);return pp(e)},up=t=>M(t,Zs),lp=t=>t&&bt(t._root),fp=u(2,(t,e)=>lc(t,e,y(e))),lc=u(3,(t,e,n)=>{let r=t._root,s=0;for(;;)switch(r._tag){case"LeafNode":return F(e,r.key)?r.value:w();case"CollisionNode":{if(n===r.hash){const o=r.children;for(let c=0,i=o.length;c<i;++c){const a=o[c];if("key"in a&&F(e,a.key))return a.value}}return w()}case"IndexedNode":{const o=Le(s,n),c=Te(o);if(r.mask&c){r=r.children[uu(r.mask,c)],s+=_e;break}return w()}case"ArrayNode":{if(r=r.children[Le(s,n)],r){s+=_e;break}return w()}default:return w()}}),hp=u(2,(t,e)=>P(lc(t,e,y(e)))),Fn=u(3,(t,e,n)=>_u(t,e,()=>S(n))),gp=u(3,(t,e,n)=>t._editable?(t._root=e,t._size=n,t):e===t._root?t:uc(t._editable,t._edit,e,n)),mu=t=>new os(t,e=>e),Tr=t=>t._size,yu=t=>uc(!0,t._edit+1,t._root,t._size),pp=t=>(t._editable=!1,t),_u=u(3,(t,e,n)=>dp(t,e,y(e),n)),dp=u(4,(t,e,n,r)=>{const s={value:t._size},o=t._root.modify(t._editable?t._edit:NaN,0,r,n,e,s);return l(t,gp(o,s.value))}),di=u(2,(t,e)=>_u(t,e,w)),mp=u(2,(t,e)=>is(t,cs(),(n,r,s)=>Fn(n,s,e(r,s)))),yp=u(2,(t,e)=>is(t,void 0,(n,r,s)=>e(r,s))),is=u(3,(t,e,n)=>{const r=t._root;if(r._tag==="LeafNode")return P(r.value)?n(e,r.value.value,r.key):e;if(r._tag==="EmptyNode")return e;const s=[r.children];let o;for(;o=s.pop();)for(let c=0,i=o.length;c<i;){const a=o[c++];a&&!bt(a)&&(a._tag==="LeafNode"?P(a.value)&&(e=n(e,a.value.value,a.key)):s.push(a.children))}return e}),bu="effect/HashSet",to=Symbol.for(bu),_p={[to]:to,[Symbol.iterator](){return mu(this._keyMap)},[R](){return I(y(this._keyMap))(y(bu))},[T](t){return Su(t)?Tr(this._keyMap)===Tr(t._keyMap)&&F(this._keyMap,t._keyMap):!1},toString(){return G(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(W)}},[J](){return this.toJSON()},pipe(){return $(this,arguments)}},as=t=>{const e=Object.create(_p);return e._keyMap=t,e},Su=t=>M(t,to),bp=as(cs()),us=()=>bp,Sp=t=>{const e=fc(us());for(const n of t)Mn(e,n);return hc(e)},vp=(...t)=>{const e=fc(us());for(const n of t)Mn(e,n);return hc(e)},wp=u(2,(t,e)=>hp(t._keyMap,e)),$p=t=>Tr(t._keyMap),fc=t=>as(yu(t._keyMap)),hc=t=>(t._keyMap._editable=!1,t),vu=u(2,(t,e)=>{const n=fc(t);return e(n),hc(n)}),Mn=u(2,(t,e)=>t._keyMap._editable?(Fn(e,!0)(t._keyMap),t):as(Fn(e,!0)(t._keyMap))),wu=u(2,(t,e)=>t._keyMap._editable?(di(e)(t._keyMap),t):as(di(e)(t._keyMap))),kp=u(2,(t,e)=>vu(t,n=>{for(const r of e)wu(n,r)})),Ep=u(2,(t,e)=>vu(us(),n=>{Ip(t,r=>Mn(n,r));for(const r of e)Mn(n,r)})),Ip=u(2,(t,e)=>yp(t._keyMap,(n,r)=>e(r))),Op=u(3,(t,e,n)=>is(t._keyMap,e,(r,s,o)=>n(r,o))),Fp=Su,Tt=us,gc=Sp,ls=vp,Mp=wp,pc=$p,$n=Mn,$u=wu,mi=kp,Yt=Ep,Cr=Op,yi=Symbol.for("effect/MutableRef"),Rp={[yi]:yi,toString(){return G(this.toJSON())},toJSON(){return{_id:"MutableRef",current:W(this.current)}},[J](){return this.toJSON()},pipe(){return $(this,arguments)}},tn=t=>{const e=Object.create(Rp);return e.current=t,e},Tp=u(3,(t,e,n)=>F(e,t.current)?(t.current=n,!0):!1),qt=t=>t.current,Cp=t=>Pp(t,e=>e+1),ke=u(2,(t,e)=>(t.current=e,t)),Np=u(2,(t,e)=>(t.current=e,t.current)),Ap=u(2,(t,e)=>ke(t,e(qt(t)))),Pp=u(2,(t,e)=>Np(t,e(qt(t)))),fs="effect/FiberId",be=Symbol.for(fs),Rn="None",eo="Runtime",no="Composite";var Bw;let Lp=class{constructor(){f(this,Bw,be);f(this,"_tag",Rn)}[(Bw=be,R)](){return l(y(fs),I(y(this._tag)))}[T](e){return dc(e)&&e._tag===Rn}toString(){return G(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[J](){return this.toJSON()}};var zw;class xp{constructor(e,n){f(this,"id");f(this,"startTimeMillis");f(this,zw,be);f(this,"_tag",eo);this.id=e,this.startTimeMillis=n}[(zw=be,R)](){return l(y(fs),I(y(this._tag)),I(y(this.id)),I(y(this.startTimeMillis)))}[T](e){return dc(e)&&e._tag===eo&&this.id===e.id&&this.startTimeMillis===e.startTimeMillis}toString(){return G(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[J](){return this.toJSON()}}var Ww;class Dp{constructor(e,n){f(this,"left");f(this,"right");f(this,Ww,be);f(this,"_tag",no);this.left=e,this.right=n}[(Ww=be,R)](){return l(y(fs),I(y(this._tag)),I(y(this.left)),I(y(this.right)))}[T](e){return dc(e)&&e._tag===no&&F(this.left,e.left)&&F(this.right,e.right)}toString(){return G(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,left:W(this.left),right:W(this.right)}}[J](){return this.toJSON()}}const jp=new Lp,dc=t=>M(t,be),qp=u(2,(t,e)=>t._tag===Rn?e:e._tag===Rn?t:new Dp(t,e)),ro=t=>{switch(t._tag){case Rn:return Tt();case eo:return ls(t.id);case no:return l(ro(t.left),Yt(ro(t.right)))}},_i=L(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>tn(0)),ku=t=>Array.from(ro(t)).map(n=>`#${n}`).join(","),Kp=()=>{const t=qt(_i);return l(_i,ke(t+1)),new xp(t,new Date().getTime())},Un=jp,Up=qp,Bp=ku,Eu=Kp,hs=cs,zp=ap,Iu=du,Wp=lp,mc=fp,yc=Fn,Ou=mu,Jp=Tr,Fu=mp,Mu=is,Tn=Symbol.for("effect/List"),Nr=t=>Array.from(t),Vp=t=>Fh(yg(t),Nr),Hp=Vp(F),Gp={[Tn]:Tn,_tag:"Cons",toString(){return G(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:Nr(this).map(W)}},[J](){return this.toJSON()},[T](t){return Tu(t)&&this._tag===t._tag&&Hp(this,t)},[R](){return Yo(Nr(this))},[Symbol.iterator](){let t=!1,e=this;return{next(){if(t)return this.return();if(e._tag==="Nil")return t=!0,this.return();const n=e.head;return e=e.tail,{done:t,value:n}},return(n){return t||(t=!0),{done:!0,value:n}}}},pipe(){return $(this,arguments)}},Ar=(t,e)=>{const n=Object.create(Gp);return n.head=t,n.tail=e,n},Yp={[Tn]:Tn,_tag:"Nil",toString(){return G(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[J](){return this.toJSON()},[R](){return Yo(Nr(this))},[T](t){return Tu(t)&&this._tag===t._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return $(this,arguments)}},Ru=Object.create(Yp),Tu=t=>M(t,Tn),Lt=t=>t._tag==="Nil",Cu=t=>t._tag==="Cons",Qp=()=>Ru,Se=(t,e)=>Ar(t,e),ve=Qp,_c=t=>Ar(t,Ru),Xp=u(2,(t,e)=>Zp(e,t)),Nu=u(2,(t,e)=>Se(e,t)),Zp=u(2,(t,e)=>{if(Lt(t))return e;if(Lt(e))return t;{const n=Ar(e.head,t);let r=n,s=e.tail;for(;!Lt(s);){const o=Ar(s.head,t);r.tail=o,r=o,s=s.tail}return n}}),td=u(3,(t,e,n)=>{let r=e,s=t;for(;!Lt(s);)r=n(r,s.head),s=s.tail;return r}),ed=t=>{let e=ve(),n=t;for(;!Lt(n);)e=Nu(e,n.head),n=n.tail;return e},nd=Symbol.for("effect/DifferContextPatch");function bi(t){return t}const Bn={...Xo.prototype,[nd]:{_Value:bi,_Patch:bi}},rd=Object.assign(Object.create(Bn),{_tag:"Empty"}),sd=Object.create(rd),Au=()=>sd,od=Object.assign(Object.create(Bn),{_tag:"AndThen"}),cd=(t,e)=>{const n=Object.create(od);return n.first=t,n.second=e,n},id=Object.assign(Object.create(Bn),{_tag:"AddService"}),ad=(t,e)=>{const n=Object.create(id);return n.tag=t,n.service=e,n},ud=Object.assign(Object.create(Bn),{_tag:"RemoveService"}),ld=t=>{const e=Object.create(ud);return e.tag=t,e},fd=Object.assign(Object.create(Bn),{_tag:"UpdateService"}),hd=(t,e)=>{const n=Object.create(fd);return n.tag=t,n.update=e,n},gd=(t,e)=>{const n=new Map(t.unsafeMap);let r=Au();for(const[s,o]of e.unsafeMap.entries())if(n.has(s)){const c=n.get(s);n.delete(s),F(c,o)||(r=vr(hd(s,()=>o))(r))}else n.delete(s),r=vr(ad(s,o))(r);for(const[s]of n.entries())r=vr(ld(s))(r);return r},vr=u(2,(t,e)=>cd(t,e)),pd=u(2,(t,e)=>{let n=!1,r=ft(t);const s=new Map(e.unsafeMap);for(;me(r);){const c=ye(r),i=zt(r);switch(c._tag){case"Empty":{r=i;break}case"AddService":{s.set(c.tag,c.service),r=i;break}case"AndThen":{r=yt(yt(i,c.second),c.first);break}case"RemoveService":{s.delete(c.tag),r=i;break}case"UpdateService":{s.set(c.tag,c.update(s.get(c.tag))),n=!0,r=i;break}}}if(!n)return jt(s);const o=new Map;for(const[c]of e.unsafeMap)s.has(c)&&(o.set(c,s.get(c)),s.delete(c));for(const[c,i]of s)o.set(c,i);return jt(o)}),dd=Symbol.for("effect/DifferHashSetPatch");function Ds(t){return t}const gs={...Xo.prototype,[dd]:{_Value:Ds,_Key:Ds,_Patch:Ds}},md=Object.assign(Object.create(gs),{_tag:"Empty"}),yd=Object.create(md),Pu=()=>yd,_d=Object.assign(Object.create(gs),{_tag:"AndThen"}),bd=(t,e)=>{const n=Object.create(_d);return n.first=t,n.second=e,n},Sd=Object.assign(Object.create(gs),{_tag:"Add"}),vd=t=>{const e=Object.create(Sd);return e.value=t,e},wd=Object.assign(Object.create(gs),{_tag:"Remove"}),$d=t=>{const e=Object.create(wd);return e.value=t,e},kd=(t,e)=>{const[n,r]=Cr([t,Pu()],([s,o],c)=>Mp(c)(s)?[$u(c)(s),o]:[s,so(vd(c))(o)])(e);return Cr(r,(s,o)=>so($d(o))(s))(n)},so=u(2,(t,e)=>bd(t,e)),Ed=u(2,(t,e)=>{let n=e,r=ft(t);for(;me(r);){const s=ye(r),o=zt(r);switch(s._tag){case"Empty":{r=o;break}case"AndThen":{r=yt(s.first)(yt(s.second)(o));break}case"Add":{n=$n(s.value)(n),r=o;break}case"Remove":n=$u(s.value)(n),r=o}}return n}),Id=Symbol.for("effect/Differ"),Od={[Id]:{_P:U,_V:U}},zn=t=>{const e=Object.create(Od);return e.empty=t.empty,e.diff=t.diff,e.combine=t.combine,e.patch=t.patch,e},Fd=()=>zn({empty:Au(),combine:(t,e)=>vr(e)(t),diff:(t,e)=>gd(t,e),patch:(t,e)=>pd(e)(t)}),Md=()=>zn({empty:Pu(),combine:(t,e)=>so(e)(t),diff:(t,e)=>kd(t,e),patch:(t,e)=>Ed(e)(t)}),Rd=()=>Td((t,e)=>e),Td=t=>zn({empty:U,combine:(e,n)=>e===U?n:n===U?e:r=>n(e(r)),diff:(e,n)=>F(e,n)?U:jn(n),patch:(e,n)=>t(n,e(n))}),Cn=255,Lu=8,oo=t=>t&Cn,co=t=>t>>Lu&Cn,Wn=(t,e)=>(t&Cn)+((e&t&Cn)<<Lu),Cd=Wn(0,0),Nd=t=>Wn(t,t),Ad=t=>Wn(t,0),Pd=u(2,(t,e)=>Wn(oo(t)&~e,co(t))),Ld=u(2,(t,e)=>t|e),xd=t=>~t>>>0&Cn,Dd=0,en=1<<0,jd=1<<1,xu=1<<2,io=1<<4,Du=1<<5,qd=t=>ps(t,Du),Kd=u(2,(t,e)=>t|e),Ut=t=>ju(t)&&!Bd(t),ju=t=>ps(t,en),ps=u(2,(t,e)=>(t&e)!==0),qu=(...t)=>t.reduce((e,n)=>e|n,0),Ud=qu(Dd),js=t=>ps(t,xu),Bd=t=>ps(t,io),De=u(2,(t,e)=>Wn(t^e,e)),ao=u(2,(t,e)=>t&(xd(oo(e))|co(e))|oo(e)&co(e)),Si=zn({empty:Cd,diff:(t,e)=>De(t,e),combine:(t,e)=>Ld(e)(t),patch:(t,e)=>ao(e,t)}),zd=Nd,Ku=Ad,vi=Pd,je=(t,e)=>({_tag:"Par",left:t,right:e}),gr=(t,e)=>({_tag:"Seq",left:t,right:e}),Wd=t=>{let e=_c(t),n=ve();for(;;){const[r,s]=td(e,[Uu(),ve()],([o,c],i)=>{const[a,h]=Jd(i);return[Bu(o,a),Xp(c,h)]});if(n=Vd(n,r),Lt(s))return ed(n);e=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},Jd=t=>{let e=t,n=Uu(),r=ve(),s=ve();for(;;)switch(e._tag){case"Empty":{if(Lt(r))return[n,s];e=r.head,r=r.tail;break}case"Par":{r=Se(e.right,r),e=e.left;break}case"Seq":{const o=e.left,c=e.right;switch(o._tag){case"Empty":{e=c;break}case"Par":{const i=o.left,a=o.right;e=je(gr(i,c),gr(a,c));break}case"Seq":{const i=o.left,a=o.right;e=gr(i,gr(a,c));break}case"Single":{e=o,s=Se(c,s);break}}break}case"Single":{if(n=Bu(n,Yd(e.dataSource,e.blockedRequest)),Lt(r))return[n,s];e=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},Vd=(t,e)=>{if(Lt(t))return _c(qs(e));if(Qd(e))return t;const n=rm(t.head),r=Xd(e);return n.length===1&&r.length===1&&F(n[0],r[0])?Se(nm(t.head,qs(e)),t.tail):Se(qs(e),t)},Hd=Symbol.for("effect/RequestBlock/RequestBlockParallel"),Gd={_R:t=>t};var Jw;class bc{constructor(e){f(this,"map");f(this,Jw,Gd);this.map=e}}Jw=Hd;const Uu=()=>new bc(hs()),Yd=(t,e)=>new bc(zp([t,Array.of(e)])),Bu=(t,e)=>new bc(Mu(t.map,e.map,(n,r,s)=>yc(n,s,te(mc(n,s),{onNone:()=>r,onSome:o=>[...o,...r]})))),Qd=t=>Wp(t.map),Xd=t=>Array.from(Ou(t.map)),qs=t=>em(Fu(t.map,e=>Array.of(e))),Zd=Symbol.for("effect/RequestBlock/RequestBlockSequential"),tm={_R:t=>t};var Vw;class zu{constructor(e){f(this,"map");f(this,Vw,tm);this.map=e}}Vw=Zd;const em=t=>new zu(t),nm=(t,e)=>new zu(Mu(e.map,t.map,(n,r,s)=>yc(n,s,te(mc(n,s),{onNone:()=>[],onSome:o=>[...o,...r]})))),rm=t=>Array.from(Ou(t.map)),sm=t=>Array.from(t.map),nn="Die",qe="Empty",rn="Fail",sn="Interrupt",Ke="Parallel",Ue="Sequential",Wu="effect/Cause",Ju=Symbol.for(Wu),om={_E:t=>t},on={[Ju]:om,[R](){return l(y(Wu),I(y(bm(this))))},[T](t){return Vu(t)&&_m(this,t)},pipe(){return $(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:W(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:W(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:W(this.left),right:W(this.right)}}},toString(){return ms(this)},[J](){return this.toJSON()}},Qt=(()=>{const t=Object.create(on);return t._tag=qe,t})(),we=t=>{const e=Object.create(on);return e._tag=rn,e.error=t,e},ct=t=>{const e=Object.create(on);return e._tag=nn,e.defect=t,e},Ft=t=>{const e=Object.create(on);return e._tag=sn,e.fiberId=t,e},ht=(t,e)=>{const n=Object.create(on);return n._tag=Ke,n.left=t,n.right=e,n},tt=(t,e)=>{const n=Object.create(on);return n._tag=Ue,n.left=t,n.right=e,n},Vu=t=>M(t,Ju),cm=t=>t._tag===nn,im=t=>t._tag===qe?!0:Be(t,!0,(e,n)=>{switch(n._tag){case qe:return S(e);case nn:case rn:case sn:return S(!1);default:return w()}}),am=t=>P(gm(t)),ds=t=>Sc(void 0,vm)(t),um=t=>Pe(Be(t,Rt(),(e,n)=>n._tag===rn?S(l(e,yt(n.error))):w())),Hu=t=>Pe(Be(t,Rt(),(e,n)=>n._tag===nn?S(l(e,yt(n.defect))):w())),lm=t=>Be(t,Tt(),(e,n)=>n._tag===sn?S(l(e,$n(n.fiberId))):w()),fm=t=>Yu(t,e=>e._tag===rn?S(e.error):w()),Gu=t=>{const e=fm(t);switch(e._tag){case"None":return dt(t);case"Some":return Mt(e.value)}},hm=t=>Jn(t,{onEmpty:S(Qt),onFail:e=>l(e,wn(we)),onDie:e=>S(ct(e)),onInterrupt:e=>S(Ft(e)),onSequential:(e,n)=>P(e)&&P(n)?S(tt(e.value,n.value)):B(e)&&P(n)?S(n.value):P(e)&&B(n)?S(e.value):w(),onParallel:(e,n)=>P(e)&&P(n)?S(ht(e.value,n.value)):B(e)&&P(n)?S(n.value):P(e)&&B(n)?S(e.value):w()}),gm=t=>Yu(t,e=>e._tag===sn?S(e.fiberId):w()),pm=t=>Jn(t,{onEmpty:w(),onFail:e=>S(ct(e)),onDie:e=>S(ct(e)),onInterrupt:()=>w(),onSequential:(e,n)=>P(e)&&P(n)?S(tt(e.value,n.value)):P(e)&&B(n)?S(e.value):B(e)&&P(n)?S(n.value):w(),onParallel:(e,n)=>P(e)&&P(n)?S(ht(e.value,n.value)):P(e)&&B(n)?S(e.value):B(e)&&P(n)?S(n.value):w()}),Pr=t=>Jn(t,{onEmpty:Qt,onFail:()=>Qt,onDie:e=>ct(e),onInterrupt:e=>Ft(e),onSequential:tt,onParallel:ht}),dm=t=>Jn(t,{onEmpty:Qt,onFail:e=>ct(e),onDie:e=>ct(e),onInterrupt:e=>Ft(e),onSequential:(e,n)=>tt(e,n),onParallel:(e,n)=>ht(e,n)}),mm=u(2,(t,e)=>ym(t,n=>we(e(n)))),ym=u(2,(t,e)=>Jn(t,{onEmpty:Qt,onFail:n=>e(n),onDie:n=>ct(n),onInterrupt:n=>Ft(n),onSequential:(n,r)=>tt(n,r),onParallel:(n,r)=>ht(n,r)})),_m=(t,e)=>{let n=ft(t),r=ft(e);for(;me(n)&&me(r);){const[s,o]=l(ye(n),Be([Tt(),Rt()],([a,h],d)=>{const[p,m]=uo(d);return S([l(a,Yt(p)),l(h,Nt(m))])})),[c,i]=l(ye(r),Be([Tt(),Rt()],([a,h],d)=>{const[p,m]=uo(d);return S([l(a,Yt(p)),l(h,Nt(m))])}));if(!F(s,c))return!1;n=o,r=i}return!0},bm=t=>Sm(ft(t),Rt()),Sm=(t,e)=>{for(;;){const[n,r]=l(t,Ht([Tt(),Rt()],([o,c],i)=>{const[a,h]=uo(i);return[l(o,Yt(a)),l(c,Nt(h))]})),s=pc(n)>0?l(e,yt(n)):e;if(oc(r))return Pe(s);t=r,e=s}throw new Error("BUG: Cause.flattenCauseLoop - please report an issue at https://github.com/Effect-TS/effect/issues")},Yu=u(2,(t,e)=>{const n=[t];for(;n.length>0;){const r=n.pop(),s=e(r);switch(s._tag){case"None":{switch(r._tag){case Ue:case Ke:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return w()}),uo=t=>{let e=t;const n=[];let r=Tt(),s=Rt();for(;e!==void 0;)switch(e._tag){case qe:{if(n.length===0)return[r,s];e=n.pop();break}case rn:{if(r=$n(r,e.error),n.length===0)return[r,s];e=n.pop();break}case nn:{if(r=$n(r,e.defect),n.length===0)return[r,s];e=n.pop();break}case sn:{if(r=$n(r,e.fiberId),n.length===0)return[r,s];e=n.pop();break}case Ue:{switch(e.left._tag){case qe:{e=e.right;break}case Ue:{e=tt(e.left.left,tt(e.left.right,e.right));break}case Ke:{e=ht(tt(e.left.left,e.right),tt(e.left.right,e.right));break}default:{s=yt(s,e.right),e=e.left;break}}break}case Ke:{n.push(e.right),e=e.left;break}}throw new Error("BUG: Cause.evaluateCauseLoop - please report an issue at https://github.com/Effect-TS/effect/issues")},vm={emptyCase:ii,failCase:Hs,dieCase:Hs,interruptCase:ii,sequentialCase:(t,e,n)=>e&&n,parallelCase:(t,e,n)=>e&&n},wi="SequentialCase",$i="ParallelCase",Jn=u(2,(t,{onDie:e,onEmpty:n,onFail:r,onInterrupt:s,onParallel:o,onSequential:c})=>Sc(t,void 0,{emptyCase:()=>n,failCase:(i,a)=>r(a),dieCase:(i,a)=>e(a),interruptCase:(i,a)=>s(a),sequentialCase:(i,a,h)=>c(a,h),parallelCase:(i,a,h)=>o(a,h)})),Be=u(3,(t,e,n)=>{let r=e,s=t;const o=[];for(;s!==void 0;){const c=n(r,s);switch(r=P(c)?c.value:r,s._tag){case Ue:{o.push(s.right),s=s.left;break}case Ke:{o.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&o.length>0&&(s=o.pop())}return r}),Sc=u(3,(t,e,n)=>{const r=[t],s=[];for(;r.length>0;){const c=r.pop();switch(c._tag){case qe:{s.push(dt(n.emptyCase(e)));break}case rn:{s.push(dt(n.failCase(e,c.error)));break}case nn:{s.push(dt(n.dieCase(e,c.defect)));break}case sn:{s.push(dt(n.interruptCase(e,c.fiberId)));break}case Ue:{r.push(c.right),r.push(c.left),s.push(Mt({_tag:wi}));break}case Ke:{r.push(c.right),r.push(c.left),s.push(Mt({_tag:$i}));break}}}const o=[];for(;s.length>0;){const c=s.pop();switch(c._tag){case"Left":{switch(c.left._tag){case wi:{const i=o.pop(),a=o.pop(),h=n.sequentialCase(e,i,a);o.push(h);break}case $i:{const i=o.pop(),a=o.pop(),h=n.parallelCase(e,i,a);o.push(h);break}}break}case"Right":{o.push(c.right);break}}}if(o.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return o.pop()}),vc=(t,e)=>{const n={value:e,enumerable:!0},r={...t,toString(){return`${this._tag}: ${this.message}`}};return s=>{const o={_tag:n};return dh(s)&&(o.message={value:s,enumerable:!0}),Object.create(r,o)}},ki=Symbol.for("effect/Cause/errors/RuntimeException"),wm=vc({[ki]:ki},"RuntimeException"),$m=Symbol.for("effect/Cause/errors/InterruptedException"),km=t=>M(t,$m),Ei=Symbol.for("effect/Cause/errors/IllegalArgument"),Qu=vc({[Ei]:Ei},"IllegalArgumentException"),Ii=Symbol.for("effect/Cause/errors/NoSuchElement"),Xu=vc({[Ii]:Ii},"NoSuchElementException"),Em=t=>{const e=t.split(`
`),n=[];for(let r=0;r<e.length;r++){if(e[r].includes("EffectPrimitive")||e[r].includes("Generator.next")||e[r].includes("FiberRuntime"))return n.join(`
`);n.push(e[r])}return n.join(`
`)},ms=t=>ds(t)?"All fibers interrupted without errors.":Zu(t).map(n=>{let r=n.message;if(n.stack&&(r+=`\r
${Em(n.stack)}`),n.span){let s=n.span,o=0;for(;s&&s._tag==="Span"&&o<10;)r+=`\r
    at ${s.name}`,s=ue(s.parent),o++}return r}).join(`\r
`);class Oi{constructor(e,n,r){f(this,"message");f(this,"stack");f(this,"span");this.message=e,this.stack=n,this.span=r}toJSON(){const e={message:this.message};return this.stack&&(e.stack=this.stack),this.span&&(e.span=this.span),e}}const Fi=t=>typeof t=="string"?`Error: ${t}`:M(t,"toString")&&Vo(t.toString)&&t.toString!==Object.prototype.toString?t.toString():`Error: ${JSON.stringify(t)}`,Mi=Symbol.for("effect/SpanAnnotation"),Ri=t=>{const e=M(t,Mi)&&t[Mi];return t instanceof Error?new Oi(Fi(t),t.stack?.split(`
`).filter(n=>n.match(/at (.*)/)).join(`
`),e):new Oi(Fi(t),void 0,e)},Zu=t=>Sc(t,void 0,{emptyCase:()=>[],dieCase:(e,n)=>[Ri(n)],failCase:(e,n)=>[Ri(n)],interruptCase:()=>[],parallelCase:(e,n,r)=>[...n,...r],sequentialCase:(e,n,r)=>[...n,...r]}),Vn="Pending",ys="Done",Im="effect/Deferred",Om=Symbol.for(Im),Fm={_E:t=>t,_A:t=>t},wc=t=>({_tag:Vn,joiners:t}),tl=t=>({_tag:ys,effect:t}),Ti=Symbol.for("effect/Tracer"),Mm=t=>({[Ti]:Ti,...t}),lo=St(Symbol.for("effect/Tracer")),el=St(Symbol.for("effect/ParentSpan")),Rm=L("effect/Tracer/SpanId.ids",()=>tn(0));class Tm{constructor(e,n,r,s,o){f(this,"name");f(this,"parent");f(this,"context");f(this,"links");f(this,"startTime");f(this,"_tag","Span");f(this,"spanId");f(this,"traceId","native");f(this,"sampled",!0);f(this,"status");f(this,"attributes");f(this,"events",[]);f(this,"end",(e,n)=>{this.status={_tag:"Ended",endTime:e,exit:n,startTime:this.status.startTime}});f(this,"attribute",(e,n)=>{this.attributes.set(e,n)});f(this,"event",(e,n,r)=>{this.events.push([e,n,r??{}])});this.name=e,this.parent=n,this.context=r,this.links=s,this.startTime=o,this.status={_tag:"Started",startTime:o},this.attributes=new Map,this.spanId=`span${Cp(Rm)}`}}const Cm=Mm({span:(t,e,n,r,s)=>new Tm(t,e,n,r,s),context:t=>t()}),Nm="effect/EffectError",fo=Symbol.for(Nm),Am=t=>M(t,fo),Pm=t=>({[fo]:fo,_tag:"EffectError",cause:t}),ot=(t,e)=>{const n=new st("Blocked");return n.i0=t,n.i1=e,n},Lm=t=>{const e=new st("RunBlocked");return e.i0=t,e},_s=Symbol.for("effect/Effect");class xm{constructor(e,n){f(this,"patch");f(this,"op");f(this,"_op",Zo);this.patch=e,this.op=n}}var Hw;class st{constructor(e){f(this,"_op");f(this,"i0");f(this,"i1");f(this,"i2");f(this,"trace");f(this,Hw,Ae);this._op=e}[(Hw=_s,T)](e){return this===e}[R](){return qn(this)}pipe(){return $(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,i0:W(this.i0),i1:W(this.i1),i2:W(this.i2)}}toString(){return G(this.toJSON())}[J](){return this.toJSON()}}var Gw;class nl{constructor(e){f(this,"_op");f(this,"i0");f(this,"i1");f(this,"i2");f(this,"trace");f(this,Gw,Ae);this._op=e,this._tag=e}[(Gw=_s,T)](e){return this===e}[R](){return qn(this)}get cause(){return this.i0}pipe(){return $(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return G(this.toJSON())}[J](){return this.toJSON()}}var Yw;class rl{constructor(e){f(this,"_op");f(this,"i0");f(this,"i1");f(this,"i2");f(this,"trace");f(this,Yw,Ae);this._op=e,this._tag=e}[(Yw=_s,T)](e){return this===e}[R](){return qn(this)}get value(){return this.i0}pipe(){return $(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:W(this.value)}}toString(){return G(this.toJSON())}[J](){return this.toJSON()}}const Xt=t=>M(t,_s),rt=t=>{const e=new st(Ia);return e.i0=t,e},Hn=u(3,(t,e,n)=>wt(r=>g(t,s=>g(mt(N(()=>r(We(e(s))))),o=>{if(o._tag==="Success"&&o.value._op==="Blocked"){const i=o.value;return ot(i.i0,Hn(k(s),()=>i.i1,n))}const c=vy(o);return N(()=>n(s,c)).pipe(X({onFailure:i=>{switch(c._tag){case Y:return j(ht(c.i0,i));case Q:return j(i)}},onSuccess:()=>c}))})))),it=u(2,(t,e)=>g(t,()=>k(e))),ut=t=>it(t,void 0),ze=(t,e=Un)=>N(()=>{let n,r;const s=new st(_r);if(t.length!==1){const o=new AbortController;r=o,s.i0=c=>{n=t(c,o.signal)}}else s.i0=o=>{n=t(o)};return s.i1=e,fl(s,()=>(r&&r.abort(),n??A))}),$c=(t,e=Un)=>ze(n=>{const r=t(n);if(Sn(r))n(r.right);else return r.left},e),sl=u(2,(t,e)=>{const n=new st(br);return n.i0=t,n.i1=e,n}),Lr=u(2,(t,e)=>Yn(t,{onFailure:e,onSuccess:k})),xr=Symbol.for("effect/SpanAnnotation"),Ci=Symbol.for("effect/OriginalAnnotation"),ol=(t,e)=>P(e)?new Proxy(t,{has(n,r){return r===xr||r===Ci||r in n},get(n,r){return r===xr?e.value:r===Ci?t:n[r]}}):t,kc=t=>Ho(t)&&!(xr in t)?rt(e=>j(ct(ol(t,vl(e))))):j(ct(t)),cl=t=>al(()=>ct(wm(t))),Dm=t=>g(_(t),kc),Nn=t=>Yn(t,{onFailure:e=>k(Mt(e)),onSuccess:e=>k(dt(e))}),mt=t=>ul(t,{onFailure:D,onSuccess:et}),V=t=>Ho(t)&&!(xr in t)?rt(e=>j(we(ol(t,vl(e))))):j(we(t)),il=t=>g(_(t),V),j=t=>{const e=new nl(Y);return e.i0=t,e},al=t=>g(_(t),j),Ec=rt(t=>k(t.id())),bs=t=>rt(e=>t(e.id())),g=u(2,(t,e)=>{const n=new st(Or);return n.i0=t,n.i1=e,n}),We=t=>{const e=new st("OnStep");return e.i0=t,e.i1=et,e},Ic=(t,e)=>{const n=new st("OnStep");return n.i0=t,n.i1=e,n},Gn=t=>g(t,U),ul=u(2,(t,{onFailure:e,onSuccess:n})=>X(t,{onFailure:r=>k(e(r)),onSuccess:r=>k(n(r))})),X=u(2,(t,{onFailure:e,onSuccess:n})=>{const r=new st(Fr);return r.i0=t,r.i1=e,r.i2=n,r}),Yn=u(2,(t,{onFailure:e,onSuccess:n})=>X(t,{onFailure:r=>{const s=um(r);return Hu(r).length>0?j(dm(r)):s.length>0?e(On(s)):j(r)},onSuccess:n})),Ot=u(2,(t,e)=>N(()=>{const n=nt(t),r=new Array(n.length);let s=0;return it(Dr({while:()=>s<n.length,body:()=>e(n[s],s),step:o=>{r[s++]=o}}),r)})),Qn=u(2,(t,e)=>N(()=>{const n=nt(t);let r=0;return Dr({while:()=>r<n.length,body:()=>e(n[r],r),step:()=>{r++}})})),jm=g(Ec,t=>ll(t)),ll=t=>j(Ft(t)),Je=t=>{const e=new st(Ye);e.i0=zd(en);const n=r=>r._tag==="Blocked"?ot(r.i0,Je(r.i1)):r;return e.i1=()=>Ic(t,n),e},qm=u(2,(t,e)=>wt(n=>g(mt(n(t)),r=>Ey(e,r)))),C=u(2,(t,e)=>g(t,n=>_(()=>e(n)))),Km=u(2,(t,{onFailure:e,onSuccess:n})=>Yn(t,{onFailure:r=>il(()=>e(r)),onSuccess:r=>_(()=>n(r))})),An=u(2,(t,e)=>X(t,{onFailure:n=>{const r=Gu(n);switch(r._tag){case"Left":return il(()=>e(r.left));case"Right":return j(r.right)}},onSuccess:k})),Pn=u(2,(t,e)=>wt(n=>X(n(t),{onFailure:r=>{const s=D(r);return X(e(s),{onFailure:o=>D(tt(r,o)),onSuccess:()=>s})},onSuccess:r=>{const s=et(r);return at(e(s),s)}}))),fl=u(2,(t,e)=>Pn(t,_l({onFailure:n=>ds(n)?ut(e(lm(n))):A,onSuccess:()=>A}))),Um=u(2,(t,e)=>Jm(t,e,k)),Bm=t=>zm(t,U),zm=u(2,(t,e)=>Yn(t,{onFailure:n=>kc(e(n)),onSuccess:k})),k=t=>{const e=new rl(Q);return e.i0=t,e},N=t=>g(_(t),U),_=t=>{const e=new st(Ea);return e.i0=t,e},cn=u(2,(t,e)=>g(t,n=>it(e(n),n))),Wm=t=>rt(e=>{const n=e.getFiberRef(po),r=l(n,At(()=>e.scope()));return t(an(po,S(r)))}),Jm=u(3,(t,e,n)=>X(t,{onFailure:r=>Hu(r).length>0?j(Gh(pm(r))):e(),onSuccess:n})),Ve=t=>{const e=new st(Ye);e.i0=Ku(en),e.i1=()=>Ic(t,n);const n=r=>r._tag==="Blocked"?ot(r.i0,Ve(r.i1)):r;return e},wt=t=>{const e=new st(Ye);e.i0=Ku(en);const n=r=>r._op==="Blocked"?ot(r.i0,Ve(r.i1)):r;return e.i1=r=>ju(r)?We(t(Je)):We(t(Ve)),g(e,n)},A=k(void 0),ho=t=>{const e=new st(Ye);return e.i0=t,e.i1=void 0,e},Vm=u(2,(t,e)=>g(e,n=>n?l(t,C(S)):k(w()))),Dr=t=>{const e=new st(Mr);return e.i0=t.while,e.i1=t.body,e.i2=t.step,e},Hm=u(2,(t,e)=>{const n=new st(Ye);return n.i0=e,n.i1=()=>t,n}),Xn=t=>{const e=new st(Sr);return typeof t?.priority<"u"?fy(e,t.priority):e},hl=u(2,(t,e)=>g(t,n=>C(e,r=>[n,r]))),Ss=u(2,(t,e)=>g(t,n=>it(e,n))),at=u(2,(t,e)=>g(t,()=>e)),Gm=u(3,(t,e,n)=>g(t,r=>C(e,s=>n(r,s)))),Zn=t=>g(Ec,e=>l(t,go(e))),go=u(2,(t,e)=>g(t.interruptAsFork(e),()=>t.await)),Ym={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return $(this,arguments)}},Qm={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return $(this,arguments)}},Xm={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return $(this,arguments)}},Zm={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return $(this,arguments)}},gl={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return $(this,arguments)}},pl={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return $(this,arguments)}},ty={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return $(this,arguments)}},ey={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return $(this,arguments)}},ny="effect/FiberRef",ry=Symbol.for(ny),sy={_A:t=>t},vs=t=>dl(t,e=>[e,e]),tr=u(2,(t,e)=>g(vs(t),e)),Ni=u(2,(t,e)=>dl(t,()=>[void 0,e])),dl=u(2,(t,e)=>rt(n=>{const[r,s]=e(n.getFiberRef(t));return n.setFiberRef(t,s),k(r)})),an=u(3,(t,e,n)=>g(Hn(Ss(vs(e),Ni(e,n)),()=>We(t),r=>Ni(e,r)),r=>r._op==="Blocked"?ot(r.i0,an(r.i1,e,n)):r)),oy=u(3,(t,e,n)=>tr(e,r=>an(t,e,n(r)))),gt=(t,e)=>er(t,{differ:Rd(),fork:e?.fork??U,join:e?.join}),ml=t=>{const e=Md();return er(t,{differ:e,fork:e.empty})},yl=t=>{const e=Fd();return er(t,{differ:e,fork:e.empty})},er=(t,e)=>({[ry]:sy,initial:t,diff:(n,r)=>e.differ.diff(n,r),combine:(n,r)=>e.differ.combine(n,r),patch:n=>r=>e.differ.patch(n,r),fork:e.fork,join:e.join??((n,r)=>r),pipe(){return $(this,arguments)}}),cy=t=>er(t,{differ:Si,fork:Si.empty}),ee=L(Symbol.for("effect/FiberRef/currentContext"),()=>yl(es())),ws=L(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>gt(0)),iy=L(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>gt(2048)),ay=L(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>gt(hs())),uy=L(Symbol.for("effect/FiberRef/currentLogLevel"),()=>gt(gl)),ly=L(Symbol.for("effect/FiberRef/currentLogSpan"),()=>gt(ve())),fy=u(2,(t,e)=>an(t,ws,e)),hy=L(Symbol.for("effect/FiberRef/currentConcurrency"),()=>gt("unbounded")),gy=L(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>gt(!0)),py=L(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>gt(S(pl))),Ks=L(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>ml(Tt())),po=L(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>gt(w(),{fork:()=>w(),join:(t,e)=>t})),pr=L(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>gt(Qt,{fork:()=>Qt,join:(t,e)=>t})),mo=Symbol.for("effect/Scope"),Ai=Symbol.for("effect/CloseableScope"),z$=(t,e)=>t.addFinalizer(()=>ut(e)),jr=(t,e)=>t.addFinalizer(e),qr=(t,e)=>t.close(e),Oc=(t,e)=>t.fork(e),Pi=u(2,(t,e)=>C(my(t,e),te({onNone:()=>()=>A,onSome:n=>r=>dy(n,r)(t)}))),dy=u(3,(t,e,n)=>N(()=>{switch(t.state._tag){case"Exited":return A;case"Running":{const r=t.state.finalizers.get(e);return t.state.finalizers.delete(e),r!=null?t.state.update(r)(n):A}}})),my=u(2,(t,e)=>N(()=>{switch(t.state._tag){case"Exited":return t.state.nextKey+=1,it(e(t.state.exit),w());case"Running":{const n=t.state.nextKey;return t.state.finalizers.set(n,e),t.state.nextKey+=1,k(S(n))}}})),yy=_(()=>({state:{_tag:"Running",nextKey:0,finalizers:new Map,update:U}})),_y=t=>t._tag==="Failure",W$=t=>t._tag==="Success",by=u(2,(t,e)=>{switch(t._tag){case Y:return D(t.i0);case Q:return et(e)}}),Us=t=>by(t,void 0),wr=(t,e)=>$y(t,e?.parallel?ht:tt),J$=t=>D(ct(t)),Li=t=>D(we(t)),D=t=>{const e=new nl(Y);return e.i0=t,e},Sy=u(2,(t,e)=>{switch(t._tag){case Y:return D(t.i0);case Q:return e(t.i0)}}),vy=t=>l(t,Sy(U)),wy=t=>D(Ft(t)),Bs=u(2,(t,e)=>{switch(t._tag){case Y:return D(t.i0);case Q:return et(e(t.i0))}}),_l=u(2,(t,{onFailure:e,onSuccess:n})=>{switch(t._tag){case Y:return e(t.i0);case Q:return n(t.i0)}}),Kr=u(2,(t,{onFailure:e,onSuccess:n})=>{switch(t._tag){case Y:return e(t.i0);case Q:return n(t.i0)}}),et=t=>{const e=new rl(Q);return e.i0=t,e},Wt=et(void 0),V$=u(2,(t,e)=>Fc(t,e,{onSuccess:(n,r)=>[n,r],onFailure:tt})),H$=u(2,(t,e)=>Fc(t,e,{onSuccess:(n,r)=>r,onFailure:tt})),Fc=u(3,(t,e,{onFailure:n,onSuccess:r})=>{switch(t._tag){case Y:switch(e._tag){case Q:return D(t.i0);case Y:return D(n(t.i0,e.i0))}case Q:switch(e._tag){case Q:return et(r(t.i0,e.i0));case Y:return D(e.i0)}}}),$y=(t,e)=>{const n=Kn(t);return me(n)?l(zt(n),Ht(l(ye(n),Bs(ft)),(r,s)=>l(r,Fc(s,{onSuccess:(o,c)=>l(o,yt(c)),onFailure:e}))),Bs(Pe),Bs(r=>Array.from(r)),S):w()},Mc=t=>({[Om]:Fm,state:tn(wc([])),blockingOn:t,pipe(){return $(this,arguments)}}),Rc=()=>g(Ec,t=>ky(t)),ky=t=>_(()=>Mc(t)),$s=t=>$c(e=>{const n=qt(t.state);switch(n._tag){case ys:return dt(n.effect);case Vn:return l(t.state,ke(wc([e,...n.joiners]))),Mt(Oy(t,e))}},t.blockingOn),nr=u(2,(t,e)=>_(()=>{const n=qt(t.state);switch(n._tag){case ys:return!1;case Vn:{l(t.state,ke(tl(e)));for(let r=0;r<n.joiners.length;r++)n.joiners[r](e);return!0}}})),Ey=u(2,(t,e)=>nr(t,e)),zs=u(2,(t,e)=>nr(t,V(e))),Tc=u(2,(t,e)=>nr(t,j(e))),G$=u(2,(t,e)=>nr(t,ll(e))),Iy=t=>_(()=>qt(t.state)._tag===ys),ks=u(2,(t,e)=>nr(t,k(e))),Cc=(t,e)=>{const n=qt(t.state);if(n._tag===Vn){l(t.state,ke(tl(e)));for(let r=n.joiners.length-1;r>=0;r--)n.joiners[r](e)}},Oy=(t,e)=>_(()=>{const n=qt(t.state);n._tag===Vn&&l(t.state,ke(wc(n.joiners.filter(r=>r!==e))))}),Fy=vs(ee),bl=()=>Fy,un=t=>g(bl(),t),Nc=u(2,(t,e)=>an(ee,e)(t)),Ac=u(2,(t,e)=>oy(ee,n=>rs(n,e))(t)),Sl=u(2,(t,e)=>un(n=>Nc(t,e(n)))),vl=t=>{const e=t.getFiberRef(ee).unsafeMap.get(el);return e!==void 0&&e._tag==="Span"?S(e):w()},Y$=Rc,My=$s,Q$=Tc,X$=Iy,Z$=ks,yo=Symbol.for("effect/Duration"),Ry=BigInt(1e3),xi=BigInt(1e9),Di=/^(-?\d+(?:\.\d+)?)\s+(nanos|micros|millis|seconds|minutes|hours|days|weeks)$/,H=t=>{if(Pc(t))return t;if(_a(t))return Br(t);if(mh(t))return Ur(t);{Di.lastIndex=0;const e=Di.exec(t);if(e){const[n,r,s]=e,o=Number(r);switch(s){case"nanos":return Ur(BigInt(r));case"micros":return $l(BigInt(r));case"millis":return Br(o);case"seconds":return kl(o);case"minutes":return El(o);case"hours":return Il(o);case"days":return Ol(o);case"weeks":return Fl(o)}}}throw new Error("Invalid duration input")},ji={_tag:"Millis",millis:0},Ty={_tag:"Infinity"},Cy={[yo]:yo,[R](){return wa(this.value)},[T](t){return Pc(t)&&Nl(this,t)},toString(){return G(this.toJSON())},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:Ml(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[J](){return this.toJSON()},pipe(){return $(this,arguments)}},lt=t=>{const e=Object.create(Cy);return _a(t)?isNaN(t)||t<0?e.value=ji:Number.isFinite(t)?Number.isInteger(t)?e.value={_tag:"Millis",millis:t}:e.value={_tag:"Nanos",nanos:BigInt(Math.round(t*1e6))}:e.value=Ty:t<BigInt(0)?e.value=ji:e.value={_tag:"Nanos",nanos:t},e},Pc=t=>M(t,yo),wl=lt(0),Ny=lt(1/0),Ur=t=>lt(t),$l=t=>lt(t*Ry),Br=t=>lt(t),kl=t=>lt(t*1e3),El=t=>lt(t*6e4),Il=t=>lt(t*36e5),Ol=t=>lt(t*864e5),Fl=t=>lt(t*6048e5),Ln=t=>{const e=H(t);switch(e.value._tag){case"Infinity":return 1/0;case"Nanos":return Number(e.value.nanos)/1e6;case"Millis":return e.value.millis}},Ay=t=>Ln(t)/1e3,Py=t=>{const e=H(t);switch(e.value._tag){case"Infinity":return w();case"Nanos":return S(e.value.nanos);case"Millis":return S(BigInt(Math.round(e.value.millis*1e6)))}},Ly=t=>{const e=H(t);switch(e.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return e.value.nanos;case"Millis":return BigInt(Math.round(e.value.millis*1e6))}},Ml=t=>{const e=H(t);switch(e.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(e.value.nanos/xi),Number(e.value.nanos%xi)];case"Millis":return[Math.floor(e.value.millis/1e3),Math.round(e.value.millis%1e3*1e6)]}},Rl=u(2,(t,e)=>{const n=H(t);switch(n.value._tag){case"Nanos":return e.onNanos(n.value.nanos);case"Infinity":return e.onMillis(1/0);case"Millis":return e.onMillis(n.value.millis)}}),ne=u(3,(t,e,n)=>{const r=H(t),s=H(e);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(Ln(r),Ln(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const o=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),c=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(o,c)}return n.onMillis(r.value.millis,s.value.millis)}),rr=tc((t,e)=>ne(t,e,{onMillis:(n,r)=>n<r?-1:n>r?1:0,onNanos:(n,r)=>n<r?-1:n>r?1:0})),xy=Vh(qa(rr,H)),Tl=(t,e)=>ne(t,e,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),Dy=Ua(rr),jy=u(2,(t,e)=>Dy(H(t),H(e))),qy=Ba(rr),Ky=u(2,(t,e)=>qy(H(t),H(e))),Uy=Jh(rr),By=u(2,(t,e)=>Uy(H(t),{minimum:H(e.minimum),maximum:H(e.maximum)})),zy=u(2,(t,e)=>Rl(t,{onMillis:n=>lt(n*e),onNanos:n=>lt(n*BigInt(e))})),Wy=u(2,(t,e)=>ne(t,e,{onMillis:(n,r)=>lt(n+r),onNanos:(n,r)=>lt(n+r)})),Jy=u(2,(t,e)=>ne(t,e,{onMillis:(n,r)=>n<r,onNanos:(n,r)=>n<r})),Vy=u(2,(t,e)=>ne(t,e,{onMillis:(n,r)=>n<=r,onNanos:(n,r)=>n<=r})),Hy=u(2,(t,e)=>ne(t,e,{onMillis:(n,r)=>n>r,onNanos:(n,r)=>n>r})),Cl=u(2,(t,e)=>ne(t,e,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),Nl=u(2,(t,e)=>Tl(H(t),H(e))),tk=Object.freeze(Object.defineProperty({__proto__:null,Equivalence:Tl,Order:rr,between:xy,clamp:By,days:Ol,decode:H,equals:Nl,greaterThan:Hy,greaterThanOrEqualTo:Cl,hours:Il,infinity:Ny,isDuration:Pc,lessThan:Jy,lessThanOrEqualTo:Vy,match:Rl,matchWith:ne,max:Ky,micros:$l,millis:Br,min:jy,minutes:El,nanos:Ur,seconds:kl,sum:Wy,times:zy,toHrTime:Ml,toMillis:Ln,toNanos:Py,toSeconds:Ay,unsafeToNanos:Ly,weeks:Fl,zero:wl},Symbol.toStringTag,{value:"Module"})),qi=Symbol.for("effect/MutableHashMap"),Gy={[qi]:qi,[Symbol.iterator](){return this.backingMap.current[Symbol.iterator]()},toString(){return G(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(W)}},[J](){return this.toJSON()},pipe(){return $(this,arguments)}},Yy=t=>{const e=Object.create(Gy);return e.backingMap=tn(t),e},Qy=()=>Yy(hs()),le=u(2,(t,e)=>mc(t.backingMap.current,e)),gn=u(2,(t,e)=>P(le(t,e))),pn=u(3,(t,e,n)=>(Ap(t.backingMap,yc(e,n)),t)),Al=typeof process>"u"?!1:!!process?.isBun,Xy=Al?t=>clearInterval(t):t=>clearTimeout(t),Pl=Al?(t,e)=>{const n=setInterval(()=>{t(),clearInterval(n)},e);return n}:(t,e)=>setTimeout(t,e),Zy="effect/Clock",_o=Symbol.for(Zy),Es=St(_o),t_=2**31-1,Ki={unsafeSchedule(t,e){const n=Ln(e);if(n>t_)return Hs;let r=!1;const s=Pl(()=>{r=!0,t()},n);return()=>(Xy(s),!r)}},Ui=function(){const t=BigInt(1e6);if(typeof performance>"u")return()=>BigInt(Date.now())*t;const e="timeOrigin"in performance&&typeof performance.timeOrigin=="number"?BigInt(Math.round(performance.timeOrigin*1e6)):BigInt(Date.now())*t-BigInt(Math.round(performance.now()*1e6));return()=>e+BigInt(Math.round(performance.now()*1e6))}(),e_=function(){const t=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!t)return Ui;const e=Ui()-t.bigint();return()=>e+t.bigint()}();var Qw;class n_{constructor(){f(this,Qw,_o);f(this,"currentTimeMillis",_(()=>this.unsafeCurrentTimeMillis()));f(this,"currentTimeNanos",_(()=>this.unsafeCurrentTimeNanos()))}unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return e_()}scheduler(){return k(Ki)}sleep(e){return $c(n=>{const r=Ki.unsafeSchedule(()=>n(A),e);return Mt(ut(_(r)))})}}Qw=_o;const r_=()=>new n_,xn=zh,Ll="And",xl="Or",Dl="InvalidData",jl="MissingData",ql="SourceUnavailable",Kl="Unsupported",s_="effect/ConfigError",Bi=Symbol.for(s_),ln={[Bi]:Bi},Ul=(t,e)=>{const n=Object.create(ln);return n._tag=Ll,n.left=t,n.right=e,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),n},Bl=(t,e)=>{const n=Object.create(ln);return n._tag=xl,n.left=t,n.right=e,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),n},o_=(t,e,n={pathDelim:"."})=>{const r=Object.create(ln);return r._tag=Dl,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${l(this.path,Xe(n.pathDelim))}: "${this.message}")`}}),r},Ee=(t,e,n={pathDelim:"."})=>{const r=Object.create(ln);return r._tag=jl,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${l(this.path,Xe(n.pathDelim))}: "${this.message}")`}}),r},c_=(t,e,n,r={pathDelim:"."})=>{const s=Object.create(ln);return s._tag=ql,s.path=t,s.message=e,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${l(this.path,Xe(r.pathDelim))}: "${this.message}")`}}),s},i_=(t,e,n={pathDelim:"."})=>{const r=Object.create(ln);return r._tag=Kl,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${l(this.path,Xe(n.pathDelim))}: "${this.message}")`}}),r},he=u(2,(t,e)=>{switch(t._tag){case Ll:return Ul(he(e)(t.left),he(e)(t.right));case xl:return Bl(he(e)(t.left),he(e)(t.right));case Dl:return o_([...e,...t.path],t.message);case jl:return Ee([...e,...t.path],t.message);case ql:return c_([...e,...t.path],t.message,t.cause);case Kl:return i_([...e,...t.path],t.message)}}),a_="Constant",u_="Fail",l_="Fallback",f_="Described",h_="Lazy",g_="MapOrFail",p_="Nested",d_="Primitive",m_="Sequence",y_="HashMap",__="ZipWith",b_=t=>e=>Ee([],`Expected ${e.description} with name ${t}`),S_={_tag:"Empty"},Ws=u(2,(t,e)=>{let n=_c(e),r=t;for(;Cu(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=Se(s.first,Se(s.second,n.tail));break}case"MapName":{r=Ce(r,s.f),n=n.tail;break}case"Nested":{r=xt(r,s.name),n=n.tail;break}case"Unnested":{if(l(Ha(r),Zh(s.name)))r=de(r),n=n.tail;else return Mt(Ee(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return dt(r)}),zr=(t,e)=>[...t,...e],v_="effect/ConfigProvider",bo=Symbol.for(v_),w_=St(bo),$_="effect/ConfigProviderFlat",zi=Symbol.for($_),k_=t=>({[bo]:bo,pipe(){return $(this,arguments)},...t}),E_=t=>({[zi]:zi,patch:t.patch,load:(e,n,r=!0)=>t.load(e,n,r),enumerateChildren:t.enumerateChildren}),I_=t=>k_({load:e=>g(pt(t,En(),e,!1),n=>te(Ha(n),{onNone:()=>V(Ee(En(),`Expected a single value having structure: ${e}`)),onSome:k})),flattened:t}),O_=(t={})=>{const{pathDelim:e,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},t),r=a=>l(a,Xe(e)),s=a=>a.split(e),o=()=>typeof process<"u"&&"env"in process&&typeof process.env=="object"?process.env:{};return I_(E_({load:(a,h,d=!0)=>{const p=r(a),m=o(),b=p in m?S(m[p]):w();return l(b,An(()=>Ee(a,`Expected ${p} to exist in the process context`)),g(v=>T_(v,a,h,n,d)))},enumerateChildren:a=>_(()=>{const h=o(),d=Object.keys(h),m=Array.from(d).map(b=>s(b.toUpperCase())).filter(b=>{for(let v=0;v<a.length;v++){const x=l(a,Va(v)),q=b[v];if(q===void 0||x!==q)return!1}return!0}).flatMap(b=>b.slice(a.length,a.length+1));return gc(m)}),patch:S_}))},F_=(t,e,n,r)=>{const s=pi(n.length,a=>a>=r.length?w():S([t(a),a+1])),o=pi(r.length,a=>a>=n.length?w():S([e(a),a+1])),c=zr(n,s),i=zr(r,o);return[c,i]},pt=(t,e,n,r)=>{const s=n;switch(s._tag){case a_:return k(Et(s.value));case f_:return N(()=>pt(t,e,s.config,r));case u_:return V(Ee(e,s.message));case l_:return l(N(()=>pt(t,e,s.first,r)),Lr(o=>s.condition(o)?l(pt(t,e,s.second,r),Lr(c=>V(Bl(o,c)))):V(o)));case h_:return N(()=>pt(t,e,s.config(),r));case g_:return N(()=>l(pt(t,e,s.original,r),g(Ot(o=>l(s.mapOrFail(o),An(he(e)))))));case p_:return N(()=>pt(t,zr(e,Et(s.name)),s.config,r));case d_:return l(Ws(e,t.patch),g(o=>l(t.load(o,s,r),g(c=>{if(c.length===0){const i=l(ag(o),At(()=>"<n/a>"));return V(b_(i))}return k(c)}))));case m_:return l(Ws(e,t.patch),g(o=>l(t.enumerateChildren(o),g(A_),g(c=>c.length===0?N(()=>C(pt(t,o,s.config,!0),Et)):l(Ot(c,i=>pt(t,Wa(e,`[${i}]`),s.config,!0)),C(i=>{const a=mg(i);return a.length===0?Et(En()):Et(a)}))))));case y_:return N(()=>l(Ws(e,t.patch),g(o=>l(t.enumerateChildren(o),g(c=>l(c,Ot(i=>pt(t,zr(o,Et(i)),s.valueConfig,r)),C(i=>{if(i.length===0)return Et(hs());const a=i.map(h=>Array.from(h));return l(C_(a),Ce(h=>Iu(gi(nt(c),h))))})))))));case __:return N(()=>l(pt(t,e,s.left,r),Nn,g(o=>l(pt(t,e,s.right,r),Nn,g(c=>{if(bn(o)&&bn(c))return V(Ul(o.left,c.left));if(bn(o)&&Sn(c))return V(o.left);if(Sn(o)&&bn(c))return V(c.left);if(Sn(o)&&Sn(c)){const i=l(e,Xe(".")),a=M_(e,i),[h,d]=F_(a,a,l(o.right,Ce(dt)),l(c.right,Ce(dt)));return l(h,gi(d),Ot(([p,m])=>l(hl(p,m),C(([b,v])=>s.zip(b,v)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},M_=(t,e)=>n=>Mt(Ee(t,`The element at index ${n} in a sequence at path "${e}" was missing`)),R_=(t,e)=>t.split(new RegExp(`\\s*${N_(e)}\\s*`)),T_=(t,e,n,r,s)=>s?l(R_(t,r),Ot(o=>n.parse(o.trim())),An(he(e))):l(n.parse(t),C(Et),An(he(e))),C_=t=>Object.keys(t[0]).map(e=>t.map(n=>n[e])),N_=t=>t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&"),A_=t=>l(Ot(t,L_),Km({onFailure:()=>En(),onSuccess:Ga(xn)}),Nn,C(ng)),P_=/^(\[(\d+)\])$/,L_=t=>{const e=t.match(P_);if(e!==null){const n=e[2];return l(n!==void 0&&n.length>0?S(n):w(),za(x_))}return w()},x_=t=>{const e=Number.parseInt(t);return Number.isNaN(e)?w():S(e)},So=Symbol.for("effect/Console"),zl=St(So),D_={[So]:So,assert(t,...e){return _(()=>{console.assert(t,...e)})},clear:_(()=>{console.clear()}),count(t){return _(()=>{console.count(t)})},countReset(t){return _(()=>{console.countReset(t)})},debug(...t){return _(()=>{console.debug(...t)})},dir(t,e){return _(()=>{console.dir(t,e)})},dirxml(...t){return _(()=>{console.dirxml(...t)})},error(...t){return _(()=>{console.error(...t)})},group(t){return t?.collapsed?_(()=>console.groupCollapsed(t?.label)):_(()=>console.group(t?.label))},groupEnd:_(()=>{console.groupEnd()}),info(...t){return _(()=>{console.info(...t)})},log(...t){return _(()=>{console.log(...t)})},table(t,e){return _(()=>{console.table(t,e)})},time(t){return _(()=>console.time(t))},timeEnd(t){return _(()=>console.timeEnd(t))},timeLog(t,...e){return _(()=>{console.timeLog(t,...e)})},trace(...t){return _(()=>{console.trace(...t)})},warn(...t){return _(()=>{console.warn(...t)})},unsafe:console},j_="effect/Random",vo=Symbol.for(j_),Wl=St(vo);var Xw;class q_{constructor(e){f(this,"seed");f(this,Xw,vo);f(this,"PRNG");this.seed=e,this.PRNG=new va(e)}get next(){return _(()=>this.PRNG.number())}get nextBoolean(){return C(this.next,e=>e>.5)}get nextInt(){return _(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(e,n){return C(this.next,r=>(n-e)*r+e)}nextIntBetween(e,n){return _(()=>this.PRNG.integer(n-e)+e)}shuffle(e){return K_(e,n=>this.nextIntBetween(0,n))}}Xw=vo;const K_=(t,e)=>N(()=>l(_(()=>Array.from(t)),g(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return l(r,Qn(s=>l(e(s),C(o=>U_(n,s-1,o)))),it(Kn(n)))}))),U_=(t,e,n)=>{const r=t[e];return t[e]=t[n],t[n]=r,t},B_=t=>new q_(t),z_=l(es(),Bt(Es,r_()),Bt(zl,D_),Bt(Wl,B_(Math.random()*4294967296>>>0)),Bt(w_,O_()),Bt(lo,Cm)),pe=L(Symbol.for("effect/DefaultServices/currentServices"),()=>yl(z_)),W_=t=>{const e=H(t);return Jl(n=>n.sleep(e))},Jl=t=>tr(pe,e=>t(Jt(e,Es))),J_=Jl(t=>t.currentTimeNanos),V_=t=>tr(pe,e=>t(Jt(e,Wl))),H_=W_,G_=J_;function Y_(t){return new sr(t)}function Q_(){return Y_(new Map)}const Wi=Symbol.for("effect/FiberRefs");var Zw;class sr{constructor(e){f(this,"locals");f(this,Zw,Wi);this.locals=e}pipe(){return $(this,arguments)}}Zw=Wi;const X_=(t,e,n,r=!1)=>{const s=t;let o=e,c=n,i=r,a;for(;a===void 0;)if(Dt(o)&&Dt(c)){const h=Z(o)[0],d=de(o),p=Z(c)[0],m=Z(c)[1],b=de(c);h.startTimeMillis<p.startTimeMillis?(c=b,i=!0):h.startTimeMillis>p.startTimeMillis?o=d:h.id<p.id?(c=b,i=!0):h.id>p.id?o=d:a=[m,i]}else a=[s.initial,!0];return a},Z_=u(3,(t,e,n)=>{const r=new Map(t.locals);for(const[s,o]of n.locals){const c=Z(o)[1];if(!F(Z(o)[0],e)){if(!r.has(s)){if(F(c,s.initial))continue;r.set(s,[[e,s.join(s.initial,c)]]);continue}const i=r.get(s),[a,h]=X_(s,i,o);if(h){const d=s.diff(a,c),p=Z(i)[1],m=s.join(p,s.patch(d)(p));if(!F(p,m)){let b;const v=Z(i)[0];F(v,e)?b=xt([v,m])(de(i)):b=xt([e,m])(i),r.set(s,b)}}}}return new sr(new Map(r))}),Vl=u(2,(t,e)=>{const n=new Map;for(const[r,s]of t.locals.entries()){const o=Z(s)[1],c=r.patch(r.fork)(o);F(o,c)?n.set(r,s):n.set(r,xt([e,c])(s))}return new sr(n)}),Hl=u(2,(t,e)=>{const n=new Map(t.locals);return n.delete(e),new sr(n)}),wo=u(2,(t,e)=>t.locals.has(e)?S(Z(t.locals.get(e))[1]):w()),Lc=u(2,(t,e)=>l(wo(t,e),At(()=>e.initial))),Wr=u(2,(t,{fiberId:e,fiberRef:n,value:r})=>{const s=t.locals.has(n)?t.locals.get(n):En();let o;if(nc(s))o=Et([e,r]);else{const[i,a]=Z(s);if(F(i,e)){if(F(a,r))return t;o=xt([e,r])(de(s))}else o=xt([e,r])(s)}const c=new Map(t.locals);return new sr(c.set(n,o))}),tb=Vl,eb=Lc,Ji=Wr,nb=Q_,rb=Ym,sb=Qm,ob=Xm,cb=Zm,Gl=gl,ib=pl,ab=ty,ub=ey,lb=l(xn,qa(t=>t.ordinal)),fb=Ka(lb),hb=t=>{switch(t){case"All":return rb;case"Debug":return ib;case"Error":return ob;case"Fatal":return sb;case"Info":return Gl;case"Trace":return ab;case"None":return ub;case"Warning":return cb}},gb=t=>e=>`${e.label.replace(/[\s="]/g,"_")}=${t-e.startTime}ms`,pb=gb,Yl=Symbol.for("effect/Ref"),Ql={_A:t=>t};var t$;class db{constructor(e){f(this,"ref");f(this,t$,Ql);this.ref=e}modify(e){return _(()=>{const n=qt(this.ref),[r,s]=e(n);return n!==s&&ke(s)(this.ref),r})}pipe(){return $(this,arguments)}}t$=Yl;const Xl=t=>new db(tn(t)),$o=t=>_(()=>Xl(t)),Jr=t=>t.modify(e=>[e,e]),xc=u(2,(t,e)=>t.modify(()=>[void 0,e])),Zl=u(2,(t,e)=>t.modify(e)),ko=u(2,(t,e)=>t.modify(n=>[void 0,e(n)])),mb=u(2,(t,e)=>t.modify(n=>{const r=e(n);return[r,r]})),yb=$o,ek=Jr,_b=Zl,nk=xc,rk=ko,sk=mb,tf="Empty",ef="Add",nf="Remove",rf="Update",sf="AndThen",bb={_tag:tf},of=(t,e)=>{const n=new Map(t.locals);let r=bb;for(const[s,o]of e.locals.entries()){const c=Z(o)[1],i=n.get(s);if(i!==void 0){const a=Z(i)[1];F(a,c)||(r=Js({_tag:rf,fiberRef:s,patch:s.diff(a,c)})(r))}else r=Js({_tag:ef,fiberRef:s,value:c})(r);n.delete(s)}for(const[s]of n.entries())r=Js({_tag:nf,fiberRef:s})(r);return r},Js=u(2,(t,e)=>({_tag:sf,first:t,second:e})),cf=u(3,(t,e,n)=>{let r=n,s=Et(t);for(;Dt(s);){const o=Z(s),c=de(s);switch(o._tag){case tf:{s=c;break}case ef:{r=Wr(r,{fiberId:e,fiberRef:o.fiberRef,value:o.value}),s=c;break}case nf:{r=Hl(r,o.fiberRef),s=c;break}case rf:{const i=Lc(r,o.fiberRef);r=Wr(r,{fiberId:e,fiberRef:o.fiberRef,value:o.fiberRef.patch(o.patch)(i)}),s=c;break}case sf:{s=xt(o.first)(xt(o.second)(c));break}}}return r}),af="effect/MetricLabel",Eo=Symbol.for(af);var e$;class Sb{constructor(e,n){f(this,"key");f(this,"value");f(this,e$,Eo);this.key=e,this.value=n}[(e$=Eo,R)](){return l(y(af),I(y(this.key)),I(y(this.value)))}[T](e){return wb(e)&&this.key===e.key&&this.value===e.value}pipe(){return $(this,arguments)}}const vb=(t,e)=>new Sb(t,e),wb=t=>M(t,Eo);class Dc{constructor(e){f(this,"self");f(this,"called",!1);this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new Dc(this.self)}}const Vi=t=>{let e,n;return typeof t=="function"?e=t:(e=t.try,n=t.catch),_(()=>{try{return e()}catch(r){throw Pm(we(n?n(r):r))}})},$b=u(2,(t,e)=>X(t,{onFailure:n=>{const r=e(n);switch(r._tag){case"None":return j(n);case"Some":return r.value}},onSuccess:k})),kb=u(2,(t,e)=>at(H_(e),t)),Eb=t=>gf(t,Rb,of),uf=u(2,(t,{onFailure:e,onSuccess:n})=>Yn(t,{onFailure:r=>k(e(r)),onSuccess:r=>k(n(r))})),Ib=t=>{const e=g(g(t,()=>Xn()),()=>e);return e};class Ob{constructor(e){f(this,"value");this.value=e}[Symbol.iterator](){return new Dc(this)}}const Fb=function(){let t=arguments[0];for(let e=1;e<arguments.length;e++)t=arguments[e](t);return new Ob(t)},Mb=function(){let t;return arguments.length===1?t=arguments[0]:t=arguments[1].bind(arguments[0]),N(()=>{const e=t(Fb),n=e.next(),r=s=>s.done?k(s.value):l(s.value.value,g(o=>r(e.next(o))));return r(n)})},Rb=rt(t=>k(t.getFiberRefs())),Tb=t=>uf(t,{onFailure:ai,onSuccess:ai}),lf=t=>(e,n)=>{const r=Qe(t);let s,o;return Vu(e)?(o=e,s=n??""):(s=e,o=n??Qt),rt(c=>(c.log(s,o,r),A))},Cb=lf(),Nb=lf(Gl),Ab=(t,e)=>e.discard?hf(t,e.while,e.step,e.body):C(ff(t,e.while,e.step,e.body),n=>Array.from(n)),ff=(t,e,n,r)=>N(()=>e(t)?g(r(t),s=>C(ff(n(t),e,n,r),Nu(s))):_(()=>ve())),hf=(t,e,n,r)=>N(()=>e(t)?g(r(t),()=>hf(n(t),e,n,r)):A),Hi=u(2,(t,e)=>X(t,{onFailure:n=>al(()=>e(n)),onSuccess:k})),Pb=t=>C(t,e=>!e),Io=t=>Bb((e,n)=>l(t,cf(e,n))),Lb=u(3,(t,e,n)=>un(r=>Nc(t,Bt(r,e,n)))),xb=V_(k),Db=u(3,(t,e,n)=>nt(t).reduce((r,s,o)=>g(r,c=>n(c,s,o)),k(e))),gf=u(3,(t,e,n)=>g(e,r=>g(t,s=>C(e,o=>[n(r,o),s])))),jb=u(2,(t,e)=>X(t,{onFailure:n=>at(e(n),j(n)),onSuccess:k})),qb=t=>Kb(t,G_),Kb=u(2,(t,e)=>gf(t,e,(n,r)=>Ur(r-n))),Ub=t=>{let e,n;return typeof t=="function"?e=t:(e=t.try,n=t.catch),e.length>=1?N(()=>{const r=new AbortController;return g(Vi(()=>e(r.signal)),s=>ze(o=>(s.then(c=>o(et(c))).catch(c=>o(V(n?n(c):c))),_(()=>r.abort()))))}):g(Vi(t),r=>ze(s=>{r.then(o=>s(et(o))).catch(o=>s(V(n?n(o):o)))}))},Bb=t=>rt(e=>(e.setFiberRefs(t(e.id(),e.getFiberRefs())),A)),zb=u(3,(t,e,n)=>Sl(t,r=>Bt(r,e,n(sc(r,e))))),Wb=u(2,(t,e)=>N(()=>e()?C(t,S):k(w()))),Gi=Oa,pf="Sequential",df="Parallel",Jb="ParallelN",jc={_tag:pf},Vb={_tag:df},Hb=t=>({_tag:Jb,parallelism:t}),Gb=t=>t._tag===pf,Yb=t=>t._tag===df,Oo=jc,Fo=Vb,Mo=Hb,Vr=of,Yi=cf,Is="effect/FiberStatus",$e=Symbol.for(Is),Ro="Done",Qi="Running",Xi="Suspended";var n$;class Qb{constructor(){f(this,n$,$e);f(this,"_tag",Ro)}[(n$=$e,R)](){return l(y(Is),I(y(this._tag)))}[T](e){return qc(e)&&e._tag===Ro}}var r$;class Xb{constructor(e){f(this,"runtimeFlags");f(this,r$,$e);f(this,"_tag",Qi);this.runtimeFlags=e}[(r$=$e,R)](){return l(y(Is),I(y(this._tag)),I(y(this.runtimeFlags)))}[T](e){return qc(e)&&e._tag===Qi&&this.runtimeFlags===e.runtimeFlags}}var s$;class Zb{constructor(e,n){f(this,"runtimeFlags");f(this,"blockingOn");f(this,s$,$e);f(this,"_tag",Xi);this.runtimeFlags=e,this.blockingOn=n}[(s$=$e,R)](){return l(y(Is),I(y(this._tag)),I(y(this.runtimeFlags)),I(y(this.blockingOn)))}[T](e){return qc(e)&&e._tag===Xi&&this.runtimeFlags===e.runtimeFlags&&F(this.blockingOn,e.blockingOn)}}const tS=new Qb,eS=t=>new Xb(t),nS=(t,e)=>new Zb(t,e),qc=t=>M(t,$e),rS=t=>t._tag===Ro,sS=tS,mf=eS,oS=nS,cS=rS;class iS{constructor(){f(this,"buckets",[])}scheduleTask(e,n){let r,s;for(s=0;s<this.buckets.length&&this.buckets[s][0]<=n;s++)r=this.buckets[s];if(r)r[1].push(e);else{const o=[];for(let c=0;c<s;c++)o.push(this.buckets[c]);o.push([n,[e]]);for(let c=s;c<this.buckets.length;c++)o.push(this.buckets[c]);this.buckets=o}}}class aS{constructor(e){f(this,"maxNextTickBeforeTimer");f(this,"running",!1);f(this,"tasks",new iS);this.maxNextTickBeforeTimer=e}starveInternal(e){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let o=0;o<s.length;o++)s[o]();this.tasks.buckets.length===0?this.running=!1:this.starve(e)}starve(e=0){e>=this.maxNextTickBeforeTimer?Pl(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(e+1))}shouldYield(e){return e.currentOpCount>e.getFiberRef(iy)?e.getFiberRef(ws):!1}scheduleTask(e,n){this.tasks.scheduleTask(e,n),this.running||(this.running=!0,this.starve())}}const uS=L(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new aS(2048)),Hr=L(Symbol.for("effect/FiberRef/currentScheduler"),()=>gt(uS)),yf=L(Symbol.for("effect/FiberRef/currentRequestMap"),()=>gt(new Map)),Zi=(t,e,n,r)=>{switch(t){case void 0:return e();case"unbounded":return n();case"inherit":return tr(hy,s=>s==="unbounded"?n():s>1?r(s):e());default:return t>1?r(t):e()}},Kc="InterruptSignal",Uc="Stateful",Bc="Resume",zc="YieldNow",ta=t=>({_tag:Kc,cause:t}),$r=t=>({_tag:Uc,onFiber:t}),Me=t=>({_tag:Bc,effect:t}),lS=()=>({_tag:zc}),fS="effect/FiberScope",Gr=Symbol.for(fS);var o$;class hS{constructor(){f(this,o$,Gr);f(this,"fiberId",Un);f(this,"roots",new Set)}add(e,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}o$=Gr;var c$;class gS{constructor(e,n){f(this,"fiberId");f(this,"parent");f(this,c$,Gr);this.fiberId=e,this.parent=n}add(e,n){this.parent.tell($r(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}c$=Gr;const pS=t=>new gS(t.id(),t),_f=L(Symbol.for("effect/FiberScope/Global"),()=>new hS),dS="effect/Fiber",mS=Symbol.for(dS),yS={_E:t=>t,_A:t=>t},_S="effect/Fiber",bS=Symbol.for(_S),SS=t=>t.await,vS=t=>t.inheritAll,ea=t=>Ss(Gn(t.await),t.inheritAll),ce="effect/FiberCurrent",wS="effect/Logger",$S=Symbol.for(wS),kS={_Message:t=>t,_Output:t=>t},Wc=t=>({[$S]:kS,log:t,pipe(){return $(this,arguments)}}),ES=Wc(({annotations:t,cause:e,date:n,fiberId:r,logLevel:s,message:o,spans:c})=>{const i=n.getTime();let h=[`timestamp=${n.toISOString()}`,`level=${s.label}`,`fiber=${ku(r)}`].join(" ");const d=To(o);if(d.length>0&&(h=h+" message=",h=Vs(d,h)),e!=null&&e._tag!=="Empty"&&(h=h+" cause=",h=Vs(ms(e),h)),Cu(c)){h=h+" ";let p=!0;for(const m of c)p?p=!1:h=h+" ",h=h+l(m,pb(i))}if(l(t,Jp)>0){h=h+" ";let p=!0;for(const[m,b]of t)p?p=!1:h=h+" ",h=h+FS(m),h=h+"=",h=Vs(To(b),h)}return h}),To=t=>{try{return typeof t=="object"?JSON.stringify(t):String(t)}catch{return String(t)}},IS=t=>`"${t.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,OS=/^[^\s"=]+$/,Vs=(t,e)=>e+(t.match(OS)?t:IS(t)),FS=t=>t.replace(/[\s="]/g,"_"),bf="effect/MetricBoundaries",Co=Symbol.for(bf);var i$;class MS{constructor(e){f(this,"values");f(this,i$,Co);this.values=e}[(i$=Co,R)](){return l(y(bf),I(y(this.values)))}[T](e){return RS(e)&&F(this.values,e.values)}pipe(){return $(this,arguments)}}const RS=t=>M(t,Co),TS=t=>{const e=l(t,Nt(ft(Number.POSITIVE_INFINITY)),Hg);return new MS(e)},CS=t=>l(ec(t.count-1,e=>t.start*Math.pow(t.factor,e)),vt,TS),NS="effect/MetricKeyType",Sf=Symbol.for(NS),vf="effect/MetricKeyType/Counter",No=Symbol.for(vf),AS="effect/MetricKeyType/Frequency",PS=Symbol.for(AS),LS="effect/MetricKeyType/Gauge",xS=Symbol.for(LS),wf="effect/MetricKeyType/Histogram",Ao=Symbol.for(wf),DS="effect/MetricKeyType/Summary",jS=Symbol.for(DS),$f={_In:t=>t,_Out:t=>t};var a$,u$;class qS{constructor(e,n){f(this,"incremental");f(this,"bigint");f(this,a$,$f);f(this,u$,No);this.incremental=e,this.bigint=n}[(a$=Sf,u$=No,R)](){return y(vf)}[T](e){return kf(e)}pipe(){return $(this,arguments)}}var l$,f$;class KS{constructor(e){f(this,"boundaries");f(this,l$,$f);f(this,f$,Ao);this.boundaries=e}[(l$=Sf,f$=Ao,R)](){return l(y(wf),I(y(this.boundaries)))}[T](e){return Ef(e)&&F(this.boundaries,e.boundaries)}pipe(){return $(this,arguments)}}const US=t=>new qS(t?.incremental??!1,t?.bigint??!1),BS=t=>new KS(t),kf=t=>M(t,No),zS=t=>M(t,PS),WS=t=>M(t,xS),Ef=t=>M(t,Ao),JS=t=>M(t,jS),VS="effect/MetricKey",If=Symbol.for(VS),HS={_Type:t=>t};var h$;class Jc{constructor(e,n,r,s=Tt()){f(this,"name");f(this,"keyType");f(this,"description");f(this,"tags");f(this,h$,HS);this.name=e,this.keyType=n,this.description=r,this.tags=s}[(h$=If,R)](){return l(y(this.name),I(y(this.keyType)),I(y(this.description)),I(y(this.tags)))}[T](e){return GS(e)&&this.name===e.name&&F(this.keyType,e.keyType)&&F(this.description,e.description)&&F(this.tags,e.tags)}pipe(){return $(this,arguments)}}const GS=t=>M(t,If),YS=(t,e)=>new Jc(t,US(e),Qe(e?.description)),QS=(t,e,n)=>new Jc(t,BS(e),Qe(n)),XS=u(2,(t,e)=>pc(e)===0?t:new Jc(t.name,t.keyType,t.description,l(t.tags,Yt(e)))),ZS="effect/MetricState",or=Symbol.for(ZS),Of="effect/MetricState/Counter",Po=Symbol.for(Of),Ff="effect/MetricState/Frequency",Lo=Symbol.for(Ff),Mf="effect/MetricState/Gauge",xo=Symbol.for(Mf),Rf="effect/MetricState/Histogram",Do=Symbol.for(Rf),Tf="effect/MetricState/Summary",jo=Symbol.for(Tf),cr={_A:t=>t};var g$,p$;class t0{constructor(e){f(this,"count");f(this,g$,cr);f(this,p$,Po);this.count=e}[(g$=or,p$=Po,R)](){return l(y(Of),I(y(this.count)))}[T](e){return l0(e)&&this.count===e.count}pipe(){return $(this,arguments)}}var d$,m$;class e0{constructor(e){f(this,"occurrences");f(this,d$,cr);f(this,m$,Lo);this.occurrences=e}[(d$=or,m$=Lo,R)](){return l(y(Ff),I(y(this.occurrences)))}[T](e){return f0(e)&&F(this.occurrences,e.occurrences)}pipe(){return $(this,arguments)}}var y$,_$;class n0{constructor(e){f(this,"value");f(this,y$,cr);f(this,_$,xo);this.value=e}[(y$=or,_$=xo,R)](){return l(y(Mf),I(y(this.value)))}[T](e){return h0(e)&&this.value===e.value}pipe(){return $(this,arguments)}}var b$,S$;class r0{constructor(e,n,r,s,o){f(this,"buckets");f(this,"count");f(this,"min");f(this,"max");f(this,"sum");f(this,b$,cr);f(this,S$,Do);this.buckets=e,this.count=n,this.min=r,this.max=s,this.sum=o}[(b$=or,S$=Do,R)](){return l(y(Rf),I(y(this.buckets)),I(y(this.count)),I(y(this.min)),I(y(this.max)),I(y(this.sum)))}[T](e){return g0(e)&&F(this.buckets,e.buckets)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return $(this,arguments)}}var v$,w$;class s0{constructor(e,n,r,s,o,c){f(this,"error");f(this,"quantiles");f(this,"count");f(this,"min");f(this,"max");f(this,"sum");f(this,v$,cr);f(this,w$,jo);this.error=e,this.quantiles=n,this.count=r,this.min=s,this.max=o,this.sum=c}[(v$=or,w$=jo,R)](){return l(y(Tf),I(y(this.error)),I(y(this.quantiles)),I(y(this.count)),I(y(this.min)),I(y(this.max)),I(y(this.sum)))}[T](e){return p0(e)&&this.error===e.error&&F(this.quantiles,e.quantiles)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return $(this,arguments)}}const o0=t=>new t0(t),c0=t=>new e0(t),i0=t=>new n0(t),a0=t=>new r0(t.buckets,t.count,t.min,t.max,t.sum),u0=t=>new s0(t.error,t.quantiles,t.count,t.min,t.max,t.sum),l0=t=>M(t,Po),f0=t=>M(t,Lo),h0=t=>M(t,xo),g0=t=>M(t,Do),p0=t=>M(t,jo),d0="effect/MetricHook",m0=Symbol.for(d0),y0={_In:t=>t,_Out:t=>t},ir=t=>({[m0]:y0,pipe(){return $(this,arguments)},...t}),na=BigInt(0),_0=t=>{let e=t.keyType.bigint?na:0;const n=t.keyType.incremental?t.keyType.bigint?r=>r>=na:r=>r>=0:r=>!0;return ir({get:()=>o0(e),update:r=>{n(r)&&(e=e+r)}})},b0=t=>{const e=new Map,n=s=>{const o=e.get(s)??0;e.set(s,o+1)},r=()=>Iu(e.entries());return ir({get:()=>c0(r()),update:n})},S0=(t,e)=>{let n=e;return ir({get:()=>i0(n),update:r=>{n=r}})},v0=t=>{const e=t.keyType.boundaries.values,n=e.length,r=new Uint32Array(n+1),s=new Float32Array(n);let o=0,c=0,i=Number.MAX_VALUE,a=Number.MIN_VALUE;l(e,Xs(xn),au((p,m)=>{s[m]=p}));const h=p=>{let m=0,b=n;for(;m!==b;){const v=Math.floor(m+(b-m)/2),x=s[v];p<=x?b=v:m=v,b===m+1&&(p<=s[m]?b=m:m=b)}r[m]=r[m]+1,o=o+1,c=c+p,p<i&&(i=p),p>a&&(a=p)},d=()=>{const p=Array(n);let m=0;for(let b=0;b<n;b++){const v=s[b],x=r[b];m=m+x,p[b]=[v,m]}return vt(p)};return ir({get:()=>a0({buckets:d(),count:o,min:i,max:a,sum:c}),update:h})},w0=t=>{const{error:e,maxAge:n,maxSize:r,quantiles:s}=t.keyType,o=l(s,Xs(xn)),c=Array(r);let i=0,a=0,h=0,d=Number.MAX_VALUE,p=Number.MIN_VALUE;const m=v=>{const x=[];let q=0;for(;q!==r-1;){const K=c[q];if(K!=null){const[kt,oe]=K,hn=Br(v-kt);Cl(hn,wl)&&hn<=n&&x.push(oe)}q=q+1}return $0(e,o,l(vt(x),Xs(xn)))},b=(v,x)=>{if(r>0){i=i+1;const q=i%r;c[q]=[x,v]}a=a+1,h=h+v,v<d&&(d=v),v>p&&(p=v)};return ir({get:()=>u0({error:e,quantiles:m(Date.now()),count:a,min:d,max:p,sum:h}),update:([v,x])=>b(v,x)})},$0=(t,e,n)=>{const r=n.length;if(oc(e))return Rt();const s=On(e),o=l(e,In(1)),c=l(o,Ht(ft(ra(t,r,w(),0,s,n)),(i,a)=>{const h=On(i);return l(i,zg(ra(t,r,h.value,h.consumed,a,h.rest)))}));return l(c,au(i=>[i.quantile,i.value]))},ra=(t,e,n,r,s,o)=>{let c=t,i=e,a=n,h=r,d=s,p=o,m=t,b=e,v=n,x=r,q=s,K=o;for(;;){if(oc(p))return{quantile:d,value:w(),consumed:h,rest:Rt()};if(d===1)return{quantile:d,value:S(Wg(p)),consumed:h+p.length,rest:Rt()};const kt=l(p,Vg(Ns=>Ns>On(p))),oe=d*i,hn=c/2*oe,Oe=h+kt[0].length,fh=Math.abs(Oe-oe);if(Oe<oe-hn){m=c,b=i,v=xs(p),x=Oe,q=d,K=kt[1],c=m,i=b,a=v,h=x,d=q,p=K;continue}if(Oe>oe+hn)return{quantile:d,value:a,consumed:h,rest:p};switch(a._tag){case"None":{m=c,b=i,v=xs(p),x=Oe,q=d,K=kt[1],c=m,i=b,a=v,h=x,d=q,p=K;continue}case"Some":{const Ns=Math.abs(oe-a.value);if(fh<Ns){m=c,b=i,v=xs(p),x=Oe,q=d,K=kt[1],c=m,i=b,a=v,h=x,d=q,p=K;continue}return{quantile:d,value:S(a.value),consumed:h,rest:p}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},k0="effect/MetricPair",E0=Symbol.for(k0),I0={_Type:t=>t},O0=(t,e)=>({[E0]:I0,metricKey:t,metricState:e,pipe(){return $(this,arguments)}}),F0="effect/MetricRegistry",sa=Symbol.for(F0);var $$;class M0{constructor(){f(this,$$,sa);f(this,"map",Qy())}snapshot(){const e=[];for(const[n,r]of this.map)e.push(O0(n,r.get()));return gc(e)}get(e){const n=l(this.map,le(e),ue);if(n==null){if(kf(e.keyType))return this.getCounter(e);if(WS(e.keyType))return this.getGauge(e);if(zS(e.keyType))return this.getFrequency(e);if(Ef(e.keyType))return this.getHistogram(e);if(JS(e.keyType))return this.getSummary(e);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(e){let n=l(this.map,le(e),ue);if(n==null){const r=_0(e);l(this.map,gn(e))||l(this.map,pn(e,r)),n=r}return n}getFrequency(e){let n=l(this.map,le(e),ue);if(n==null){const r=b0();l(this.map,gn(e))||l(this.map,pn(e,r)),n=r}return n}getGauge(e){let n=l(this.map,le(e),ue);if(n==null){const r=S0(e,e.keyType.bigint?BigInt(0):0);l(this.map,gn(e))||l(this.map,pn(e,r)),n=r}return n}getHistogram(e){let n=l(this.map,le(e),ue);if(n==null){const r=v0(e);l(this.map,gn(e))||l(this.map,pn(e,r)),n=r}return n}getSummary(e){let n=l(this.map,le(e),ue);if(n==null){const r=w0(e);l(this.map,gn(e))||l(this.map,pn(e,r)),n=r}return n}}$$=sa;const R0=()=>new M0,T0="effect/Metric",C0=Symbol.for(T0),N0={_Type:t=>t,_In:t=>t,_Out:t=>t},A0=L(Symbol.for("effect/Metric/globalMetricRegistry"),()=>R0()),Cf=function(t,e,n){return Object.assign(s=>cn(s,o=>_(()=>e(o,Tt()))),{[C0]:N0,keyType:t,unsafeUpdate:e,unsafeValue:n,pipe(){return $(this,arguments)}})},Os=(t,e)=>Nf(YS(t,e)),Nf=t=>{const e=n=>{const r=l(t,XS(n));return A0.get(r)};return Cf(t.keyType,(n,r)=>e(r).update(n),n=>e(n).get())},P0=(t,e,n)=>Nf(QS(t,e,n)),L0=u(3,(t,e,n)=>x0(t,ls(vb(e,n)))),x0=u(2,(t,e)=>{const n=Fp(e)?e:gc(e);return Cf(t.keyType,(r,s)=>t.unsafeUpdate(r,l(n,Yt(s))),r=>t.unsafeValue(l(n,Yt(r))))}),D0=u(2,(t,e)=>tr(yf,n=>_(()=>{if(n.has(t)){const r=n.get(t);r.state.completed||(r.state.completed=!0,Cc(r.result,e))}}))),j0="effect/Supervisor",Fs=Symbol.for(j0),Vc={_T:t=>t};var k$;const oi=class{constructor(e,n){f(this,"underlying");f(this,"value0");f(this,k$,Vc);this.underlying=e,this.value0=n}get value(){return this.value0}onStart(e,n,r,s){this.underlying.onStart(e,n,r,s)}onEnd(e,n){this.underlying.onEnd(e,n)}onEffect(e,n){this.underlying.onEffect(e,n)}onSuspend(e){this.underlying.onSuspend(e)}onResume(e){this.underlying.onResume(e)}map(e){return new oi(this,l(this.value,C(e)))}zip(e){return new Qr(this,e)}};let Yr=oi;k$=Fs;var E$;const ci=class{constructor(e,n){f(this,"left");f(this,"right");f(this,"_tag","Zip");f(this,E$,Vc);this.left=e,this.right=n}get value(){return hl(this.left.value,this.right.value)}onStart(e,n,r,s){this.left.onStart(e,n,r,s),this.right.onStart(e,n,r,s)}onEnd(e,n){this.left.onEnd(e,n),this.right.onEnd(e,n)}onEffect(e,n){this.left.onEffect(e,n),this.right.onEffect(e,n)}onSuspend(e){this.left.onSuspend(e),this.right.onSuspend(e)}onResume(e){this.left.onResume(e),this.right.onResume(e)}map(e){return new Yr(this,l(this.value,C(e)))}zip(e){return new ci(this,e)}};let Qr=ci;E$=Fs;const Af=t=>M(t,Fs)&&ba(t,"Zip");var I$;class q0{constructor(e){f(this,"effect");f(this,I$,Vc);this.effect=e}get value(){return this.effect}onStart(e,n,r,s){}onEnd(e,n){}onEffect(e,n){}onSuspend(e){}onResume(e){}map(e){return new Yr(this,l(this.value,C(e)))}zip(e){return new Qr(this,e)}onRun(e,n){return e()}}I$=Fs;const K0=t=>new q0(t),Ms=L("effect/Supervisor/none",()=>K0(A)),U0=zn,Pf="Empty",Lf="AddSupervisor",xf="RemoveSupervisor",Df="AndThen",kn={_tag:Pf},kr=(t,e)=>({_tag:Df,first:t,second:e}),B0=(t,e)=>z0(e,ft(t)),z0=(t,e)=>{let n=t,r=e;for(;me(r);){const s=ye(r);switch(s._tag){case Pf:{r=zt(r);break}case Lf:{n=n.zip(s.supervisor),r=zt(r);break}case xf:{n=qo(n,s.supervisor),r=zt(r);break}case Df:{r=yt(s.first)(yt(s.second)(zt(r)));break}}}return n},qo=(t,e)=>F(t,e)?Ms:Af(t)?qo(t.left,e).zip(qo(t.right,e)):t,Xr=t=>F(t,Ms)?Tt():Af(t)?l(Xr(t.left),Yt(Xr(t.right))):ls(t),W0=(t,e)=>{if(F(t,e))return kn;const n=Xr(t),r=Xr(e),s=l(r,mi(n),Cr(kn,(c,i)=>kr(c,{_tag:Lf,supervisor:i}))),o=l(n,mi(r),Cr(kn,(c,i)=>kr(c,{_tag:xf,supervisor:i})));return kr(s,o)},J0=U0({empty:kn,patch:B0,combine:kr,diff:W0}),V0=Os("effect_fiber_started"),oa=Os("effect_fiber_active"),H0=Os("effect_fiber_successes"),G0=Os("effect_fiber_failures"),Y0=L0(P0("effect_fiber_lifetimes",CS({start:1,factor:1.3,count:100})),"time_unit","milliseconds"),dn="Continue",Q0="Done",ca="Yield",X0={_E:t=>t,_A:t=>t},mn=t=>{throw new Error(`BUG: FiberRuntime - ${JSON.stringify(t)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},dr={[Or]:(t,e,n)=>e.i1(n),OnStep:(t,e,n)=>e.i1(et(n)),[Fr]:(t,e,n)=>e.i2(n),[Zo]:(t,e,n)=>(t.patchRuntimeFlags(t._runtimeFlags,e.patch),Ut(t._runtimeFlags)&&t.isInterrupted()?D(t.getInterruptedCause()):et(n)),[Mr]:(t,e,n)=>(e.i2(n),e.i0()?(t.pushStack(e),e.i1()):A)},Z0={[Kc]:(t,e,n,r)=>(t.processNewInterruptSignal(r.cause),Ut(e)?D(r.cause):n),[Bc]:(t,e,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[Uc]:(t,e,n,r)=>(r.onFiber(t,mf(e)),n),[zc]:(t,e,n,r)=>g(Xn(),()=>n)},tv=t=>Qn(Wd(t),e=>Ge(sm(e),([n,r])=>{const s=new Map;for(const o of r)for(const c of o)s.set(c.request,c);return an(vv(n.runAll(r),r.flat()),yf,s)},!1));var O$,F$;class jf{constructor(e,n,r){f(this,O$,yS);f(this,F$,X0);f(this,"_fiberRefs");f(this,"_fiberId");f(this,"_runtimeFlags");f(this,"_queue",new Array);f(this,"_children",null);f(this,"_observers",new Array);f(this,"_running",!1);f(this,"_stack",[]);f(this,"_asyncInterruptor",null);f(this,"_asyncBlockingOn",null);f(this,"_exitValue",null);f(this,"_steps",[!1]);f(this,"_supervisor");f(this,"_scheduler");f(this,"_tracer");f(this,"currentOpCount",0);f(this,"isYielding",!1);f(this,"run",()=>{this.drainQueueOnCurrentThread()});if(this._runtimeFlags=r,this._fiberId=e,this._fiberRefs=n,this._supervisor=this.getFiberRef(fa),this._scheduler=this.getFiberRef(Hr),js(r)){const s=this.getFiberRef(Ks);V0.unsafeUpdate(1,s),oa.unsafeUpdate(1,s)}this._tracer=Jt(this.getFiberRef(pe),lo)}pipe(){return $(this,arguments)}id(){return this._fiberId}resume(e){this.tell(Me(e))}get status(){return this.ask((e,n)=>n)}get runtimeFlags(){return this.ask((e,n)=>cS(n)?e._runtimeFlags:n.runtimeFlags)}scope(){return pS(this)}get children(){return this.ask(e=>Array.from(e.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(pr)}fiberRefs(){return this.ask(e=>e.getFiberRefs())}ask(e){return N(()=>{const n=Mc(this._fiberId);return this.tell($r((r,s)=>{Cc(n,_(()=>e(r,s)))})),$s(n)})}tell(e){this._queue.push(e),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return ze(e=>{const n=r=>e(k(r));return this.tell($r((r,s)=>{r._exitValue!==null?n(this._exitValue):r.addObserver(n)})),_(()=>this.tell($r((r,s)=>{r.removeObserver(n)})))},this.id())}get inheritAll(){return rt((e,n)=>{const r=e.id(),s=e.getFiberRefs(),o=n.runtimeFlags,c=this.getFiberRefs(),i=Z_(s,r,c);e.setFiberRefs(i);const a=e.getFiberRef(la),h=l(De(o,a),vi(en),vi(io));return ho(h)})}get poll(){return _(()=>Qe(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(e){return _(()=>this.tell(ta(Ft(e))))}addObserver(e){this._exitValue!==null?e(this._exitValue):this._observers.push(e)}removeObserver(e){this._observers=this._observers.filter(n=>n!==e)}getFiberRefs(){return this.setFiberRef(la,this._runtimeFlags),this._fiberRefs}unsafeDeleteFiberRef(e){this._fiberRefs=Hl(this._fiberRefs,e)}getFiberRef(e){return this._fiberRefs.locals.has(e)?this._fiberRefs.locals.get(e)[0][1]:e.initial}setFiberRef(e,n){this._fiberRefs=Wr(this._fiberRefs,{fiberId:this._fiberId,fiberRef:e,value:n}),this.refreshRefCache()}refreshRefCache(){this._tracer=Jt(this.getFiberRef(pe),lo),this._supervisor=this.getFiberRef(fa),this._scheduler=this.getFiberRef(Hr)}setFiberRefs(e){this._fiberRefs=e,this.refreshRefCache()}addChild(e){this.getChildren().add(e)}removeChild(e){this.getChildren().delete(e)}drainQueueOnCurrentThread(){let e=!0;for(;e;){let n=dn;const r=globalThis[ce];globalThis[ce]=this;try{for(;n===dn;)n=this._queue.length===0?Q0:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[ce]=r}this._queue.length>0&&!this._running?(this._running=!0,n===ca?(this.drainQueueLaterOnExecutor(),e=!1):e=!0):e=!1}}drainQueueLaterOnExecutor(){this._scheduler.scheduleTask(this.run,this.getFiberRef(ws))}drainQueueWhileRunning(e,n){let r=n;for(;this._queue.length>0;){const s=this._queue.splice(0,1)[0];r=Z0[s._tag](this,e,r,s)}return r}isInterrupted(){return!im(this.getFiberRef(pr))}addInterruptedCause(e){const n=this.getFiberRef(pr);this.setFiberRef(pr,tt(n,e))}processNewInterruptSignal(e){this.addInterruptedCause(e),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let e=!1;for(const n of this._children)n.tell(ta(Ft(this.id()))),e=!0;return e}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const e=this._children.values();this._children=null;let n=!1;return Dr({while:()=>!n,body:()=>{const s=e.next();return s.done?_(()=>{n=!0}):ut(s.value.await)},step:()=>{}})}return null}reportExitValue(e){if(js(this._runtimeFlags)){const n=this.getFiberRef(Ks);switch(oa.unsafeUpdate(-1,n),e._tag){case Q:{H0.unsafeUpdate(1,n);break}case Y:{G0.unsafeUpdate(1,n);break}}}if(e._tag==="Failure"){const n=this.getFiberRef(py);!ds(e.cause)&&n._tag==="Some"&&this.log("Fiber terminated with a non handled error",e.cause,n)}}setExitValue(e){if(this._exitValue=e,js(this._runtimeFlags)){const n=this.getFiberRef(Ks),r=this.id().startTimeMillis,s=new Date().getTime();Y0.unsafeUpdate(s-r,n)}this.reportExitValue(e);for(let n=this._observers.length-1;n>=0;n--)this._observers[n](e)}getLoggers(){return this.getFiberRef(ov)}log(e,n,r){const s=P(r)?r.value:this.getFiberRef(uy),o=this.getFiberRef(ev);if(fb(o,s))return;const c=this.getFiberRef(ly),i=this.getFiberRef(ay),a=this.getLoggers(),h=this.getFiberRefs();if(pc(a)>0){const d=Jt(this.getFiberRef(pe),Es),p=new Date(d.unsafeCurrentTimeMillis());for(const m of a)m.log({fiberId:this.id(),logLevel:s,message:e,cause:n,context:h,spans:c,annotations:i,date:p})}}evaluateMessageWhileSuspended(e){switch(e._tag){case zc:return ca;case Kc:return this.processNewInterruptSignal(e.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(D(e.cause)),this._asyncInterruptor=null),dn;case Bc:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(e.effect),dn;case Uc:return e.onFiber(this,this._exitValue!==null?sS:oS(this._runtimeFlags,this._asyncBlockingOn)),dn;default:return mn(e)}}evaluateEffect(e){this._supervisor.onResume(this);try{let n=Ut(this._runtimeFlags)&&this.isInterrupted()?D(this.getInterruptedCause()):e;for(;n!==null;)try{const r=n,s=this.runLoop(r);this._runtimeFlags=l(this._runtimeFlags,Kd(io));const o=this.interruptAllChildren();o!==null?n=g(o,()=>s):(this._queue.length===0?this.setExitValue(s):this.tell(Me(s)),n=null)}catch(r){if(Xt(r))r._op===Sr?qd(this._runtimeFlags)?(this.tell(lS()),this.tell(Me(Wt)),n=null):n=Wt:r._op===_r&&(n=null);else throw r}}finally{this._supervisor.onSuspend(this)}}start(e){if(this._running)this.tell(Me(e));else{this._running=!0;const n=globalThis[ce];globalThis[ce]=this;try{this.evaluateEffect(e)}finally{this._running=!1,globalThis[ce]=n,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(e){this.tell(Me(e))}patchRuntimeFlags(e,n){const r=ao(e,n);return globalThis[ce]=this,this._runtimeFlags=r,r}initiateAsync(e,n){let r=!1;const s=o=>{r||(r=!0,this.tell(Me(o)))};Ut(e)&&(this._asyncInterruptor=s);try{n(s)}catch(o){s(j(ct(o)))}}pushStack(e){this._stack.push(e),e._op==="OnStep"&&this._steps.push(!0),e._op==="RevertFlags"&&this._steps.push(!1)}popStack(){const e=this._stack.pop();if(e)return(e._op==="OnStep"||e._op==="RevertFlags")&&this._steps.pop(),e}getNextSuccessCont(){let e=this.popStack();for(;e;){if(e._op!==br)return e;e=this.popStack()}}getNextFailCont(){let e=this.popStack();for(;e;){if(e._op!==Or&&e._op!==Mr)return e;e=this.popStack()}}[(O$=mS,F$=bS,Th)](e){return C(vs(ee),n=>{try{return sc(n,e)}catch(r){throw console.log(r),r}})}Left(e){return V(e.left)}None(e){return V(Xu())}Right(e){return et(e.right)}Some(e){return et(e.value)}[Ea](e){const n=e.i0(),r=this.getNextSuccessCont();if(r!==void 0)return r._op in dr||mn(r),dr[r._op](this,r,n);throw et(n)}[Q](e){const n=e,r=this.getNextSuccessCont();if(r!==void 0)return r._op in dr||mn(r),dr[r._op](this,r,n.i0);throw n}[Y](e){const n=e.i0,r=this.getNextFailCont();if(r!==void 0)switch(r._op){case br:case Fr:return Ut(this._runtimeFlags)&&this.isInterrupted()?D(Pr(n)):r.i1(n);case"OnStep":return Ut(this._runtimeFlags)&&this.isInterrupted()?D(Pr(n)):r.i1(D(n));case Zo:return this.patchRuntimeFlags(this._runtimeFlags,r.patch),Ut(this._runtimeFlags)&&this.isInterrupted()?D(tt(n,this.getInterruptedCause())):D(n);default:mn(r)}else throw D(n)}[Ia](e){return e.i0(this,mf(this._runtimeFlags))}Blocked(e){if(this._steps[this._steps.length-1]){const n=this.popStack();if(n)switch(n._op){case"OnStep":return n.i1(e);case"OnSuccess":return ot(e.i0,g(e.i1,n.i1));case"OnSuccessAndFailure":return ot(e.i0,X(e.i1,{onFailure:n.i1,onSuccess:n.i2}));case"OnFailure":return ot(e.i0,sl(e.i1,n.i1));case"While":return ot(e.i0,g(e.i1,r=>(n.i2(r),n.i0()?Dr({while:n.i0,body:n.i1,step:n.i2}):A)));case"RevertFlags":{this.pushStack(n);break}}}return wt(n=>g(Er(Lm(e.i0)),()=>n(e.i1)))}RunBlocked(e){return tv(e.i0)}[Ye](e){const n=e.i0,r=this._runtimeFlags,s=ao(r,n);if(Ut(s)&&this.isInterrupted())return D(this.getInterruptedCause());if(this.patchRuntimeFlags(this._runtimeFlags,n),e.i1){const o=De(s,r);return this.pushStack(new xm(o,e)),e.i1(r)}else return Wt}[Or](e){return this.pushStack(e),e.i0}OnStep(e){return this.pushStack(e),e.i0}[br](e){return this.pushStack(e),e.i0}[Fr](e){return this.pushStack(e),e.i0}[_r](e){throw this._asyncBlockingOn=e.i1,this.initiateAsync(this._runtimeFlags,e.i0),e}[Sr](e){throw this.isYielding=!1,e}[Mr](e){const n=e.i0,r=e.i1;return n()?(this.pushStack(e),r()):Wt}[ka](e){return e.commit()}runLoop(e){let n=e;for(this.currentOpCount=0;;){if(this._runtimeFlags&jd&&this._supervisor.onEffect(this,n),this._queue.length>0&&(n=this.drainQueueWhileRunning(this._runtimeFlags,n)),!this.isYielding){this.currentOpCount+=1;const r=this._scheduler.shouldYield(this);if(r!==!1){this.isYielding=!0,this.currentOpCount=0;const s=n;n=g(Xn({priority:r}),()=>s)}}try{(!("_op"in n)||!(n._op in this))&&(console.log(n),mn(n)),n=this._tracer.context(()=>Ir!==n[Gi]._V?cl(`Cannot execute an Effect versioned ${n[Gi]._V} with a Runtime of version ${Ir}`):this[n._op](n),this)}catch(r){if(Xt(r)){if(r._op===Sr||r._op===_r)throw r;if(r._op===Q||r._op===Y)return r}else Am(r)?n=D(r.cause):km(r)?n=D(tt(ct(r),Ft(Un))):n=D(ct(r))}}}}const ev=L("effect/FiberRef/currentMinimumLogLevel",()=>gt(hb("Info"))),nv=t=>{const e=eb(t,pe);return Jt(e,zl).unsafe},rv=L(Symbol.for("effect/Logger/defaultLogger"),()=>Wc(t=>{const e=ES.log(t);nv(t.context).log(e)})),sv=L(Symbol.for("effect/Logger/tracerLogger"),()=>Wc(({annotations:t,cause:e,context:n,fiberId:r,logLevel:s,message:o})=>{const c=za(wo(n,ee),Ze(el)),i=wn(wo(n,pe),h=>Jt(h,Es));if(c._tag==="None"||c.value._tag==="ExternalSpan"||i._tag==="None")return;const a=Object.fromEntries(Fu(t,h=>To(h)));a["effect.fiberId"]=Bp(r),a["effect.logLevel"]=s.label,e!==null&&e._tag!=="Empty"&&(a["effect.cause"]=ms(e)),c.value.event(String(o),i.value.unsafeCurrentTimeNanos(),a)})),ov=L(Symbol.for("effect/FiberRef/currentLoggers"),()=>ml(ls(rv,sv))),cv=u(t=>Xt(t[0]),(t,e)=>Ve(cn(t,n=>qf(r=>e(n,r))))),qf=t=>rt(e=>{const n=e.getFiberRefs(),r=e._runtimeFlags;return g(zf,s=>jr(s,o=>rt(c=>{const i=c.getFiberRefs(),a=c._runtimeFlags,h=Vr(i,n),d=De(a,r),p=Vr(n,i);return c.setFiberRefs(Yi(h,c.id(),n)),Yc(Hm(t(o),d),_(()=>{c.setFiberRefs(Yi(p,c.id(),c.getFiberRefs()))}))})))}),iv=t=>{if(Array.isArray(t)||Sa(t))return[t,w()];const e=Object.keys(t),n=e.length;return[e.map(r=>t[r]),S(r=>{const s={};for(let o=0;o<n;o++)s[e[o]]=r[o];return s})]},av=(t,e,n)=>{const r=[];for(const s of t)r.push(Nn(s));return g(He(r,U,{concurrency:n?.concurrency,batching:n?.batching}),s=>{const o=w(),c=s.length,i=new Array(c),a=new Array(c);let h=!1;for(let d=0;d<c;d++){const p=s[d];p._tag==="Left"?(i[d]=S(p.left),h=!0):(a[d]=p.right,i[d]=o)}return h?e._tag==="Some"?V(e.value(i)):V(i):n?.discard?A:e._tag==="Some"?k(e.value(a)):k(a)})},uv=(t,e,n)=>{const r=[];for(const s of t)r.push(Nn(s));return n?.discard?He(r,U,{concurrency:n?.concurrency,batching:n?.batching,discard:!0}):C(He(r,U,{concurrency:n?.concurrency,batching:n?.batching}),s=>e._tag==="Some"?e.value(s):s)},Kf=(t,e)=>{const[n,r]=iv(t);return e?.mode==="validate"?av(n,r,e):e?.mode==="either"?uv(n,r,e):r._tag==="Some"?C(He(n,U,e),r.value):He(n,U,e)},He=u(t=>Sa(t[0]),(t,e,n)=>rt(r=>{const s=n?.batching===!0||n?.batching==="inherit"&&r.getFiberRef(gy);return n?.discard?Zi(n.concurrency,()=>Re(Oo)(o=>s?Ko(t,(c,i)=>o(e(c,i))):Qn(t,(c,i)=>o(e(c,i)))),()=>Re(Fo)(o=>Ge(t,(c,i)=>o(e(c,i)),s)),o=>Re(Mo(o))(c=>Gc(t,o,(i,a)=>c(e(i,a)),s))):Zi(n?.concurrency,()=>Re(Oo)(o=>s?Uo(t,1,(c,i)=>o(e(c,i)),!0):Ot(t,(c,i)=>o(e(c,i)))),()=>Re(Fo)(o=>Hc(t,(c,i)=>o(e(c,i)),s)),o=>Re(Mo(o))(c=>Uo(t,o,(i,a)=>c(e(i,a)),s)))})),Hc=(t,e,n)=>N(()=>{const r=nt(t),s=new Array(r.length);return at(Ge(r,(c,i)=>g(e(c,i),a=>_(()=>s[i]=a)),n),k(s))}),Ko=(t,e)=>N(()=>{const n=nt(t),r=n.length;if(r===0)return A;if(r===1)return ut(e(n[0],0));const s=n.map(e),o=new Array,c=i=>i===s.length?N(()=>{if(o.length>0){const a=o.map(h=>h.i0).reduce(je);return ot(a,Ko(o.map(h=>h.i1),U))}return A}):Ic(s[i],a=>a._op==="Blocked"?(o.push(a),c(i+1)):a._op==="Failure"?N(()=>{if(o.length>0){const h=o.map(d=>d.i0).reduce(je);return ot(h,g(Ko(o.map(d=>d.i1),U),()=>a))}return A}):c(i+1));return c(0)}),Ge=(t,e,n)=>N(()=>{const r=nt(t),s=r.length;return s===0?A:s===1?ut(e(r[0],0)):wt(o=>{const c=Mc(Un);let i=0;const a=[],h=[],d=Wm(p=>Ot(r,(m,b)=>l(p(l(N(()=>o((n?We:mt)(e(m,b)))),g(v=>{switch(v._op){case"Failure":{if(a.length>0){const x=a.map(K=>K.i0).reduce(je),q=Ge(a,K=>K.i1,n);return ot(x,X(q,{onFailure:K=>at(zs(c,void 0),j(ht(K,v.cause))),onSuccess:()=>at(zs(c,void 0),j(v.cause))}))}return at(zs(c,void 0),j(v.cause))}default:{if(v._op==="Blocked"&&a.push(v),i+1===s)if(a.length>0){const x=a.map(K=>K.i0).reduce(je),q=Ge(a,K=>K.i1,n);return ks(c,ot(x,q))}else Cc(c,et(Wt));else i=i+1;return A}}}))),Rs,C(v=>(v.addObserver(()=>{h.push(v)}),v)))));return g(d,p=>X(o($s(c)),{onFailure:m=>g(Hc(p,Zn,n),b=>{const v=wr(b,{parallel:!0});return v._tag==="Some"&&_y(v.value)?j(ht(Pr(m),v.value.i0)):j(Pr(m))}),onSuccess:m=>g(m,()=>Qn(h,b=>b.inheritAll))}))})}),Uo=(t,e,n,r)=>N(()=>{const s=nt(t),o=new Array(s.length);return at(Gc(s,e,(i,a)=>C(n(i,a),h=>o[a]=h),r),k(o))}),Gc=(t,e,n,r)=>N(()=>{let s=0;const o=t[Symbol.iterator](),c=[],i=g(_(()=>o.next()),h=>h.done?A:g((r?We:mt)(ut(n(h.value,s++))),d=>{switch(d._op){case"Blocked":return c.push(d),i;case"Failure":return d;case"Success":return i}})),a=[];for(let h=0;h<e;h++)a.push(i);return g(mt(Ge(a,U,r)),h=>{if(c.length===0)return h;const d=c.map(m=>m.i0).reduce(je),p=Gc(c,e,m=>m.i1,r);return h._tag==="Failure"?ot(d,X(p,{onFailure:m=>D(ht(h.cause,m)),onSuccess:()=>h})):ot(d,p)})}),Er=t=>rt((e,n)=>k(Uf(t,e,n.runtimeFlags))),Rs=t=>lv(t,_f),Uf=(t,e,n,r=null)=>{const s=Bo(t,e,n,r);return s.resume(t),s},Bo=(t,e,n,r=null)=>{const s=Eu(),o=e.getFiberRefs(),c=Vl(o,s),i=new jf(s,c,n),a=Lc(c,ee),h=i._supervisor;return h.onStart(a,t,S(e),i),i.addObserver(p=>h.onEnd(p,i)),(r!==null?r:l(e.getFiberRef(po),At(()=>e.scope()))).add(n,i),i},lv=(t,e)=>rt((n,r)=>k(Uf(t,n,r.runtimeFlags,e))),fv=t=>{const e=Kn(t);if(!me(e))return Dm(()=>Qu("Received an empty collection of effects"));const n=ye(e),r=zt(e),s=o=>l(vS(o[1]),it(o[0]));return l(Rc(),g(o=>l(yb(r.length),g(c=>wt(i=>l(Er(Je(n)),g(a=>l(r,Ot(h=>Er(Je(h))),C(vt),C(h=>l(h,yt(a))),cn(h=>l(h,Ht(A,(d,p)=>l(d,at(l(SS(p),g(hv(h,p,o,c)),Er,ut)))))),g(h=>l(i(l(My(o),g(s))),fl(()=>l(h,Ht(A,(d,p)=>l(d,Ss(Zn(p))))))))))))))))},hv=(t,e,n,r)=>s=>Kr(s,{onFailure:o=>l(_b(r,c=>[c===0?l(Tc(n,o),ut):A,c-1]),Gn),onSuccess:o=>l(ks(n,[o,e]),g(c=>c?l(Kn(t),Ht(A,(i,a)=>a===e?i:l(i,Ss(Zn(a))))):A))}),ia=t=>un(e=>te(Ze(e,Ie),{onNone:()=>t,onSome:n=>{switch(n.strategy._tag){case"Parallel":return t;case"Sequential":case"ParallelN":return g(Oc(n,Fo),r=>ur(t,r))}}})),aa=t=>e=>un(n=>te(Ze(n,Ie),{onNone:()=>e,onSome:r=>r.strategy._tag==="ParallelN"&&r.strategy.parallelism===t?e:g(Oc(r,Mo(t)),s=>ur(e,s))})),Re=t=>e=>un(n=>te(Ze(n,Ie),{onNone:()=>e(U),onSome:r=>{const s=t._tag==="Parallel"?ia:t._tag==="Sequential"?ua:aa(t.parallelism);switch(r.strategy._tag){case"Parallel":return s(e(ia));case"Sequential":return s(e(ua));case"ParallelN":return s(e(aa(r.strategy.parallelism)))}}})),Bf=t=>g(Ie,t),gv=t=>g(Ts(),e=>_v(e)(t)),ua=t=>un(e=>te(Ze(e,Ie),{onNone:()=>t,onSome:n=>{switch(n.strategy._tag){case"Sequential":return t;case"Parallel":case"ParallelN":return g(Oc(n,Oo),r=>ur(t,r))}}})),pv=u(t=>Xt(t[1]),(t,e,n)=>ar(t,e,(r,s)=>[r,s],n)),dv=u(t=>Xt(t[1]),(t,e,n)=>ar(t,e,(r,s)=>r,n)),mv=u(t=>Xt(t[1]),(t,e,n)=>ar(t,e,(r,s)=>s,n)),ar=u(t=>Xt(t[1]),(t,e,n,r)=>C(Kf([t,e],{concurrency:r?.concurrent?2:1,batching:r?.batching}),([s,o])=>n(s,o))),yv=(t,e)=>n=>N(()=>{switch(n.state._tag){case"Exited":return A;case"Running":{const r=n.state.finalizers,s=n.state.update,o=Array.from(r.keys()).sort((c,i)=>i-c).map(c=>r.get(c));return n.state={_tag:"Exited",nextKey:n.state.nextKey,exit:e,update:s},Gb(t)?l(o,Ot(c=>mt(s(c)(e))),g(c=>l(wr(c),wn(Us),At(()=>Wt)))):Yb(t)?l(Hc(o,c=>mt(s(c)(e)),!1),g(c=>l(wr(c,{parallel:!0}),wn(Us),At(()=>Wt)))):l(Uo(o,t.parallelism,c=>mt(s(c)(e)),!1),g(c=>l(wr(c,{parallel:!0}),wn(Us),At(()=>Wt))))}}}),Ie=St(mo),zf=Ie,Ts=(t=jc)=>C(yy,e=>({[mo]:mo,[Ai]:Ai,strategy:t,pipe(){return $(this,arguments)},fork:n=>Ve(l(Ts(n),g(r=>l(Pi(e,s=>qr(r,s)),cn(s=>jr(r,s)),it(r))))),close:n=>ut(yv(t,n)(e)),addFinalizer:n=>ut(Pi(n)(e))})),ur=u(2,(t,e)=>Sl(t,rs(ns(Ie,e)))),_v=u(2,(t,e)=>l(t,ur(e),Pn(n=>e.close(n)))),bv=t=>er(t,{differ:J0,fork:kn}),la=cy(Ud),fa=bv(Ms),Wf=u(3,(t,e,n)=>Sv(t,e,{onSelfWin:(r,s)=>g(r.await,o=>{switch(o._tag){case Q:return g(r.inheritAll,()=>n.onSelfDone(o,s));case Y:return n.onSelfDone(o,s)}}),onOtherWin:(r,s)=>g(r.await,o=>{switch(o._tag){case Q:return g(r.inheritAll,()=>n.onOtherDone(o,s));case Y:return n.onOtherDone(o,s)}})})),Jf=u(2,(t,e)=>bs(n=>Wf(t,e,{onSelfDone:(r,s)=>Kr(r,{onFailure:o=>l(ea(s),Hi(c=>ht(o,c))),onSuccess:o=>l(s,go(n),it(o))}),onOtherDone:(r,s)=>Kr(r,{onFailure:o=>l(ea(s),Hi(c=>ht(c,o))),onSuccess:o=>l(s,go(n),it(o))})}))),Sv=u(3,(t,e,n)=>rt((r,s)=>{const o=s.runtimeFlags,c=tn(!0),i=Bo(t,r,o,n.selfScope),a=Bo(e,r,o,n.otherScope);return ze(h=>{i.addObserver(()=>ha(i,a,n.onSelfWin,c,h)),a.addObserver(()=>ha(a,i,n.onOtherWin,c,h)),i.startFork(t),a.startFork(e)},Up(i.id(),a.id()))})),ha=(t,e,n,r,s)=>{Tp(!0,!1)(r)&&s(n(t,e))},Yc=u(2,(t,e)=>wt(n=>X(n(t),{onFailure:r=>X(e,{onFailure:s=>j(tt(r,s)),onSuccess:()=>j(r)}),onSuccess:r=>it(e,r)}))),vv=(t,e)=>bs(n=>g(g(Rs(Je(t)),r=>ze(s=>{const o=e.map(a=>a.listeners.count),c=()=>{o.every(a=>a===0)&&(i.forEach(a=>a()),s(Zn(r)))};r.addObserver(a=>{i.forEach(h=>h()),s(a)});const i=e.map((a,h)=>{const d=p=>{o[h]=p,c()};return a.listeners.addObserver(d),()=>a.listeners.removeObserver(d)});return c(),_(()=>{i.forEach(a=>a())})})),()=>N(()=>{const r=e.flatMap(s=>s.state.completed?[]:[s]);return Qn(r,s=>D0(s.request,wy(n)))}))),ok=we,ck=ct,ik=Ft,ak=cm,uk=am,lk=ds,wv=Gu,fk=hm,hk=mm,gk=Qu,$v=u(2,(t,e)=>Qc(t,n=>_(()=>e(n)))),Qc=u(2,(t,e)=>g(t,n=>g(e(n),r=>r?k(n):g(Xn(),()=>Qc(t,e))))),kv=u(2,(t,e)=>Ev(t,n=>_(()=>e(n)))),Ev=u(2,(t,e)=>Qc(t,n=>Pb(e(n)))),Iv=u(2,(t,e)=>Vf(t,e)),Vf=(t,e)=>Lr(t,n=>e<0?V(n):g(Xn(),()=>Vf(t,e-1)));class Ov{constructor(e){f(this,"permits");f(this,"waiters",new Array);f(this,"taken",0);f(this,"take",e=>$c(n=>{if(this.free<e){const r=()=>{if(this.free>=e){const s=this.waiters.findIndex(o=>o===r);s!==-1&&this.waiters.splice(s,1),this.taken+=e,n(k(e))}};return this.waiters.push(r),Mt(_(()=>{const s=this.waiters.findIndex(o=>o===r);s!==-1&&this.waiters.splice(s,1)}))}return this.taken+=e,dt(k(e))}));f(this,"release",e=>rt(n=>(this.taken-=e,n.getFiberRef(Hr).scheduleTask(()=>{this.waiters.forEach(r=>r())},n.getFiberRef(ws)),A)));f(this,"withPermits",e=>n=>wt(r=>g(r(this.take(e)),s=>Yc(r(n),this.release(s)))));this.permits=e}get free(){return this.permits-this.taken}}const Hf=t=>new Ov(t),Fv=t=>_(()=>Hf(t)),Mv=u(2,(t,e)=>wt(n=>g(e.fork(jc),r=>l(n(t),Pn(s=>r.close(s)),Rs,cn(s=>r.addFinalizer(()=>bs(o=>F(o,s.id())?A:ut(Zn(s))))))))),Rv=t=>Bf(e=>Mv(t,e)),Tv=u(2,(t,e)=>l(mt(t),Jf(mt(e)),n=>Gn(n))),Cv="effect/Ref/SynchronizedRef",Nv=Symbol.for(Cv),Av={_A:t=>t};var M$,R$;class Pv{constructor(e,n){f(this,"ref");f(this,"withLock");f(this,M$,Av);f(this,R$,Ql);this.ref=e,this.withLock=n}modify(e){return this.modifyEffect(n=>k(e(n)))}modifyEffect(e){return this.withLock(l(g(Jr(this.ref),e),g(([n,r])=>it(xc(this.ref,r),n))))}pipe(){return $(this,arguments)}}M$=Nv,R$=Yl;const Lv=t=>_(()=>xv(t)),xv=t=>{const e=Xl(t),n=Hf(1);return new Pv(e,n.withPermits(1))},Dv="Fold",jv="Fresh",qv="FromEffect",Kv="Suspend",Uv="ProvideTo",Bv="ZipWith",zv=t=>(e,n)=>{const r=Eu(),s=e;let o=Ji(t.fiberRefs,{fiberId:r,fiberRef:ee,value:t.context});n?.scheduler&&(o=Ji(o,{fiberId:r,fiberRef:Hr,value:n.scheduler})),n?.updateRefs&&(o=n.updateRefs(o,r));const c=new jf(r,tb(o,r),t.runtimeFlags),i=c._supervisor;return i!==Ms&&(i.onStart(t.context,s,w(),c),c.addObserver(a=>i.onEnd(a,c))),_f.add(t.runtimeFlags,c),c.start(s),c},ga=Symbol.for("effect/Runtime/FiberFailure"),Wv=Symbol.for("effect/Runtime/FiberFailure/Cause"),Jv=t=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new Error;Error.stackTraceLimit=e;const r=Zu(t);if(r.length>0){const s=r[0];n.name=s.message.split(":")[0],n.message=s.message.substring(n.name.length+2),n.stack=ms(t)}return n[ga]=ga,n[Wv]=t,n.toJSON=()=>({_id:"FiberFailure",cause:t.toJSON()}),n.toString=()=>G(n.toJSON()),n[J]=()=>n.toJSON(),n},Vv=t=>{const e=t;switch(e._op){case"Failure":case"Success":return e;case"Left":return Li(e.left);case"Right":return et(e.right);case"Some":return et(e.value);case"None":return Li(Xu())}},Hv=t=>e=>Gv(t)(e).then(n=>{switch(n._tag){case Q:return n.i0;case Y:throw Jv(n.i0)}}),Gv=t=>e=>new Promise(n=>{const r=Vv(e);r&&n(r),zv(t)(e).addObserver(s=>{n(s)})});class Yv{constructor(e,n,r){f(this,"context");f(this,"runtimeFlags");f(this,"fiberRefs");this.context=e,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return $(this,arguments)}}const Qv=t=>new Yv(t.context,t.runtimeFlags,t.fiberRefs),Xv=qu(en,Du,xu),vn=Qv({context:es(),runtimeFlags:Xv,fiberRefs:nb()}),Zv=Hv(vn),t1=u(2,(t,e)=>t.modifyEffect(e)),e1="effect/Layer",Gf=Symbol.for(e1),n1={_RIn:t=>t,_E:t=>t,_ROut:t=>t},Dn={[Gf]:n1,pipe(){return $(this,arguments)}},r1=t=>M(t,Gf),s1=t=>t._tag===jv;class o1{constructor(e){f(this,"ref");this.ref=e}getOrElseMemoize(e,n){return l(t1(this.ref,r=>{const s=r.get(e);if(s!==void 0){const[o,c]=s,i=l(o,g(([a,h])=>l(Io(a),it(h))),Pn(_l({onFailure:()=>A,onSuccess:()=>jr(n,c)})));return k([i,r])}return l($o(0),g(o=>l(Rc(),g(c=>l($o(()=>A),C(i=>{const a=wt(d=>l(Ts(),g(p=>l(d(g(Qf(e,p),m=>Eb(m(this)))),mt,g(m=>{switch(m._tag){case Y:return l(Tc(c,m.i0),at(qr(p,m)),at(j(m.i0)));case Q:return l(xc(i,b=>l(qr(p,b),Vm(Zl(o,v=>[v===1,v-1])),ut)),at(ko(o,b=>b+1)),at(jr(n,b=>l(Jr(i),g(v=>v(b))))),at(ks(c,m.i0)),it(m.i0[1]))}}))))),h=[l($s(c),Pn(Kr({onFailure:()=>A,onSuccess:()=>ko(o,d=>d+1)}))),d=>l(Jr(i),g(p=>p(d)))];return[a,s1(e)?r:r.set(e,h)]}))))))}),Gn)}}const c1=()=>C(Lv(new Map),t=>new o1(t)),Yf=u(2,(t,e)=>g(c1(),n=>g(Qf(t,e),r=>r(n)))),Qf=(t,e)=>{const n=t;switch(n._tag){case"Locally":return _(()=>r=>n.f(r.getOrElseMemoize(n.self,e)));case"ExtendScope":return _(()=>r=>Bf(s=>r.getOrElseMemoize(n.layer,s)));case"Fold":return _(()=>r=>l(r.getOrElseMemoize(n.layer,e),X({onFailure:s=>r.getOrElseMemoize(n.failureK(s),e),onSuccess:s=>r.getOrElseMemoize(n.successK(s),e)})));case"Fresh":return _(()=>r=>l(n.layer,Yf(e)));case"FromEffect":return _(()=>r=>n.effect);case"ProvideTo":return _(()=>r=>l(r.getOrElseMemoize(n.first,e),g(s=>l(r.getOrElseMemoize(n.second,e),Nc(s)))));case"Scoped":return _(()=>r=>ur(n.effect,e));case"Suspend":return _(()=>r=>r.getOrElseMemoize(n.evaluate(),e));case"ZipWith":return _(()=>r=>l(r.getOrElseMemoize(n.first,e),Gm(r.getOrElseMemoize(n.second,e),n.zipK)));case"ZipWithPar":return _(()=>r=>l(r.getOrElseMemoize(n.first,e),ar(r.getOrElseMemoize(n.second,e),n.zipK,{concurrent:!0})))}},i1=u(2,(t,e)=>h1(t,{onFailure:e,onSuccess:d1})),a1=()=>fn(bl()),u1=t=>fn(j(t)),l1=u(2,(t,e)=>{const n=rc(t),r=n?t:e;return fn(C(n?e:t,o=>ns(r,o)))});function fn(t){const e=Object.create(Dn);return e._tag=qv,e.effect=t,e}const f1=u(2,(t,{onFailure:e,onSuccess:n})=>{const r=Object.create(Dn);return r._tag=Dv,r.layer=t,r.failureK=e,r.successK=n,r}),h1=u(2,(t,{onFailure:e,onSuccess:n})=>f1(t,{onFailure:r=>{const s=wv(r);switch(s._tag){case"Left":return e(s.left);case"Right":return u1(s.right)}},onSuccess:n})),g1=u(2,(t,e)=>m1(()=>{const n=Object.create(Dn);return n._tag=Uv,n.first=Object.create(Dn,{_tag:{value:Bv,enumerable:!0},first:{value:a1(),enumerable:!0},second:{value:t},zipK:{value:(r,s)=>rs(r,s)}}),n.second=e,n})),p1=u(2,(t,e)=>{const n=rc(t);return fn(k(ns(n?t:e,n?e:t)))}),d1=t=>fn(k(t)),m1=t=>{const e=Object.create(Dn);return e._tag=Kv,e.evaluate=t,e},y1=u(2,(t,e)=>i1(t,n=>fn(g(e(n),()=>V(n))))),_1=u(2,(t,e)=>Hn(Ts(),n=>g(Yf(e,n),r=>Ac(t,r)),(n,r)=>qr(n,r))),b1=u(2,(t,e)=>{const n=De(vn.runtimeFlags,e.runtimeFlags),r=De(e.runtimeFlags,vn.runtimeFlags),s=Vr(vn.fiberRefs,e.fiberRefs),o=Vr(e.fiberRefs,vn.fiberRefs);return Hn(g(ho(n),()=>Io(s)),()=>Ac(t,e.context),()=>g(ho(r),()=>Io(o)))}),S1=u(2,(t,e)=>r1(e)?_1(t,e):nu(e)?Ac(t,e):b1(t,e)),pk=Xt,fe=Kf,zo=He,dk=Db,mk=V,yk=j,_k=kc,bk=cl,Sk=Mb,vk=k,yn=N,E=_,Wo=A,wk=Lr,$k=sl,kk=$b,Ek=Tb,Ik=Iv,Ok=Ub,Fk=jm,Mk=Je,Rk=Ve,Tk=wt,lr=it,Ck=ut,Xc=C,Xf=An,Nk=cv,v1=Hn,Ak=qf,Pk=Yc,Lk=zf,w1=gv,xk=bs,Dk=Rs,jk=Rv,$1=kb,qk=qb,Jo=S1,Zf=Lb,k1=zb,Kk=mt,Uk=qm,Bk=Wb,Zt=g,zk=Gn,Wk=fv,Jk=Jf,Vk=Tv,Hk=Wf,E1=cn,Gk=jb,Yk=Ib,Qk=Ab,Xk=$v,Zk=kv,tE=uf,eE=ul,nE=X,I1=Cb,rE=Nb,sE=Bm,O1=Um,oE=xb,cE=Fv,iE=Zv,F1=pv,th=dv,Ct=mv,aE=ar,fr=l1,M1=g1,R1=p1,T1=y1,C1=t=>t.length===0,N1=(t,e,n,r)=>({_tag:"Hsla",h:t,s:e,l:n,a:r}),eh=(t,e,n)=>N1(t,e,n,1),uE=eh(0,0,0),lE=eh(360,1,1),mr=t=>{switch(t._tag){case"Hex":return t.value;case"Hsla":{const{h:e,s:n,l:r,a:s}=t,o=d=>Math.round(d*100)/100,c=o(e),i=o(n*100)+"%",a=o(r*100)+"%",h=String(s);return s===1?`hsl(${c}, ${i}, ${a})`:`hsla(${c}, ${i}, ${a}, ${h})`}}},{Tag:nh}=jg;nh();class Zc{constructor(e){this.message=e,this._tag="CanvasError"}}const re=nh(),A1=O(t=>E(()=>t.canvas.width)),P1=O(t=>E(()=>t.canvas.height)),fE=fe({width:A1,height:P1});O(t=>E(()=>t.canvas.toDataURL()));const pa=t=>se(e=>{e.fillStyle=t});se(t=>t.fillStyle);O(t=>E(()=>t.font));function L1(t){return O(e=>l(E(()=>e.font=t),lr(e)))}O(t=>E(()=>t.globalAlpha));O(t=>E(()=>t.globalCompositeOperation));O(t=>E(()=>t.imageSmoothingEnabled));O(t=>E(()=>t.lineCap));O(t=>E(()=>t.lineDashOffset));O(t=>E(()=>t.lineJoin));function x1(t){return se(e=>{e.lineWidth=t})}O(t=>l(E(()=>t.lineWidth)));O(t=>E(()=>t.miterLimit));function D1(t){return se(e=>{e.strokeStyle=t})}se(t=>t.strokeStyle);function j1(t){return O(e=>l(E(()=>e.shadowBlur=t),lr(e)))}O(t=>E(()=>t.shadowBlur));function q1(t){return O(e=>E(()=>e.shadowColor=t))}O(t=>l(E(()=>t.shadowColor)));function K1(t){return O(e=>l(E(()=>e.shadowOffsetX=t),lr(e)))}O(t=>l(E(()=>t.shadowOffsetX)));function U1(t){return O(e=>l(E(()=>e.shadowOffsetY=t),lr(e)))}O(t=>l(E(()=>t.shadowOffsetY)));se(t=>t.textAlign);O(t=>E(()=>t.textBaseline));function B1(t,e,n,r,s,o=!1){return O(c=>l(E(()=>c.arc(t,e,n,r,s,o)),lr(c)))}const ti=se(t=>{t.beginPath()});function hE(t,e,n,r){return O(s=>E(()=>{s.clearRect(t,e,n,r)}))}function z1(t,e){return O(n=>E(()=>{typeof e<"u"?n.clip(e,t):typeof t<"u"?n.clip(t):n.clip()}))}const W1=O(t=>E(()=>{t.closePath()})),rh=(t,e,n)=>O(r=>E(()=>{r.drawImage(t,e,n)}));function J1(t,e,n,r,s,o,c,i=!1){return O(a=>E(()=>{a.ellipse(t,e,n,r,s,o,c,i)}))}const V1=(t,e)=>O(n=>E(()=>{typeof e<"u"?n.fill(e,t):typeof t<"u"?n.fill(t):n.fill()}));function gE(t,e,n,r){return O(s=>E(()=>{s.fillRect(t,e,n,r)}))}const H1=(t,e,n,r)=>O(s=>E(()=>{typeof r<"u"?s.fillText(t,e,n,r):s.fillText(t,e,n)}));function pE(t,e,n,r){return O(s=>E(()=>s.getImageData(t,e,n,r)))}O(t=>E(()=>t.getLineDash()));O(t=>E(()=>t.getTransform()));const G1=(t,e)=>se(n=>{n.lineTo(t,e)});function Y1(t,e){return O(n=>E(()=>{n.moveTo(t,e)}))}function Q1(t,e,n,r){return O(s=>E(()=>{s.rect(t,e,n,r)}))}const X1=O(t=>E(()=>{t.restore()})),Z1=t=>O(e=>E(()=>{e.rotate(t)})),tw=O(t=>E(()=>{t.save()})),ew=(t,e)=>O(n=>E(()=>{n.scale(t,e)}));function nw(t){return O(e=>E(()=>{typeof t<"u"?e.stroke(t):e.stroke()}))}const rw=(t,e)=>O(n=>E(()=>{n.translate(t,e)})),sw=t=>ti.pipe(Ct(t),th(V1())),ow=t=>ti.pipe(Ct(t),th(nw()));function se(t){return O(e=>E(()=>t(e)))}function Kt(t){return w1(v1(tw,e=>t,e=>X1))}function O(t){return re.pipe(Zt(t))}function dE(t){const e=typeof t=="string"?cw(t):t instanceof HTMLElement?aw(t):iw(t);return Jo(e.pipe(T1(()=>I1(`i got an error for ${t}`))))}function cw(t){return fr(re,uw(t))}function iw(t){return R1(re,t)}function aw(t){return fr(re,Zt(oh(t),sh))}function uw(t){return Zt(lw(t),sh)}function lw(t){return E(()=>document.getElementById(t)).pipe(Zt(Qe),Xf(()=>new Zc(`No such element with id ${t} exists`)),Zt(oh))}function sh(t){return E(()=>t.getContext("2d")).pipe(Zt(Qe),Xf(e=>new Zc(`${t.id} is not an instance of HTMLCanvasElement`)))}const oh=t=>t instanceof HTMLCanvasElement?dt(t):Mt(new Zc("element is not an instance of HTMLCanvasElement"));function fw(t,e){return function(n){if(Array.isArray(n))return n.reduce(e,t);let r=t;for(const s of n)r=e(r,s);return r}}function hw(t){return function(e){return Array.isArray(e)?e.map(t):function*(){for(const n of e)yield t(n)}()}}const gw=t=>e=>{const n=Object.keys(e);return t.imap(t.productAll(n.map(r=>e[r])),r=>{const s={};for(let o=0;o<r.length;o++)s[n[o]]=r[o];return s},r=>n.map(s=>r[s]))},$t=(t,e=(n,r)=>fw(n,t)(r))=>({combine:t,combineMany:e}),mE=t=>$t((e,n)=>t(e,n)===1?e:n),pw=t=>$t(()=>t,()=>t),dw=()=>$t(t=>t,t=>t),mw=u(3,(t,e,n)=>$t((r,s)=>e(t.combine(n(r),n(s))),(r,s)=>e(t.combineMany(n(r),hw(n)(s))))),yw=(t,e)=>$t(([n,r],[s,o])=>[t.combine(n,s),e.combine(r,o)]),ch=t=>$t((e,n)=>{const r=Math.min(e.length,n.length),s=[];let o=0;for(const c of t){if(o>=r)break;s.push(c.combine(e[o],n[o])),o++}return s}),_w=(t,e)=>{const n=ch(e);return $t((r,s)=>[t.combine(r[0],s[0]),...n.combine(r.slice(1),s.slice(1))])},bw=pw,Sw={of:bw,imap:mw,product:yw,productMany:_w,productAll:ch},vw=()=>$t((t,e)=>t.concat(e)),ww=gw(Sw),hr=(t,e)=>({combine:t.combine,combineMany:t.combineMany,empty:e,combineAll:n=>t.combineMany(e,n)}),ih=()=>hr(vw(),[]),Cs=t=>{const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n].empty);return hr(ww(t),e)},$w=t=>hr($t((e,n)=>B(e)?n:B(n)?e:S(t.combine(e.value,n.value))),w()),ah=St(),kw=fr(ah,re.pipe(Xc(Ow))),ei=St(),Ew=M1(kw,fr(ei,ah.pipe(Xc(Iw)))),yE=t=>k1(ei,e=>n=>n._tag!="Composite"?$1(t)(e(n)):e(n));function Iw(t){return function e(n){switch(n._tag){case"Arc":return t.arc(n.x,n.y,n.r,n.start,n.end,n.anticlockwise);case"Composite":return zo(n.shapes,r=>e(r),{concurrency:n.shapes.length});case"Ellipse":return t.ellipse(n.x,n.y,n.rx,n.ry,n.rotation,n.start,n.end,n.anticlockwise);case"Path":return l(n.points,og({onEmpty:()=>Wo,onNonEmpty:([r,...s])=>t.moveTo(r.x,r.y).pipe(Ct(zo(s,({x:o,y:c})=>t.lineTo(o,c))),Ct(n.closed?t.closePath:Wo))}));case"Rect":return t.rect(n.x,n.y,n.width,n.height)}}}function Ow(t){const e=Zf(re,t);return{moveTo:It(Y1,e),lineTo:It(G1,e),closePath:e(W1),ellipse:It(J1,e),rect:It(Q1,e),arc:It(B1,e),drawImage:It(rh,e)}}const Fw={show:t=>[t.style,t.variant,t.weight].filter(P).map(At(jn(""))).join(" ")},Mw=It(C1,tg),Rw={show:({fontFamily:t,size:e,fontOptions:n})=>[Fw.show(n),`${e}px`,t].filter(Mw).join(" ")},ni=St(),Tw=l(ei.pipe(F1(re),Xc(([t,e])=>Aw(t,e)),fr(ni)));function Cw(t){return ni.pipe(E1(e=>e(t)))}function Nw(t){return ni.pipe(Zt(e=>e(t)),Jo(Tw),Jo(Ew))}function Aw(t,e){const n=Zf(re,e);function r(o){return s(o).pipe(n)}return r;function s(o){switch(o._tag){case"Clipped":return fe([ti,t(o.shape),z1(),yn(()=>r(o.drawing))]).pipe(Kt);case"Fill":return fe([ie(o.style.color,c=>pa(mr(c))),sw(t(o.shape))],{discard:!0}).pipe(Kt);case"Many":return zo(o.drawings,s,{discard:!0});case"Outline":return fe([ie(o.style.color,It(mr,D1)),ie(o.style.lineWidth,x1),ow(t(o.shape))],{discard:!0}).pipe(Kt);case"Rotate":return Z1(o.angle).pipe(Ct(yn(()=>r(o.drawing))),Kt);case"Scale":return fe([ew(o.scaleX,o.scaleY).pipe(Ct(yn(()=>r(o.drawing))))]).pipe(Kt);case"Text":return fe([L1(Rw.show(o.font)),ie(o.style.color,It(mr,pa)),H1(o.text,o.x,o.y)]).pipe(Kt);case"Translate":return rw(o.translateX,o.translateY).pipe(Ct(yn(()=>r(o.drawing))),Kt);case"WithShadow":return fe([ie(o.shadow.color,It(mr,q1)),ie(o.shadow.blur,j1),ie(o.shadow.offset,({x:c,y:i})=>K1(c).pipe(Ct(U1(i))))],{discard:!0}).pipe(Ct(yn(()=>r(o.drawing))),Kt);case"Image":return rh(o.image,o.source.x,o.source.y)}}}const ie=(t,e)=>t.pipe(Zt(e),O1(()=>Wo)),yr=ih(),ri=()=>$w(dw()),si=ri(),uh=ri(),Pw=ri(),_E=t=>e=>({_tag:"Clipped",shape:t,drawing:e}),bE=(t,e)=>({_tag:"Fill",shape:t,style:e}),SE=t=>({color:S(t)}),vE=(t,e)=>({_tag:"Outline",shape:t,style:e}),wE=t=>({color:S(t),lineWidth:w()}),_n=t=>({_tag:"Many",drawings:t});function $E(t){return e=>({_tag:"Rotate",angle:t,drawing:e})}function kE(t,e){return n=>({_tag:"Scale",scaleX:t,scaleY:e,drawing:n})}const EE=(t,e,n)=>({_tag:"Image",image:t,source:e,dest:n});function IE(t,e){return n=>({_tag:"Translate",translateX:t,translateY:e,drawing:n})}function OE(t){return e=>({_tag:"WithShadow",shadow:t,drawing:e})}const FE=t=>({color:w(),blur:S(t),offset:w()}),ME=t=>({color:S(t),blur:w(),offset:w()}),RE=Nw,TE=Cw;Cs({color:si});Cs({color:si,lineWidth:uh});const CE=Cs({color:si,blur:uh,offset:Pw}),lh=hr($t((t,e)=>t._tag==="Many"&&e._tag==="Many"?_n(yr.combineAll([t.drawings,e.drawings])):t._tag==="Many"?_n(yr.combineAll([t.drawings,[e]])):e._tag==="Many"?_n(yr.combineAll([[t],e.drawings])):_n([t,e])),_n(yr.empty)),NE=lh.combineAll,AE=lh.combine,Lw={reduce:Ht},xw=ih,Dw=$t((t,e)=>t||e,(t,e)=>{if(t===!0)return!0;for(const n of e)if(n===!0)return!0;return!1}),jw=hr(Dw,!1),PE=t=>({_tag:"Degrees",degrees:t}),da=t=>({_tag:"Radians",radians:t}),ma=t=>{switch(t._tag){case"Degrees":return t.degrees*(Math.PI/180);case"Radians":return t.radians}},qw=(t,e)=>({x:t,y:e});function LE(t,e){return function(n){return n.x>t.x&&n.y>t.y&&n.x<e.y&&n.y<e.y}}const xE=(t,e,n)=>({_tag:"Arc",x:t,y:e,r:n,start:ma(da(0)),end:ma(da(Math.PI*2)),anticlockwise:!1});function Kw(t){return t.reduce(Uw.empty,(e,n)=>({_tag:"Path",closed:!0,points:Wa(n)(e.points)}))}const DE=(t,e,n,r)=>({_tag:"Rect",x:t,y:e,width:n,height:r}),jE=t=>l(sg(0,t-1),Ce(e=>l(e*Math.PI/(t/2),n=>qw(Math.sin(n),Math.cos(n)))),Kw(Lw)),Uw=Cs({_tag:{combineAll:()=>"Path",combineMany:()=>"Path",combine:()=>"Path",empty:"Path"},closed:jw,points:xw()});export{D$ as $,hE as A,Z1 as B,lE as C,l as D,$E as E,hr as F,mE as G,Xc as H,IE as I,fE as J,PE as K,oE as L,ma as M,eh as N,xn as O,K$ as P,qw as Q,E1 as R,zo as S,I1 as T,Rl as U,At as V,qk as W,LE as X,ft as Y,Wo as Z,zg as _,fe as a,vS as a$,mk as a0,wk as a1,Ik as a2,Vt as a3,vk as a4,xE as a5,AE as a6,kE as a7,uE as a8,St as a9,sw as aA,B1 as aB,x1 as aC,W$ as aD,_l as aE,_y as aF,wr as aG,J$ as aH,D as aI,et as aJ,Wt as aK,H$ as aL,Li as aM,Bs as aN,V$ as aO,G as aP,W as aQ,J as aR,$ as aS,u as aT,yt as aU,Pe as aV,qr as aW,ur as aX,Oc as aY,Ts as aZ,z$ as a_,fr as aa,re as ab,Zf as ac,It as ad,lr as ae,ti as af,nw as ag,M1 as ah,Y1 as ai,G1 as aj,Sk as ak,yb as al,nk as am,ek as an,sk as ao,pE as ap,Ok as aq,sE as ar,EE as as,ew as at,E as au,Rt as av,q$ as aw,za as ax,Qe as ay,tk as az,D1 as b,w1 as b$,Zn as b0,ea as b1,SS as b2,g as b3,_ as b4,C as b5,tn as b6,Rc as b7,A as b8,k as b9,Cc as bA,ok as bB,eg as bC,wv as bD,U as bE,M as bF,pk as bG,Ek as bH,aE as bI,Kk as bJ,nE as bK,yn as bL,Dk as bM,ck as bN,Pk as bO,Rk as bP,P as bQ,Tk as bR,Lk as bS,jk as bT,Ak as bU,My as bV,th as bW,Oo as bX,Y$ as bY,bk as bZ,$k as b_,N as ba,Lr as bb,jm as bc,qt as bd,w as be,S as bf,Ve as bg,rt as bh,ke as bi,ut as bj,Vm as bk,ks as bl,at as bm,Ge as bn,G$ as bo,$s as bp,nt as bq,En as br,N$ as bs,oc as bt,Mc as bu,fl as bv,Kn as bw,Nt as bx,Ec as by,P$ as bz,ow as c,_n as c$,v1 as c0,Uk as c1,Gk as c2,yk as c3,Z$ as c4,zk as c5,_b as c6,xk as c7,Fk as c8,Mt as c9,Xf as cA,tE as cB,au as cC,x$ as cD,gk as cE,_k as cF,dk as cG,vt as cH,j$ as cI,Qs as cJ,U$ as cK,Vg as cL,fk as cM,xs as cN,A$ as cO,kk as cP,lk as cQ,Ew as cR,yE as cS,Tw as cT,Qk as cU,TE as cV,rE as cW,OE as cX,CE as cY,ME as cZ,FE as c_,dt as ca,Q$ as cb,hk as cc,eE as cd,ik as ce,Nk as cf,Mk as cg,Hk as ch,ak as ci,F as cj,cE as ck,Ck as cl,Vk as cm,Yk as cn,ai as co,te as cp,Jk as cq,X$ as cr,Bk as cs,Zk as ct,Xk as cu,rk as cv,uk as cw,ii as cx,C$ as cy,L$ as cz,rw as d,jE as d0,lh as d1,sg as d2,Ce as d3,dg as d4,ec as d5,_E as d6,Wk as d7,NE as e,gE as f,bE as g,SE as h,DE as i,wE as j,N1 as k,Zt as l,Ct as m,dE as n,vE as o,Jo as p,iE as q,Q1 as r,pa as s,mr as t,se as u,$1 as v,Kt as w,Br as x,RE as y,F1 as z};
